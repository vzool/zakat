<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>zakat API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>
            <img src="https://raw.githubusercontent.com/vzool/zakat/main/images/logo.jpg" class="logo" alt="project logo"/>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#ZakatTracker">ZakatTracker</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ZakatTracker.__init__">ZakatTracker</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.Version">Version</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.ZakatCut">ZakatCut</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.TimeCycle">TimeCycle</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.Nisab">Nisab</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.ext">ext</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.path">path</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.base_path">base_path</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.scale">scale</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.unscale">unscale</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.reset">reset</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.minimum_time_diff_ns">minimum_time_diff_ns</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.time">time</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.time_to_datetime">time_to_datetime</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.clean_history">clean_history</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.nolock">nolock</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.lock">lock</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.steps">steps</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.free">free</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.recall">recall</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.vault">vault</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.stats_init">stats_init</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.stats">stats</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.files">files</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.account_exists">account_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.box_size">box_size</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.log_size">log_size</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.file_hash">file_hash</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.snapshot_cache_path">snapshot_cache_path</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.snapshot">snapshot</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.snapshots">snapshots</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.ref_exists">ref_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.box_exists">box_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.track">track</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.log_exists">log_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.exchange">exchange</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.exchange_calc">exchange_calc</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.exchanges">exchanges</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.accounts">accounts</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.boxes">boxes</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.logs">logs</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.daily_logs_init">daily_logs_init</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.daily_logs">daily_logs</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.add_file">add_file</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.remove_file">remove_file</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.balance">balance</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.hide">hide</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.zakatable">zakatable</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.sub">sub</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.transfer">transfer</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.check">check</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.build_payment_parts">build_payment_parts</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.check_payment_parts">check_payment_parts</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.zakat">zakat</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.export_json">export_json</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.save">save</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.load">load</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.import_csv_cache_path">import_csv_cache_path</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.import_csv">import_csv</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.human_readable_size">human_readable_size</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.get_dict_size">get_dict_size</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.duration_from_nanoseconds">duration_from_nanoseconds</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.day_to_time">day_to_time</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.generate_random_date">generate_random_date</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.generate_random_csv_file">generate_random_csv_file</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.create_random_list">create_random_list</a>
                        </li>
                        <li>
                                <a class="function" href="#ZakatTracker.test">test</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#test">test</a>
            </li>
            <li>
                    <a class="class" href="#Action">Action</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Action.CREATE">CREATE</a>
                        </li>
                        <li>
                                <a class="variable" href="#Action.TRACK">TRACK</a>
                        </li>
                        <li>
                                <a class="variable" href="#Action.LOG">LOG</a>
                        </li>
                        <li>
                                <a class="variable" href="#Action.SUB">SUB</a>
                        </li>
                        <li>
                                <a class="variable" href="#Action.ADD_FILE">ADD_FILE</a>
                        </li>
                        <li>
                                <a class="variable" href="#Action.REMOVE_FILE">REMOVE_FILE</a>
                        </li>
                        <li>
                                <a class="variable" href="#Action.BOX_TRANSFER">BOX_TRANSFER</a>
                        </li>
                        <li>
                                <a class="variable" href="#Action.EXCHANGE">EXCHANGE</a>
                        </li>
                        <li>
                                <a class="variable" href="#Action.REPORT">REPORT</a>
                        </li>
                        <li>
                                <a class="variable" href="#Action.ZAKAT">ZAKAT</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#JSONEncoder">JSONEncoder</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#JSONEncoder.default">default</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MathOperation">MathOperation</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#MathOperation.ADDITION">ADDITION</a>
                        </li>
                        <li>
                                <a class="variable" href="#MathOperation.EQUAL">EQUAL</a>
                        </li>
                        <li>
                                <a class="variable" href="#MathOperation.SUBTRACTION">SUBTRACTION</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#WeekDay">WeekDay</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#WeekDay.Monday">Monday</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeekDay.Tuesday">Tuesday</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeekDay.Wednesday">Wednesday</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeekDay.Thursday">Thursday</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeekDay.Friday">Friday</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeekDay.Saturday">Saturday</a>
                        </li>
                        <li>
                                <a class="variable" href="#WeekDay.Sunday">Sunday</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#start_file_server">start_file_server</a>
            </li>
            <li>
                    <a class="function" href="#find_available_port">find_available_port</a>
            </li>
            <li>
                    <a class="class" href="#FileType">FileType</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#FileType.Database">Database</a>
                        </li>
                        <li>
                                <a class="variable" href="#FileType.CSV">CSV</a>
                        </li>
                </ul>

            </li>
    </ul>


            <footer>zakat v0.2.98-2cf5fcd</footer>

        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
zakat    </h1>

                        <div class="docstring"><p>"رَبَّنَا افْتَحْ بَيْنَنَا وَبَيْنَ قَوْمِنَا بِالْحَقِّ وَأَنتَ خَيْرُ الْفَاتِحِينَ (89)" -- سورة الأعراف</p>

<pre><code> _____     _         _     _     _ _                          
|__  /__ _| | ____ _| |_  | |   (_) |__  _ __ __ _ _ __ _   _ 
  / // _` | |/ / _` | __| | |   | | '_ \| '__/ _` | '__| | | |
 / /| (_| |   &lt; (_| | |_  | |___| | |_) | | | (_| | |  | |_| |
/____\__,_|_|\_\__,_|\__| |_____|_|_.__/|_|  \__,_|_|   \__, |
... Never Trust, Always Verify ...                       |___/ 
</code></pre>

<p>This file provides the ZakatLibrary classes, functions for tracking and calculating Zakat.</p>
</div>

                        <input id="mod-zakat-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-zakat-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">&quot;رَبَّنَا افْتَحْ بَيْنَنَا وَبَيْنَ قَوْمِنَا بِالْحَقِّ وَأَنتَ خَيْرُ الْفَاتِحِينَ (89)&quot; -- سورة الأعراف</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="sd">```</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="sd"> _____     _         _     _     _ _                          </span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="sd">|__  /__ _| | ____ _| |_  | |   (_) |__  _ __ __ _ _ __ _   _ </span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="sd">  / // _` | |/ / _` | __| | |   | | &#39;_ \| &#39;__/ _` | &#39;__| | | |</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="sd"> / /| (_| |   &lt; (_| | |_  | |___| | |_) | | | (_| | |  | |_| |</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="sd">/____\__,_|_|\_\__,_|\__| |_____|_|_.__/|_|  \__,_|_|   \__, |</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="sd">... Never Trust, Always Verify ...                       |___/ </span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="sd">```</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="sd">This file provides the ZakatLibrary classes, functions for tracking and calculating Zakat.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a><span class="c1"># Importing necessary classes and functions from the main module</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">zakat.zakat_tracker</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="n">ZakatTracker</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="n">test</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="n">Action</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="n">JSONEncoder</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="n">MathOperation</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>    <span class="n">WeekDay</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a><span class="p">)</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">zakat.file_server</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>    <span class="n">start_file_server</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>    <span class="n">find_available_port</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>    <span class="n">FileType</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a><span class="p">)</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a><span class="c1"># Version information for the module</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">Version</span><span class="p">()</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>    <span class="s2">&quot;ZakatTracker&quot;</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>    <span class="s2">&quot;test&quot;</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a>    <span class="s2">&quot;Action&quot;</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>    <span class="s2">&quot;JSONEncoder&quot;</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a>    <span class="s2">&quot;MathOperation&quot;</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a>    <span class="s2">&quot;WeekDay&quot;</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a>    <span class="s2">&quot;start_file_server&quot;</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a>    <span class="s2">&quot;find_available_port&quot;</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">42</span></a>    <span class="s2">&quot;FileType&quot;</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">43</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="ZakatTracker">
                            <input id="ZakatTracker-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ZakatTracker</span>:

                <label class="view-source-button" for="ZakatTracker-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker-213"><a href="#ZakatTracker-213"><span class="linenos"> 213</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ZakatTracker</span><span class="p">:</span>
</span><span id="ZakatTracker-214"><a href="#ZakatTracker-214"><span class="linenos"> 214</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-215"><a href="#ZakatTracker-215"><span class="linenos"> 215</span></a><span class="sd">    A class for tracking and calculating Zakat.</span>
</span><span id="ZakatTracker-216"><a href="#ZakatTracker-216"><span class="linenos"> 216</span></a>
</span><span id="ZakatTracker-217"><a href="#ZakatTracker-217"><span class="linenos"> 217</span></a><span class="sd">    This class provides functionalities for recording transactions, calculating Zakat due,</span>
</span><span id="ZakatTracker-218"><a href="#ZakatTracker-218"><span class="linenos"> 218</span></a><span class="sd">    and managing account balances. It also offers features like importing transactions from</span>
</span><span id="ZakatTracker-219"><a href="#ZakatTracker-219"><span class="linenos"> 219</span></a><span class="sd">    CSV files, exporting data to JSON format, and saving/loading the tracker state.</span>
</span><span id="ZakatTracker-220"><a href="#ZakatTracker-220"><span class="linenos"> 220</span></a>
</span><span id="ZakatTracker-221"><a href="#ZakatTracker-221"><span class="linenos"> 221</span></a><span class="sd">    The `ZakatTracker` class is designed to handle both positive and negative transactions,</span>
</span><span id="ZakatTracker-222"><a href="#ZakatTracker-222"><span class="linenos"> 222</span></a><span class="sd">    allowing for flexible tracking of financial activities related to Zakat. It also supports</span>
</span><span id="ZakatTracker-223"><a href="#ZakatTracker-223"><span class="linenos"> 223</span></a><span class="sd">    the concept of a &quot;Nisab&quot; (minimum threshold for Zakat) and a &quot;haul&quot; (complete one year for Transaction) can calculate Zakat due</span>
</span><span id="ZakatTracker-224"><a href="#ZakatTracker-224"><span class="linenos"> 224</span></a><span class="sd">    based on the current silver price.</span>
</span><span id="ZakatTracker-225"><a href="#ZakatTracker-225"><span class="linenos"> 225</span></a>
</span><span id="ZakatTracker-226"><a href="#ZakatTracker-226"><span class="linenos"> 226</span></a><span class="sd">    The class uses a camel file as its database to persist the tracker state,</span>
</span><span id="ZakatTracker-227"><a href="#ZakatTracker-227"><span class="linenos"> 227</span></a><span class="sd">    ensuring data integrity across sessions. It also provides options for enabling or</span>
</span><span id="ZakatTracker-228"><a href="#ZakatTracker-228"><span class="linenos"> 228</span></a><span class="sd">    disabling history tracking, allowing users to choose their preferred level of detail.</span>
</span><span id="ZakatTracker-229"><a href="#ZakatTracker-229"><span class="linenos"> 229</span></a>
</span><span id="ZakatTracker-230"><a href="#ZakatTracker-230"><span class="linenos"> 230</span></a><span class="sd">    In addition, the `ZakatTracker` class includes various helper methods like</span>
</span><span id="ZakatTracker-231"><a href="#ZakatTracker-231"><span class="linenos"> 231</span></a><span class="sd">    `time`, `time_to_datetime`, `lock`, `free`, `recall`, `export_json`,</span>
</span><span id="ZakatTracker-232"><a href="#ZakatTracker-232"><span class="linenos"> 232</span></a><span class="sd">    and more. These methods provide additional functionalities and flexibility</span>
</span><span id="ZakatTracker-233"><a href="#ZakatTracker-233"><span class="linenos"> 233</span></a><span class="sd">    for interacting with and managing the Zakat tracker.</span>
</span><span id="ZakatTracker-234"><a href="#ZakatTracker-234"><span class="linenos"> 234</span></a>
</span><span id="ZakatTracker-235"><a href="#ZakatTracker-235"><span class="linenos"> 235</span></a><span class="sd">    Attributes:</span>
</span><span id="ZakatTracker-236"><a href="#ZakatTracker-236"><span class="linenos"> 236</span></a><span class="sd">        ZakatTracker.ZakatCut (function): A function to calculate the Zakat percentage.</span>
</span><span id="ZakatTracker-237"><a href="#ZakatTracker-237"><span class="linenos"> 237</span></a><span class="sd">        ZakatTracker.TimeCycle (function): A function to determine the time cycle for Zakat.</span>
</span><span id="ZakatTracker-238"><a href="#ZakatTracker-238"><span class="linenos"> 238</span></a><span class="sd">        ZakatTracker.Nisab (function): A function to calculate the Nisab based on the silver price.</span>
</span><span id="ZakatTracker-239"><a href="#ZakatTracker-239"><span class="linenos"> 239</span></a><span class="sd">        ZakatTracker.Version (function): The version of the ZakatTracker class.</span>
</span><span id="ZakatTracker-240"><a href="#ZakatTracker-240"><span class="linenos"> 240</span></a>
</span><span id="ZakatTracker-241"><a href="#ZakatTracker-241"><span class="linenos"> 241</span></a><span class="sd">    Data Structure:</span>
</span><span id="ZakatTracker-242"><a href="#ZakatTracker-242"><span class="linenos"> 242</span></a><span class="sd">        The ZakatTracker class utilizes a nested dictionary structure called &quot;_vault&quot; to store and manage data.</span>
</span><span id="ZakatTracker-243"><a href="#ZakatTracker-243"><span class="linenos"> 243</span></a>
</span><span id="ZakatTracker-244"><a href="#ZakatTracker-244"><span class="linenos"> 244</span></a><span class="sd">        _vault (dict):</span>
</span><span id="ZakatTracker-245"><a href="#ZakatTracker-245"><span class="linenos"> 245</span></a><span class="sd">            - account (dict):</span>
</span><span id="ZakatTracker-246"><a href="#ZakatTracker-246"><span class="linenos"> 246</span></a><span class="sd">                - {account_name} (dict):</span>
</span><span id="ZakatTracker-247"><a href="#ZakatTracker-247"><span class="linenos"> 247</span></a><span class="sd">                    - balance (int): The current balance of the account.</span>
</span><span id="ZakatTracker-248"><a href="#ZakatTracker-248"><span class="linenos"> 248</span></a><span class="sd">                    - box (dict): A dictionary storing transaction details.</span>
</span><span id="ZakatTracker-249"><a href="#ZakatTracker-249"><span class="linenos"> 249</span></a><span class="sd">                        - {timestamp} (dict):</span>
</span><span id="ZakatTracker-250"><a href="#ZakatTracker-250"><span class="linenos"> 250</span></a><span class="sd">                            - capital (int): The initial amount of the transaction.</span>
</span><span id="ZakatTracker-251"><a href="#ZakatTracker-251"><span class="linenos"> 251</span></a><span class="sd">                            - count (int): The number of times Zakat has been calculated for this transaction.</span>
</span><span id="ZakatTracker-252"><a href="#ZakatTracker-252"><span class="linenos"> 252</span></a><span class="sd">                            - last (int): The timestamp of the last Zakat calculation.</span>
</span><span id="ZakatTracker-253"><a href="#ZakatTracker-253"><span class="linenos"> 253</span></a><span class="sd">                            - rest (int): The remaining amount after Zakat deductions and withdrawal.</span>
</span><span id="ZakatTracker-254"><a href="#ZakatTracker-254"><span class="linenos"> 254</span></a><span class="sd">                            - total (int): The total Zakat deducted from this transaction.</span>
</span><span id="ZakatTracker-255"><a href="#ZakatTracker-255"><span class="linenos"> 255</span></a><span class="sd">                    - count (int): The total number of transactions for the account.</span>
</span><span id="ZakatTracker-256"><a href="#ZakatTracker-256"><span class="linenos"> 256</span></a><span class="sd">                    - log (dict): A dictionary storing transaction logs.</span>
</span><span id="ZakatTracker-257"><a href="#ZakatTracker-257"><span class="linenos"> 257</span></a><span class="sd">                        - {timestamp} (dict):</span>
</span><span id="ZakatTracker-258"><a href="#ZakatTracker-258"><span class="linenos"> 258</span></a><span class="sd">                            - value (int): The transaction amount (positive or negative).</span>
</span><span id="ZakatTracker-259"><a href="#ZakatTracker-259"><span class="linenos"> 259</span></a><span class="sd">                            - desc (str): The description of the transaction.</span>
</span><span id="ZakatTracker-260"><a href="#ZakatTracker-260"><span class="linenos"> 260</span></a><span class="sd">                            - ref (int): The box reference (positive or None).</span>
</span><span id="ZakatTracker-261"><a href="#ZakatTracker-261"><span class="linenos"> 261</span></a><span class="sd">                            - file (dict): A dictionary storing file references associated with the transaction.</span>
</span><span id="ZakatTracker-262"><a href="#ZakatTracker-262"><span class="linenos"> 262</span></a><span class="sd">                    - hide (bool): Indicates whether the account is hidden or not.</span>
</span><span id="ZakatTracker-263"><a href="#ZakatTracker-263"><span class="linenos"> 263</span></a><span class="sd">                    - zakatable (bool): Indicates whether the account is subject to Zakat.</span>
</span><span id="ZakatTracker-264"><a href="#ZakatTracker-264"><span class="linenos"> 264</span></a><span class="sd">            - exchange (dict):</span>
</span><span id="ZakatTracker-265"><a href="#ZakatTracker-265"><span class="linenos"> 265</span></a><span class="sd">                - {account_name} (dict):</span>
</span><span id="ZakatTracker-266"><a href="#ZakatTracker-266"><span class="linenos"> 266</span></a><span class="sd">                    - {timestamps} (dict):</span>
</span><span id="ZakatTracker-267"><a href="#ZakatTracker-267"><span class="linenos"> 267</span></a><span class="sd">                        - rate (float): Exchange rate when compared to local currency.</span>
</span><span id="ZakatTracker-268"><a href="#ZakatTracker-268"><span class="linenos"> 268</span></a><span class="sd">                        - description (str): The description of the exchange rate.</span>
</span><span id="ZakatTracker-269"><a href="#ZakatTracker-269"><span class="linenos"> 269</span></a><span class="sd">            - history (dict):</span>
</span><span id="ZakatTracker-270"><a href="#ZakatTracker-270"><span class="linenos"> 270</span></a><span class="sd">                - {timestamp} (list): A list of dictionaries storing the history of actions performed.</span>
</span><span id="ZakatTracker-271"><a href="#ZakatTracker-271"><span class="linenos"> 271</span></a><span class="sd">                    - {action_dict} (dict):</span>
</span><span id="ZakatTracker-272"><a href="#ZakatTracker-272"><span class="linenos"> 272</span></a><span class="sd">                        - action (Action): The type of action (CREATE, TRACK, LOG, SUB, ADD_FILE, REMOVE_FILE, BOX_TRANSFER, EXCHANGE, REPORT, ZAKAT).</span>
</span><span id="ZakatTracker-273"><a href="#ZakatTracker-273"><span class="linenos"> 273</span></a><span class="sd">                        - account (str): The account number associated with the action.</span>
</span><span id="ZakatTracker-274"><a href="#ZakatTracker-274"><span class="linenos"> 274</span></a><span class="sd">                        - ref (int): The reference number of the transaction.</span>
</span><span id="ZakatTracker-275"><a href="#ZakatTracker-275"><span class="linenos"> 275</span></a><span class="sd">                        - file (int): The reference number of the file (if applicable).</span>
</span><span id="ZakatTracker-276"><a href="#ZakatTracker-276"><span class="linenos"> 276</span></a><span class="sd">                        - key (str): The key associated with the action (e.g., &#39;rest&#39;, &#39;total&#39;).</span>
</span><span id="ZakatTracker-277"><a href="#ZakatTracker-277"><span class="linenos"> 277</span></a><span class="sd">                        - value (int): The value associated with the action.</span>
</span><span id="ZakatTracker-278"><a href="#ZakatTracker-278"><span class="linenos"> 278</span></a><span class="sd">                        - math (MathOperation): The mathematical operation performed (if applicable).</span>
</span><span id="ZakatTracker-279"><a href="#ZakatTracker-279"><span class="linenos"> 279</span></a><span class="sd">            - lock (int or None): The timestamp indicating the current lock status (None if not locked).</span>
</span><span id="ZakatTracker-280"><a href="#ZakatTracker-280"><span class="linenos"> 280</span></a><span class="sd">            - report (dict):</span>
</span><span id="ZakatTracker-281"><a href="#ZakatTracker-281"><span class="linenos"> 281</span></a><span class="sd">                - {timestamp} (tuple): A tuple storing Zakat report details.</span>
</span><span id="ZakatTracker-282"><a href="#ZakatTracker-282"><span class="linenos"> 282</span></a>
</span><span id="ZakatTracker-283"><a href="#ZakatTracker-283"><span class="linenos"> 283</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-284"><a href="#ZakatTracker-284"><span class="linenos"> 284</span></a>
</span><span id="ZakatTracker-285"><a href="#ZakatTracker-285"><span class="linenos"> 285</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-286"><a href="#ZakatTracker-286"><span class="linenos"> 286</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">Version</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZakatTracker-287"><a href="#ZakatTracker-287"><span class="linenos"> 287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-288"><a href="#ZakatTracker-288"><span class="linenos"> 288</span></a><span class="sd">        Returns the current version of the software.</span>
</span><span id="ZakatTracker-289"><a href="#ZakatTracker-289"><span class="linenos"> 289</span></a>
</span><span id="ZakatTracker-290"><a href="#ZakatTracker-290"><span class="linenos"> 290</span></a><span class="sd">        This function returns a string representing the current version of the software,</span>
</span><span id="ZakatTracker-291"><a href="#ZakatTracker-291"><span class="linenos"> 291</span></a><span class="sd">        including major, minor, and patch version numbers in the format &quot;X.Y.Z&quot;.</span>
</span><span id="ZakatTracker-292"><a href="#ZakatTracker-292"><span class="linenos"> 292</span></a>
</span><span id="ZakatTracker-293"><a href="#ZakatTracker-293"><span class="linenos"> 293</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-294"><a href="#ZakatTracker-294"><span class="linenos"> 294</span></a><span class="sd">        - str: The current version of the software.</span>
</span><span id="ZakatTracker-295"><a href="#ZakatTracker-295"><span class="linenos"> 295</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-296"><a href="#ZakatTracker-296"><span class="linenos"> 296</span></a>        <span class="k">return</span> <span class="s1">&#39;0.2.98&#39;</span>
</span><span id="ZakatTracker-297"><a href="#ZakatTracker-297"><span class="linenos"> 297</span></a>
</span><span id="ZakatTracker-298"><a href="#ZakatTracker-298"><span class="linenos"> 298</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-299"><a href="#ZakatTracker-299"><span class="linenos"> 299</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ZakatCut</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ZakatTracker-300"><a href="#ZakatTracker-300"><span class="linenos"> 300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-301"><a href="#ZakatTracker-301"><span class="linenos"> 301</span></a><span class="sd">        Calculates the Zakat amount due on an asset.</span>
</span><span id="ZakatTracker-302"><a href="#ZakatTracker-302"><span class="linenos"> 302</span></a>
</span><span id="ZakatTracker-303"><a href="#ZakatTracker-303"><span class="linenos"> 303</span></a><span class="sd">        This function calculates the zakat amount due on a given asset value over one lunar year.</span>
</span><span id="ZakatTracker-304"><a href="#ZakatTracker-304"><span class="linenos"> 304</span></a><span class="sd">        Zakat is an Islamic obligatory alms-giving, calculated as a fixed percentage of an individual&#39;s wealth</span>
</span><span id="ZakatTracker-305"><a href="#ZakatTracker-305"><span class="linenos"> 305</span></a><span class="sd">        that exceeds a certain threshold (Nisab).</span>
</span><span id="ZakatTracker-306"><a href="#ZakatTracker-306"><span class="linenos"> 306</span></a>
</span><span id="ZakatTracker-307"><a href="#ZakatTracker-307"><span class="linenos"> 307</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-308"><a href="#ZakatTracker-308"><span class="linenos"> 308</span></a><span class="sd">        - x (float): The total value of the asset on which Zakat is to be calculated.</span>
</span><span id="ZakatTracker-309"><a href="#ZakatTracker-309"><span class="linenos"> 309</span></a>
</span><span id="ZakatTracker-310"><a href="#ZakatTracker-310"><span class="linenos"> 310</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-311"><a href="#ZakatTracker-311"><span class="linenos"> 311</span></a><span class="sd">        - float: The amount of Zakat due on the asset, calculated as 2.5% of the asset&#39;s value.</span>
</span><span id="ZakatTracker-312"><a href="#ZakatTracker-312"><span class="linenos"> 312</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-313"><a href="#ZakatTracker-313"><span class="linenos"> 313</span></a>        <span class="k">return</span> <span class="mf">0.025</span> <span class="o">*</span> <span class="n">x</span>  <span class="c1"># Zakat Cut in one Lunar Year</span>
</span><span id="ZakatTracker-314"><a href="#ZakatTracker-314"><span class="linenos"> 314</span></a>
</span><span id="ZakatTracker-315"><a href="#ZakatTracker-315"><span class="linenos"> 315</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-316"><a href="#ZakatTracker-316"><span class="linenos"> 316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">TimeCycle</span><span class="p">(</span><span class="n">days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">355</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-317"><a href="#ZakatTracker-317"><span class="linenos"> 317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-318"><a href="#ZakatTracker-318"><span class="linenos"> 318</span></a><span class="sd">        Calculates the approximate duration of a lunar year in nanoseconds.</span>
</span><span id="ZakatTracker-319"><a href="#ZakatTracker-319"><span class="linenos"> 319</span></a>
</span><span id="ZakatTracker-320"><a href="#ZakatTracker-320"><span class="linenos"> 320</span></a><span class="sd">        This function calculates the approximate duration of a lunar year based on the given number of days.</span>
</span><span id="ZakatTracker-321"><a href="#ZakatTracker-321"><span class="linenos"> 321</span></a><span class="sd">        It converts the given number of days into nanoseconds for use in high-precision timing applications.</span>
</span><span id="ZakatTracker-322"><a href="#ZakatTracker-322"><span class="linenos"> 322</span></a>
</span><span id="ZakatTracker-323"><a href="#ZakatTracker-323"><span class="linenos"> 323</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-324"><a href="#ZakatTracker-324"><span class="linenos"> 324</span></a><span class="sd">        - days (int): The number of days in a lunar year. Defaults to 355,</span>
</span><span id="ZakatTracker-325"><a href="#ZakatTracker-325"><span class="linenos"> 325</span></a><span class="sd">              which is an approximation of the average length of a lunar year.</span>
</span><span id="ZakatTracker-326"><a href="#ZakatTracker-326"><span class="linenos"> 326</span></a>
</span><span id="ZakatTracker-327"><a href="#ZakatTracker-327"><span class="linenos"> 327</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-328"><a href="#ZakatTracker-328"><span class="linenos"> 328</span></a><span class="sd">        - int: The approximate duration of a lunar year in nanoseconds.</span>
</span><span id="ZakatTracker-329"><a href="#ZakatTracker-329"><span class="linenos"> 329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-330"><a href="#ZakatTracker-330"><span class="linenos"> 330</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">days</span> <span class="o">*</span> <span class="mf">1e9</span><span class="p">)</span>  <span class="c1"># Lunar Year in nanoseconds</span>
</span><span id="ZakatTracker-331"><a href="#ZakatTracker-331"><span class="linenos"> 331</span></a>
</span><span id="ZakatTracker-332"><a href="#ZakatTracker-332"><span class="linenos"> 332</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-333"><a href="#ZakatTracker-333"><span class="linenos"> 333</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">Nisab</span><span class="p">(</span><span class="n">gram_price</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">gram_quantity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">595</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ZakatTracker-334"><a href="#ZakatTracker-334"><span class="linenos"> 334</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-335"><a href="#ZakatTracker-335"><span class="linenos"> 335</span></a><span class="sd">        Calculate the total value of Nisab (a unit of weight in Islamic jurisprudence) based on the given price per gram.</span>
</span><span id="ZakatTracker-336"><a href="#ZakatTracker-336"><span class="linenos"> 336</span></a>
</span><span id="ZakatTracker-337"><a href="#ZakatTracker-337"><span class="linenos"> 337</span></a><span class="sd">        This function calculates the Nisab value, which is the minimum threshold of wealth,</span>
</span><span id="ZakatTracker-338"><a href="#ZakatTracker-338"><span class="linenos"> 338</span></a><span class="sd">        that makes an individual liable for paying Zakat.</span>
</span><span id="ZakatTracker-339"><a href="#ZakatTracker-339"><span class="linenos"> 339</span></a><span class="sd">        The Nisab value is determined by the equivalent value of a specific amount</span>
</span><span id="ZakatTracker-340"><a href="#ZakatTracker-340"><span class="linenos"> 340</span></a><span class="sd">        of gold or silver (currently 595 grams in silver) in the local currency.</span>
</span><span id="ZakatTracker-341"><a href="#ZakatTracker-341"><span class="linenos"> 341</span></a>
</span><span id="ZakatTracker-342"><a href="#ZakatTracker-342"><span class="linenos"> 342</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-343"><a href="#ZakatTracker-343"><span class="linenos"> 343</span></a><span class="sd">        - gram_price (float): The price per gram of Nisab.</span>
</span><span id="ZakatTracker-344"><a href="#ZakatTracker-344"><span class="linenos"> 344</span></a><span class="sd">        - gram_quantity (float): The quantity of grams in a Nisab. Default is 595 grams of silver.</span>
</span><span id="ZakatTracker-345"><a href="#ZakatTracker-345"><span class="linenos"> 345</span></a>
</span><span id="ZakatTracker-346"><a href="#ZakatTracker-346"><span class="linenos"> 346</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-347"><a href="#ZakatTracker-347"><span class="linenos"> 347</span></a><span class="sd">        - float: The total value of Nisab based on the given price per gram.</span>
</span><span id="ZakatTracker-348"><a href="#ZakatTracker-348"><span class="linenos"> 348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-349"><a href="#ZakatTracker-349"><span class="linenos"> 349</span></a>        <span class="k">return</span> <span class="n">gram_price</span> <span class="o">*</span> <span class="n">gram_quantity</span>
</span><span id="ZakatTracker-350"><a href="#ZakatTracker-350"><span class="linenos"> 350</span></a>
</span><span id="ZakatTracker-351"><a href="#ZakatTracker-351"><span class="linenos"> 351</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-352"><a href="#ZakatTracker-352"><span class="linenos"> 352</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ext</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZakatTracker-353"><a href="#ZakatTracker-353"><span class="linenos"> 353</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-354"><a href="#ZakatTracker-354"><span class="linenos"> 354</span></a><span class="sd">        Returns the file extension used by the ZakatTracker class.</span>
</span><span id="ZakatTracker-355"><a href="#ZakatTracker-355"><span class="linenos"> 355</span></a>
</span><span id="ZakatTracker-356"><a href="#ZakatTracker-356"><span class="linenos"> 356</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-357"><a href="#ZakatTracker-357"><span class="linenos"> 357</span></a><span class="sd">        - str: The file extension used by the ZakatTracker class, which is &#39;camel&#39;.</span>
</span><span id="ZakatTracker-358"><a href="#ZakatTracker-358"><span class="linenos"> 358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-359"><a href="#ZakatTracker-359"><span class="linenos"> 359</span></a>        <span class="k">return</span> <span class="s1">&#39;camel&#39;</span>
</span><span id="ZakatTracker-360"><a href="#ZakatTracker-360"><span class="linenos"> 360</span></a>
</span><span id="ZakatTracker-361"><a href="#ZakatTracker-361"><span class="linenos"> 361</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./zakat_db/&quot;</span><span class="p">,</span> <span class="n">history_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="ZakatTracker-362"><a href="#ZakatTracker-362"><span class="linenos"> 362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-363"><a href="#ZakatTracker-363"><span class="linenos"> 363</span></a><span class="sd">        Initialize ZakatTracker with database path and history mode.</span>
</span><span id="ZakatTracker-364"><a href="#ZakatTracker-364"><span class="linenos"> 364</span></a>
</span><span id="ZakatTracker-365"><a href="#ZakatTracker-365"><span class="linenos"> 365</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-366"><a href="#ZakatTracker-366"><span class="linenos"> 366</span></a><span class="sd">        - db_path (str): The path to the database  directory. Default is &quot;./zakat_db&quot;.</span>
</span><span id="ZakatTracker-367"><a href="#ZakatTracker-367"><span class="linenos"> 367</span></a><span class="sd">        - history_mode (bool): The mode for tracking history. Default is True.</span>
</span><span id="ZakatTracker-368"><a href="#ZakatTracker-368"><span class="linenos"> 368</span></a>
</span><span id="ZakatTracker-369"><a href="#ZakatTracker-369"><span class="linenos"> 369</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-370"><a href="#ZakatTracker-370"><span class="linenos"> 370</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker-371"><a href="#ZakatTracker-371"><span class="linenos"> 371</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-372"><a href="#ZakatTracker-372"><span class="linenos"> 372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_base_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ZakatTracker-373"><a href="#ZakatTracker-373"><span class="linenos"> 373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ZakatTracker-374"><a href="#ZakatTracker-374"><span class="linenos"> 374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ZakatTracker-375"><a href="#ZakatTracker-375"><span class="linenos"> 375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker-376"><a href="#ZakatTracker-376"><span class="linenos"> 376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">(</span><span class="n">history_mode</span><span class="p">)</span>
</span><span id="ZakatTracker-377"><a href="#ZakatTracker-377"><span class="linenos"> 377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">db_path</span><span class="si">}</span><span class="s1">/db.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-378"><a href="#ZakatTracker-378"><span class="linenos"> 378</span></a>
</span><span id="ZakatTracker-379"><a href="#ZakatTracker-379"><span class="linenos"> 379</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZakatTracker-380"><a href="#ZakatTracker-380"><span class="linenos"> 380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-381"><a href="#ZakatTracker-381"><span class="linenos"> 381</span></a><span class="sd">        Set or get the path to the database file.</span>
</span><span id="ZakatTracker-382"><a href="#ZakatTracker-382"><span class="linenos"> 382</span></a>
</span><span id="ZakatTracker-383"><a href="#ZakatTracker-383"><span class="linenos"> 383</span></a><span class="sd">        If no path is provided, the current path is returned.</span>
</span><span id="ZakatTracker-384"><a href="#ZakatTracker-384"><span class="linenos"> 384</span></a><span class="sd">        If a path is provided, it is set as the new path.</span>
</span><span id="ZakatTracker-385"><a href="#ZakatTracker-385"><span class="linenos"> 385</span></a><span class="sd">        The function also creates the necessary directories if the provided path is a file.</span>
</span><span id="ZakatTracker-386"><a href="#ZakatTracker-386"><span class="linenos"> 386</span></a>
</span><span id="ZakatTracker-387"><a href="#ZakatTracker-387"><span class="linenos"> 387</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-388"><a href="#ZakatTracker-388"><span class="linenos"> 388</span></a><span class="sd">        - path (str): The new path to the database file. If not provided, the current path is returned.</span>
</span><span id="ZakatTracker-389"><a href="#ZakatTracker-389"><span class="linenos"> 389</span></a>
</span><span id="ZakatTracker-390"><a href="#ZakatTracker-390"><span class="linenos"> 390</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-391"><a href="#ZakatTracker-391"><span class="linenos"> 391</span></a><span class="sd">        - str: The current or new path to the database file.</span>
</span><span id="ZakatTracker-392"><a href="#ZakatTracker-392"><span class="linenos"> 392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-393"><a href="#ZakatTracker-393"><span class="linenos"> 393</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-394"><a href="#ZakatTracker-394"><span class="linenos"> 394</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault_path</span>
</span><span id="ZakatTracker-395"><a href="#ZakatTracker-395"><span class="linenos"> 395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
</span><span id="ZakatTracker-396"><a href="#ZakatTracker-396"><span class="linenos"> 396</span></a>        <span class="n">base_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
</span><span id="ZakatTracker-397"><a href="#ZakatTracker-397"><span class="linenos"> 397</span></a>        <span class="k">if</span> <span class="n">base_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">or</span> <span class="n">base_path</span><span class="o">.</span><span class="n">suffix</span><span class="p">:</span>
</span><span id="ZakatTracker-398"><a href="#ZakatTracker-398"><span class="linenos"> 398</span></a>            <span class="n">base_path</span> <span class="o">=</span> <span class="n">base_path</span><span class="o">.</span><span class="n">parent</span>
</span><span id="ZakatTracker-399"><a href="#ZakatTracker-399"><span class="linenos"> 399</span></a>        <span class="n">base_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker-400"><a href="#ZakatTracker-400"><span class="linenos"> 400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_base_path</span> <span class="o">=</span> <span class="n">base_path</span>
</span><span id="ZakatTracker-401"><a href="#ZakatTracker-401"><span class="linenos"> 401</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault_path</span><span class="p">)</span>
</span><span id="ZakatTracker-402"><a href="#ZakatTracker-402"><span class="linenos"> 402</span></a>
</span><span id="ZakatTracker-403"><a href="#ZakatTracker-403"><span class="linenos"> 403</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">base_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZakatTracker-404"><a href="#ZakatTracker-404"><span class="linenos"> 404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-405"><a href="#ZakatTracker-405"><span class="linenos"> 405</span></a><span class="sd">        Generate a base path by joining the provided arguments with the existing base path.</span>
</span><span id="ZakatTracker-406"><a href="#ZakatTracker-406"><span class="linenos"> 406</span></a>
</span><span id="ZakatTracker-407"><a href="#ZakatTracker-407"><span class="linenos"> 407</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-408"><a href="#ZakatTracker-408"><span class="linenos"> 408</span></a><span class="sd">        - *args (str): Variable length argument list of strings to be joined with the base path.</span>
</span><span id="ZakatTracker-409"><a href="#ZakatTracker-409"><span class="linenos"> 409</span></a>
</span><span id="ZakatTracker-410"><a href="#ZakatTracker-410"><span class="linenos"> 410</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-411"><a href="#ZakatTracker-411"><span class="linenos"> 411</span></a><span class="sd">        - str: The generated base path. If no arguments are provided, the existing base path is returned.</span>
</span><span id="ZakatTracker-412"><a href="#ZakatTracker-412"><span class="linenos"> 412</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-413"><a href="#ZakatTracker-413"><span class="linenos"> 413</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
</span><span id="ZakatTracker-414"><a href="#ZakatTracker-414"><span class="linenos"> 414</span></a>            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_path</span><span class="p">)</span>
</span><span id="ZakatTracker-415"><a href="#ZakatTracker-415"><span class="linenos"> 415</span></a>        <span class="n">filtered_args</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker-416"><a href="#ZakatTracker-416"><span class="linenos"> 416</span></a>        <span class="n">ignored_filename</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ZakatTracker-417"><a href="#ZakatTracker-417"><span class="linenos"> 417</span></a>        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="ZakatTracker-418"><a href="#ZakatTracker-418"><span class="linenos"> 418</span></a>            <span class="k">if</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="p">:</span>
</span><span id="ZakatTracker-419"><a href="#ZakatTracker-419"><span class="linenos"> 419</span></a>                <span class="n">ignored_filename</span> <span class="o">=</span> <span class="n">arg</span>
</span><span id="ZakatTracker-420"><a href="#ZakatTracker-420"><span class="linenos"> 420</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker-421"><a href="#ZakatTracker-421"><span class="linenos"> 421</span></a>                <span class="n">filtered_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span><span id="ZakatTracker-422"><a href="#ZakatTracker-422"><span class="linenos"> 422</span></a>        <span class="n">base_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_path</span><span class="p">)</span>
</span><span id="ZakatTracker-423"><a href="#ZakatTracker-423"><span class="linenos"> 423</span></a>        <span class="n">full_path</span> <span class="o">=</span> <span class="n">base_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="o">*</span><span class="n">filtered_args</span><span class="p">)</span>
</span><span id="ZakatTracker-424"><a href="#ZakatTracker-424"><span class="linenos"> 424</span></a>        <span class="n">full_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker-425"><a href="#ZakatTracker-425"><span class="linenos"> 425</span></a>        <span class="k">if</span> <span class="n">ignored_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-426"><a href="#ZakatTracker-426"><span class="linenos"> 426</span></a>            <span class="k">return</span> <span class="n">full_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="n">ignored_filename</span>  <span class="c1"># Join with the ignored filename</span>
</span><span id="ZakatTracker-427"><a href="#ZakatTracker-427"><span class="linenos"> 427</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
</span><span id="ZakatTracker-428"><a href="#ZakatTracker-428"><span class="linenos"> 428</span></a>
</span><span id="ZakatTracker-429"><a href="#ZakatTracker-429"><span class="linenos"> 429</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-430"><a href="#ZakatTracker-430"><span class="linenos"> 430</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-431"><a href="#ZakatTracker-431"><span class="linenos"> 431</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-432"><a href="#ZakatTracker-432"><span class="linenos"> 432</span></a><span class="sd">        Scales a numerical value by a specified power of 10, returning an integer.</span>
</span><span id="ZakatTracker-433"><a href="#ZakatTracker-433"><span class="linenos"> 433</span></a>
</span><span id="ZakatTracker-434"><a href="#ZakatTracker-434"><span class="linenos"> 434</span></a><span class="sd">        This function is designed to handle various numeric types (`float`, `int`, or `decimal.Decimal`) and</span>
</span><span id="ZakatTracker-435"><a href="#ZakatTracker-435"><span class="linenos"> 435</span></a><span class="sd">        facilitate precise scaling operations, particularly useful in financial or scientific calculations.</span>
</span><span id="ZakatTracker-436"><a href="#ZakatTracker-436"><span class="linenos"> 436</span></a>
</span><span id="ZakatTracker-437"><a href="#ZakatTracker-437"><span class="linenos"> 437</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-438"><a href="#ZakatTracker-438"><span class="linenos"> 438</span></a><span class="sd">        - x (float | int | decimal.Decimal): The numeric value to scale. Can be a floating-point number, integer, or decimal.</span>
</span><span id="ZakatTracker-439"><a href="#ZakatTracker-439"><span class="linenos"> 439</span></a><span class="sd">        - decimal_places (int): The exponent for the scaling factor (10**y). Defaults to 2, meaning the input is scaled</span>
</span><span id="ZakatTracker-440"><a href="#ZakatTracker-440"><span class="linenos"> 440</span></a><span class="sd">            by a factor of 100 (e.g., converts 1.23 to 123).</span>
</span><span id="ZakatTracker-441"><a href="#ZakatTracker-441"><span class="linenos"> 441</span></a>
</span><span id="ZakatTracker-442"><a href="#ZakatTracker-442"><span class="linenos"> 442</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-443"><a href="#ZakatTracker-443"><span class="linenos"> 443</span></a><span class="sd">        - The scaled value, rounded to the nearest integer.</span>
</span><span id="ZakatTracker-444"><a href="#ZakatTracker-444"><span class="linenos"> 444</span></a>
</span><span id="ZakatTracker-445"><a href="#ZakatTracker-445"><span class="linenos"> 445</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker-446"><a href="#ZakatTracker-446"><span class="linenos"> 446</span></a><span class="sd">        - TypeError: If the input `x` is not a valid numeric type.</span>
</span><span id="ZakatTracker-447"><a href="#ZakatTracker-447"><span class="linenos"> 447</span></a>
</span><span id="ZakatTracker-448"><a href="#ZakatTracker-448"><span class="linenos"> 448</span></a><span class="sd">        Examples:</span>
</span><span id="ZakatTracker-449"><a href="#ZakatTracker-449"><span class="linenos"> 449</span></a><span class="sd">        &gt;&gt;&gt; ZakatTracker.scale(3.14159)</span>
</span><span id="ZakatTracker-450"><a href="#ZakatTracker-450"><span class="linenos"> 450</span></a><span class="sd">        314</span>
</span><span id="ZakatTracker-451"><a href="#ZakatTracker-451"><span class="linenos"> 451</span></a><span class="sd">        &gt;&gt;&gt; ZakatTracker.scale(1234, decimal_places=3)</span>
</span><span id="ZakatTracker-452"><a href="#ZakatTracker-452"><span class="linenos"> 452</span></a><span class="sd">        1234000</span>
</span><span id="ZakatTracker-453"><a href="#ZakatTracker-453"><span class="linenos"> 453</span></a><span class="sd">        &gt;&gt;&gt; ZakatTracker.scale(Decimal(&quot;0.005&quot;), decimal_places=4)</span>
</span><span id="ZakatTracker-454"><a href="#ZakatTracker-454"><span class="linenos"> 454</span></a><span class="sd">        50</span>
</span><span id="ZakatTracker-455"><a href="#ZakatTracker-455"><span class="linenos"> 455</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-456"><a href="#ZakatTracker-456"><span class="linenos"> 456</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">)):</span>
</span><span id="ZakatTracker-457"><a href="#ZakatTracker-457"><span class="linenos"> 457</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input &#39;x&#39; must be a float, int, or decimal.Decimal.&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-458"><a href="#ZakatTracker-458"><span class="linenos"> 458</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">decimal_places</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">decimal_places</span><span class="p">))</span>
</span><span id="ZakatTracker-459"><a href="#ZakatTracker-459"><span class="linenos"> 459</span></a>
</span><span id="ZakatTracker-460"><a href="#ZakatTracker-460"><span class="linenos"> 460</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-461"><a href="#ZakatTracker-461"><span class="linenos"> 461</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unscale</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">return_type</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">:</span>
</span><span id="ZakatTracker-462"><a href="#ZakatTracker-462"><span class="linenos"> 462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-463"><a href="#ZakatTracker-463"><span class="linenos"> 463</span></a><span class="sd">        Unscales an integer by a power of 10.</span>
</span><span id="ZakatTracker-464"><a href="#ZakatTracker-464"><span class="linenos"> 464</span></a>
</span><span id="ZakatTracker-465"><a href="#ZakatTracker-465"><span class="linenos"> 465</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-466"><a href="#ZakatTracker-466"><span class="linenos"> 466</span></a><span class="sd">        - x (int): The integer to unscale.</span>
</span><span id="ZakatTracker-467"><a href="#ZakatTracker-467"><span class="linenos"> 467</span></a><span class="sd">        - return_type (type): The desired type for the returned value. Can be float, int, or decimal.Decimal. Defaults to float.</span>
</span><span id="ZakatTracker-468"><a href="#ZakatTracker-468"><span class="linenos"> 468</span></a><span class="sd">        - decimal_places (int): The power of 10 to use. Defaults to 2.</span>
</span><span id="ZakatTracker-469"><a href="#ZakatTracker-469"><span class="linenos"> 469</span></a>
</span><span id="ZakatTracker-470"><a href="#ZakatTracker-470"><span class="linenos"> 470</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-471"><a href="#ZakatTracker-471"><span class="linenos"> 471</span></a><span class="sd">        - float | int | decimal.Decimal: The unscaled number, converted to the specified return_type.</span>
</span><span id="ZakatTracker-472"><a href="#ZakatTracker-472"><span class="linenos"> 472</span></a>
</span><span id="ZakatTracker-473"><a href="#ZakatTracker-473"><span class="linenos"> 473</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker-474"><a href="#ZakatTracker-474"><span class="linenos"> 474</span></a><span class="sd">        - TypeError: If the return_type is not float or decimal.Decimal.</span>
</span><span id="ZakatTracker-475"><a href="#ZakatTracker-475"><span class="linenos"> 475</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-476"><a href="#ZakatTracker-476"><span class="linenos"> 476</span></a>        <span class="k">if</span> <span class="n">return_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">):</span>
</span><span id="ZakatTracker-477"><a href="#ZakatTracker-477"><span class="linenos"> 477</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid return_type(</span><span class="si">{</span><span class="n">return_type</span><span class="si">}</span><span class="s1">). Supported types are float, int, and decimal.Decimal.&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-478"><a href="#ZakatTracker-478"><span class="linenos"> 478</span></a>        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">return_type</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">decimal_places</span><span class="p">)),</span> <span class="n">decimal_places</span><span class="p">)</span>
</span><span id="ZakatTracker-479"><a href="#ZakatTracker-479"><span class="linenos"> 479</span></a>
</span><span id="ZakatTracker-480"><a href="#ZakatTracker-480"><span class="linenos"> 480</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-481"><a href="#ZakatTracker-481"><span class="linenos"> 481</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-482"><a href="#ZakatTracker-482"><span class="linenos"> 482</span></a><span class="sd">        Reset the internal data structure to its initial state.</span>
</span><span id="ZakatTracker-483"><a href="#ZakatTracker-483"><span class="linenos"> 483</span></a>
</span><span id="ZakatTracker-484"><a href="#ZakatTracker-484"><span class="linenos"> 484</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-485"><a href="#ZakatTracker-485"><span class="linenos"> 485</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker-486"><a href="#ZakatTracker-486"><span class="linenos"> 486</span></a>
</span><span id="ZakatTracker-487"><a href="#ZakatTracker-487"><span class="linenos"> 487</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-488"><a href="#ZakatTracker-488"><span class="linenos"> 488</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker-489"><a href="#ZakatTracker-489"><span class="linenos"> 489</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-490"><a href="#ZakatTracker-490"><span class="linenos"> 490</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-491"><a href="#ZakatTracker-491"><span class="linenos"> 491</span></a>            <span class="s1">&#39;account&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker-492"><a href="#ZakatTracker-492"><span class="linenos"> 492</span></a>            <span class="s1">&#39;exchange&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker-493"><a href="#ZakatTracker-493"><span class="linenos"> 493</span></a>            <span class="s1">&#39;history&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker-494"><a href="#ZakatTracker-494"><span class="linenos"> 494</span></a>            <span class="s1">&#39;lock&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker-495"><a href="#ZakatTracker-495"><span class="linenos"> 495</span></a>            <span class="s1">&#39;report&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker-496"><a href="#ZakatTracker-496"><span class="linenos"> 496</span></a>        <span class="p">}</span>
</span><span id="ZakatTracker-497"><a href="#ZakatTracker-497"><span class="linenos"> 497</span></a>
</span><span id="ZakatTracker-498"><a href="#ZakatTracker-498"><span class="linenos"> 498</span></a>    <span class="n">_last_time_ns</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ZakatTracker-499"><a href="#ZakatTracker-499"><span class="linenos"> 499</span></a>    <span class="n">_time_diff_ns</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ZakatTracker-500"><a href="#ZakatTracker-500"><span class="linenos"> 500</span></a>
</span><span id="ZakatTracker-501"><a href="#ZakatTracker-501"><span class="linenos"> 501</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-502"><a href="#ZakatTracker-502"><span class="linenos"> 502</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">minimum_time_diff_ns</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="ZakatTracker-503"><a href="#ZakatTracker-503"><span class="linenos"> 503</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-504"><a href="#ZakatTracker-504"><span class="linenos"> 504</span></a><span class="sd">        Calculates the minimum time difference between two consecutive calls to</span>
</span><span id="ZakatTracker-505"><a href="#ZakatTracker-505"><span class="linenos"> 505</span></a><span class="sd">        `ZakatTracker._time()` in nanoseconds.</span>
</span><span id="ZakatTracker-506"><a href="#ZakatTracker-506"><span class="linenos"> 506</span></a>
</span><span id="ZakatTracker-507"><a href="#ZakatTracker-507"><span class="linenos"> 507</span></a><span class="sd">        This method is used internally to determine the minimum granularity of</span>
</span><span id="ZakatTracker-508"><a href="#ZakatTracker-508"><span class="linenos"> 508</span></a><span class="sd">        time measurements within the system.</span>
</span><span id="ZakatTracker-509"><a href="#ZakatTracker-509"><span class="linenos"> 509</span></a>
</span><span id="ZakatTracker-510"><a href="#ZakatTracker-510"><span class="linenos"> 510</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-511"><a href="#ZakatTracker-511"><span class="linenos"> 511</span></a><span class="sd">        tuple[int, int]:</span>
</span><span id="ZakatTracker-512"><a href="#ZakatTracker-512"><span class="linenos"> 512</span></a><span class="sd">            - The minimum time difference in nanoseconds.</span>
</span><span id="ZakatTracker-513"><a href="#ZakatTracker-513"><span class="linenos"> 513</span></a><span class="sd">            - The number of iterations required to measure the difference.</span>
</span><span id="ZakatTracker-514"><a href="#ZakatTracker-514"><span class="linenos"> 514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-515"><a href="#ZakatTracker-515"><span class="linenos"> 515</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-516"><a href="#ZakatTracker-516"><span class="linenos"> 516</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time</span><span class="p">()</span>
</span><span id="ZakatTracker-517"><a href="#ZakatTracker-517"><span class="linenos"> 517</span></a>        <span class="k">while</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
</span><span id="ZakatTracker-518"><a href="#ZakatTracker-518"><span class="linenos"> 518</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time</span><span class="p">()</span>
</span><span id="ZakatTracker-519"><a href="#ZakatTracker-519"><span class="linenos"> 519</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-520"><a href="#ZakatTracker-520"><span class="linenos"> 520</span></a>        <span class="k">return</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">i</span>
</span><span id="ZakatTracker-521"><a href="#ZakatTracker-521"><span class="linenos"> 521</span></a>
</span><span id="ZakatTracker-522"><a href="#ZakatTracker-522"><span class="linenos"> 522</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-523"><a href="#ZakatTracker-523"><span class="linenos"> 523</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_time</span><span class="p">(</span><span class="n">now</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-524"><a href="#ZakatTracker-524"><span class="linenos"> 524</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-525"><a href="#ZakatTracker-525"><span class="linenos"> 525</span></a><span class="sd">        Internal method to generate a nanosecond-precision timestamp from a datetime object.</span>
</span><span id="ZakatTracker-526"><a href="#ZakatTracker-526"><span class="linenos"> 526</span></a>
</span><span id="ZakatTracker-527"><a href="#ZakatTracker-527"><span class="linenos"> 527</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-528"><a href="#ZakatTracker-528"><span class="linenos"> 528</span></a><span class="sd">        - now (datetime.datetime, optional): The datetime object to generate the timestamp from.</span>
</span><span id="ZakatTracker-529"><a href="#ZakatTracker-529"><span class="linenos"> 529</span></a><span class="sd">        If not provided, the current datetime is used.</span>
</span><span id="ZakatTracker-530"><a href="#ZakatTracker-530"><span class="linenos"> 530</span></a>
</span><span id="ZakatTracker-531"><a href="#ZakatTracker-531"><span class="linenos"> 531</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-532"><a href="#ZakatTracker-532"><span class="linenos"> 532</span></a><span class="sd">        - int: The timestamp in nanoseconds since the epoch (January 1, 1AD).</span>
</span><span id="ZakatTracker-533"><a href="#ZakatTracker-533"><span class="linenos"> 533</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-534"><a href="#ZakatTracker-534"><span class="linenos"> 534</span></a>        <span class="k">if</span> <span class="n">now</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-535"><a href="#ZakatTracker-535"><span class="linenos"> 535</span></a>            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="ZakatTracker-536"><a href="#ZakatTracker-536"><span class="linenos"> 536</span></a>        <span class="n">ns_in_day</span> <span class="o">=</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">now</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span>
</span><span id="ZakatTracker-537"><a href="#ZakatTracker-537"><span class="linenos"> 537</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">toordinal</span><span class="p">()</span> <span class="o">*</span> <span class="mi">86_400_000_000_000</span> <span class="o">+</span> <span class="n">ns_in_day</span><span class="p">)</span>
</span><span id="ZakatTracker-538"><a href="#ZakatTracker-538"><span class="linenos"> 538</span></a>
</span><span id="ZakatTracker-539"><a href="#ZakatTracker-539"><span class="linenos"> 539</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-540"><a href="#ZakatTracker-540"><span class="linenos"> 540</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">time</span><span class="p">(</span><span class="n">now</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-541"><a href="#ZakatTracker-541"><span class="linenos"> 541</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-542"><a href="#ZakatTracker-542"><span class="linenos"> 542</span></a><span class="sd">        Generates a unique, monotonically increasing timestamp based on the provided</span>
</span><span id="ZakatTracker-543"><a href="#ZakatTracker-543"><span class="linenos"> 543</span></a><span class="sd">        datetime object or the current datetime.</span>
</span><span id="ZakatTracker-544"><a href="#ZakatTracker-544"><span class="linenos"> 544</span></a>
</span><span id="ZakatTracker-545"><a href="#ZakatTracker-545"><span class="linenos"> 545</span></a><span class="sd">        This method ensures that timestamps are unique even if called in rapid succession</span>
</span><span id="ZakatTracker-546"><a href="#ZakatTracker-546"><span class="linenos"> 546</span></a><span class="sd">        by introducing a small delay if necessary, based on the system&#39;s minimum</span>
</span><span id="ZakatTracker-547"><a href="#ZakatTracker-547"><span class="linenos"> 547</span></a><span class="sd">        time resolution.</span>
</span><span id="ZakatTracker-548"><a href="#ZakatTracker-548"><span class="linenos"> 548</span></a>
</span><span id="ZakatTracker-549"><a href="#ZakatTracker-549"><span class="linenos"> 549</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-550"><a href="#ZakatTracker-550"><span class="linenos"> 550</span></a><span class="sd">        - now (datetime.datetime, optional): The datetime object to generate the timestamp from.</span>
</span><span id="ZakatTracker-551"><a href="#ZakatTracker-551"><span class="linenos"> 551</span></a><span class="sd">        If not provided, the current datetime is used.</span>
</span><span id="ZakatTracker-552"><a href="#ZakatTracker-552"><span class="linenos"> 552</span></a>
</span><span id="ZakatTracker-553"><a href="#ZakatTracker-553"><span class="linenos"> 553</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-554"><a href="#ZakatTracker-554"><span class="linenos"> 554</span></a><span class="sd">        - int: The unique timestamp in nanoseconds since the epoch (January 1, 1AD).</span>
</span><span id="ZakatTracker-555"><a href="#ZakatTracker-555"><span class="linenos"> 555</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-556"><a href="#ZakatTracker-556"><span class="linenos"> 556</span></a>        <span class="n">new_time</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
</span><span id="ZakatTracker-557"><a href="#ZakatTracker-557"><span class="linenos"> 557</span></a>        <span class="k">if</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_last_time_ns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-558"><a href="#ZakatTracker-558"><span class="linenos"> 558</span></a>            <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_last_time_ns</span> <span class="o">=</span> <span class="n">new_time</span>
</span><span id="ZakatTracker-559"><a href="#ZakatTracker-559"><span class="linenos"> 559</span></a>            <span class="k">return</span> <span class="n">new_time</span>
</span><span id="ZakatTracker-560"><a href="#ZakatTracker-560"><span class="linenos"> 560</span></a>        <span class="k">while</span> <span class="n">new_time</span> <span class="o">==</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_last_time_ns</span><span class="p">:</span>
</span><span id="ZakatTracker-561"><a href="#ZakatTracker-561"><span class="linenos"> 561</span></a>            <span class="k">if</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time_diff_ns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-562"><a href="#ZakatTracker-562"><span class="linenos"> 562</span></a>                <span class="n">diff</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">minimum_time_diff_ns</span><span class="p">()</span>
</span><span id="ZakatTracker-563"><a href="#ZakatTracker-563"><span class="linenos"> 563</span></a>                <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time_diff_ns</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
</span><span id="ZakatTracker-564"><a href="#ZakatTracker-564"><span class="linenos"> 564</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time_diff_ns</span> <span class="o">/</span> <span class="mi">1_000_000_000</span><span class="p">)</span>
</span><span id="ZakatTracker-565"><a href="#ZakatTracker-565"><span class="linenos"> 565</span></a>            <span class="n">new_time</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time</span><span class="p">()</span>
</span><span id="ZakatTracker-566"><a href="#ZakatTracker-566"><span class="linenos"> 566</span></a>        <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_last_time_ns</span> <span class="o">=</span> <span class="n">new_time</span>
</span><span id="ZakatTracker-567"><a href="#ZakatTracker-567"><span class="linenos"> 567</span></a>        <span class="k">return</span> <span class="n">new_time</span>
</span><span id="ZakatTracker-568"><a href="#ZakatTracker-568"><span class="linenos"> 568</span></a>
</span><span id="ZakatTracker-569"><a href="#ZakatTracker-569"><span class="linenos"> 569</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-570"><a href="#ZakatTracker-570"><span class="linenos"> 570</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">time_to_datetime</span><span class="p">(</span><span class="n">ordinal_ns</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
</span><span id="ZakatTracker-571"><a href="#ZakatTracker-571"><span class="linenos"> 571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-572"><a href="#ZakatTracker-572"><span class="linenos"> 572</span></a><span class="sd">        Converts a nanosecond-precision timestamp (ordinal number of nanoseconds since 1AD)</span>
</span><span id="ZakatTracker-573"><a href="#ZakatTracker-573"><span class="linenos"> 573</span></a><span class="sd">        back to a datetime object.</span>
</span><span id="ZakatTracker-574"><a href="#ZakatTracker-574"><span class="linenos"> 574</span></a>
</span><span id="ZakatTracker-575"><a href="#ZakatTracker-575"><span class="linenos"> 575</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-576"><a href="#ZakatTracker-576"><span class="linenos"> 576</span></a><span class="sd">        - ordinal_ns (int): The timestamp in nanoseconds since the epoch (January 1, 1AD).</span>
</span><span id="ZakatTracker-577"><a href="#ZakatTracker-577"><span class="linenos"> 577</span></a>
</span><span id="ZakatTracker-578"><a href="#ZakatTracker-578"><span class="linenos"> 578</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-579"><a href="#ZakatTracker-579"><span class="linenos"> 579</span></a><span class="sd">        - datetime.datetime: The corresponding datetime object.</span>
</span><span id="ZakatTracker-580"><a href="#ZakatTracker-580"><span class="linenos"> 580</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-581"><a href="#ZakatTracker-581"><span class="linenos"> 581</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromordinal</span><span class="p">(</span><span class="n">ordinal_ns</span> <span class="o">//</span> <span class="mi">86_400_000_000_000</span><span class="p">)</span>
</span><span id="ZakatTracker-582"><a href="#ZakatTracker-582"><span class="linenos"> 582</span></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="p">(</span><span class="n">ordinal_ns</span> <span class="o">%</span> <span class="mi">86_400_000_000_000</span><span class="p">)</span> <span class="o">//</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="ZakatTracker-583"><a href="#ZakatTracker-583"><span class="linenos"> 583</span></a>        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="n">t</span>
</span><span id="ZakatTracker-584"><a href="#ZakatTracker-584"><span class="linenos"> 584</span></a>
</span><span id="ZakatTracker-585"><a href="#ZakatTracker-585"><span class="linenos"> 585</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clean_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lock</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-586"><a href="#ZakatTracker-586"><span class="linenos"> 586</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-587"><a href="#ZakatTracker-587"><span class="linenos"> 587</span></a><span class="sd">        Cleans up the empty history records of actions performed on the ZakatTracker instance.</span>
</span><span id="ZakatTracker-588"><a href="#ZakatTracker-588"><span class="linenos"> 588</span></a>
</span><span id="ZakatTracker-589"><a href="#ZakatTracker-589"><span class="linenos"> 589</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-590"><a href="#ZakatTracker-590"><span class="linenos"> 590</span></a><span class="sd">        - lock (int, optional): The lock ID is used to clean up the empty history.</span>
</span><span id="ZakatTracker-591"><a href="#ZakatTracker-591"><span class="linenos"> 591</span></a><span class="sd">            If not provided, it cleans up the empty history records for all locks.</span>
</span><span id="ZakatTracker-592"><a href="#ZakatTracker-592"><span class="linenos"> 592</span></a>
</span><span id="ZakatTracker-593"><a href="#ZakatTracker-593"><span class="linenos"> 593</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-594"><a href="#ZakatTracker-594"><span class="linenos"> 594</span></a><span class="sd">        - int: The number of locks cleaned up.</span>
</span><span id="ZakatTracker-595"><a href="#ZakatTracker-595"><span class="linenos"> 595</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-596"><a href="#ZakatTracker-596"><span class="linenos"> 596</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-597"><a href="#ZakatTracker-597"><span class="linenos"> 597</span></a>        <span class="k">if</span> <span class="n">lock</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-598"><a href="#ZakatTracker-598"><span class="linenos"> 598</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">lock</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-599"><a href="#ZakatTracker-599"><span class="linenos"> 599</span></a>                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-600"><a href="#ZakatTracker-600"><span class="linenos"> 600</span></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">lock</span><span class="p">]</span>
</span><span id="ZakatTracker-601"><a href="#ZakatTracker-601"><span class="linenos"> 601</span></a>            <span class="k">return</span> <span class="n">count</span>
</span><span id="ZakatTracker-602"><a href="#ZakatTracker-602"><span class="linenos"> 602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">())</span>
</span><span id="ZakatTracker-603"><a href="#ZakatTracker-603"><span class="linenos"> 603</span></a>        <span class="k">for</span> <span class="n">lock</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-604"><a href="#ZakatTracker-604"><span class="linenos"> 604</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">lock</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-605"><a href="#ZakatTracker-605"><span class="linenos"> 605</span></a>                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-606"><a href="#ZakatTracker-606"><span class="linenos"> 606</span></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">lock</span><span class="p">]</span>
</span><span id="ZakatTracker-607"><a href="#ZakatTracker-607"><span class="linenos"> 607</span></a>        <span class="k">return</span> <span class="n">count</span>
</span><span id="ZakatTracker-608"><a href="#ZakatTracker-608"><span class="linenos"> 608</span></a>
</span><span id="ZakatTracker-609"><a href="#ZakatTracker-609"><span class="linenos"> 609</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-610"><a href="#ZakatTracker-610"><span class="linenos"> 610</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-611"><a href="#ZakatTracker-611"><span class="linenos"> 611</span></a><span class="sd">        Enable or disable history tracking.</span>
</span><span id="ZakatTracker-612"><a href="#ZakatTracker-612"><span class="linenos"> 612</span></a>
</span><span id="ZakatTracker-613"><a href="#ZakatTracker-613"><span class="linenos"> 613</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-614"><a href="#ZakatTracker-614"><span class="linenos"> 614</span></a><span class="sd">        - status (bool): The status of history tracking. Default is True.</span>
</span><span id="ZakatTracker-615"><a href="#ZakatTracker-615"><span class="linenos"> 615</span></a>
</span><span id="ZakatTracker-616"><a href="#ZakatTracker-616"><span class="linenos"> 616</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-617"><a href="#ZakatTracker-617"><span class="linenos"> 617</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker-618"><a href="#ZakatTracker-618"><span class="linenos"> 618</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-619"><a href="#ZakatTracker-619"><span class="linenos"> 619</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-620"><a href="#ZakatTracker-620"><span class="linenos"> 620</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_history_mode</span> <span class="o">=</span> <span class="n">status</span>
</span><span id="ZakatTracker-621"><a href="#ZakatTracker-621"><span class="linenos"> 621</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history_mode</span>
</span><span id="ZakatTracker-622"><a href="#ZakatTracker-622"><span class="linenos"> 622</span></a>
</span><span id="ZakatTracker-623"><a href="#ZakatTracker-623"><span class="linenos"> 623</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">Action</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker-624"><a href="#ZakatTracker-624"><span class="linenos"> 624</span></a>              <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">math_operation</span><span class="p">:</span> <span class="n">MathOperation</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-625"><a href="#ZakatTracker-625"><span class="linenos"> 625</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-626"><a href="#ZakatTracker-626"><span class="linenos"> 626</span></a><span class="sd">        This method is responsible for recording the actions performed on the ZakatTracker.</span>
</span><span id="ZakatTracker-627"><a href="#ZakatTracker-627"><span class="linenos"> 627</span></a>
</span><span id="ZakatTracker-628"><a href="#ZakatTracker-628"><span class="linenos"> 628</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-629"><a href="#ZakatTracker-629"><span class="linenos"> 629</span></a><span class="sd">        - action (Action): The type of action performed.</span>
</span><span id="ZakatTracker-630"><a href="#ZakatTracker-630"><span class="linenos"> 630</span></a><span class="sd">        - account (str): The account number on which the action was performed.</span>
</span><span id="ZakatTracker-631"><a href="#ZakatTracker-631"><span class="linenos"> 631</span></a><span class="sd">        - ref (int): The reference number of the action.</span>
</span><span id="ZakatTracker-632"><a href="#ZakatTracker-632"><span class="linenos"> 632</span></a><span class="sd">        - file (int): The file reference number of the action.</span>
</span><span id="ZakatTracker-633"><a href="#ZakatTracker-633"><span class="linenos"> 633</span></a><span class="sd">        - value (int): The value associated with the action.</span>
</span><span id="ZakatTracker-634"><a href="#ZakatTracker-634"><span class="linenos"> 634</span></a><span class="sd">        - key (str): The key associated with the action.</span>
</span><span id="ZakatTracker-635"><a href="#ZakatTracker-635"><span class="linenos"> 635</span></a><span class="sd">        - math_operation (MathOperation): The mathematical operation performed during the action.</span>
</span><span id="ZakatTracker-636"><a href="#ZakatTracker-636"><span class="linenos"> 636</span></a><span class="sd">        - debug (bool): If True, the function will print debug information. Default is False.</span>
</span><span id="ZakatTracker-637"><a href="#ZakatTracker-637"><span class="linenos"> 637</span></a>
</span><span id="ZakatTracker-638"><a href="#ZakatTracker-638"><span class="linenos"> 638</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-639"><a href="#ZakatTracker-639"><span class="linenos"> 639</span></a><span class="sd">        - int: The lock time of the recorded action. If no lock was performed, it returns 0.</span>
</span><span id="ZakatTracker-640"><a href="#ZakatTracker-640"><span class="linenos"> 640</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-641"><a href="#ZakatTracker-641"><span class="linenos"> 641</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">():</span>
</span><span id="ZakatTracker-642"><a href="#ZakatTracker-642"><span class="linenos"> 642</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="ZakatTracker-643"><a href="#ZakatTracker-643"><span class="linenos"> 643</span></a>        <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;lock&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-644"><a href="#ZakatTracker-644"><span class="linenos"> 644</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">():</span>
</span><span id="ZakatTracker-645"><a href="#ZakatTracker-645"><span class="linenos"> 645</span></a>            <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;lock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker-646"><a href="#ZakatTracker-646"><span class="linenos"> 646</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">lock</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker-647"><a href="#ZakatTracker-647"><span class="linenos"> 647</span></a>        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-648"><a href="#ZakatTracker-648"><span class="linenos"> 648</span></a>            <span class="k">return</span> <span class="n">lock</span>
</span><span id="ZakatTracker-649"><a href="#ZakatTracker-649"><span class="linenos"> 649</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-650"><a href="#ZakatTracker-650"><span class="linenos"> 650</span></a>             <span class="n">print_stack</span><span class="p">()</span>
</span><span id="ZakatTracker-651"><a href="#ZakatTracker-651"><span class="linenos"> 651</span></a>        <span class="k">assert</span> <span class="n">account</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">action</span> <span class="o">!=</span> <span class="n">Action</span><span class="o">.</span><span class="n">REPORT</span>
</span><span id="ZakatTracker-652"><a href="#ZakatTracker-652"><span class="linenos"> 652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">lock</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="ZakatTracker-653"><a href="#ZakatTracker-653"><span class="linenos"> 653</span></a>            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
</span><span id="ZakatTracker-654"><a href="#ZakatTracker-654"><span class="linenos"> 654</span></a>            <span class="s1">&#39;account&#39;</span><span class="p">:</span> <span class="n">account</span><span class="p">,</span>
</span><span id="ZakatTracker-655"><a href="#ZakatTracker-655"><span class="linenos"> 655</span></a>            <span class="s1">&#39;ref&#39;</span><span class="p">:</span> <span class="n">ref</span><span class="p">,</span>
</span><span id="ZakatTracker-656"><a href="#ZakatTracker-656"><span class="linenos"> 656</span></a>            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">file</span><span class="p">,</span>
</span><span id="ZakatTracker-657"><a href="#ZakatTracker-657"><span class="linenos"> 657</span></a>            <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
</span><span id="ZakatTracker-658"><a href="#ZakatTracker-658"><span class="linenos"> 658</span></a>            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
</span><span id="ZakatTracker-659"><a href="#ZakatTracker-659"><span class="linenos"> 659</span></a>            <span class="s1">&#39;math&#39;</span><span class="p">:</span> <span class="n">math_operation</span><span class="p">,</span>
</span><span id="ZakatTracker-660"><a href="#ZakatTracker-660"><span class="linenos"> 660</span></a>        <span class="p">})</span>
</span><span id="ZakatTracker-661"><a href="#ZakatTracker-661"><span class="linenos"> 661</span></a>        <span class="k">return</span> <span class="n">lock</span>
</span><span id="ZakatTracker-662"><a href="#ZakatTracker-662"><span class="linenos"> 662</span></a>
</span><span id="ZakatTracker-663"><a href="#ZakatTracker-663"><span class="linenos"> 663</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nolock</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-664"><a href="#ZakatTracker-664"><span class="linenos"> 664</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-665"><a href="#ZakatTracker-665"><span class="linenos"> 665</span></a><span class="sd">        Check if the vault lock is currently not set.</span>
</span><span id="ZakatTracker-666"><a href="#ZakatTracker-666"><span class="linenos"> 666</span></a>
</span><span id="ZakatTracker-667"><a href="#ZakatTracker-667"><span class="linenos"> 667</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-668"><a href="#ZakatTracker-668"><span class="linenos"> 668</span></a><span class="sd">        - bool: True if the vault lock is not set, False otherwise.</span>
</span><span id="ZakatTracker-669"><a href="#ZakatTracker-669"><span class="linenos"> 669</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-670"><a href="#ZakatTracker-670"><span class="linenos"> 670</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;lock&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker-671"><a href="#ZakatTracker-671"><span class="linenos"> 671</span></a>
</span><span id="ZakatTracker-672"><a href="#ZakatTracker-672"><span class="linenos"> 672</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-673"><a href="#ZakatTracker-673"><span class="linenos"> 673</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-674"><a href="#ZakatTracker-674"><span class="linenos"> 674</span></a><span class="sd">        Acquires a lock on the ZakatTracker instance.</span>
</span><span id="ZakatTracker-675"><a href="#ZakatTracker-675"><span class="linenos"> 675</span></a>
</span><span id="ZakatTracker-676"><a href="#ZakatTracker-676"><span class="linenos"> 676</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-677"><a href="#ZakatTracker-677"><span class="linenos"> 677</span></a><span class="sd">        - int: The lock ID. This ID can be used to release the lock later.</span>
</span><span id="ZakatTracker-678"><a href="#ZakatTracker-678"><span class="linenos"> 678</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-679"><a href="#ZakatTracker-679"><span class="linenos"> 679</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">()</span>
</span><span id="ZakatTracker-680"><a href="#ZakatTracker-680"><span class="linenos"> 680</span></a>
</span><span id="ZakatTracker-681"><a href="#ZakatTracker-681"><span class="linenos"> 681</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">steps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker-682"><a href="#ZakatTracker-682"><span class="linenos"> 682</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-683"><a href="#ZakatTracker-683"><span class="linenos"> 683</span></a><span class="sd">        Returns a copy of the history of steps taken in the ZakatTracker.</span>
</span><span id="ZakatTracker-684"><a href="#ZakatTracker-684"><span class="linenos"> 684</span></a>
</span><span id="ZakatTracker-685"><a href="#ZakatTracker-685"><span class="linenos"> 685</span></a><span class="sd">        The history is a dictionary where each key is a unique identifier for a step,</span>
</span><span id="ZakatTracker-686"><a href="#ZakatTracker-686"><span class="linenos"> 686</span></a><span class="sd">        and the corresponding value is a dictionary containing information about the step.</span>
</span><span id="ZakatTracker-687"><a href="#ZakatTracker-687"><span class="linenos"> 687</span></a>
</span><span id="ZakatTracker-688"><a href="#ZakatTracker-688"><span class="linenos"> 688</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-689"><a href="#ZakatTracker-689"><span class="linenos"> 689</span></a><span class="sd">        - dict: A copy of the history of steps taken in the ZakatTracker.</span>
</span><span id="ZakatTracker-690"><a href="#ZakatTracker-690"><span class="linenos"> 690</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-691"><a href="#ZakatTracker-691"><span class="linenos"> 691</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="ZakatTracker-692"><a href="#ZakatTracker-692"><span class="linenos"> 692</span></a>
</span><span id="ZakatTracker-693"><a href="#ZakatTracker-693"><span class="linenos"> 693</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">free</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lock</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">auto_save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-694"><a href="#ZakatTracker-694"><span class="linenos"> 694</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-695"><a href="#ZakatTracker-695"><span class="linenos"> 695</span></a><span class="sd">        Releases the lock on the database.</span>
</span><span id="ZakatTracker-696"><a href="#ZakatTracker-696"><span class="linenos"> 696</span></a>
</span><span id="ZakatTracker-697"><a href="#ZakatTracker-697"><span class="linenos"> 697</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-698"><a href="#ZakatTracker-698"><span class="linenos"> 698</span></a><span class="sd">        - lock (int): The lock ID to be released.</span>
</span><span id="ZakatTracker-699"><a href="#ZakatTracker-699"><span class="linenos"> 699</span></a><span class="sd">        - auto_save (bool): Whether to automatically save the database after releasing the lock.</span>
</span><span id="ZakatTracker-700"><a href="#ZakatTracker-700"><span class="linenos"> 700</span></a>
</span><span id="ZakatTracker-701"><a href="#ZakatTracker-701"><span class="linenos"> 701</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-702"><a href="#ZakatTracker-702"><span class="linenos"> 702</span></a><span class="sd">        - bool: True if the lock is successfully released and (optionally) saved, False otherwise.</span>
</span><span id="ZakatTracker-703"><a href="#ZakatTracker-703"><span class="linenos"> 703</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-704"><a href="#ZakatTracker-704"><span class="linenos"> 704</span></a>        <span class="k">if</span> <span class="n">lock</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;lock&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-705"><a href="#ZakatTracker-705"><span class="linenos"> 705</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;lock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ZakatTracker-706"><a href="#ZakatTracker-706"><span class="linenos"> 706</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">clean_history</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker-707"><a href="#ZakatTracker-707"><span class="linenos"> 707</span></a>            <span class="k">if</span> <span class="n">auto_save</span><span class="p">:</span>
</span><span id="ZakatTracker-708"><a href="#ZakatTracker-708"><span class="linenos"> 708</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>
</span><span id="ZakatTracker-709"><a href="#ZakatTracker-709"><span class="linenos"> 709</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker-710"><a href="#ZakatTracker-710"><span class="linenos"> 710</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker-711"><a href="#ZakatTracker-711"><span class="linenos"> 711</span></a>
</span><span id="ZakatTracker-712"><a href="#ZakatTracker-712"><span class="linenos"> 712</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-713"><a href="#ZakatTracker-713"><span class="linenos"> 713</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-714"><a href="#ZakatTracker-714"><span class="linenos"> 714</span></a><span class="sd">        Revert the last operation.</span>
</span><span id="ZakatTracker-715"><a href="#ZakatTracker-715"><span class="linenos"> 715</span></a>
</span><span id="ZakatTracker-716"><a href="#ZakatTracker-716"><span class="linenos"> 716</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-717"><a href="#ZakatTracker-717"><span class="linenos"> 717</span></a><span class="sd">        - dry (bool): If True, the function will not modify the data, but will simulate the operation. Default is True.</span>
</span><span id="ZakatTracker-718"><a href="#ZakatTracker-718"><span class="linenos"> 718</span></a><span class="sd">        - debug (bool): If True, the function will print debug information. Default is False.</span>
</span><span id="ZakatTracker-719"><a href="#ZakatTracker-719"><span class="linenos"> 719</span></a>
</span><span id="ZakatTracker-720"><a href="#ZakatTracker-720"><span class="linenos"> 720</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-721"><a href="#ZakatTracker-721"><span class="linenos"> 721</span></a><span class="sd">        - bool: True if the operation was successful, False otherwise.</span>
</span><span id="ZakatTracker-722"><a href="#ZakatTracker-722"><span class="linenos"> 722</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-723"><a href="#ZakatTracker-723"><span class="linenos"> 723</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-724"><a href="#ZakatTracker-724"><span class="linenos"> 724</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker-725"><a href="#ZakatTracker-725"><span class="linenos"> 725</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-726"><a href="#ZakatTracker-726"><span class="linenos"> 726</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker-727"><a href="#ZakatTracker-727"><span class="linenos"> 727</span></a>        <span class="n">ref</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker-728"><a href="#ZakatTracker-728"><span class="linenos"> 728</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-729"><a href="#ZakatTracker-729"><span class="linenos"> 729</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
</span><span id="ZakatTracker-730"><a href="#ZakatTracker-730"><span class="linenos"> 730</span></a>        <span class="n">memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">]</span>
</span><span id="ZakatTracker-731"><a href="#ZakatTracker-731"><span class="linenos"> 731</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-732"><a href="#ZakatTracker-732"><span class="linenos"> 732</span></a>            <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">memory</span><span class="p">),</span> <span class="s1">&#39;memory&#39;</span><span class="p">,</span> <span class="n">memory</span><span class="p">)</span>
</span><span id="ZakatTracker-733"><a href="#ZakatTracker-733"><span class="linenos"> 733</span></a>        <span class="n">limit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ZakatTracker-734"><a href="#ZakatTracker-734"><span class="linenos"> 734</span></a>        <span class="n">sub_positive_log_negative</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-735"><a href="#ZakatTracker-735"><span class="linenos"> 735</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ZakatTracker-736"><a href="#ZakatTracker-736"><span class="linenos"> 736</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">memory</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="ZakatTracker-737"><a href="#ZakatTracker-737"><span class="linenos"> 737</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-738"><a href="#ZakatTracker-738"><span class="linenos"> 738</span></a>                <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker-739"><a href="#ZakatTracker-739"><span class="linenos"> 739</span></a>            <span class="k">match</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-740"><a href="#ZakatTracker-740"><span class="linenos"> 740</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">CREATE</span><span class="p">:</span>
</span><span id="ZakatTracker-741"><a href="#ZakatTracker-741"><span class="linenos"> 741</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-742"><a href="#ZakatTracker-742"><span class="linenos"> 742</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker-743"><a href="#ZakatTracker-743"><span class="linenos"> 743</span></a>                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-744"><a href="#ZakatTracker-744"><span class="linenos"> 744</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]])</span>
</span><span id="ZakatTracker-745"><a href="#ZakatTracker-745"><span class="linenos"> 745</span></a>                            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-746"><a href="#ZakatTracker-746"><span class="linenos"> 746</span></a>                            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-747"><a href="#ZakatTracker-747"><span class="linenos"> 747</span></a>                            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-748"><a href="#ZakatTracker-748"><span class="linenos"> 748</span></a>                            <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker-749"><a href="#ZakatTracker-749"><span class="linenos"> 749</span></a>                                <span class="k">continue</span>
</span><span id="ZakatTracker-750"><a href="#ZakatTracker-750"><span class="linenos"> 750</span></a>                            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]]</span>
</span><span id="ZakatTracker-751"><a href="#ZakatTracker-751"><span class="linenos"> 751</span></a>
</span><span id="ZakatTracker-752"><a href="#ZakatTracker-752"><span class="linenos"> 752</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">TRACK</span><span class="p">:</span>
</span><span id="ZakatTracker-753"><a href="#ZakatTracker-753"><span class="linenos"> 753</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-754"><a href="#ZakatTracker-754"><span class="linenos"> 754</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker-755"><a href="#ZakatTracker-755"><span class="linenos"> 755</span></a>                            <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker-756"><a href="#ZakatTracker-756"><span class="linenos"> 756</span></a>                                <span class="k">continue</span>
</span><span id="ZakatTracker-757"><a href="#ZakatTracker-757"><span class="linenos"> 757</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-758"><a href="#ZakatTracker-758"><span class="linenos"> 758</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-759"><a href="#ZakatTracker-759"><span class="linenos"> 759</span></a>                            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]]</span>
</span><span id="ZakatTracker-760"><a href="#ZakatTracker-760"><span class="linenos"> 760</span></a>
</span><span id="ZakatTracker-761"><a href="#ZakatTracker-761"><span class="linenos"> 761</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">LOG</span><span class="p">:</span>
</span><span id="ZakatTracker-762"><a href="#ZakatTracker-762"><span class="linenos"> 762</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-763"><a href="#ZakatTracker-763"><span class="linenos"> 763</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker-764"><a href="#ZakatTracker-764"><span class="linenos"> 764</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-765"><a href="#ZakatTracker-765"><span class="linenos"> 765</span></a>                                <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker-766"><a href="#ZakatTracker-766"><span class="linenos"> 766</span></a>                                    <span class="k">continue</span>
</span><span id="ZakatTracker-767"><a href="#ZakatTracker-767"><span class="linenos"> 767</span></a>                                <span class="k">if</span> <span class="n">sub_positive_log_negative</span> <span class="o">==</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-768"><a href="#ZakatTracker-768"><span class="linenos"> 768</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-769"><a href="#ZakatTracker-769"><span class="linenos"> 769</span></a>                                    <span class="n">sub_positive_log_negative</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-770"><a href="#ZakatTracker-770"><span class="linenos"> 770</span></a>                                <span class="n">box_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-771"><a href="#ZakatTracker-771"><span class="linenos"> 771</span></a>                                <span class="k">if</span> <span class="ow">not</span> <span class="n">box_ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-772"><a href="#ZakatTracker-772"><span class="linenos"> 772</span></a>                                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">],</span> <span class="n">box_ref</span><span class="p">)</span>
</span><span id="ZakatTracker-773"><a href="#ZakatTracker-773"><span class="linenos"> 773</span></a>                                    <span class="n">box_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-774"><a href="#ZakatTracker-774"><span class="linenos"> 774</span></a>                                    <span class="k">assert</span> <span class="n">box_value</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker-775"><a href="#ZakatTracker-775"><span class="linenos"> 775</span></a>
</span><span id="ZakatTracker-776"><a href="#ZakatTracker-776"><span class="linenos"> 776</span></a>                                    <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-777"><a href="#ZakatTracker-777"><span class="linenos"> 777</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">box_ref</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">box_value</span>
</span><span id="ZakatTracker-778"><a href="#ZakatTracker-778"><span class="linenos"> 778</span></a>                                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="ZakatTracker-779"><a href="#ZakatTracker-779"><span class="linenos"> 779</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">box_ref</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span>
</span><span id="ZakatTracker-780"><a href="#ZakatTracker-780"><span class="linenos"> 780</span></a>                                            <span class="o">-</span><span class="n">box_value</span><span class="p">)</span>
</span><span id="ZakatTracker-781"><a href="#ZakatTracker-781"><span class="linenos"> 781</span></a>
</span><span id="ZakatTracker-782"><a href="#ZakatTracker-782"><span class="linenos"> 782</span></a>                                    <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-783"><a href="#ZakatTracker-783"><span class="linenos"> 783</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">box_value</span>
</span><span id="ZakatTracker-784"><a href="#ZakatTracker-784"><span class="linenos"> 784</span></a>                                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="ZakatTracker-785"><a href="#ZakatTracker-785"><span class="linenos"> 785</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="o">-</span><span class="n">box_value</span><span class="p">)</span>
</span><span id="ZakatTracker-786"><a href="#ZakatTracker-786"><span class="linenos"> 786</span></a>
</span><span id="ZakatTracker-787"><a href="#ZakatTracker-787"><span class="linenos"> 787</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-788"><a href="#ZakatTracker-788"><span class="linenos"> 788</span></a>                                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]]</span>
</span><span id="ZakatTracker-789"><a href="#ZakatTracker-789"><span class="linenos"> 789</span></a>
</span><span id="ZakatTracker-790"><a href="#ZakatTracker-790"><span class="linenos"> 790</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">SUB</span><span class="p">:</span>
</span><span id="ZakatTracker-791"><a href="#ZakatTracker-791"><span class="linenos"> 791</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-792"><a href="#ZakatTracker-792"><span class="linenos"> 792</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker-793"><a href="#ZakatTracker-793"><span class="linenos"> 793</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-794"><a href="#ZakatTracker-794"><span class="linenos"> 794</span></a>                                <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker-795"><a href="#ZakatTracker-795"><span class="linenos"> 795</span></a>                                    <span class="k">continue</span>
</span><span id="ZakatTracker-796"><a href="#ZakatTracker-796"><span class="linenos"> 796</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-797"><a href="#ZakatTracker-797"><span class="linenos"> 797</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-798"><a href="#ZakatTracker-798"><span class="linenos"> 798</span></a>                                <span class="n">sub_positive_log_negative</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-799"><a href="#ZakatTracker-799"><span class="linenos"> 799</span></a>
</span><span id="ZakatTracker-800"><a href="#ZakatTracker-800"><span class="linenos"> 800</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">ADD_FILE</span><span class="p">:</span>
</span><span id="ZakatTracker-801"><a href="#ZakatTracker-801"><span class="linenos"> 801</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-802"><a href="#ZakatTracker-802"><span class="linenos"> 802</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker-803"><a href="#ZakatTracker-803"><span class="linenos"> 803</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-804"><a href="#ZakatTracker-804"><span class="linenos"> 804</span></a>                                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;file&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-805"><a href="#ZakatTracker-805"><span class="linenos"> 805</span></a>                                    <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker-806"><a href="#ZakatTracker-806"><span class="linenos"> 806</span></a>                                        <span class="k">continue</span>
</span><span id="ZakatTracker-807"><a href="#ZakatTracker-807"><span class="linenos"> 807</span></a>                                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]]</span>
</span><span id="ZakatTracker-808"><a href="#ZakatTracker-808"><span class="linenos"> 808</span></a>
</span><span id="ZakatTracker-809"><a href="#ZakatTracker-809"><span class="linenos"> 809</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">REMOVE_FILE</span><span class="p">:</span>
</span><span id="ZakatTracker-810"><a href="#ZakatTracker-810"><span class="linenos"> 810</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-811"><a href="#ZakatTracker-811"><span class="linenos"> 811</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker-812"><a href="#ZakatTracker-812"><span class="linenos"> 812</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-813"><a href="#ZakatTracker-813"><span class="linenos"> 813</span></a>                                <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker-814"><a href="#ZakatTracker-814"><span class="linenos"> 814</span></a>                                    <span class="k">continue</span>
</span><span id="ZakatTracker-815"><a href="#ZakatTracker-815"><span class="linenos"> 815</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-816"><a href="#ZakatTracker-816"><span class="linenos"> 816</span></a>
</span><span id="ZakatTracker-817"><a href="#ZakatTracker-817"><span class="linenos"> 817</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">BOX_TRANSFER</span><span class="p">:</span>
</span><span id="ZakatTracker-818"><a href="#ZakatTracker-818"><span class="linenos"> 818</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-819"><a href="#ZakatTracker-819"><span class="linenos"> 819</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker-820"><a href="#ZakatTracker-820"><span class="linenos"> 820</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-821"><a href="#ZakatTracker-821"><span class="linenos"> 821</span></a>                                <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker-822"><a href="#ZakatTracker-822"><span class="linenos"> 822</span></a>                                    <span class="k">continue</span>
</span><span id="ZakatTracker-823"><a href="#ZakatTracker-823"><span class="linenos"> 823</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-824"><a href="#ZakatTracker-824"><span class="linenos"> 824</span></a>
</span><span id="ZakatTracker-825"><a href="#ZakatTracker-825"><span class="linenos"> 825</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">EXCHANGE</span><span class="p">:</span>
</span><span id="ZakatTracker-826"><a href="#ZakatTracker-826"><span class="linenos"> 826</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-827"><a href="#ZakatTracker-827"><span class="linenos"> 827</span></a>                        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-828"><a href="#ZakatTracker-828"><span class="linenos"> 828</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]]:</span>
</span><span id="ZakatTracker-829"><a href="#ZakatTracker-829"><span class="linenos"> 829</span></a>                                <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker-830"><a href="#ZakatTracker-830"><span class="linenos"> 830</span></a>                                    <span class="k">continue</span>
</span><span id="ZakatTracker-831"><a href="#ZakatTracker-831"><span class="linenos"> 831</span></a>                                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]]</span>
</span><span id="ZakatTracker-832"><a href="#ZakatTracker-832"><span class="linenos"> 832</span></a>
</span><span id="ZakatTracker-833"><a href="#ZakatTracker-833"><span class="linenos"> 833</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">REPORT</span><span class="p">:</span>
</span><span id="ZakatTracker-834"><a href="#ZakatTracker-834"><span class="linenos"> 834</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-835"><a href="#ZakatTracker-835"><span class="linenos"> 835</span></a>                        <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker-836"><a href="#ZakatTracker-836"><span class="linenos"> 836</span></a>                            <span class="k">continue</span>
</span><span id="ZakatTracker-837"><a href="#ZakatTracker-837"><span class="linenos"> 837</span></a>                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]]</span>
</span><span id="ZakatTracker-838"><a href="#ZakatTracker-838"><span class="linenos"> 838</span></a>
</span><span id="ZakatTracker-839"><a href="#ZakatTracker-839"><span class="linenos"> 839</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">ZAKAT</span><span class="p">:</span>
</span><span id="ZakatTracker-840"><a href="#ZakatTracker-840"><span class="linenos"> 840</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-841"><a href="#ZakatTracker-841"><span class="linenos"> 841</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker-842"><a href="#ZakatTracker-842"><span class="linenos"> 842</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-843"><a href="#ZakatTracker-843"><span class="linenos"> 843</span></a>                                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]]:</span>
</span><span id="ZakatTracker-844"><a href="#ZakatTracker-844"><span class="linenos"> 844</span></a>                                    <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker-845"><a href="#ZakatTracker-845"><span class="linenos"> 845</span></a>                                        <span class="k">continue</span>
</span><span id="ZakatTracker-846"><a href="#ZakatTracker-846"><span class="linenos"> 846</span></a>                                    <span class="k">match</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;math&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-847"><a href="#ZakatTracker-847"><span class="linenos"> 847</span></a>                                        <span class="k">case</span> <span class="n">MathOperation</span><span class="o">.</span><span class="n">ADDITION</span><span class="p">:</span>
</span><span id="ZakatTracker-848"><a href="#ZakatTracker-848"><span class="linenos"> 848</span></a>                                            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]]</span> <span class="o">-=</span> <span class="n">x</span><span class="p">[</span>
</span><span id="ZakatTracker-849"><a href="#ZakatTracker-849"><span class="linenos"> 849</span></a>                                                <span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-850"><a href="#ZakatTracker-850"><span class="linenos"> 850</span></a>                                        <span class="k">case</span> <span class="n">MathOperation</span><span class="o">.</span><span class="n">EQUAL</span><span class="p">:</span>
</span><span id="ZakatTracker-851"><a href="#ZakatTracker-851"><span class="linenos"> 851</span></a>                                            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-852"><a href="#ZakatTracker-852"><span class="linenos"> 852</span></a>                                        <span class="k">case</span> <span class="n">MathOperation</span><span class="o">.</span><span class="n">SUBTRACTION</span><span class="p">:</span>
</span><span id="ZakatTracker-853"><a href="#ZakatTracker-853"><span class="linenos"> 853</span></a>                                            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span>
</span><span id="ZakatTracker-854"><a href="#ZakatTracker-854"><span class="linenos"> 854</span></a>                                                <span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-855"><a href="#ZakatTracker-855"><span class="linenos"> 855</span></a>
</span><span id="ZakatTracker-856"><a href="#ZakatTracker-856"><span class="linenos"> 856</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker-857"><a href="#ZakatTracker-857"><span class="linenos"> 857</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">]</span>
</span><span id="ZakatTracker-858"><a href="#ZakatTracker-858"><span class="linenos"> 858</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker-859"><a href="#ZakatTracker-859"><span class="linenos"> 859</span></a>
</span><span id="ZakatTracker-860"><a href="#ZakatTracker-860"><span class="linenos"> 860</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">vault</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker-861"><a href="#ZakatTracker-861"><span class="linenos"> 861</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-862"><a href="#ZakatTracker-862"><span class="linenos"> 862</span></a><span class="sd">        Returns a copy of the internal vault dictionary.</span>
</span><span id="ZakatTracker-863"><a href="#ZakatTracker-863"><span class="linenos"> 863</span></a>
</span><span id="ZakatTracker-864"><a href="#ZakatTracker-864"><span class="linenos"> 864</span></a><span class="sd">        This method is used to retrieve the current state of the ZakatTracker object.</span>
</span><span id="ZakatTracker-865"><a href="#ZakatTracker-865"><span class="linenos"> 865</span></a><span class="sd">        It provides a snapshot of the internal data structure, allowing for further</span>
</span><span id="ZakatTracker-866"><a href="#ZakatTracker-866"><span class="linenos"> 866</span></a><span class="sd">        processing or analysis.</span>
</span><span id="ZakatTracker-867"><a href="#ZakatTracker-867"><span class="linenos"> 867</span></a>
</span><span id="ZakatTracker-868"><a href="#ZakatTracker-868"><span class="linenos"> 868</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-869"><a href="#ZakatTracker-869"><span class="linenos"> 869</span></a><span class="sd">        - dict: A copy of the internal vault dictionary.</span>
</span><span id="ZakatTracker-870"><a href="#ZakatTracker-870"><span class="linenos"> 870</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-871"><a href="#ZakatTracker-871"><span class="linenos"> 871</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="ZakatTracker-872"><a href="#ZakatTracker-872"><span class="linenos"> 872</span></a>
</span><span id="ZakatTracker-873"><a href="#ZakatTracker-873"><span class="linenos"> 873</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stats_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
</span><span id="ZakatTracker-874"><a href="#ZakatTracker-874"><span class="linenos"> 874</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-875"><a href="#ZakatTracker-875"><span class="linenos"> 875</span></a><span class="sd">        Initialize and return a dictionary containing initial statistics for the ZakatTracker instance.</span>
</span><span id="ZakatTracker-876"><a href="#ZakatTracker-876"><span class="linenos"> 876</span></a>
</span><span id="ZakatTracker-877"><a href="#ZakatTracker-877"><span class="linenos"> 877</span></a><span class="sd">        The dictionary contains two keys: &#39;database&#39; and &#39;ram&#39;. Each key maps to a tuple containing two elements:</span>
</span><span id="ZakatTracker-878"><a href="#ZakatTracker-878"><span class="linenos"> 878</span></a><span class="sd">        - The initial size of the respective statistic in bytes (int).</span>
</span><span id="ZakatTracker-879"><a href="#ZakatTracker-879"><span class="linenos"> 879</span></a><span class="sd">        - The initial size of the respective statistic in a human-readable format (str).</span>
</span><span id="ZakatTracker-880"><a href="#ZakatTracker-880"><span class="linenos"> 880</span></a>
</span><span id="ZakatTracker-881"><a href="#ZakatTracker-881"><span class="linenos"> 881</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-882"><a href="#ZakatTracker-882"><span class="linenos"> 882</span></a><span class="sd">        - dict[str, tuple]: A dictionary with initial statistics for the ZakatTracker instance.</span>
</span><span id="ZakatTracker-883"><a href="#ZakatTracker-883"><span class="linenos"> 883</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-884"><a href="#ZakatTracker-884"><span class="linenos"> 884</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ZakatTracker-885"><a href="#ZakatTracker-885"><span class="linenos"> 885</span></a>            <span class="s1">&#39;database&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">),</span>
</span><span id="ZakatTracker-886"><a href="#ZakatTracker-886"><span class="linenos"> 886</span></a>            <span class="s1">&#39;ram&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">),</span>
</span><span id="ZakatTracker-887"><a href="#ZakatTracker-887"><span class="linenos"> 887</span></a>        <span class="p">}</span>
</span><span id="ZakatTracker-888"><a href="#ZakatTracker-888"><span class="linenos"> 888</span></a>
</span><span id="ZakatTracker-889"><a href="#ZakatTracker-889"><span class="linenos"> 889</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
</span><span id="ZakatTracker-890"><a href="#ZakatTracker-890"><span class="linenos"> 890</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-891"><a href="#ZakatTracker-891"><span class="linenos"> 891</span></a><span class="sd">        Calculates and returns statistics about the object&#39;s data storage.</span>
</span><span id="ZakatTracker-892"><a href="#ZakatTracker-892"><span class="linenos"> 892</span></a>
</span><span id="ZakatTracker-893"><a href="#ZakatTracker-893"><span class="linenos"> 893</span></a><span class="sd">        This method determines the size of the database file on disk and the</span>
</span><span id="ZakatTracker-894"><a href="#ZakatTracker-894"><span class="linenos"> 894</span></a><span class="sd">        size of the data currently held in RAM (likely within a dictionary).</span>
</span><span id="ZakatTracker-895"><a href="#ZakatTracker-895"><span class="linenos"> 895</span></a><span class="sd">        Both sizes are reported in bytes and in a human-readable format</span>
</span><span id="ZakatTracker-896"><a href="#ZakatTracker-896"><span class="linenos"> 896</span></a><span class="sd">        (e.g., KB, MB).</span>
</span><span id="ZakatTracker-897"><a href="#ZakatTracker-897"><span class="linenos"> 897</span></a>
</span><span id="ZakatTracker-898"><a href="#ZakatTracker-898"><span class="linenos"> 898</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-899"><a href="#ZakatTracker-899"><span class="linenos"> 899</span></a><span class="sd">        - ignore_ram (bool): Whether to ignore the RAM size. Default is True</span>
</span><span id="ZakatTracker-900"><a href="#ZakatTracker-900"><span class="linenos"> 900</span></a>
</span><span id="ZakatTracker-901"><a href="#ZakatTracker-901"><span class="linenos"> 901</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-902"><a href="#ZakatTracker-902"><span class="linenos"> 902</span></a><span class="sd">        - dict[str, tuple]: A dictionary containing the following statistics:</span>
</span><span id="ZakatTracker-903"><a href="#ZakatTracker-903"><span class="linenos"> 903</span></a>
</span><span id="ZakatTracker-904"><a href="#ZakatTracker-904"><span class="linenos"> 904</span></a><span class="sd">            * &#39;database&#39;: A tuple with two elements:</span>
</span><span id="ZakatTracker-905"><a href="#ZakatTracker-905"><span class="linenos"> 905</span></a><span class="sd">                - The database file size in bytes (int).</span>
</span><span id="ZakatTracker-906"><a href="#ZakatTracker-906"><span class="linenos"> 906</span></a><span class="sd">                - The database file size in human-readable format (str).</span>
</span><span id="ZakatTracker-907"><a href="#ZakatTracker-907"><span class="linenos"> 907</span></a><span class="sd">            * &#39;ram&#39;: A tuple with two elements:</span>
</span><span id="ZakatTracker-908"><a href="#ZakatTracker-908"><span class="linenos"> 908</span></a><span class="sd">                - The RAM usage (dictionary size) in bytes (int).</span>
</span><span id="ZakatTracker-909"><a href="#ZakatTracker-909"><span class="linenos"> 909</span></a><span class="sd">                - The RAM usage in human-readable format (str).</span>
</span><span id="ZakatTracker-910"><a href="#ZakatTracker-910"><span class="linenos"> 910</span></a>
</span><span id="ZakatTracker-911"><a href="#ZakatTracker-911"><span class="linenos"> 911</span></a><span class="sd">        Example:</span>
</span><span id="ZakatTracker-912"><a href="#ZakatTracker-912"><span class="linenos"> 912</span></a><span class="sd">        &gt;&gt;&gt; stats = my_object.stats()</span>
</span><span id="ZakatTracker-913"><a href="#ZakatTracker-913"><span class="linenos"> 913</span></a><span class="sd">        &gt;&gt;&gt; print(stats[&#39;database&#39;])</span>
</span><span id="ZakatTracker-914"><a href="#ZakatTracker-914"><span class="linenos"> 914</span></a><span class="sd">        (256000, &#39;250.0 KB&#39;)</span>
</span><span id="ZakatTracker-915"><a href="#ZakatTracker-915"><span class="linenos"> 915</span></a><span class="sd">        &gt;&gt;&gt; print(stats[&#39;ram&#39;])</span>
</span><span id="ZakatTracker-916"><a href="#ZakatTracker-916"><span class="linenos"> 916</span></a><span class="sd">        (12345, &#39;12.1 KB&#39;)</span>
</span><span id="ZakatTracker-917"><a href="#ZakatTracker-917"><span class="linenos"> 917</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-918"><a href="#ZakatTracker-918"><span class="linenos"> 918</span></a>        <span class="n">ram_size</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="k">if</span> <span class="n">ignore_ram</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dict_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vault</span><span class="p">())</span>
</span><span id="ZakatTracker-919"><a href="#ZakatTracker-919"><span class="linenos"> 919</span></a>        <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>
</span><span id="ZakatTracker-920"><a href="#ZakatTracker-920"><span class="linenos"> 920</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ZakatTracker-921"><a href="#ZakatTracker-921"><span class="linenos"> 921</span></a>            <span class="s1">&#39;database&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">file_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="n">file_size</span><span class="p">)),</span>
</span><span id="ZakatTracker-922"><a href="#ZakatTracker-922"><span class="linenos"> 922</span></a>            <span class="s1">&#39;ram&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">ram_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="n">ram_size</span><span class="p">)),</span>
</span><span id="ZakatTracker-923"><a href="#ZakatTracker-923"><span class="linenos"> 923</span></a>        <span class="p">}</span>
</span><span id="ZakatTracker-924"><a href="#ZakatTracker-924"><span class="linenos"> 924</span></a>
</span><span id="ZakatTracker-925"><a href="#ZakatTracker-925"><span class="linenos"> 925</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="ZakatTracker-926"><a href="#ZakatTracker-926"><span class="linenos"> 926</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-927"><a href="#ZakatTracker-927"><span class="linenos"> 927</span></a><span class="sd">        Retrieves information about files associated with this class.</span>
</span><span id="ZakatTracker-928"><a href="#ZakatTracker-928"><span class="linenos"> 928</span></a>
</span><span id="ZakatTracker-929"><a href="#ZakatTracker-929"><span class="linenos"> 929</span></a><span class="sd">        This class method provides a standardized way to gather details about</span>
</span><span id="ZakatTracker-930"><a href="#ZakatTracker-930"><span class="linenos"> 930</span></a><span class="sd">        files used by the class for storage, snapshots, and CSV imports.</span>
</span><span id="ZakatTracker-931"><a href="#ZakatTracker-931"><span class="linenos"> 931</span></a>
</span><span id="ZakatTracker-932"><a href="#ZakatTracker-932"><span class="linenos"> 932</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-933"><a href="#ZakatTracker-933"><span class="linenos"> 933</span></a><span class="sd">        - list[dict[str, str | int]]: A list of dictionaries, each containing information</span>
</span><span id="ZakatTracker-934"><a href="#ZakatTracker-934"><span class="linenos"> 934</span></a><span class="sd">            about a specific file:</span>
</span><span id="ZakatTracker-935"><a href="#ZakatTracker-935"><span class="linenos"> 935</span></a>
</span><span id="ZakatTracker-936"><a href="#ZakatTracker-936"><span class="linenos"> 936</span></a><span class="sd">            * type (str): The type of file (&#39;database&#39;, &#39;snapshot&#39;, &#39;import_csv&#39;).</span>
</span><span id="ZakatTracker-937"><a href="#ZakatTracker-937"><span class="linenos"> 937</span></a><span class="sd">            * path (str): The full file path.</span>
</span><span id="ZakatTracker-938"><a href="#ZakatTracker-938"><span class="linenos"> 938</span></a><span class="sd">            * exists (bool): Whether the file exists on the filesystem.</span>
</span><span id="ZakatTracker-939"><a href="#ZakatTracker-939"><span class="linenos"> 939</span></a><span class="sd">            * size (int): The file size in bytes (0 if the file doesn&#39;t exist).</span>
</span><span id="ZakatTracker-940"><a href="#ZakatTracker-940"><span class="linenos"> 940</span></a><span class="sd">            * human_readable_size (str): A human-friendly representation of the file size (e.g., &#39;10 KB&#39;, &#39;2.5 MB&#39;).</span>
</span><span id="ZakatTracker-941"><a href="#ZakatTracker-941"><span class="linenos"> 941</span></a>
</span><span id="ZakatTracker-942"><a href="#ZakatTracker-942"><span class="linenos"> 942</span></a><span class="sd">        Example:</span>
</span><span id="ZakatTracker-943"><a href="#ZakatTracker-943"><span class="linenos"> 943</span></a><span class="sd">        ```</span>
</span><span id="ZakatTracker-944"><a href="#ZakatTracker-944"><span class="linenos"> 944</span></a><span class="sd">        file_info = MyClass.files()</span>
</span><span id="ZakatTracker-945"><a href="#ZakatTracker-945"><span class="linenos"> 945</span></a><span class="sd">        for info in file_info:</span>
</span><span id="ZakatTracker-946"><a href="#ZakatTracker-946"><span class="linenos"> 946</span></a><span class="sd">            print(f&quot;Type: {info[&#39;type&#39;]}, Exists: {info[&#39;exists&#39;]}, Size: {info[&#39;human_readable_size&#39;]}&quot;)</span>
</span><span id="ZakatTracker-947"><a href="#ZakatTracker-947"><span class="linenos"> 947</span></a><span class="sd">        ```</span>
</span><span id="ZakatTracker-948"><a href="#ZakatTracker-948"><span class="linenos"> 948</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-949"><a href="#ZakatTracker-949"><span class="linenos"> 949</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker-950"><a href="#ZakatTracker-950"><span class="linenos"> 950</span></a>        <span class="k">for</span> <span class="n">file_type</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">{</span>
</span><span id="ZakatTracker-951"><a href="#ZakatTracker-951"><span class="linenos"> 951</span></a>            <span class="s1">&#39;database&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">(),</span>
</span><span id="ZakatTracker-952"><a href="#ZakatTracker-952"><span class="linenos"> 952</span></a>            <span class="s1">&#39;snapshot&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_cache_path</span><span class="p">(),</span>
</span><span id="ZakatTracker-953"><a href="#ZakatTracker-953"><span class="linenos"> 953</span></a>            <span class="s1">&#39;import_csv&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_csv_cache_path</span><span class="p">(),</span>
</span><span id="ZakatTracker-954"><a href="#ZakatTracker-954"><span class="linenos"> 954</span></a>        <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker-955"><a href="#ZakatTracker-955"><span class="linenos"> 955</span></a>            <span class="n">exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="ZakatTracker-956"><a href="#ZakatTracker-956"><span class="linenos"> 956</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">exists</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="ZakatTracker-957"><a href="#ZakatTracker-957"><span class="linenos"> 957</span></a>            <span class="n">human_readable_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="k">if</span> <span class="n">exists</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="ZakatTracker-958"><a href="#ZakatTracker-958"><span class="linenos"> 958</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="ZakatTracker-959"><a href="#ZakatTracker-959"><span class="linenos"> 959</span></a>                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">file_type</span><span class="p">,</span>
</span><span id="ZakatTracker-960"><a href="#ZakatTracker-960"><span class="linenos"> 960</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
</span><span id="ZakatTracker-961"><a href="#ZakatTracker-961"><span class="linenos"> 961</span></a>                <span class="s1">&#39;exists&#39;</span><span class="p">:</span> <span class="n">exists</span><span class="p">,</span>
</span><span id="ZakatTracker-962"><a href="#ZakatTracker-962"><span class="linenos"> 962</span></a>                <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
</span><span id="ZakatTracker-963"><a href="#ZakatTracker-963"><span class="linenos"> 963</span></a>                <span class="s1">&#39;human_readable_size&#39;</span><span class="p">:</span> <span class="n">human_readable_size</span><span class="p">,</span>
</span><span id="ZakatTracker-964"><a href="#ZakatTracker-964"><span class="linenos"> 964</span></a>            <span class="p">})</span>
</span><span id="ZakatTracker-965"><a href="#ZakatTracker-965"><span class="linenos"> 965</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="ZakatTracker-966"><a href="#ZakatTracker-966"><span class="linenos"> 966</span></a>
</span><span id="ZakatTracker-967"><a href="#ZakatTracker-967"><span class="linenos"> 967</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">account_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-968"><a href="#ZakatTracker-968"><span class="linenos"> 968</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-969"><a href="#ZakatTracker-969"><span class="linenos"> 969</span></a><span class="sd">        Check if the given account exists in the vault.</span>
</span><span id="ZakatTracker-970"><a href="#ZakatTracker-970"><span class="linenos"> 970</span></a>
</span><span id="ZakatTracker-971"><a href="#ZakatTracker-971"><span class="linenos"> 971</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-972"><a href="#ZakatTracker-972"><span class="linenos"> 972</span></a><span class="sd">        - account (str): The account number to check.</span>
</span><span id="ZakatTracker-973"><a href="#ZakatTracker-973"><span class="linenos"> 973</span></a>
</span><span id="ZakatTracker-974"><a href="#ZakatTracker-974"><span class="linenos"> 974</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-975"><a href="#ZakatTracker-975"><span class="linenos"> 975</span></a><span class="sd">        - bool: True if the account exists, False otherwise.</span>
</span><span id="ZakatTracker-976"><a href="#ZakatTracker-976"><span class="linenos"> 976</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-977"><a href="#ZakatTracker-977"><span class="linenos"> 977</span></a>        <span class="k">return</span> <span class="n">account</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-978"><a href="#ZakatTracker-978"><span class="linenos"> 978</span></a>
</span><span id="ZakatTracker-979"><a href="#ZakatTracker-979"><span class="linenos"> 979</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">box_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-980"><a href="#ZakatTracker-980"><span class="linenos"> 980</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-981"><a href="#ZakatTracker-981"><span class="linenos"> 981</span></a><span class="sd">        Calculate the size of the box for a specific account.</span>
</span><span id="ZakatTracker-982"><a href="#ZakatTracker-982"><span class="linenos"> 982</span></a>
</span><span id="ZakatTracker-983"><a href="#ZakatTracker-983"><span class="linenos"> 983</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-984"><a href="#ZakatTracker-984"><span class="linenos"> 984</span></a><span class="sd">        - account (str): The account number for which the box size needs to be calculated.</span>
</span><span id="ZakatTracker-985"><a href="#ZakatTracker-985"><span class="linenos"> 985</span></a>
</span><span id="ZakatTracker-986"><a href="#ZakatTracker-986"><span class="linenos"> 986</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-987"><a href="#ZakatTracker-987"><span class="linenos"> 987</span></a><span class="sd">        - int: The size of the box for the given account. If the account does not exist, -1 is returned.</span>
</span><span id="ZakatTracker-988"><a href="#ZakatTracker-988"><span class="linenos"> 988</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-989"><a href="#ZakatTracker-989"><span class="linenos"> 989</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker-990"><a href="#ZakatTracker-990"><span class="linenos"> 990</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-991"><a href="#ZakatTracker-991"><span class="linenos"> 991</span></a>        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="ZakatTracker-992"><a href="#ZakatTracker-992"><span class="linenos"> 992</span></a>
</span><span id="ZakatTracker-993"><a href="#ZakatTracker-993"><span class="linenos"> 993</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">log_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-994"><a href="#ZakatTracker-994"><span class="linenos"> 994</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-995"><a href="#ZakatTracker-995"><span class="linenos"> 995</span></a><span class="sd">        Get the size of the log for a specific account.</span>
</span><span id="ZakatTracker-996"><a href="#ZakatTracker-996"><span class="linenos"> 996</span></a>
</span><span id="ZakatTracker-997"><a href="#ZakatTracker-997"><span class="linenos"> 997</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-998"><a href="#ZakatTracker-998"><span class="linenos"> 998</span></a><span class="sd">        - account (str): The account number for which the log size needs to be calculated.</span>
</span><span id="ZakatTracker-999"><a href="#ZakatTracker-999"><span class="linenos"> 999</span></a>
</span><span id="ZakatTracker-1000"><a href="#ZakatTracker-1000"><span class="linenos">1000</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1001"><a href="#ZakatTracker-1001"><span class="linenos">1001</span></a><span class="sd">        - int: The size of the log for the given account. If the account does not exist, -1 is returned.</span>
</span><span id="ZakatTracker-1002"><a href="#ZakatTracker-1002"><span class="linenos">1002</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1003"><a href="#ZakatTracker-1003"><span class="linenos">1003</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker-1004"><a href="#ZakatTracker-1004"><span class="linenos">1004</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-1005"><a href="#ZakatTracker-1005"><span class="linenos">1005</span></a>        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="ZakatTracker-1006"><a href="#ZakatTracker-1006"><span class="linenos">1006</span></a>
</span><span id="ZakatTracker-1007"><a href="#ZakatTracker-1007"><span class="linenos">1007</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-1008"><a href="#ZakatTracker-1008"><span class="linenos">1008</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">file_hash</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;blake2b&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZakatTracker-1009"><a href="#ZakatTracker-1009"><span class="linenos">1009</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1010"><a href="#ZakatTracker-1010"><span class="linenos">1010</span></a><span class="sd">        Calculates the hash of a file using the specified algorithm.</span>
</span><span id="ZakatTracker-1011"><a href="#ZakatTracker-1011"><span class="linenos">1011</span></a>
</span><span id="ZakatTracker-1012"><a href="#ZakatTracker-1012"><span class="linenos">1012</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1013"><a href="#ZakatTracker-1013"><span class="linenos">1013</span></a><span class="sd">        - file_path (str): The path to the file.</span>
</span><span id="ZakatTracker-1014"><a href="#ZakatTracker-1014"><span class="linenos">1014</span></a><span class="sd">        - algorithm (str, optional): The hashing algorithm to use. Defaults to &quot;blake2b&quot;.</span>
</span><span id="ZakatTracker-1015"><a href="#ZakatTracker-1015"><span class="linenos">1015</span></a>
</span><span id="ZakatTracker-1016"><a href="#ZakatTracker-1016"><span class="linenos">1016</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1017"><a href="#ZakatTracker-1017"><span class="linenos">1017</span></a><span class="sd">        - str: The hexadecimal representation of the file&#39;s hash.</span>
</span><span id="ZakatTracker-1018"><a href="#ZakatTracker-1018"><span class="linenos">1018</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1019"><a href="#ZakatTracker-1019"><span class="linenos">1019</span></a>        <span class="n">hash_obj</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">algorithm</span><span class="p">)</span>  <span class="c1"># Create the hash object</span>
</span><span id="ZakatTracker-1020"><a href="#ZakatTracker-1020"><span class="linenos">1020</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># Open file in binary mode for reading</span>
</span><span id="ZakatTracker-1021"><a href="#ZakatTracker-1021"><span class="linenos">1021</span></a>            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4096</span><span class="p">),</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>  <span class="c1"># Read file in chunks</span>
</span><span id="ZakatTracker-1022"><a href="#ZakatTracker-1022"><span class="linenos">1022</span></a>                <span class="n">hash_obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="ZakatTracker-1023"><a href="#ZakatTracker-1023"><span class="linenos">1023</span></a>        <span class="k">return</span> <span class="n">hash_obj</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>  <span class="c1"># Return the hash as a hexadecimal string</span>
</span><span id="ZakatTracker-1024"><a href="#ZakatTracker-1024"><span class="linenos">1024</span></a>
</span><span id="ZakatTracker-1025"><a href="#ZakatTracker-1025"><span class="linenos">1025</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">snapshot_cache_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ZakatTracker-1026"><a href="#ZakatTracker-1026"><span class="linenos">1026</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1027"><a href="#ZakatTracker-1027"><span class="linenos">1027</span></a><span class="sd">        Generate the path for the cache file used to store snapshots.</span>
</span><span id="ZakatTracker-1028"><a href="#ZakatTracker-1028"><span class="linenos">1028</span></a>
</span><span id="ZakatTracker-1029"><a href="#ZakatTracker-1029"><span class="linenos">1029</span></a><span class="sd">        The cache file is a camel file that stores the timestamps of the snapshots.</span>
</span><span id="ZakatTracker-1030"><a href="#ZakatTracker-1030"><span class="linenos">1030</span></a><span class="sd">        The file name is derived from the main database file name by replacing the &quot;.camel&quot; extension with &quot;.snapshots.camel&quot;.</span>
</span><span id="ZakatTracker-1031"><a href="#ZakatTracker-1031"><span class="linenos">1031</span></a>
</span><span id="ZakatTracker-1032"><a href="#ZakatTracker-1032"><span class="linenos">1032</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1033"><a href="#ZakatTracker-1033"><span class="linenos">1033</span></a><span class="sd">        - str: The path to the cache file.</span>
</span><span id="ZakatTracker-1034"><a href="#ZakatTracker-1034"><span class="linenos">1034</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1035"><a href="#ZakatTracker-1035"><span class="linenos">1035</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>
</span><span id="ZakatTracker-1036"><a href="#ZakatTracker-1036"><span class="linenos">1036</span></a>        <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span>
</span><span id="ZakatTracker-1037"><a href="#ZakatTracker-1037"><span class="linenos">1037</span></a>        <span class="n">ext_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
</span><span id="ZakatTracker-1038"><a href="#ZakatTracker-1038"><span class="linenos">1038</span></a>        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
</span><span id="ZakatTracker-1039"><a href="#ZakatTracker-1039"><span class="linenos">1039</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="n">ext_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker-1040"><a href="#ZakatTracker-1040"><span class="linenos">1040</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;.snapshots.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-1041"><a href="#ZakatTracker-1041"><span class="linenos">1041</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="ZakatTracker-1042"><a href="#ZakatTracker-1042"><span class="linenos">1042</span></a>
</span><span id="ZakatTracker-1043"><a href="#ZakatTracker-1043"><span class="linenos">1043</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">snapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-1044"><a href="#ZakatTracker-1044"><span class="linenos">1044</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1045"><a href="#ZakatTracker-1045"><span class="linenos">1045</span></a><span class="sd">        This function creates a snapshot of the current database state.</span>
</span><span id="ZakatTracker-1046"><a href="#ZakatTracker-1046"><span class="linenos">1046</span></a>
</span><span id="ZakatTracker-1047"><a href="#ZakatTracker-1047"><span class="linenos">1047</span></a><span class="sd">        The function calculates the hash of the current database file and checks if a snapshot with the same hash already exists.</span>
</span><span id="ZakatTracker-1048"><a href="#ZakatTracker-1048"><span class="linenos">1048</span></a><span class="sd">        If a snapshot with the same hash exists, the function returns True without creating a new snapshot.</span>
</span><span id="ZakatTracker-1049"><a href="#ZakatTracker-1049"><span class="linenos">1049</span></a><span class="sd">        If a snapshot with the same hash does not exist, the function creates a new snapshot by saving the current database state</span>
</span><span id="ZakatTracker-1050"><a href="#ZakatTracker-1050"><span class="linenos">1050</span></a><span class="sd">        in a new camel file with a unique timestamp as the file name. The function also updates the snapshot cache file with the new snapshot&#39;s hash and timestamp.</span>
</span><span id="ZakatTracker-1051"><a href="#ZakatTracker-1051"><span class="linenos">1051</span></a>
</span><span id="ZakatTracker-1052"><a href="#ZakatTracker-1052"><span class="linenos">1052</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1053"><a href="#ZakatTracker-1053"><span class="linenos">1053</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker-1054"><a href="#ZakatTracker-1054"><span class="linenos">1054</span></a>
</span><span id="ZakatTracker-1055"><a href="#ZakatTracker-1055"><span class="linenos">1055</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1056"><a href="#ZakatTracker-1056"><span class="linenos">1056</span></a><span class="sd">        - bool: True if a snapshot with the same hash already exists or if the snapshot is successfully created. False if the snapshot creation fails.</span>
</span><span id="ZakatTracker-1057"><a href="#ZakatTracker-1057"><span class="linenos">1057</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1058"><a href="#ZakatTracker-1058"><span class="linenos">1058</span></a>        <span class="n">current_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>
</span><span id="ZakatTracker-1059"><a href="#ZakatTracker-1059"><span class="linenos">1059</span></a>        <span class="n">cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># hash: time_ns</span>
</span><span id="ZakatTracker-1060"><a href="#ZakatTracker-1060"><span class="linenos">1060</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-1061"><a href="#ZakatTracker-1061"><span class="linenos">1061</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapshot_cache_path</span><span class="p">(),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker-1062"><a href="#ZakatTracker-1062"><span class="linenos">1062</span></a>                <span class="n">cache</span> <span class="o">=</span> <span class="n">camel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="ZakatTracker-1063"><a href="#ZakatTracker-1063"><span class="linenos">1063</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="ZakatTracker-1064"><a href="#ZakatTracker-1064"><span class="linenos">1064</span></a>            <span class="k">pass</span>
</span><span id="ZakatTracker-1065"><a href="#ZakatTracker-1065"><span class="linenos">1065</span></a>        <span class="k">if</span> <span class="n">current_hash</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
</span><span id="ZakatTracker-1066"><a href="#ZakatTracker-1066"><span class="linenos">1066</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker-1067"><a href="#ZakatTracker-1067"><span class="linenos">1067</span></a>        <span class="n">ref</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="ZakatTracker-1068"><a href="#ZakatTracker-1068"><span class="linenos">1068</span></a>        <span class="n">cache</span><span class="p">[</span><span class="n">current_hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span>
</span><span id="ZakatTracker-1069"><a href="#ZakatTracker-1069"><span class="linenos">1069</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">(</span><span class="s1">&#39;snapshots&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ref</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)):</span>
</span><span id="ZakatTracker-1070"><a href="#ZakatTracker-1070"><span class="linenos">1070</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker-1071"><a href="#ZakatTracker-1071"><span class="linenos">1071</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapshot_cache_path</span><span class="p">(),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker-1072"><a href="#ZakatTracker-1072"><span class="linenos">1072</span></a>            <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">camel</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cache</span><span class="p">))</span>
</span><span id="ZakatTracker-1073"><a href="#ZakatTracker-1073"><span class="linenos">1073</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker-1074"><a href="#ZakatTracker-1074"><span class="linenos">1074</span></a>
</span><span id="ZakatTracker-1075"><a href="#ZakatTracker-1075"><span class="linenos">1075</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">snapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hide_missing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verified_hash_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> \
</span><span id="ZakatTracker-1076"><a href="#ZakatTracker-1076"><span class="linenos">1076</span></a>            <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]:</span>
</span><span id="ZakatTracker-1077"><a href="#ZakatTracker-1077"><span class="linenos">1077</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1078"><a href="#ZakatTracker-1078"><span class="linenos">1078</span></a><span class="sd">        Retrieve a dictionary of snapshots, with their respective hashes, paths, and existence status.</span>
</span><span id="ZakatTracker-1079"><a href="#ZakatTracker-1079"><span class="linenos">1079</span></a>
</span><span id="ZakatTracker-1080"><a href="#ZakatTracker-1080"><span class="linenos">1080</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1081"><a href="#ZakatTracker-1081"><span class="linenos">1081</span></a><span class="sd">        - hide_missing (bool): If True, only include snapshots that exist in the dictionary. Default is True.</span>
</span><span id="ZakatTracker-1082"><a href="#ZakatTracker-1082"><span class="linenos">1082</span></a><span class="sd">        - verified_hash_only (bool): If True, only include snapshots with a valid hash. Default is False.</span>
</span><span id="ZakatTracker-1083"><a href="#ZakatTracker-1083"><span class="linenos">1083</span></a>
</span><span id="ZakatTracker-1084"><a href="#ZakatTracker-1084"><span class="linenos">1084</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1085"><a href="#ZakatTracker-1085"><span class="linenos">1085</span></a><span class="sd">        - dict[int, tuple[str, str, bool]]: A dictionary where the keys are the timestamps of the snapshots,</span>
</span><span id="ZakatTracker-1086"><a href="#ZakatTracker-1086"><span class="linenos">1086</span></a><span class="sd">        and the values are tuples containing the snapshot&#39;s hash, path, and existence status.</span>
</span><span id="ZakatTracker-1087"><a href="#ZakatTracker-1087"><span class="linenos">1087</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1088"><a href="#ZakatTracker-1088"><span class="linenos">1088</span></a>        <span class="n">cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># hash: time_ns</span>
</span><span id="ZakatTracker-1089"><a href="#ZakatTracker-1089"><span class="linenos">1089</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-1090"><a href="#ZakatTracker-1090"><span class="linenos">1090</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapshot_cache_path</span><span class="p">(),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker-1091"><a href="#ZakatTracker-1091"><span class="linenos">1091</span></a>                <span class="n">cache</span> <span class="o">=</span> <span class="n">camel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="ZakatTracker-1092"><a href="#ZakatTracker-1092"><span class="linenos">1092</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="ZakatTracker-1093"><a href="#ZakatTracker-1093"><span class="linenos">1093</span></a>            <span class="k">pass</span>
</span><span id="ZakatTracker-1094"><a href="#ZakatTracker-1094"><span class="linenos">1094</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cache</span><span class="p">:</span>
</span><span id="ZakatTracker-1095"><a href="#ZakatTracker-1095"><span class="linenos">1095</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="ZakatTracker-1096"><a href="#ZakatTracker-1096"><span class="linenos">1096</span></a>        <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># time_ns: (hash, path, exists)</span>
</span><span id="ZakatTracker-1097"><a href="#ZakatTracker-1097"><span class="linenos">1097</span></a>        <span class="k">for</span> <span class="n">file_hash</span><span class="p">,</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">cache</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker-1098"><a href="#ZakatTracker-1098"><span class="linenos">1098</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">(</span><span class="s1">&#39;snapshots&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ref</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-1099"><a href="#ZakatTracker-1099"><span class="linenos">1099</span></a>            <span class="n">exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="ZakatTracker-1100"><a href="#ZakatTracker-1100"><span class="linenos">1100</span></a>            <span class="n">valid_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_hash</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="n">file_hash</span> <span class="k">if</span> <span class="n">verified_hash_only</span> <span class="k">else</span> <span class="kc">True</span>
</span><span id="ZakatTracker-1101"><a href="#ZakatTracker-1101"><span class="linenos">1101</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">verified_hash_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">valid_hash</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">verified_hash_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">):</span>
</span><span id="ZakatTracker-1102"><a href="#ZakatTracker-1102"><span class="linenos">1102</span></a>                <span class="k">continue</span>
</span><span id="ZakatTracker-1103"><a href="#ZakatTracker-1103"><span class="linenos">1103</span></a>            <span class="k">if</span> <span class="n">exists</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">hide_missing</span><span class="p">:</span>
</span><span id="ZakatTracker-1104"><a href="#ZakatTracker-1104"><span class="linenos">1104</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_hash</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">exists</span><span class="p">)</span>
</span><span id="ZakatTracker-1105"><a href="#ZakatTracker-1105"><span class="linenos">1105</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="ZakatTracker-1106"><a href="#ZakatTracker-1106"><span class="linenos">1106</span></a>
</span><span id="ZakatTracker-1107"><a href="#ZakatTracker-1107"><span class="linenos">1107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ref_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-1108"><a href="#ZakatTracker-1108"><span class="linenos">1108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1109"><a href="#ZakatTracker-1109"><span class="linenos">1109</span></a><span class="sd">        Check if a specific reference (transaction) exists in the vault for a given account and reference type.</span>
</span><span id="ZakatTracker-1110"><a href="#ZakatTracker-1110"><span class="linenos">1110</span></a>
</span><span id="ZakatTracker-1111"><a href="#ZakatTracker-1111"><span class="linenos">1111</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1112"><a href="#ZakatTracker-1112"><span class="linenos">1112</span></a><span class="sd">        - account (str): The account number for which to check the existence of the reference.</span>
</span><span id="ZakatTracker-1113"><a href="#ZakatTracker-1113"><span class="linenos">1113</span></a><span class="sd">        - ref_type (str): The type of reference (e.g., &#39;box&#39;, &#39;log&#39;, etc.).</span>
</span><span id="ZakatTracker-1114"><a href="#ZakatTracker-1114"><span class="linenos">1114</span></a><span class="sd">        - ref (int): The reference (transaction) number to check for existence.</span>
</span><span id="ZakatTracker-1115"><a href="#ZakatTracker-1115"><span class="linenos">1115</span></a>
</span><span id="ZakatTracker-1116"><a href="#ZakatTracker-1116"><span class="linenos">1116</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1117"><a href="#ZakatTracker-1117"><span class="linenos">1117</span></a><span class="sd">        - bool: True if the reference exists for the given account and reference type, False otherwise.</span>
</span><span id="ZakatTracker-1118"><a href="#ZakatTracker-1118"><span class="linenos">1118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1119"><a href="#ZakatTracker-1119"><span class="linenos">1119</span></a>        <span class="k">if</span> <span class="n">account</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-1120"><a href="#ZakatTracker-1120"><span class="linenos">1120</span></a>            <span class="k">return</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="n">ref_type</span><span class="p">]</span>
</span><span id="ZakatTracker-1121"><a href="#ZakatTracker-1121"><span class="linenos">1121</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker-1122"><a href="#ZakatTracker-1122"><span class="linenos">1122</span></a>
</span><span id="ZakatTracker-1123"><a href="#ZakatTracker-1123"><span class="linenos">1123</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">box_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-1124"><a href="#ZakatTracker-1124"><span class="linenos">1124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1125"><a href="#ZakatTracker-1125"><span class="linenos">1125</span></a><span class="sd">        Check if a specific box (transaction) exists in the vault for a given account and reference.</span>
</span><span id="ZakatTracker-1126"><a href="#ZakatTracker-1126"><span class="linenos">1126</span></a>
</span><span id="ZakatTracker-1127"><a href="#ZakatTracker-1127"><span class="linenos">1127</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1128"><a href="#ZakatTracker-1128"><span class="linenos">1128</span></a><span class="sd">        - account (str): The account number for which to check the existence of the box.</span>
</span><span id="ZakatTracker-1129"><a href="#ZakatTracker-1129"><span class="linenos">1129</span></a><span class="sd">        - ref (int): The reference (transaction) number to check for existence.</span>
</span><span id="ZakatTracker-1130"><a href="#ZakatTracker-1130"><span class="linenos">1130</span></a>
</span><span id="ZakatTracker-1131"><a href="#ZakatTracker-1131"><span class="linenos">1131</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1132"><a href="#ZakatTracker-1132"><span class="linenos">1132</span></a><span class="sd">        - bool: True if the box exists for the given account and reference, False otherwise.</span>
</span><span id="ZakatTracker-1133"><a href="#ZakatTracker-1133"><span class="linenos">1133</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1134"><a href="#ZakatTracker-1134"><span class="linenos">1134</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_exists</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
</span><span id="ZakatTracker-1135"><a href="#ZakatTracker-1135"><span class="linenos">1135</span></a>
</span><span id="ZakatTracker-1136"><a href="#ZakatTracker-1136"><span class="linenos">1136</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unscaled_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ZakatTracker-1137"><a href="#ZakatTracker-1137"><span class="linenos">1137</span></a>              <span class="n">created</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker-1138"><a href="#ZakatTracker-1138"><span class="linenos">1138</span></a>              <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-1139"><a href="#ZakatTracker-1139"><span class="linenos">1139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1140"><a href="#ZakatTracker-1140"><span class="linenos">1140</span></a><span class="sd">        This function tracks a transaction for a specific account, so it do creates a new account if it doesn&#39;t exist, logs the transaction if logging is True, and updates the account&#39;s balance and box.</span>
</span><span id="ZakatTracker-1141"><a href="#ZakatTracker-1141"><span class="linenos">1141</span></a>
</span><span id="ZakatTracker-1142"><a href="#ZakatTracker-1142"><span class="linenos">1142</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1143"><a href="#ZakatTracker-1143"><span class="linenos">1143</span></a><span class="sd">        - unscaled_value (float | int | decimal.Decimal): The value of the transaction. Default is 0.</span>
</span><span id="ZakatTracker-1144"><a href="#ZakatTracker-1144"><span class="linenos">1144</span></a><span class="sd">        - desc (str): The description of the transaction. Default is an empty string.</span>
</span><span id="ZakatTracker-1145"><a href="#ZakatTracker-1145"><span class="linenos">1145</span></a><span class="sd">        - account (str): The account for which the transaction is being tracked. Default is &#39;1&#39;.</span>
</span><span id="ZakatTracker-1146"><a href="#ZakatTracker-1146"><span class="linenos">1146</span></a><span class="sd">        - logging (bool): Whether to log the transaction. Default is True.</span>
</span><span id="ZakatTracker-1147"><a href="#ZakatTracker-1147"><span class="linenos">1147</span></a><span class="sd">        - created (int): The timestamp of the transaction. If not provided, it will be generated. Default is None.</span>
</span><span id="ZakatTracker-1148"><a href="#ZakatTracker-1148"><span class="linenos">1148</span></a><span class="sd">        - debug (bool): Whether to print debug information. Default is False.</span>
</span><span id="ZakatTracker-1149"><a href="#ZakatTracker-1149"><span class="linenos">1149</span></a>
</span><span id="ZakatTracker-1150"><a href="#ZakatTracker-1150"><span class="linenos">1150</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1151"><a href="#ZakatTracker-1151"><span class="linenos">1151</span></a><span class="sd">        - int: The timestamp of the transaction.</span>
</span><span id="ZakatTracker-1152"><a href="#ZakatTracker-1152"><span class="linenos">1152</span></a>
</span><span id="ZakatTracker-1153"><a href="#ZakatTracker-1153"><span class="linenos">1153</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker-1154"><a href="#ZakatTracker-1154"><span class="linenos">1154</span></a><span class="sd">        - ValueError: The created should be greater than zero.</span>
</span><span id="ZakatTracker-1155"><a href="#ZakatTracker-1155"><span class="linenos">1155</span></a><span class="sd">        - ValueError: The log transaction happened again in the same nanosecond time.</span>
</span><span id="ZakatTracker-1156"><a href="#ZakatTracker-1156"><span class="linenos">1156</span></a><span class="sd">        - ValueError: The box transaction happened again in the same nanosecond time.</span>
</span><span id="ZakatTracker-1157"><a href="#ZakatTracker-1157"><span class="linenos">1157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1158"><a href="#ZakatTracker-1158"><span class="linenos">1158</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1159"><a href="#ZakatTracker-1159"><span class="linenos">1159</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;track&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;unscaled_value=</span><span class="si">{</span><span class="n">unscaled_value</span><span class="si">}</span><span class="s1">, debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-1160"><a href="#ZakatTracker-1160"><span class="linenos">1160</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-1161"><a href="#ZakatTracker-1161"><span class="linenos">1161</span></a>            <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker-1162"><a href="#ZakatTracker-1162"><span class="linenos">1162</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1163"><a href="#ZakatTracker-1163"><span class="linenos">1163</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The created should be greater than zero.&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-1164"><a href="#ZakatTracker-1164"><span class="linenos">1164</span></a>        <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-1165"><a href="#ZakatTracker-1165"><span class="linenos">1165</span></a>        <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker-1166"><a href="#ZakatTracker-1166"><span class="linenos">1166</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker-1167"><a href="#ZakatTracker-1167"><span class="linenos">1167</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1168"><a href="#ZakatTracker-1168"><span class="linenos">1168</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;account </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2"> created&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-1169"><a href="#ZakatTracker-1169"><span class="linenos">1169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-1170"><a href="#ZakatTracker-1170"><span class="linenos">1170</span></a>                <span class="s1">&#39;balance&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1171"><a href="#ZakatTracker-1171"><span class="linenos">1171</span></a>                <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker-1172"><a href="#ZakatTracker-1172"><span class="linenos">1172</span></a>                <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1173"><a href="#ZakatTracker-1173"><span class="linenos">1173</span></a>                <span class="s1">&#39;log&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker-1174"><a href="#ZakatTracker-1174"><span class="linenos">1174</span></a>                <span class="s1">&#39;hide&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ZakatTracker-1175"><a href="#ZakatTracker-1175"><span class="linenos">1175</span></a>                <span class="s1">&#39;zakatable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ZakatTracker-1176"><a href="#ZakatTracker-1176"><span class="linenos">1176</span></a>                <span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="n">created</span><span class="p">,</span>
</span><span id="ZakatTracker-1177"><a href="#ZakatTracker-1177"><span class="linenos">1177</span></a>            <span class="p">}</span>
</span><span id="ZakatTracker-1178"><a href="#ZakatTracker-1178"><span class="linenos">1178</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">CREATE</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</span><span id="ZakatTracker-1179"><a href="#ZakatTracker-1179"><span class="linenos">1179</span></a>        <span class="k">if</span> <span class="n">unscaled_value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1180"><a href="#ZakatTracker-1180"><span class="linenos">1180</span></a>            <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker-1181"><a href="#ZakatTracker-1181"><span class="linenos">1181</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker-1182"><a href="#ZakatTracker-1182"><span class="linenos">1182</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="ZakatTracker-1183"><a href="#ZakatTracker-1183"><span class="linenos">1183</span></a>        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">unscaled_value</span><span class="p">)</span>
</span><span id="ZakatTracker-1184"><a href="#ZakatTracker-1184"><span class="linenos">1184</span></a>        <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
</span><span id="ZakatTracker-1185"><a href="#ZakatTracker-1185"><span class="linenos">1185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">created</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-1186"><a href="#ZakatTracker-1186"><span class="linenos">1186</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1187"><a href="#ZakatTracker-1187"><span class="linenos">1187</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;create-box&#39;</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker-1188"><a href="#ZakatTracker-1188"><span class="linenos">1188</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_exists</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="p">):</span>
</span><span id="ZakatTracker-1189"><a href="#ZakatTracker-1189"><span class="linenos">1189</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The box transaction happened again in the same nanosecond time(</span><span class="si">{</span><span class="n">created</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-1190"><a href="#ZakatTracker-1190"><span class="linenos">1190</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1191"><a href="#ZakatTracker-1191"><span class="linenos">1191</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;created-box&#39;</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker-1192"><a href="#ZakatTracker-1192"><span class="linenos">1192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">created</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-1193"><a href="#ZakatTracker-1193"><span class="linenos">1193</span></a>            <span class="s1">&#39;capital&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
</span><span id="ZakatTracker-1194"><a href="#ZakatTracker-1194"><span class="linenos">1194</span></a>            <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1195"><a href="#ZakatTracker-1195"><span class="linenos">1195</span></a>            <span class="s1">&#39;last&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1196"><a href="#ZakatTracker-1196"><span class="linenos">1196</span></a>            <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
</span><span id="ZakatTracker-1197"><a href="#ZakatTracker-1197"><span class="linenos">1197</span></a>            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1198"><a href="#ZakatTracker-1198"><span class="linenos">1198</span></a>        <span class="p">}</span>
</span><span id="ZakatTracker-1199"><a href="#ZakatTracker-1199"><span class="linenos">1199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">TRACK</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">created</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
</span><span id="ZakatTracker-1200"><a href="#ZakatTracker-1200"><span class="linenos">1200</span></a>        <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker-1201"><a href="#ZakatTracker-1201"><span class="linenos">1201</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker-1202"><a href="#ZakatTracker-1202"><span class="linenos">1202</span></a>        <span class="k">return</span> <span class="n">created</span>
</span><span id="ZakatTracker-1203"><a href="#ZakatTracker-1203"><span class="linenos">1203</span></a>
</span><span id="ZakatTracker-1204"><a href="#ZakatTracker-1204"><span class="linenos">1204</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">log_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-1205"><a href="#ZakatTracker-1205"><span class="linenos">1205</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1206"><a href="#ZakatTracker-1206"><span class="linenos">1206</span></a><span class="sd">        Checks if a specific transaction log entry exists for a given account.</span>
</span><span id="ZakatTracker-1207"><a href="#ZakatTracker-1207"><span class="linenos">1207</span></a>
</span><span id="ZakatTracker-1208"><a href="#ZakatTracker-1208"><span class="linenos">1208</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1209"><a href="#ZakatTracker-1209"><span class="linenos">1209</span></a><span class="sd">        - account (str): The account number associated with the transaction log.</span>
</span><span id="ZakatTracker-1210"><a href="#ZakatTracker-1210"><span class="linenos">1210</span></a><span class="sd">        - ref (int): The reference to the transaction log entry.</span>
</span><span id="ZakatTracker-1211"><a href="#ZakatTracker-1211"><span class="linenos">1211</span></a>
</span><span id="ZakatTracker-1212"><a href="#ZakatTracker-1212"><span class="linenos">1212</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1213"><a href="#ZakatTracker-1213"><span class="linenos">1213</span></a><span class="sd">        - bool: True if the transaction log entry exists, False otherwise.</span>
</span><span id="ZakatTracker-1214"><a href="#ZakatTracker-1214"><span class="linenos">1214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1215"><a href="#ZakatTracker-1215"><span class="linenos">1215</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_exists</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
</span><span id="ZakatTracker-1216"><a href="#ZakatTracker-1216"><span class="linenos">1216</span></a>
</span><span id="ZakatTracker-1217"><a href="#ZakatTracker-1217"><span class="linenos">1217</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">created</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker-1218"><a href="#ZakatTracker-1218"><span class="linenos">1218</span></a>             <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-1219"><a href="#ZakatTracker-1219"><span class="linenos">1219</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1220"><a href="#ZakatTracker-1220"><span class="linenos">1220</span></a><span class="sd">        Log a transaction into the account&#39;s log by updates the account&#39;s balance, count, and log with the transaction details.</span>
</span><span id="ZakatTracker-1221"><a href="#ZakatTracker-1221"><span class="linenos">1221</span></a><span class="sd">        It also creates a step in the history of the transaction.</span>
</span><span id="ZakatTracker-1222"><a href="#ZakatTracker-1222"><span class="linenos">1222</span></a>
</span><span id="ZakatTracker-1223"><a href="#ZakatTracker-1223"><span class="linenos">1223</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1224"><a href="#ZakatTracker-1224"><span class="linenos">1224</span></a><span class="sd">        - value (float): The value of the transaction.</span>
</span><span id="ZakatTracker-1225"><a href="#ZakatTracker-1225"><span class="linenos">1225</span></a><span class="sd">        - desc (str): The description of the transaction.</span>
</span><span id="ZakatTracker-1226"><a href="#ZakatTracker-1226"><span class="linenos">1226</span></a><span class="sd">        - account (str): The account to log the transaction into. Default is &#39;1&#39;.</span>
</span><span id="ZakatTracker-1227"><a href="#ZakatTracker-1227"><span class="linenos">1227</span></a><span class="sd">        - created (int): The timestamp of the transaction. If not provided, it will be generated.</span>
</span><span id="ZakatTracker-1228"><a href="#ZakatTracker-1228"><span class="linenos">1228</span></a><span class="sd">        - ref (int): The reference of the object.</span>
</span><span id="ZakatTracker-1229"><a href="#ZakatTracker-1229"><span class="linenos">1229</span></a><span class="sd">        - debug (bool): Whether to print debug information. Default is False.</span>
</span><span id="ZakatTracker-1230"><a href="#ZakatTracker-1230"><span class="linenos">1230</span></a>
</span><span id="ZakatTracker-1231"><a href="#ZakatTracker-1231"><span class="linenos">1231</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1232"><a href="#ZakatTracker-1232"><span class="linenos">1232</span></a><span class="sd">        - int: The timestamp of the logged transaction.</span>
</span><span id="ZakatTracker-1233"><a href="#ZakatTracker-1233"><span class="linenos">1233</span></a>
</span><span id="ZakatTracker-1234"><a href="#ZakatTracker-1234"><span class="linenos">1234</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker-1235"><a href="#ZakatTracker-1235"><span class="linenos">1235</span></a><span class="sd">        - ValueError: The created should be greater than zero.</span>
</span><span id="ZakatTracker-1236"><a href="#ZakatTracker-1236"><span class="linenos">1236</span></a><span class="sd">        - ValueError: The log transaction happened again in the same nanosecond time.</span>
</span><span id="ZakatTracker-1237"><a href="#ZakatTracker-1237"><span class="linenos">1237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1238"><a href="#ZakatTracker-1238"><span class="linenos">1238</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1239"><a href="#ZakatTracker-1239"><span class="linenos">1239</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;_log&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-1240"><a href="#ZakatTracker-1240"><span class="linenos">1240</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-1241"><a href="#ZakatTracker-1241"><span class="linenos">1241</span></a>            <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker-1242"><a href="#ZakatTracker-1242"><span class="linenos">1242</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1243"><a href="#ZakatTracker-1243"><span class="linenos">1243</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The created should be greater than zero.&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-1244"><a href="#ZakatTracker-1244"><span class="linenos">1244</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-1245"><a href="#ZakatTracker-1245"><span class="linenos">1245</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker-1246"><a href="#ZakatTracker-1246"><span class="linenos">1246</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="ZakatTracker-1247"><a href="#ZakatTracker-1247"><span class="linenos">1247</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="ZakatTracker-1248"><a href="#ZakatTracker-1248"><span class="linenos">1248</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-1249"><a href="#ZakatTracker-1249"><span class="linenos">1249</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1250"><a href="#ZakatTracker-1250"><span class="linenos">1250</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;create-log&#39;</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker-1251"><a href="#ZakatTracker-1251"><span class="linenos">1251</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_exists</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="p">):</span>
</span><span id="ZakatTracker-1252"><a href="#ZakatTracker-1252"><span class="linenos">1252</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The log transaction happened again in the same nanosecond time(</span><span class="si">{</span><span class="n">created</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-1253"><a href="#ZakatTracker-1253"><span class="linenos">1253</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1254"><a href="#ZakatTracker-1254"><span class="linenos">1254</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;created-log&#39;</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker-1255"><a href="#ZakatTracker-1255"><span class="linenos">1255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">created</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-1256"><a href="#ZakatTracker-1256"><span class="linenos">1256</span></a>            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
</span><span id="ZakatTracker-1257"><a href="#ZakatTracker-1257"><span class="linenos">1257</span></a>            <span class="s1">&#39;desc&#39;</span><span class="p">:</span> <span class="n">desc</span><span class="p">,</span>
</span><span id="ZakatTracker-1258"><a href="#ZakatTracker-1258"><span class="linenos">1258</span></a>            <span class="s1">&#39;ref&#39;</span><span class="p">:</span> <span class="n">ref</span><span class="p">,</span>
</span><span id="ZakatTracker-1259"><a href="#ZakatTracker-1259"><span class="linenos">1259</span></a>            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker-1260"><a href="#ZakatTracker-1260"><span class="linenos">1260</span></a>        <span class="p">}</span>
</span><span id="ZakatTracker-1261"><a href="#ZakatTracker-1261"><span class="linenos">1261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">LOG</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">created</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
</span><span id="ZakatTracker-1262"><a href="#ZakatTracker-1262"><span class="linenos">1262</span></a>        <span class="k">return</span> <span class="n">created</span>
</span><span id="ZakatTracker-1263"><a href="#ZakatTracker-1263"><span class="linenos">1263</span></a>
</span><span id="ZakatTracker-1264"><a href="#ZakatTracker-1264"><span class="linenos">1264</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exchange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker-1265"><a href="#ZakatTracker-1265"><span class="linenos">1265</span></a>                 <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker-1266"><a href="#ZakatTracker-1266"><span class="linenos">1266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1267"><a href="#ZakatTracker-1267"><span class="linenos">1267</span></a><span class="sd">        This method is used to record or retrieve exchange rates for a specific account.</span>
</span><span id="ZakatTracker-1268"><a href="#ZakatTracker-1268"><span class="linenos">1268</span></a>
</span><span id="ZakatTracker-1269"><a href="#ZakatTracker-1269"><span class="linenos">1269</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1270"><a href="#ZakatTracker-1270"><span class="linenos">1270</span></a><span class="sd">        - account (str): The account number for which the exchange rate is being recorded or retrieved.</span>
</span><span id="ZakatTracker-1271"><a href="#ZakatTracker-1271"><span class="linenos">1271</span></a><span class="sd">        - created (int): The timestamp of the exchange rate. If not provided, the current timestamp will be used.</span>
</span><span id="ZakatTracker-1272"><a href="#ZakatTracker-1272"><span class="linenos">1272</span></a><span class="sd">        - rate (float): The exchange rate to be recorded. If not provided, the method will retrieve the latest exchange rate.</span>
</span><span id="ZakatTracker-1273"><a href="#ZakatTracker-1273"><span class="linenos">1273</span></a><span class="sd">        - description (str): A description of the exchange rate.</span>
</span><span id="ZakatTracker-1274"><a href="#ZakatTracker-1274"><span class="linenos">1274</span></a><span class="sd">        - debug (bool): Whether to print debug information. Default is False.</span>
</span><span id="ZakatTracker-1275"><a href="#ZakatTracker-1275"><span class="linenos">1275</span></a>
</span><span id="ZakatTracker-1276"><a href="#ZakatTracker-1276"><span class="linenos">1276</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1277"><a href="#ZakatTracker-1277"><span class="linenos">1277</span></a><span class="sd">        - dict: A dictionary containing the latest exchange rate and its description. If no exchange rate is found,</span>
</span><span id="ZakatTracker-1278"><a href="#ZakatTracker-1278"><span class="linenos">1278</span></a><span class="sd">        it returns a dictionary with default values for the rate and description.</span>
</span><span id="ZakatTracker-1279"><a href="#ZakatTracker-1279"><span class="linenos">1279</span></a>
</span><span id="ZakatTracker-1280"><a href="#ZakatTracker-1280"><span class="linenos">1280</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker-1281"><a href="#ZakatTracker-1281"><span class="linenos">1281</span></a><span class="sd">        - ValueError: The created should be greater than zero.</span>
</span><span id="ZakatTracker-1282"><a href="#ZakatTracker-1282"><span class="linenos">1282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1283"><a href="#ZakatTracker-1283"><span class="linenos">1283</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1284"><a href="#ZakatTracker-1284"><span class="linenos">1284</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exchange&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-1285"><a href="#ZakatTracker-1285"><span class="linenos">1285</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-1286"><a href="#ZakatTracker-1286"><span class="linenos">1286</span></a>            <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker-1287"><a href="#ZakatTracker-1287"><span class="linenos">1287</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1288"><a href="#ZakatTracker-1288"><span class="linenos">1288</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The created should be greater than zero.&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-1289"><a href="#ZakatTracker-1289"><span class="linenos">1289</span></a>        <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-1290"><a href="#ZakatTracker-1290"><span class="linenos">1290</span></a>        <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker-1291"><a href="#ZakatTracker-1291"><span class="linenos">1291</span></a>        <span class="k">if</span> <span class="n">rate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-1292"><a href="#ZakatTracker-1292"><span class="linenos">1292</span></a>            <span class="k">if</span> <span class="n">rate</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1293"><a href="#ZakatTracker-1293"><span class="linenos">1293</span></a>                <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="ZakatTracker-1294"><a href="#ZakatTracker-1294"><span class="linenos">1294</span></a>            <span class="k">if</span> <span class="n">account</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-1295"><a href="#ZakatTracker-1295"><span class="linenos">1295</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker-1296"><a href="#ZakatTracker-1296"><span class="linenos">1296</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">rate</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ZakatTracker-1297"><a href="#ZakatTracker-1297"><span class="linenos">1297</span></a>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">created</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="ZakatTracker-1298"><a href="#ZakatTracker-1298"><span class="linenos">1298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="n">created</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="n">rate</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">}</span>
</span><span id="ZakatTracker-1299"><a href="#ZakatTracker-1299"><span class="linenos">1299</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">EXCHANGE</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">created</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">rate</span><span class="p">)</span>
</span><span id="ZakatTracker-1300"><a href="#ZakatTracker-1300"><span class="linenos">1300</span></a>            <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker-1301"><a href="#ZakatTracker-1301"><span class="linenos">1301</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker-1302"><a href="#ZakatTracker-1302"><span class="linenos">1302</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1303"><a href="#ZakatTracker-1303"><span class="linenos">1303</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exchange-created-1&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker-1304"><a href="#ZakatTracker-1304"><span class="linenos">1304</span></a>                      <span class="sa">f</span><span class="s1">&#39;account: </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s1">, created: </span><span class="si">{</span><span class="n">created</span><span class="si">}</span><span class="s1">, rate:</span><span class="si">{</span><span class="n">rate</span><span class="si">}</span><span class="s1">, description:</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-1305"><a href="#ZakatTracker-1305"><span class="linenos">1305</span></a>
</span><span id="ZakatTracker-1306"><a href="#ZakatTracker-1306"><span class="linenos">1306</span></a>        <span class="k">if</span> <span class="n">account</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-1307"><a href="#ZakatTracker-1307"><span class="linenos">1307</span></a>            <span class="n">valid_rates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ts</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">ts</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">ts</span> <span class="o">&lt;=</span> <span class="n">created</span><span class="p">]</span>
</span><span id="ZakatTracker-1308"><a href="#ZakatTracker-1308"><span class="linenos">1308</span></a>            <span class="k">if</span> <span class="n">valid_rates</span><span class="p">:</span>
</span><span id="ZakatTracker-1309"><a href="#ZakatTracker-1309"><span class="linenos">1309</span></a>                <span class="n">latest_rate</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">valid_rates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="ZakatTracker-1310"><a href="#ZakatTracker-1310"><span class="linenos">1310</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1311"><a href="#ZakatTracker-1311"><span class="linenos">1311</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exchange-read-1&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker-1312"><a href="#ZakatTracker-1312"><span class="linenos">1312</span></a>                          <span class="sa">f</span><span class="s1">&#39;account: </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s1">, created: </span><span class="si">{</span><span class="n">created</span><span class="si">}</span><span class="s1">, rate:</span><span class="si">{</span><span class="n">rate</span><span class="si">}</span><span class="s1">, description:</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-1313"><a href="#ZakatTracker-1313"><span class="linenos">1313</span></a>                          <span class="s1">&#39;latest_rate&#39;</span><span class="p">,</span> <span class="n">latest_rate</span><span class="p">)</span>
</span><span id="ZakatTracker-1314"><a href="#ZakatTracker-1314"><span class="linenos">1314</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">latest_rate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker-1315"><a href="#ZakatTracker-1315"><span class="linenos">1315</span></a>                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">latest_rate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ZakatTracker-1316"><a href="#ZakatTracker-1316"><span class="linenos">1316</span></a>                <span class="k">return</span> <span class="n">result</span>  <span class="c1"># إرجاع قاموس يحتوي على المعدل والوصف</span>
</span><span id="ZakatTracker-1317"><a href="#ZakatTracker-1317"><span class="linenos">1317</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1318"><a href="#ZakatTracker-1318"><span class="linenos">1318</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exchange-read-0&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;account: </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s1">, created: </span><span class="si">{</span><span class="n">created</span><span class="si">}</span><span class="s1">, rate:</span><span class="si">{</span><span class="n">rate</span><span class="si">}</span><span class="s1">, description:</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-1319"><a href="#ZakatTracker-1319"><span class="linenos">1319</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">created</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>  <span class="c1"># إرجاع القيمة الافتراضية مع وصف فارغ</span>
</span><span id="ZakatTracker-1320"><a href="#ZakatTracker-1320"><span class="linenos">1320</span></a>
</span><span id="ZakatTracker-1321"><a href="#ZakatTracker-1321"><span class="linenos">1321</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-1322"><a href="#ZakatTracker-1322"><span class="linenos">1322</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exchange_calc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ZakatTracker-1323"><a href="#ZakatTracker-1323"><span class="linenos">1323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1324"><a href="#ZakatTracker-1324"><span class="linenos">1324</span></a><span class="sd">        This function calculates the exchanged amount of a currency.</span>
</span><span id="ZakatTracker-1325"><a href="#ZakatTracker-1325"><span class="linenos">1325</span></a>
</span><span id="ZakatTracker-1326"><a href="#ZakatTracker-1326"><span class="linenos">1326</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1327"><a href="#ZakatTracker-1327"><span class="linenos">1327</span></a><span class="sd">        - x (float): The original amount of the currency.</span>
</span><span id="ZakatTracker-1328"><a href="#ZakatTracker-1328"><span class="linenos">1328</span></a><span class="sd">        - x_rate (float): The exchange rate of the original currency.</span>
</span><span id="ZakatTracker-1329"><a href="#ZakatTracker-1329"><span class="linenos">1329</span></a><span class="sd">         - y_rate (float): The exchange rate of the target currency.</span>
</span><span id="ZakatTracker-1330"><a href="#ZakatTracker-1330"><span class="linenos">1330</span></a>
</span><span id="ZakatTracker-1331"><a href="#ZakatTracker-1331"><span class="linenos">1331</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1332"><a href="#ZakatTracker-1332"><span class="linenos">1332</span></a><span class="sd">        - float: The exchanged amount of the target currency.</span>
</span><span id="ZakatTracker-1333"><a href="#ZakatTracker-1333"><span class="linenos">1333</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1334"><a href="#ZakatTracker-1334"><span class="linenos">1334</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_rate</span>
</span><span id="ZakatTracker-1335"><a href="#ZakatTracker-1335"><span class="linenos">1335</span></a>
</span><span id="ZakatTracker-1336"><a href="#ZakatTracker-1336"><span class="linenos">1336</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exchanges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker-1337"><a href="#ZakatTracker-1337"><span class="linenos">1337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1338"><a href="#ZakatTracker-1338"><span class="linenos">1338</span></a><span class="sd">        Retrieve the recorded exchange rates for all accounts.</span>
</span><span id="ZakatTracker-1339"><a href="#ZakatTracker-1339"><span class="linenos">1339</span></a>
</span><span id="ZakatTracker-1340"><a href="#ZakatTracker-1340"><span class="linenos">1340</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1341"><a href="#ZakatTracker-1341"><span class="linenos">1341</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker-1342"><a href="#ZakatTracker-1342"><span class="linenos">1342</span></a>
</span><span id="ZakatTracker-1343"><a href="#ZakatTracker-1343"><span class="linenos">1343</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1344"><a href="#ZakatTracker-1344"><span class="linenos">1344</span></a><span class="sd">        - dict: A dictionary containing all recorded exchange rates.</span>
</span><span id="ZakatTracker-1345"><a href="#ZakatTracker-1345"><span class="linenos">1345</span></a><span class="sd">        The keys are account names or numbers, and the values are dictionaries containing the exchange rates.</span>
</span><span id="ZakatTracker-1346"><a href="#ZakatTracker-1346"><span class="linenos">1346</span></a><span class="sd">        Each exchange rate dictionary has timestamps as keys and exchange rate details as values.</span>
</span><span id="ZakatTracker-1347"><a href="#ZakatTracker-1347"><span class="linenos">1347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1348"><a href="#ZakatTracker-1348"><span class="linenos">1348</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="ZakatTracker-1349"><a href="#ZakatTracker-1349"><span class="linenos">1349</span></a>
</span><span id="ZakatTracker-1350"><a href="#ZakatTracker-1350"><span class="linenos">1350</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">accounts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker-1351"><a href="#ZakatTracker-1351"><span class="linenos">1351</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1352"><a href="#ZakatTracker-1352"><span class="linenos">1352</span></a><span class="sd">        Returns a dictionary containing account numbers as keys and their respective balances as values.</span>
</span><span id="ZakatTracker-1353"><a href="#ZakatTracker-1353"><span class="linenos">1353</span></a>
</span><span id="ZakatTracker-1354"><a href="#ZakatTracker-1354"><span class="linenos">1354</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1355"><a href="#ZakatTracker-1355"><span class="linenos">1355</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker-1356"><a href="#ZakatTracker-1356"><span class="linenos">1356</span></a>
</span><span id="ZakatTracker-1357"><a href="#ZakatTracker-1357"><span class="linenos">1357</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1358"><a href="#ZakatTracker-1358"><span class="linenos">1358</span></a><span class="sd">        - dict: A dictionary where keys are account numbers and values are their respective balances.</span>
</span><span id="ZakatTracker-1359"><a href="#ZakatTracker-1359"><span class="linenos">1359</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1360"><a href="#ZakatTracker-1360"><span class="linenos">1360</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker-1361"><a href="#ZakatTracker-1361"><span class="linenos">1361</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-1362"><a href="#ZakatTracker-1362"><span class="linenos">1362</span></a>            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1363"><a href="#ZakatTracker-1363"><span class="linenos">1363</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="ZakatTracker-1364"><a href="#ZakatTracker-1364"><span class="linenos">1364</span></a>
</span><span id="ZakatTracker-1365"><a href="#ZakatTracker-1365"><span class="linenos">1365</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">boxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker-1366"><a href="#ZakatTracker-1366"><span class="linenos">1366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1367"><a href="#ZakatTracker-1367"><span class="linenos">1367</span></a><span class="sd">        Retrieve the boxes (transactions) associated with a specific account.</span>
</span><span id="ZakatTracker-1368"><a href="#ZakatTracker-1368"><span class="linenos">1368</span></a>
</span><span id="ZakatTracker-1369"><a href="#ZakatTracker-1369"><span class="linenos">1369</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1370"><a href="#ZakatTracker-1370"><span class="linenos">1370</span></a><span class="sd">        - account (str): The account number for which to retrieve the boxes.</span>
</span><span id="ZakatTracker-1371"><a href="#ZakatTracker-1371"><span class="linenos">1371</span></a>
</span><span id="ZakatTracker-1372"><a href="#ZakatTracker-1372"><span class="linenos">1372</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1373"><a href="#ZakatTracker-1373"><span class="linenos">1373</span></a><span class="sd">        - dict: A dictionary containing the boxes associated with the given account.</span>
</span><span id="ZakatTracker-1374"><a href="#ZakatTracker-1374"><span class="linenos">1374</span></a><span class="sd">        If the account does not exist, an empty dictionary is returned.</span>
</span><span id="ZakatTracker-1375"><a href="#ZakatTracker-1375"><span class="linenos">1375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1376"><a href="#ZakatTracker-1376"><span class="linenos">1376</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker-1377"><a href="#ZakatTracker-1377"><span class="linenos">1377</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1378"><a href="#ZakatTracker-1378"><span class="linenos">1378</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="ZakatTracker-1379"><a href="#ZakatTracker-1379"><span class="linenos">1379</span></a>
</span><span id="ZakatTracker-1380"><a href="#ZakatTracker-1380"><span class="linenos">1380</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker-1381"><a href="#ZakatTracker-1381"><span class="linenos">1381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1382"><a href="#ZakatTracker-1382"><span class="linenos">1382</span></a><span class="sd">        Retrieve the logs (transactions) associated with a specific account.</span>
</span><span id="ZakatTracker-1383"><a href="#ZakatTracker-1383"><span class="linenos">1383</span></a>
</span><span id="ZakatTracker-1384"><a href="#ZakatTracker-1384"><span class="linenos">1384</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1385"><a href="#ZakatTracker-1385"><span class="linenos">1385</span></a><span class="sd">        - account (str): The account number for which to retrieve the logs.</span>
</span><span id="ZakatTracker-1386"><a href="#ZakatTracker-1386"><span class="linenos">1386</span></a>
</span><span id="ZakatTracker-1387"><a href="#ZakatTracker-1387"><span class="linenos">1387</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1388"><a href="#ZakatTracker-1388"><span class="linenos">1388</span></a><span class="sd">        - dict: A dictionary containing the logs associated with the given account.</span>
</span><span id="ZakatTracker-1389"><a href="#ZakatTracker-1389"><span class="linenos">1389</span></a><span class="sd">        If the account does not exist, an empty dictionary is returned.</span>
</span><span id="ZakatTracker-1390"><a href="#ZakatTracker-1390"><span class="linenos">1390</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1391"><a href="#ZakatTracker-1391"><span class="linenos">1391</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker-1392"><a href="#ZakatTracker-1392"><span class="linenos">1392</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1393"><a href="#ZakatTracker-1393"><span class="linenos">1393</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="ZakatTracker-1394"><a href="#ZakatTracker-1394"><span class="linenos">1394</span></a>
</span><span id="ZakatTracker-1395"><a href="#ZakatTracker-1395"><span class="linenos">1395</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">daily_logs_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
</span><span id="ZakatTracker-1396"><a href="#ZakatTracker-1396"><span class="linenos">1396</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1397"><a href="#ZakatTracker-1397"><span class="linenos">1397</span></a><span class="sd">        Initialize a dictionary to store daily, weekly, monthly, and yearly logs.</span>
</span><span id="ZakatTracker-1398"><a href="#ZakatTracker-1398"><span class="linenos">1398</span></a>
</span><span id="ZakatTracker-1399"><a href="#ZakatTracker-1399"><span class="linenos">1399</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1400"><a href="#ZakatTracker-1400"><span class="linenos">1400</span></a><span class="sd">        dict: A dictionary with keys &#39;daily&#39;, &#39;weekly&#39;, &#39;monthly&#39;, and &#39;yearly&#39;, each containing an empty dictionary.</span>
</span><span id="ZakatTracker-1401"><a href="#ZakatTracker-1401"><span class="linenos">1401</span></a><span class="sd">            Later each key maps to another dictionary, which will store the logs for the corresponding time period.</span>
</span><span id="ZakatTracker-1402"><a href="#ZakatTracker-1402"><span class="linenos">1402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1403"><a href="#ZakatTracker-1403"><span class="linenos">1403</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ZakatTracker-1404"><a href="#ZakatTracker-1404"><span class="linenos">1404</span></a>            <span class="s1">&#39;daily&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker-1405"><a href="#ZakatTracker-1405"><span class="linenos">1405</span></a>            <span class="s1">&#39;weekly&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker-1406"><a href="#ZakatTracker-1406"><span class="linenos">1406</span></a>            <span class="s1">&#39;monthly&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker-1407"><a href="#ZakatTracker-1407"><span class="linenos">1407</span></a>            <span class="s1">&#39;yearly&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker-1408"><a href="#ZakatTracker-1408"><span class="linenos">1408</span></a>        <span class="p">}</span>
</span><span id="ZakatTracker-1409"><a href="#ZakatTracker-1409"><span class="linenos">1409</span></a>
</span><span id="ZakatTracker-1410"><a href="#ZakatTracker-1410"><span class="linenos">1410</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">daily_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weekday</span><span class="p">:</span> <span class="n">WeekDay</span> <span class="o">=</span> <span class="n">WeekDay</span><span class="o">.</span><span class="n">Friday</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="ZakatTracker-1411"><a href="#ZakatTracker-1411"><span class="linenos">1411</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1412"><a href="#ZakatTracker-1412"><span class="linenos">1412</span></a><span class="sd">        Retrieve the daily logs (transactions) from all accounts.</span>
</span><span id="ZakatTracker-1413"><a href="#ZakatTracker-1413"><span class="linenos">1413</span></a>
</span><span id="ZakatTracker-1414"><a href="#ZakatTracker-1414"><span class="linenos">1414</span></a><span class="sd">        The function groups the logs by day, month, and year, and calculates the total value for each group.</span>
</span><span id="ZakatTracker-1415"><a href="#ZakatTracker-1415"><span class="linenos">1415</span></a><span class="sd">        It returns a dictionary where the keys are the timestamps of the daily groups,</span>
</span><span id="ZakatTracker-1416"><a href="#ZakatTracker-1416"><span class="linenos">1416</span></a><span class="sd">        and the values are dictionaries containing the total value and the logs for that group.</span>
</span><span id="ZakatTracker-1417"><a href="#ZakatTracker-1417"><span class="linenos">1417</span></a>
</span><span id="ZakatTracker-1418"><a href="#ZakatTracker-1418"><span class="linenos">1418</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1419"><a href="#ZakatTracker-1419"><span class="linenos">1419</span></a><span class="sd">        - weekday (WeekDay): Select the weekday is collected for the week data. Default is WeekDay.Friday.</span>
</span><span id="ZakatTracker-1420"><a href="#ZakatTracker-1420"><span class="linenos">1420</span></a><span class="sd">        - debug (bool): Whether to print debug information. Default is False.</span>
</span><span id="ZakatTracker-1421"><a href="#ZakatTracker-1421"><span class="linenos">1421</span></a>
</span><span id="ZakatTracker-1422"><a href="#ZakatTracker-1422"><span class="linenos">1422</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1423"><a href="#ZakatTracker-1423"><span class="linenos">1423</span></a><span class="sd">        dict: A dictionary containing the daily logs.</span>
</span><span id="ZakatTracker-1424"><a href="#ZakatTracker-1424"><span class="linenos">1424</span></a>
</span><span id="ZakatTracker-1425"><a href="#ZakatTracker-1425"><span class="linenos">1425</span></a><span class="sd">        Example:</span>
</span><span id="ZakatTracker-1426"><a href="#ZakatTracker-1426"><span class="linenos">1426</span></a><span class="sd">        &gt;&gt;&gt; tracker = ZakatTracker()</span>
</span><span id="ZakatTracker-1427"><a href="#ZakatTracker-1427"><span class="linenos">1427</span></a><span class="sd">        &gt;&gt;&gt; tracker.sub(51, &#39;desc&#39;, &#39;account1&#39;)</span>
</span><span id="ZakatTracker-1428"><a href="#ZakatTracker-1428"><span class="linenos">1428</span></a><span class="sd">        &gt;&gt;&gt; ref = tracker.track(100, &#39;desc&#39;, &#39;account2&#39;)</span>
</span><span id="ZakatTracker-1429"><a href="#ZakatTracker-1429"><span class="linenos">1429</span></a><span class="sd">        &gt;&gt;&gt; tracker.add_file(&#39;account2&#39;, ref, &#39;file_0&#39;)</span>
</span><span id="ZakatTracker-1430"><a href="#ZakatTracker-1430"><span class="linenos">1430</span></a><span class="sd">        &gt;&gt;&gt; tracker.add_file(&#39;account2&#39;, ref, &#39;file_1&#39;)</span>
</span><span id="ZakatTracker-1431"><a href="#ZakatTracker-1431"><span class="linenos">1431</span></a><span class="sd">        &gt;&gt;&gt; tracker.add_file(&#39;account2&#39;, ref, &#39;file_2&#39;)</span>
</span><span id="ZakatTracker-1432"><a href="#ZakatTracker-1432"><span class="linenos">1432</span></a><span class="sd">        &gt;&gt;&gt; tracker.daily_logs()</span>
</span><span id="ZakatTracker-1433"><a href="#ZakatTracker-1433"><span class="linenos">1433</span></a><span class="sd">        {</span>
</span><span id="ZakatTracker-1434"><a href="#ZakatTracker-1434"><span class="linenos">1434</span></a><span class="sd">            &#39;daily&#39;: {</span>
</span><span id="ZakatTracker-1435"><a href="#ZakatTracker-1435"><span class="linenos">1435</span></a><span class="sd">                &#39;2024-06-30&#39;: {</span>
</span><span id="ZakatTracker-1436"><a href="#ZakatTracker-1436"><span class="linenos">1436</span></a><span class="sd">                    &#39;positive&#39;: 100,</span>
</span><span id="ZakatTracker-1437"><a href="#ZakatTracker-1437"><span class="linenos">1437</span></a><span class="sd">                    &#39;negative&#39;: 51,</span>
</span><span id="ZakatTracker-1438"><a href="#ZakatTracker-1438"><span class="linenos">1438</span></a><span class="sd">                    &#39;total&#39;: 99,</span>
</span><span id="ZakatTracker-1439"><a href="#ZakatTracker-1439"><span class="linenos">1439</span></a><span class="sd">                    &#39;rows&#39;: [</span>
</span><span id="ZakatTracker-1440"><a href="#ZakatTracker-1440"><span class="linenos">1440</span></a><span class="sd">                        {</span>
</span><span id="ZakatTracker-1441"><a href="#ZakatTracker-1441"><span class="linenos">1441</span></a><span class="sd">                            &#39;account&#39;: &#39;account1&#39;,</span>
</span><span id="ZakatTracker-1442"><a href="#ZakatTracker-1442"><span class="linenos">1442</span></a><span class="sd">                            &#39;desc&#39;: &#39;desc&#39;,</span>
</span><span id="ZakatTracker-1443"><a href="#ZakatTracker-1443"><span class="linenos">1443</span></a><span class="sd">                            &#39;file&#39;: {},</span>
</span><span id="ZakatTracker-1444"><a href="#ZakatTracker-1444"><span class="linenos">1444</span></a><span class="sd">                            &#39;ref&#39;: None,</span>
</span><span id="ZakatTracker-1445"><a href="#ZakatTracker-1445"><span class="linenos">1445</span></a><span class="sd">                            &#39;value&#39;: -51,</span>
</span><span id="ZakatTracker-1446"><a href="#ZakatTracker-1446"><span class="linenos">1446</span></a><span class="sd">                            &#39;time&#39;: 1690977015000000000,</span>
</span><span id="ZakatTracker-1447"><a href="#ZakatTracker-1447"><span class="linenos">1447</span></a><span class="sd">                            &#39;transfer&#39;: False,</span>
</span><span id="ZakatTracker-1448"><a href="#ZakatTracker-1448"><span class="linenos">1448</span></a><span class="sd">                        },</span>
</span><span id="ZakatTracker-1449"><a href="#ZakatTracker-1449"><span class="linenos">1449</span></a><span class="sd">                        {</span>
</span><span id="ZakatTracker-1450"><a href="#ZakatTracker-1450"><span class="linenos">1450</span></a><span class="sd">                            &#39;account&#39;: &#39;account2&#39;,</span>
</span><span id="ZakatTracker-1451"><a href="#ZakatTracker-1451"><span class="linenos">1451</span></a><span class="sd">                            &#39;desc&#39;: &#39;desc&#39;,</span>
</span><span id="ZakatTracker-1452"><a href="#ZakatTracker-1452"><span class="linenos">1452</span></a><span class="sd">                            &#39;file&#39;: {</span>
</span><span id="ZakatTracker-1453"><a href="#ZakatTracker-1453"><span class="linenos">1453</span></a><span class="sd">                                1722919011626770944: &#39;file_0&#39;,</span>
</span><span id="ZakatTracker-1454"><a href="#ZakatTracker-1454"><span class="linenos">1454</span></a><span class="sd">                                1722919011626812928: &#39;file_1&#39;,</span>
</span><span id="ZakatTracker-1455"><a href="#ZakatTracker-1455"><span class="linenos">1455</span></a><span class="sd">                                1722919011626846976: &#39;file_2&#39;,</span>
</span><span id="ZakatTracker-1456"><a href="#ZakatTracker-1456"><span class="linenos">1456</span></a><span class="sd">                            },</span>
</span><span id="ZakatTracker-1457"><a href="#ZakatTracker-1457"><span class="linenos">1457</span></a><span class="sd">                            &#39;ref&#39;: None,</span>
</span><span id="ZakatTracker-1458"><a href="#ZakatTracker-1458"><span class="linenos">1458</span></a><span class="sd">                            &#39;value&#39;: 100,</span>
</span><span id="ZakatTracker-1459"><a href="#ZakatTracker-1459"><span class="linenos">1459</span></a><span class="sd">                            &#39;time&#39;: 1690977015000000000,</span>
</span><span id="ZakatTracker-1460"><a href="#ZakatTracker-1460"><span class="linenos">1460</span></a><span class="sd">                            &#39;transfer&#39;: False,</span>
</span><span id="ZakatTracker-1461"><a href="#ZakatTracker-1461"><span class="linenos">1461</span></a><span class="sd">                        },</span>
</span><span id="ZakatTracker-1462"><a href="#ZakatTracker-1462"><span class="linenos">1462</span></a><span class="sd">                    ],</span>
</span><span id="ZakatTracker-1463"><a href="#ZakatTracker-1463"><span class="linenos">1463</span></a><span class="sd">                },</span>
</span><span id="ZakatTracker-1464"><a href="#ZakatTracker-1464"><span class="linenos">1464</span></a><span class="sd">            },</span>
</span><span id="ZakatTracker-1465"><a href="#ZakatTracker-1465"><span class="linenos">1465</span></a><span class="sd">            &#39;weekly&#39;: {</span>
</span><span id="ZakatTracker-1466"><a href="#ZakatTracker-1466"><span class="linenos">1466</span></a><span class="sd">                datetime: {</span>
</span><span id="ZakatTracker-1467"><a href="#ZakatTracker-1467"><span class="linenos">1467</span></a><span class="sd">                    &#39;positive&#39;: 100,</span>
</span><span id="ZakatTracker-1468"><a href="#ZakatTracker-1468"><span class="linenos">1468</span></a><span class="sd">                    &#39;negative&#39;: 51,</span>
</span><span id="ZakatTracker-1469"><a href="#ZakatTracker-1469"><span class="linenos">1469</span></a><span class="sd">                    &#39;total&#39;: 99,</span>
</span><span id="ZakatTracker-1470"><a href="#ZakatTracker-1470"><span class="linenos">1470</span></a><span class="sd">                },</span>
</span><span id="ZakatTracker-1471"><a href="#ZakatTracker-1471"><span class="linenos">1471</span></a><span class="sd">            },</span>
</span><span id="ZakatTracker-1472"><a href="#ZakatTracker-1472"><span class="linenos">1472</span></a><span class="sd">            &#39;monthly&#39;: {</span>
</span><span id="ZakatTracker-1473"><a href="#ZakatTracker-1473"><span class="linenos">1473</span></a><span class="sd">                &#39;2024-06&#39;: {</span>
</span><span id="ZakatTracker-1474"><a href="#ZakatTracker-1474"><span class="linenos">1474</span></a><span class="sd">                    &#39;positive&#39;: 100,</span>
</span><span id="ZakatTracker-1475"><a href="#ZakatTracker-1475"><span class="linenos">1475</span></a><span class="sd">                    &#39;negative&#39;: 51,</span>
</span><span id="ZakatTracker-1476"><a href="#ZakatTracker-1476"><span class="linenos">1476</span></a><span class="sd">                    &#39;total&#39;: 99,</span>
</span><span id="ZakatTracker-1477"><a href="#ZakatTracker-1477"><span class="linenos">1477</span></a><span class="sd">                },</span>
</span><span id="ZakatTracker-1478"><a href="#ZakatTracker-1478"><span class="linenos">1478</span></a><span class="sd">            },</span>
</span><span id="ZakatTracker-1479"><a href="#ZakatTracker-1479"><span class="linenos">1479</span></a><span class="sd">            &#39;yearly&#39;: {</span>
</span><span id="ZakatTracker-1480"><a href="#ZakatTracker-1480"><span class="linenos">1480</span></a><span class="sd">                2024: {</span>
</span><span id="ZakatTracker-1481"><a href="#ZakatTracker-1481"><span class="linenos">1481</span></a><span class="sd">                    &#39;positive&#39;: 100,</span>
</span><span id="ZakatTracker-1482"><a href="#ZakatTracker-1482"><span class="linenos">1482</span></a><span class="sd">                    &#39;negative&#39;: 51,</span>
</span><span id="ZakatTracker-1483"><a href="#ZakatTracker-1483"><span class="linenos">1483</span></a><span class="sd">                    &#39;total&#39;: 99,</span>
</span><span id="ZakatTracker-1484"><a href="#ZakatTracker-1484"><span class="linenos">1484</span></a><span class="sd">                },</span>
</span><span id="ZakatTracker-1485"><a href="#ZakatTracker-1485"><span class="linenos">1485</span></a><span class="sd">            },</span>
</span><span id="ZakatTracker-1486"><a href="#ZakatTracker-1486"><span class="linenos">1486</span></a><span class="sd">        }</span>
</span><span id="ZakatTracker-1487"><a href="#ZakatTracker-1487"><span class="linenos">1487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1488"><a href="#ZakatTracker-1488"><span class="linenos">1488</span></a>        <span class="n">logs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker-1489"><a href="#ZakatTracker-1489"><span class="linenos">1489</span></a>        <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">():</span>
</span><span id="ZakatTracker-1490"><a href="#ZakatTracker-1490"><span class="linenos">1490</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">(</span><span class="n">account</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker-1491"><a href="#ZakatTracker-1491"><span class="linenos">1491</span></a>                <span class="n">v</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="ZakatTracker-1492"><a href="#ZakatTracker-1492"><span class="linenos">1492</span></a>                <span class="n">v</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">account</span>
</span><span id="ZakatTracker-1493"><a href="#ZakatTracker-1493"><span class="linenos">1493</span></a>                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
</span><span id="ZakatTracker-1494"><a href="#ZakatTracker-1494"><span class="linenos">1494</span></a>                    <span class="n">logs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker-1495"><a href="#ZakatTracker-1495"><span class="linenos">1495</span></a>                <span class="n">logs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="ZakatTracker-1496"><a href="#ZakatTracker-1496"><span class="linenos">1496</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1497"><a href="#ZakatTracker-1497"><span class="linenos">1497</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="n">logs</span><span class="p">)</span>
</span><span id="ZakatTracker-1498"><a href="#ZakatTracker-1498"><span class="linenos">1498</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daily_logs_init</span><span class="p">()</span>
</span><span id="ZakatTracker-1499"><a href="#ZakatTracker-1499"><span class="linenos">1499</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">logs</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="ZakatTracker-1500"><a href="#ZakatTracker-1500"><span class="linenos">1500</span></a>            <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_to_datetime</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="ZakatTracker-1501"><a href="#ZakatTracker-1501"><span class="linenos">1501</span></a>            <span class="n">daily</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ZakatTracker-1502"><a href="#ZakatTracker-1502"><span class="linenos">1502</span></a>            <span class="n">weekly</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">weekday</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="ZakatTracker-1503"><a href="#ZakatTracker-1503"><span class="linenos">1503</span></a>            <span class="n">monthly</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ZakatTracker-1504"><a href="#ZakatTracker-1504"><span class="linenos">1504</span></a>            <span class="n">yearly</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">year</span>
</span><span id="ZakatTracker-1505"><a href="#ZakatTracker-1505"><span class="linenos">1505</span></a>            <span class="c1"># daily</span>
</span><span id="ZakatTracker-1506"><a href="#ZakatTracker-1506"><span class="linenos">1506</span></a>            <span class="k">if</span> <span class="n">daily</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-1507"><a href="#ZakatTracker-1507"><span class="linenos">1507</span></a>                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">][</span><span class="n">daily</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-1508"><a href="#ZakatTracker-1508"><span class="linenos">1508</span></a>                    <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1509"><a href="#ZakatTracker-1509"><span class="linenos">1509</span></a>                    <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1510"><a href="#ZakatTracker-1510"><span class="linenos">1510</span></a>                    <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1511"><a href="#ZakatTracker-1511"><span class="linenos">1511</span></a>                    <span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="ZakatTracker-1512"><a href="#ZakatTracker-1512"><span class="linenos">1512</span></a>                <span class="p">}</span>
</span><span id="ZakatTracker-1513"><a href="#ZakatTracker-1513"><span class="linenos">1513</span></a>            <span class="n">transfer</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">logs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span><span id="ZakatTracker-1514"><a href="#ZakatTracker-1514"><span class="linenos">1514</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1515"><a href="#ZakatTracker-1515"><span class="linenos">1515</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;logs[i]&#39;</span><span class="p">,</span> <span class="n">logs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="ZakatTracker-1516"><a href="#ZakatTracker-1516"><span class="linenos">1516</span></a>            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="ZakatTracker-1517"><a href="#ZakatTracker-1517"><span class="linenos">1517</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1518"><a href="#ZakatTracker-1518"><span class="linenos">1518</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</span><span id="ZakatTracker-1519"><a href="#ZakatTracker-1519"><span class="linenos">1519</span></a>                <span class="c1"># daily</span>
</span><span id="ZakatTracker-1520"><a href="#ZakatTracker-1520"><span class="linenos">1520</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1521"><a href="#ZakatTracker-1521"><span class="linenos">1521</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1522"><a href="#ZakatTracker-1522"><span class="linenos">1522</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">][</span><span class="n">daily</span><span class="p">][</span><span class="s1">&#39;positive&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker-1523"><a href="#ZakatTracker-1523"><span class="linenos">1523</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker-1524"><a href="#ZakatTracker-1524"><span class="linenos">1524</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">][</span><span class="n">daily</span><span class="p">][</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">value</span>
</span><span id="ZakatTracker-1525"><a href="#ZakatTracker-1525"><span class="linenos">1525</span></a>                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">][</span><span class="n">daily</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker-1526"><a href="#ZakatTracker-1526"><span class="linenos">1526</span></a>                <span class="n">z</span><span class="p">[</span><span class="s1">&#39;transfer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transfer</span>
</span><span id="ZakatTracker-1527"><a href="#ZakatTracker-1527"><span class="linenos">1527</span></a>                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">][</span><span class="n">daily</span><span class="p">][</span><span class="s1">&#39;rows&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="ZakatTracker-1528"><a href="#ZakatTracker-1528"><span class="linenos">1528</span></a>                <span class="c1"># weekly</span>
</span><span id="ZakatTracker-1529"><a href="#ZakatTracker-1529"><span class="linenos">1529</span></a>                <span class="k">if</span> <span class="n">weekly</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;weekly&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-1530"><a href="#ZakatTracker-1530"><span class="linenos">1530</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;weekly&#39;</span><span class="p">][</span><span class="n">weekly</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-1531"><a href="#ZakatTracker-1531"><span class="linenos">1531</span></a>                        <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1532"><a href="#ZakatTracker-1532"><span class="linenos">1532</span></a>                        <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1533"><a href="#ZakatTracker-1533"><span class="linenos">1533</span></a>                        <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1534"><a href="#ZakatTracker-1534"><span class="linenos">1534</span></a>                    <span class="p">}</span>
</span><span id="ZakatTracker-1535"><a href="#ZakatTracker-1535"><span class="linenos">1535</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1536"><a href="#ZakatTracker-1536"><span class="linenos">1536</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;weekly&#39;</span><span class="p">][</span><span class="n">weekly</span><span class="p">][</span><span class="s1">&#39;positive&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker-1537"><a href="#ZakatTracker-1537"><span class="linenos">1537</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker-1538"><a href="#ZakatTracker-1538"><span class="linenos">1538</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;weekly&#39;</span><span class="p">][</span><span class="n">weekly</span><span class="p">][</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">value</span>
</span><span id="ZakatTracker-1539"><a href="#ZakatTracker-1539"><span class="linenos">1539</span></a>                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;weekly&#39;</span><span class="p">][</span><span class="n">weekly</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker-1540"><a href="#ZakatTracker-1540"><span class="linenos">1540</span></a>                <span class="c1"># monthly</span>
</span><span id="ZakatTracker-1541"><a href="#ZakatTracker-1541"><span class="linenos">1541</span></a>                <span class="k">if</span> <span class="n">monthly</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;monthly&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-1542"><a href="#ZakatTracker-1542"><span class="linenos">1542</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;monthly&#39;</span><span class="p">][</span><span class="n">monthly</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-1543"><a href="#ZakatTracker-1543"><span class="linenos">1543</span></a>                        <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1544"><a href="#ZakatTracker-1544"><span class="linenos">1544</span></a>                        <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1545"><a href="#ZakatTracker-1545"><span class="linenos">1545</span></a>                        <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1546"><a href="#ZakatTracker-1546"><span class="linenos">1546</span></a>                    <span class="p">}</span>
</span><span id="ZakatTracker-1547"><a href="#ZakatTracker-1547"><span class="linenos">1547</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1548"><a href="#ZakatTracker-1548"><span class="linenos">1548</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;monthly&#39;</span><span class="p">][</span><span class="n">monthly</span><span class="p">][</span><span class="s1">&#39;positive&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker-1549"><a href="#ZakatTracker-1549"><span class="linenos">1549</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker-1550"><a href="#ZakatTracker-1550"><span class="linenos">1550</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;monthly&#39;</span><span class="p">][</span><span class="n">monthly</span><span class="p">][</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">value</span>
</span><span id="ZakatTracker-1551"><a href="#ZakatTracker-1551"><span class="linenos">1551</span></a>                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;monthly&#39;</span><span class="p">][</span><span class="n">monthly</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker-1552"><a href="#ZakatTracker-1552"><span class="linenos">1552</span></a>                <span class="c1"># yearly</span>
</span><span id="ZakatTracker-1553"><a href="#ZakatTracker-1553"><span class="linenos">1553</span></a>                <span class="k">if</span> <span class="n">yearly</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;yearly&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-1554"><a href="#ZakatTracker-1554"><span class="linenos">1554</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;yearly&#39;</span><span class="p">][</span><span class="n">yearly</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-1555"><a href="#ZakatTracker-1555"><span class="linenos">1555</span></a>                        <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1556"><a href="#ZakatTracker-1556"><span class="linenos">1556</span></a>                        <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1557"><a href="#ZakatTracker-1557"><span class="linenos">1557</span></a>                        <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-1558"><a href="#ZakatTracker-1558"><span class="linenos">1558</span></a>                    <span class="p">}</span>
</span><span id="ZakatTracker-1559"><a href="#ZakatTracker-1559"><span class="linenos">1559</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1560"><a href="#ZakatTracker-1560"><span class="linenos">1560</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;yearly&#39;</span><span class="p">][</span><span class="n">yearly</span><span class="p">][</span><span class="s1">&#39;positive&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker-1561"><a href="#ZakatTracker-1561"><span class="linenos">1561</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker-1562"><a href="#ZakatTracker-1562"><span class="linenos">1562</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;yearly&#39;</span><span class="p">][</span><span class="n">yearly</span><span class="p">][</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">value</span>
</span><span id="ZakatTracker-1563"><a href="#ZakatTracker-1563"><span class="linenos">1563</span></a>                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;yearly&#39;</span><span class="p">][</span><span class="n">yearly</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker-1564"><a href="#ZakatTracker-1564"><span class="linenos">1564</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1565"><a href="#ZakatTracker-1565"><span class="linenos">1565</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker-1566"><a href="#ZakatTracker-1566"><span class="linenos">1566</span></a>        <span class="k">return</span> <span class="n">y</span>
</span><span id="ZakatTracker-1567"><a href="#ZakatTracker-1567"><span class="linenos">1567</span></a>
</span><span id="ZakatTracker-1568"><a href="#ZakatTracker-1568"><span class="linenos">1568</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-1569"><a href="#ZakatTracker-1569"><span class="linenos">1569</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1570"><a href="#ZakatTracker-1570"><span class="linenos">1570</span></a><span class="sd">        Adds a file reference to a specific transaction log entry in the vault.</span>
</span><span id="ZakatTracker-1571"><a href="#ZakatTracker-1571"><span class="linenos">1571</span></a>
</span><span id="ZakatTracker-1572"><a href="#ZakatTracker-1572"><span class="linenos">1572</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1573"><a href="#ZakatTracker-1573"><span class="linenos">1573</span></a><span class="sd">        - account (str): The account number associated with the transaction log.</span>
</span><span id="ZakatTracker-1574"><a href="#ZakatTracker-1574"><span class="linenos">1574</span></a><span class="sd">        - ref (int): The reference to the transaction log entry.</span>
</span><span id="ZakatTracker-1575"><a href="#ZakatTracker-1575"><span class="linenos">1575</span></a><span class="sd">        - path (str): The path of the file to be added.</span>
</span><span id="ZakatTracker-1576"><a href="#ZakatTracker-1576"><span class="linenos">1576</span></a>
</span><span id="ZakatTracker-1577"><a href="#ZakatTracker-1577"><span class="linenos">1577</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1578"><a href="#ZakatTracker-1578"><span class="linenos">1578</span></a><span class="sd">        - int: The reference of the added file. If the account or transaction log entry does not exist, returns 0.</span>
</span><span id="ZakatTracker-1579"><a href="#ZakatTracker-1579"><span class="linenos">1579</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1580"><a href="#ZakatTracker-1580"><span class="linenos">1580</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker-1581"><a href="#ZakatTracker-1581"><span class="linenos">1581</span></a>            <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-1582"><a href="#ZakatTracker-1582"><span class="linenos">1582</span></a>                <span class="n">file_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker-1583"><a href="#ZakatTracker-1583"><span class="linenos">1583</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">file_ref</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>
</span><span id="ZakatTracker-1584"><a href="#ZakatTracker-1584"><span class="linenos">1584</span></a>                <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-1585"><a href="#ZakatTracker-1585"><span class="linenos">1585</span></a>                <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker-1586"><a href="#ZakatTracker-1586"><span class="linenos">1586</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">ADD_FILE</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file_ref</span><span class="p">)</span>
</span><span id="ZakatTracker-1587"><a href="#ZakatTracker-1587"><span class="linenos">1587</span></a>                <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker-1588"><a href="#ZakatTracker-1588"><span class="linenos">1588</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker-1589"><a href="#ZakatTracker-1589"><span class="linenos">1589</span></a>                <span class="k">return</span> <span class="n">file_ref</span>
</span><span id="ZakatTracker-1590"><a href="#ZakatTracker-1590"><span class="linenos">1590</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="ZakatTracker-1591"><a href="#ZakatTracker-1591"><span class="linenos">1591</span></a>
</span><span id="ZakatTracker-1592"><a href="#ZakatTracker-1592"><span class="linenos">1592</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_ref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-1593"><a href="#ZakatTracker-1593"><span class="linenos">1593</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1594"><a href="#ZakatTracker-1594"><span class="linenos">1594</span></a><span class="sd">        Removes a file reference from a specific transaction log entry in the vault.</span>
</span><span id="ZakatTracker-1595"><a href="#ZakatTracker-1595"><span class="linenos">1595</span></a>
</span><span id="ZakatTracker-1596"><a href="#ZakatTracker-1596"><span class="linenos">1596</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1597"><a href="#ZakatTracker-1597"><span class="linenos">1597</span></a><span class="sd">        - account (str): The account number associated with the transaction log.</span>
</span><span id="ZakatTracker-1598"><a href="#ZakatTracker-1598"><span class="linenos">1598</span></a><span class="sd">        - ref (int): The reference to the transaction log entry.</span>
</span><span id="ZakatTracker-1599"><a href="#ZakatTracker-1599"><span class="linenos">1599</span></a><span class="sd">        - file_ref (int): The reference of the file to be removed.</span>
</span><span id="ZakatTracker-1600"><a href="#ZakatTracker-1600"><span class="linenos">1600</span></a>
</span><span id="ZakatTracker-1601"><a href="#ZakatTracker-1601"><span class="linenos">1601</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1602"><a href="#ZakatTracker-1602"><span class="linenos">1602</span></a><span class="sd">        - bool: True if the file reference is successfully removed, False otherwise.</span>
</span><span id="ZakatTracker-1603"><a href="#ZakatTracker-1603"><span class="linenos">1603</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1604"><a href="#ZakatTracker-1604"><span class="linenos">1604</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker-1605"><a href="#ZakatTracker-1605"><span class="linenos">1605</span></a>            <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-1606"><a href="#ZakatTracker-1606"><span class="linenos">1606</span></a>                <span class="k">if</span> <span class="n">file_ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-1607"><a href="#ZakatTracker-1607"><span class="linenos">1607</span></a>                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">file_ref</span><span class="p">]</span>
</span><span id="ZakatTracker-1608"><a href="#ZakatTracker-1608"><span class="linenos">1608</span></a>                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">file_ref</span><span class="p">]</span>
</span><span id="ZakatTracker-1609"><a href="#ZakatTracker-1609"><span class="linenos">1609</span></a>                    <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-1610"><a href="#ZakatTracker-1610"><span class="linenos">1610</span></a>                    <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker-1611"><a href="#ZakatTracker-1611"><span class="linenos">1611</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">REMOVE_FILE</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file_ref</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker-1612"><a href="#ZakatTracker-1612"><span class="linenos">1612</span></a>                    <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker-1613"><a href="#ZakatTracker-1613"><span class="linenos">1613</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker-1614"><a href="#ZakatTracker-1614"><span class="linenos">1614</span></a>                    <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker-1615"><a href="#ZakatTracker-1615"><span class="linenos">1615</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker-1616"><a href="#ZakatTracker-1616"><span class="linenos">1616</span></a>
</span><span id="ZakatTracker-1617"><a href="#ZakatTracker-1617"><span class="linenos">1617</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cached</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-1618"><a href="#ZakatTracker-1618"><span class="linenos">1618</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1619"><a href="#ZakatTracker-1619"><span class="linenos">1619</span></a><span class="sd">        Calculate and return the balance of a specific account.</span>
</span><span id="ZakatTracker-1620"><a href="#ZakatTracker-1620"><span class="linenos">1620</span></a>
</span><span id="ZakatTracker-1621"><a href="#ZakatTracker-1621"><span class="linenos">1621</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1622"><a href="#ZakatTracker-1622"><span class="linenos">1622</span></a><span class="sd">        - account (str): The account number. Default is &#39;1&#39;.</span>
</span><span id="ZakatTracker-1623"><a href="#ZakatTracker-1623"><span class="linenos">1623</span></a><span class="sd">        - cached (bool): If True, use the cached balance. If False, calculate the balance from the box. Default is True.</span>
</span><span id="ZakatTracker-1624"><a href="#ZakatTracker-1624"><span class="linenos">1624</span></a>
</span><span id="ZakatTracker-1625"><a href="#ZakatTracker-1625"><span class="linenos">1625</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1626"><a href="#ZakatTracker-1626"><span class="linenos">1626</span></a><span class="sd">        - int: The balance of the account.</span>
</span><span id="ZakatTracker-1627"><a href="#ZakatTracker-1627"><span class="linenos">1627</span></a>
</span><span id="ZakatTracker-1628"><a href="#ZakatTracker-1628"><span class="linenos">1628</span></a><span class="sd">        Notes:</span>
</span><span id="ZakatTracker-1629"><a href="#ZakatTracker-1629"><span class="linenos">1629</span></a><span class="sd">        - If cached is True, the function returns the cached balance.</span>
</span><span id="ZakatTracker-1630"><a href="#ZakatTracker-1630"><span class="linenos">1630</span></a><span class="sd">        - If cached is False, the function calculates the balance from the box by summing up the &#39;rest&#39; values of all box items.</span>
</span><span id="ZakatTracker-1631"><a href="#ZakatTracker-1631"><span class="linenos">1631</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1632"><a href="#ZakatTracker-1632"><span class="linenos">1632</span></a>        <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
</span><span id="ZakatTracker-1633"><a href="#ZakatTracker-1633"><span class="linenos">1633</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1634"><a href="#ZakatTracker-1634"><span class="linenos">1634</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-1635"><a href="#ZakatTracker-1635"><span class="linenos">1635</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="o">:=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker-1636"><a href="#ZakatTracker-1636"><span class="linenos">1636</span></a>
</span><span id="ZakatTracker-1637"><a href="#ZakatTracker-1637"><span class="linenos">1637</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">hide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-1638"><a href="#ZakatTracker-1638"><span class="linenos">1638</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1639"><a href="#ZakatTracker-1639"><span class="linenos">1639</span></a><span class="sd">        Check or set the hide status of a specific account.</span>
</span><span id="ZakatTracker-1640"><a href="#ZakatTracker-1640"><span class="linenos">1640</span></a>
</span><span id="ZakatTracker-1641"><a href="#ZakatTracker-1641"><span class="linenos">1641</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1642"><a href="#ZakatTracker-1642"><span class="linenos">1642</span></a><span class="sd">        - account (str): The account number.</span>
</span><span id="ZakatTracker-1643"><a href="#ZakatTracker-1643"><span class="linenos">1643</span></a><span class="sd">        - status (bool, optional): The new hide status. If not provided, the function will return the current status.</span>
</span><span id="ZakatTracker-1644"><a href="#ZakatTracker-1644"><span class="linenos">1644</span></a>
</span><span id="ZakatTracker-1645"><a href="#ZakatTracker-1645"><span class="linenos">1645</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1646"><a href="#ZakatTracker-1646"><span class="linenos">1646</span></a><span class="sd">        - bool: The current or updated hide status of the account.</span>
</span><span id="ZakatTracker-1647"><a href="#ZakatTracker-1647"><span class="linenos">1647</span></a>
</span><span id="ZakatTracker-1648"><a href="#ZakatTracker-1648"><span class="linenos">1648</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker-1649"><a href="#ZakatTracker-1649"><span class="linenos">1649</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker-1650"><a href="#ZakatTracker-1650"><span class="linenos">1650</span></a>
</span><span id="ZakatTracker-1651"><a href="#ZakatTracker-1651"><span class="linenos">1651</span></a><span class="sd">        Example:</span>
</span><span id="ZakatTracker-1652"><a href="#ZakatTracker-1652"><span class="linenos">1652</span></a><span class="sd">        &gt;&gt;&gt; tracker = ZakatTracker()</span>
</span><span id="ZakatTracker-1653"><a href="#ZakatTracker-1653"><span class="linenos">1653</span></a><span class="sd">        &gt;&gt;&gt; ref = tracker.track(51, &#39;desc&#39;, &#39;account1&#39;)</span>
</span><span id="ZakatTracker-1654"><a href="#ZakatTracker-1654"><span class="linenos">1654</span></a><span class="sd">        &gt;&gt;&gt; tracker.hide(&#39;account1&#39;)  # Set the hide status of &#39;account1&#39; to True</span>
</span><span id="ZakatTracker-1655"><a href="#ZakatTracker-1655"><span class="linenos">1655</span></a><span class="sd">        False</span>
</span><span id="ZakatTracker-1656"><a href="#ZakatTracker-1656"><span class="linenos">1656</span></a><span class="sd">        &gt;&gt;&gt; tracker.hide(&#39;account1&#39;, True)  # Set the hide status of &#39;account1&#39; to True</span>
</span><span id="ZakatTracker-1657"><a href="#ZakatTracker-1657"><span class="linenos">1657</span></a><span class="sd">        True</span>
</span><span id="ZakatTracker-1658"><a href="#ZakatTracker-1658"><span class="linenos">1658</span></a><span class="sd">        &gt;&gt;&gt; tracker.hide(&#39;account1&#39;)  # Get the hide status of &#39;account1&#39; by default</span>
</span><span id="ZakatTracker-1659"><a href="#ZakatTracker-1659"><span class="linenos">1659</span></a><span class="sd">        True</span>
</span><span id="ZakatTracker-1660"><a href="#ZakatTracker-1660"><span class="linenos">1660</span></a><span class="sd">        &gt;&gt;&gt; tracker.hide(&#39;account1&#39;, False)</span>
</span><span id="ZakatTracker-1661"><a href="#ZakatTracker-1661"><span class="linenos">1661</span></a><span class="sd">        False</span>
</span><span id="ZakatTracker-1662"><a href="#ZakatTracker-1662"><span class="linenos">1662</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1663"><a href="#ZakatTracker-1663"><span class="linenos">1663</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker-1664"><a href="#ZakatTracker-1664"><span class="linenos">1664</span></a>            <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-1665"><a href="#ZakatTracker-1665"><span class="linenos">1665</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;hide&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1666"><a href="#ZakatTracker-1666"><span class="linenos">1666</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;hide&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
</span><span id="ZakatTracker-1667"><a href="#ZakatTracker-1667"><span class="linenos">1667</span></a>            <span class="k">return</span> <span class="n">status</span>
</span><span id="ZakatTracker-1668"><a href="#ZakatTracker-1668"><span class="linenos">1668</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker-1669"><a href="#ZakatTracker-1669"><span class="linenos">1669</span></a>
</span><span id="ZakatTracker-1670"><a href="#ZakatTracker-1670"><span class="linenos">1670</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">zakatable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-1671"><a href="#ZakatTracker-1671"><span class="linenos">1671</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1672"><a href="#ZakatTracker-1672"><span class="linenos">1672</span></a><span class="sd">        Check or set the zakatable status of a specific account.</span>
</span><span id="ZakatTracker-1673"><a href="#ZakatTracker-1673"><span class="linenos">1673</span></a>
</span><span id="ZakatTracker-1674"><a href="#ZakatTracker-1674"><span class="linenos">1674</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1675"><a href="#ZakatTracker-1675"><span class="linenos">1675</span></a><span class="sd">        - account (str): The account number.</span>
</span><span id="ZakatTracker-1676"><a href="#ZakatTracker-1676"><span class="linenos">1676</span></a><span class="sd">        - status (bool, optional): The new zakatable status. If not provided, the function will return the current status.</span>
</span><span id="ZakatTracker-1677"><a href="#ZakatTracker-1677"><span class="linenos">1677</span></a>
</span><span id="ZakatTracker-1678"><a href="#ZakatTracker-1678"><span class="linenos">1678</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1679"><a href="#ZakatTracker-1679"><span class="linenos">1679</span></a><span class="sd">        - bool: The current or updated zakatable status of the account.</span>
</span><span id="ZakatTracker-1680"><a href="#ZakatTracker-1680"><span class="linenos">1680</span></a>
</span><span id="ZakatTracker-1681"><a href="#ZakatTracker-1681"><span class="linenos">1681</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker-1682"><a href="#ZakatTracker-1682"><span class="linenos">1682</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker-1683"><a href="#ZakatTracker-1683"><span class="linenos">1683</span></a>
</span><span id="ZakatTracker-1684"><a href="#ZakatTracker-1684"><span class="linenos">1684</span></a><span class="sd">        Example:</span>
</span><span id="ZakatTracker-1685"><a href="#ZakatTracker-1685"><span class="linenos">1685</span></a><span class="sd">        &gt;&gt;&gt; tracker = ZakatTracker()</span>
</span><span id="ZakatTracker-1686"><a href="#ZakatTracker-1686"><span class="linenos">1686</span></a><span class="sd">        &gt;&gt;&gt; ref = tracker.track(51, &#39;desc&#39;, &#39;account1&#39;)</span>
</span><span id="ZakatTracker-1687"><a href="#ZakatTracker-1687"><span class="linenos">1687</span></a><span class="sd">        &gt;&gt;&gt; tracker.zakatable(&#39;account1&#39;)  # Set the zakatable status of &#39;account1&#39; to True</span>
</span><span id="ZakatTracker-1688"><a href="#ZakatTracker-1688"><span class="linenos">1688</span></a><span class="sd">        True</span>
</span><span id="ZakatTracker-1689"><a href="#ZakatTracker-1689"><span class="linenos">1689</span></a><span class="sd">        &gt;&gt;&gt; tracker.zakatable(&#39;account1&#39;, True)  # Set the zakatable status of &#39;account1&#39; to True</span>
</span><span id="ZakatTracker-1690"><a href="#ZakatTracker-1690"><span class="linenos">1690</span></a><span class="sd">        True</span>
</span><span id="ZakatTracker-1691"><a href="#ZakatTracker-1691"><span class="linenos">1691</span></a><span class="sd">        &gt;&gt;&gt; tracker.zakatable(&#39;account1&#39;)  # Get the zakatable status of &#39;account1&#39; by default</span>
</span><span id="ZakatTracker-1692"><a href="#ZakatTracker-1692"><span class="linenos">1692</span></a><span class="sd">        True</span>
</span><span id="ZakatTracker-1693"><a href="#ZakatTracker-1693"><span class="linenos">1693</span></a><span class="sd">        &gt;&gt;&gt; tracker.zakatable(&#39;account1&#39;, False)</span>
</span><span id="ZakatTracker-1694"><a href="#ZakatTracker-1694"><span class="linenos">1694</span></a><span class="sd">        False</span>
</span><span id="ZakatTracker-1695"><a href="#ZakatTracker-1695"><span class="linenos">1695</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1696"><a href="#ZakatTracker-1696"><span class="linenos">1696</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker-1697"><a href="#ZakatTracker-1697"><span class="linenos">1697</span></a>            <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-1698"><a href="#ZakatTracker-1698"><span class="linenos">1698</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;zakatable&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1699"><a href="#ZakatTracker-1699"><span class="linenos">1699</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;zakatable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
</span><span id="ZakatTracker-1700"><a href="#ZakatTracker-1700"><span class="linenos">1700</span></a>            <span class="k">return</span> <span class="n">status</span>
</span><span id="ZakatTracker-1701"><a href="#ZakatTracker-1701"><span class="linenos">1701</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker-1702"><a href="#ZakatTracker-1702"><span class="linenos">1702</span></a>
</span><span id="ZakatTracker-1703"><a href="#ZakatTracker-1703"><span class="linenos">1703</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unscaled_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">created</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker-1704"><a href="#ZakatTracker-1704"><span class="linenos">1704</span></a>            <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> \
</span><span id="ZakatTracker-1705"><a href="#ZakatTracker-1705"><span class="linenos">1705</span></a>            <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
</span><span id="ZakatTracker-1706"><a href="#ZakatTracker-1706"><span class="linenos">1706</span></a>                   <span class="nb">int</span><span class="p">,</span>
</span><span id="ZakatTracker-1707"><a href="#ZakatTracker-1707"><span class="linenos">1707</span></a>                   <span class="nb">list</span><span class="p">[</span>
</span><span id="ZakatTracker-1708"><a href="#ZakatTracker-1708"><span class="linenos">1708</span></a>                       <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="ZakatTracker-1709"><a href="#ZakatTracker-1709"><span class="linenos">1709</span></a>                   <span class="p">],</span>
</span><span id="ZakatTracker-1710"><a href="#ZakatTracker-1710"><span class="linenos">1710</span></a>               <span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="ZakatTracker-1711"><a href="#ZakatTracker-1711"><span class="linenos">1711</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1712"><a href="#ZakatTracker-1712"><span class="linenos">1712</span></a><span class="sd">        Subtracts a specified value from an account&#39;s balance.</span>
</span><span id="ZakatTracker-1713"><a href="#ZakatTracker-1713"><span class="linenos">1713</span></a>
</span><span id="ZakatTracker-1714"><a href="#ZakatTracker-1714"><span class="linenos">1714</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1715"><a href="#ZakatTracker-1715"><span class="linenos">1715</span></a><span class="sd">        - unscaled_value (float | int | decimal.Decimal): The amount to be subtracted.</span>
</span><span id="ZakatTracker-1716"><a href="#ZakatTracker-1716"><span class="linenos">1716</span></a><span class="sd">        - desc (str): A description for the transaction. Defaults to an empty string.</span>
</span><span id="ZakatTracker-1717"><a href="#ZakatTracker-1717"><span class="linenos">1717</span></a><span class="sd">        - account (str): The account from which the value will be subtracted. Defaults to &#39;1&#39;.</span>
</span><span id="ZakatTracker-1718"><a href="#ZakatTracker-1718"><span class="linenos">1718</span></a><span class="sd">        - created (int): The timestamp of the transaction. If not provided, the current timestamp will be used.</span>
</span><span id="ZakatTracker-1719"><a href="#ZakatTracker-1719"><span class="linenos">1719</span></a><span class="sd">        - debug (bool): A flag indicating whether to print debug information. Defaults to False.</span>
</span><span id="ZakatTracker-1720"><a href="#ZakatTracker-1720"><span class="linenos">1720</span></a>
</span><span id="ZakatTracker-1721"><a href="#ZakatTracker-1721"><span class="linenos">1721</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1722"><a href="#ZakatTracker-1722"><span class="linenos">1722</span></a><span class="sd">        - tuple: A tuple containing the timestamp of the transaction and a list of tuples representing the age of each transaction.</span>
</span><span id="ZakatTracker-1723"><a href="#ZakatTracker-1723"><span class="linenos">1723</span></a>
</span><span id="ZakatTracker-1724"><a href="#ZakatTracker-1724"><span class="linenos">1724</span></a><span class="sd">        If the amount to subtract is greater than the account&#39;s balance,</span>
</span><span id="ZakatTracker-1725"><a href="#ZakatTracker-1725"><span class="linenos">1725</span></a><span class="sd">        the remaining amount will be transferred to a new transaction with a negative value.</span>
</span><span id="ZakatTracker-1726"><a href="#ZakatTracker-1726"><span class="linenos">1726</span></a>
</span><span id="ZakatTracker-1727"><a href="#ZakatTracker-1727"><span class="linenos">1727</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker-1728"><a href="#ZakatTracker-1728"><span class="linenos">1728</span></a><span class="sd">        - ValueError: The created should be greater than zero.</span>
</span><span id="ZakatTracker-1729"><a href="#ZakatTracker-1729"><span class="linenos">1729</span></a><span class="sd">        - ValueError: The box transaction happened again in the same nanosecond time.</span>
</span><span id="ZakatTracker-1730"><a href="#ZakatTracker-1730"><span class="linenos">1730</span></a><span class="sd">        - ValueError: The log transaction happened again in the same nanosecond time.</span>
</span><span id="ZakatTracker-1731"><a href="#ZakatTracker-1731"><span class="linenos">1731</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1732"><a href="#ZakatTracker-1732"><span class="linenos">1732</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1733"><a href="#ZakatTracker-1733"><span class="linenos">1733</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-1734"><a href="#ZakatTracker-1734"><span class="linenos">1734</span></a>        <span class="k">if</span> <span class="n">unscaled_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1735"><a href="#ZakatTracker-1735"><span class="linenos">1735</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>
</span><span id="ZakatTracker-1736"><a href="#ZakatTracker-1736"><span class="linenos">1736</span></a>        <span class="k">if</span> <span class="n">unscaled_value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1737"><a href="#ZakatTracker-1737"><span class="linenos">1737</span></a>            <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="n">unscaled_value</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</span><span id="ZakatTracker-1738"><a href="#ZakatTracker-1738"><span class="linenos">1738</span></a>            <span class="k">return</span> <span class="n">ref</span><span class="p">,</span> <span class="n">ref</span>
</span><span id="ZakatTracker-1739"><a href="#ZakatTracker-1739"><span class="linenos">1739</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-1740"><a href="#ZakatTracker-1740"><span class="linenos">1740</span></a>            <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker-1741"><a href="#ZakatTracker-1741"><span class="linenos">1741</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1742"><a href="#ZakatTracker-1742"><span class="linenos">1742</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The created should be greater than zero.&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-1743"><a href="#ZakatTracker-1743"><span class="linenos">1743</span></a>        <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-1744"><a href="#ZakatTracker-1744"><span class="linenos">1744</span></a>        <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker-1745"><a href="#ZakatTracker-1745"><span class="linenos">1745</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</span><span id="ZakatTracker-1746"><a href="#ZakatTracker-1746"><span class="linenos">1746</span></a>        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">unscaled_value</span><span class="p">)</span>
</span><span id="ZakatTracker-1747"><a href="#ZakatTracker-1747"><span class="linenos">1747</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">value</span><span class="o">=-</span><span class="n">value</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">created</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-1748"><a href="#ZakatTracker-1748"><span class="linenos">1748</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ZakatTracker-1749"><a href="#ZakatTracker-1749"><span class="linenos">1749</span></a>        <span class="n">limit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ZakatTracker-1750"><a href="#ZakatTracker-1750"><span class="linenos">1750</span></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="ZakatTracker-1751"><a href="#ZakatTracker-1751"><span class="linenos">1751</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1752"><a href="#ZakatTracker-1752"><span class="linenos">1752</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ids&#39;</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>
</span><span id="ZakatTracker-1753"><a href="#ZakatTracker-1753"><span class="linenos">1753</span></a>        <span class="n">ages</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker-1754"><a href="#ZakatTracker-1754"><span class="linenos">1754</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ZakatTracker-1755"><a href="#ZakatTracker-1755"><span class="linenos">1755</span></a>            <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1756"><a href="#ZakatTracker-1756"><span class="linenos">1756</span></a>                <span class="k">break</span>
</span><span id="ZakatTracker-1757"><a href="#ZakatTracker-1757"><span class="linenos">1757</span></a>            <span class="n">j</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="ZakatTracker-1758"><a href="#ZakatTracker-1758"><span class="linenos">1758</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1759"><a href="#ZakatTracker-1759"><span class="linenos">1759</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
</span><span id="ZakatTracker-1760"><a href="#ZakatTracker-1760"><span class="linenos">1760</span></a>            <span class="n">rest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1761"><a href="#ZakatTracker-1761"><span class="linenos">1761</span></a>            <span class="k">if</span> <span class="n">rest</span> <span class="o">&gt;=</span> <span class="n">target</span><span class="p">:</span>
</span><span id="ZakatTracker-1762"><a href="#ZakatTracker-1762"><span class="linenos">1762</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">target</span>
</span><span id="ZakatTracker-1763"><a href="#ZakatTracker-1763"><span class="linenos">1763</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">SUB</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
</span><span id="ZakatTracker-1764"><a href="#ZakatTracker-1764"><span class="linenos">1764</span></a>                <span class="n">ages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">j</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
</span><span id="ZakatTracker-1765"><a href="#ZakatTracker-1765"><span class="linenos">1765</span></a>                <span class="n">target</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-1766"><a href="#ZakatTracker-1766"><span class="linenos">1766</span></a>                <span class="k">break</span>
</span><span id="ZakatTracker-1767"><a href="#ZakatTracker-1767"><span class="linenos">1767</span></a>            <span class="k">elif</span> <span class="n">target</span> <span class="o">&gt;</span> <span class="n">rest</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1768"><a href="#ZakatTracker-1768"><span class="linenos">1768</span></a>                <span class="n">chunk</span> <span class="o">=</span> <span class="n">rest</span>
</span><span id="ZakatTracker-1769"><a href="#ZakatTracker-1769"><span class="linenos">1769</span></a>                <span class="n">target</span> <span class="o">-=</span> <span class="n">chunk</span>
</span><span id="ZakatTracker-1770"><a href="#ZakatTracker-1770"><span class="linenos">1770</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">SUB</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="ZakatTracker-1771"><a href="#ZakatTracker-1771"><span class="linenos">1771</span></a>                <span class="n">ages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">j</span><span class="p">,</span> <span class="n">chunk</span><span class="p">))</span>
</span><span id="ZakatTracker-1772"><a href="#ZakatTracker-1772"><span class="linenos">1772</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-1773"><a href="#ZakatTracker-1773"><span class="linenos">1773</span></a>        <span class="k">if</span> <span class="n">target</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1774"><a href="#ZakatTracker-1774"><span class="linenos">1774</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span>
</span><span id="ZakatTracker-1775"><a href="#ZakatTracker-1775"><span class="linenos">1775</span></a>                <span class="n">unscaled_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span><span class="o">-</span><span class="n">target</span><span class="p">),</span>
</span><span id="ZakatTracker-1776"><a href="#ZakatTracker-1776"><span class="linenos">1776</span></a>                <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
</span><span id="ZakatTracker-1777"><a href="#ZakatTracker-1777"><span class="linenos">1777</span></a>                <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span>
</span><span id="ZakatTracker-1778"><a href="#ZakatTracker-1778"><span class="linenos">1778</span></a>                <span class="n">logging</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ZakatTracker-1779"><a href="#ZakatTracker-1779"><span class="linenos">1779</span></a>                <span class="n">created</span><span class="o">=</span><span class="n">created</span><span class="p">,</span>
</span><span id="ZakatTracker-1780"><a href="#ZakatTracker-1780"><span class="linenos">1780</span></a>            <span class="p">)</span>
</span><span id="ZakatTracker-1781"><a href="#ZakatTracker-1781"><span class="linenos">1781</span></a>            <span class="n">ages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">created</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
</span><span id="ZakatTracker-1782"><a href="#ZakatTracker-1782"><span class="linenos">1782</span></a>        <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker-1783"><a href="#ZakatTracker-1783"><span class="linenos">1783</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker-1784"><a href="#ZakatTracker-1784"><span class="linenos">1784</span></a>        <span class="k">return</span> <span class="n">created</span><span class="p">,</span> <span class="n">ages</span>
</span><span id="ZakatTracker-1785"><a href="#ZakatTracker-1785"><span class="linenos">1785</span></a>
</span><span id="ZakatTracker-1786"><a href="#ZakatTracker-1786"><span class="linenos">1786</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unscaled_amount</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">from_account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-1787"><a href="#ZakatTracker-1787"><span class="linenos">1787</span></a>                 <span class="n">created</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker-1788"><a href="#ZakatTracker-1788"><span class="linenos">1788</span></a>                 <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="ZakatTracker-1789"><a href="#ZakatTracker-1789"><span class="linenos">1789</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1790"><a href="#ZakatTracker-1790"><span class="linenos">1790</span></a><span class="sd">        Transfers a specified value from one account to another.</span>
</span><span id="ZakatTracker-1791"><a href="#ZakatTracker-1791"><span class="linenos">1791</span></a>
</span><span id="ZakatTracker-1792"><a href="#ZakatTracker-1792"><span class="linenos">1792</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1793"><a href="#ZakatTracker-1793"><span class="linenos">1793</span></a><span class="sd">        - unscaled_amount (float | int | decimal.Decimal): The amount to be transferred.</span>
</span><span id="ZakatTracker-1794"><a href="#ZakatTracker-1794"><span class="linenos">1794</span></a><span class="sd">        - from_account (str): The account from which the value will be transferred.</span>
</span><span id="ZakatTracker-1795"><a href="#ZakatTracker-1795"><span class="linenos">1795</span></a><span class="sd">        - to_account (str): The account to which the value will be transferred.</span>
</span><span id="ZakatTracker-1796"><a href="#ZakatTracker-1796"><span class="linenos">1796</span></a><span class="sd">        - desc (str, optional): A description for the transaction. Defaults to an empty string.</span>
</span><span id="ZakatTracker-1797"><a href="#ZakatTracker-1797"><span class="linenos">1797</span></a><span class="sd">        -;created (int, optional): The timestamp of the transaction. If not provided, the current timestamp will be used.</span>
</span><span id="ZakatTracker-1798"><a href="#ZakatTracker-1798"><span class="linenos">1798</span></a><span class="sd">        - debug (bool): A flag indicating whether to print debug information. Defaults to False.</span>
</span><span id="ZakatTracker-1799"><a href="#ZakatTracker-1799"><span class="linenos">1799</span></a>
</span><span id="ZakatTracker-1800"><a href="#ZakatTracker-1800"><span class="linenos">1800</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1801"><a href="#ZakatTracker-1801"><span class="linenos">1801</span></a><span class="sd">        - list[int]: A list of timestamps corresponding to the transactions made during the transfer.</span>
</span><span id="ZakatTracker-1802"><a href="#ZakatTracker-1802"><span class="linenos">1802</span></a>
</span><span id="ZakatTracker-1803"><a href="#ZakatTracker-1803"><span class="linenos">1803</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker-1804"><a href="#ZakatTracker-1804"><span class="linenos">1804</span></a><span class="sd">        - ValueError: Transfer to the same account is forbidden.</span>
</span><span id="ZakatTracker-1805"><a href="#ZakatTracker-1805"><span class="linenos">1805</span></a><span class="sd">        - ValueError: The created should be greater than zero.</span>
</span><span id="ZakatTracker-1806"><a href="#ZakatTracker-1806"><span class="linenos">1806</span></a><span class="sd">        - ValueError: The box transaction happened again in the same nanosecond time.</span>
</span><span id="ZakatTracker-1807"><a href="#ZakatTracker-1807"><span class="linenos">1807</span></a><span class="sd">        - ValueError: The log transaction happened again in the same nanosecond time.</span>
</span><span id="ZakatTracker-1808"><a href="#ZakatTracker-1808"><span class="linenos">1808</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1809"><a href="#ZakatTracker-1809"><span class="linenos">1809</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1810"><a href="#ZakatTracker-1810"><span class="linenos">1810</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;transfer&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-1811"><a href="#ZakatTracker-1811"><span class="linenos">1811</span></a>        <span class="k">if</span> <span class="n">from_account</span> <span class="o">==</span> <span class="n">to_account</span><span class="p">:</span>
</span><span id="ZakatTracker-1812"><a href="#ZakatTracker-1812"><span class="linenos">1812</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Transfer to the same account is forbidden. </span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-1813"><a href="#ZakatTracker-1813"><span class="linenos">1813</span></a>        <span class="k">if</span> <span class="n">unscaled_amount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1814"><a href="#ZakatTracker-1814"><span class="linenos">1814</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="ZakatTracker-1815"><a href="#ZakatTracker-1815"><span class="linenos">1815</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-1816"><a href="#ZakatTracker-1816"><span class="linenos">1816</span></a>            <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker-1817"><a href="#ZakatTracker-1817"><span class="linenos">1817</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1818"><a href="#ZakatTracker-1818"><span class="linenos">1818</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The created should be greater than zero.&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-1819"><a href="#ZakatTracker-1819"><span class="linenos">1819</span></a>        <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-1820"><a href="#ZakatTracker-1820"><span class="linenos">1820</span></a>        <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker-1821"><a href="#ZakatTracker-1821"><span class="linenos">1821</span></a>        <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">ages</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">unscaled_amount</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">from_account</span><span class="p">,</span> <span class="n">created</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-1822"><a href="#ZakatTracker-1822"><span class="linenos">1822</span></a>        <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker-1823"><a href="#ZakatTracker-1823"><span class="linenos">1823</span></a>        <span class="n">source_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">from_account</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker-1824"><a href="#ZakatTracker-1824"><span class="linenos">1824</span></a>        <span class="n">target_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">to_account</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker-1825"><a href="#ZakatTracker-1825"><span class="linenos">1825</span></a>
</span><span id="ZakatTracker-1826"><a href="#ZakatTracker-1826"><span class="linenos">1826</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1827"><a href="#ZakatTracker-1827"><span class="linenos">1827</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span> <span class="n">ages</span><span class="p">)</span>
</span><span id="ZakatTracker-1828"><a href="#ZakatTracker-1828"><span class="linenos">1828</span></a>
</span><span id="ZakatTracker-1829"><a href="#ZakatTracker-1829"><span class="linenos">1829</span></a>        <span class="k">for</span> <span class="n">age</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ages</span><span class="p">:</span>
</span><span id="ZakatTracker-1830"><a href="#ZakatTracker-1830"><span class="linenos">1830</span></a>            <span class="n">target_amount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange_calc</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">source_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="n">target_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]))</span>
</span><span id="ZakatTracker-1831"><a href="#ZakatTracker-1831"><span class="linenos">1831</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1832"><a href="#ZakatTracker-1832"><span class="linenos">1832</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;target_amount&#39;</span><span class="p">,</span> <span class="n">target_amount</span><span class="p">)</span>
</span><span id="ZakatTracker-1833"><a href="#ZakatTracker-1833"><span class="linenos">1833</span></a>            <span class="c1"># Perform the transfer</span>
</span><span id="ZakatTracker-1834"><a href="#ZakatTracker-1834"><span class="linenos">1834</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_exists</span><span class="p">(</span><span class="n">to_account</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
</span><span id="ZakatTracker-1835"><a href="#ZakatTracker-1835"><span class="linenos">1835</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1836"><a href="#ZakatTracker-1836"><span class="linenos">1836</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;box_exists&#39;</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
</span><span id="ZakatTracker-1837"><a href="#ZakatTracker-1837"><span class="linenos">1837</span></a>                <span class="n">capital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">to_account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">age</span><span class="p">][</span><span class="s1">&#39;capital&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1838"><a href="#ZakatTracker-1838"><span class="linenos">1838</span></a>                <span class="n">rest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">to_account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">age</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1839"><a href="#ZakatTracker-1839"><span class="linenos">1839</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1840"><a href="#ZakatTracker-1840"><span class="linenos">1840</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="ZakatTracker-1841"><a href="#ZakatTracker-1841"><span class="linenos">1841</span></a>                        <span class="sa">f</span><span class="s2">&quot;Transfer(loop) </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> from `</span><span class="si">{</span><span class="n">from_account</span><span class="si">}</span><span class="s2">` to `</span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s2">` (equivalent to </span><span class="si">{</span><span class="n">target_amount</span><span class="si">}</span><span class="s2"> `</span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s2">`).&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-1842"><a href="#ZakatTracker-1842"><span class="linenos">1842</span></a>                <span class="n">selected_age</span> <span class="o">=</span> <span class="n">age</span>
</span><span id="ZakatTracker-1843"><a href="#ZakatTracker-1843"><span class="linenos">1843</span></a>                <span class="k">if</span> <span class="n">rest</span> <span class="o">+</span> <span class="n">target_amount</span> <span class="o">&gt;</span> <span class="n">capital</span><span class="p">:</span>
</span><span id="ZakatTracker-1844"><a href="#ZakatTracker-1844"><span class="linenos">1844</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">to_account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">age</span><span class="p">][</span><span class="s1">&#39;capital&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">target_amount</span>
</span><span id="ZakatTracker-1845"><a href="#ZakatTracker-1845"><span class="linenos">1845</span></a>                    <span class="n">selected_age</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker-1846"><a href="#ZakatTracker-1846"><span class="linenos">1846</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">to_account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">age</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">target_amount</span>
</span><span id="ZakatTracker-1847"><a href="#ZakatTracker-1847"><span class="linenos">1847</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">BOX_TRANSFER</span><span class="p">,</span> <span class="n">to_account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">selected_age</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">target_amount</span><span class="p">)</span>
</span><span id="ZakatTracker-1848"><a href="#ZakatTracker-1848"><span class="linenos">1848</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">target_amount</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;TRANSFER </span><span class="si">{</span><span class="n">from_account</span><span class="si">}</span><span class="s1"> -&gt; </span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">to_account</span><span class="p">,</span>
</span><span id="ZakatTracker-1849"><a href="#ZakatTracker-1849"><span class="linenos">1849</span></a>                              <span class="n">created</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-1850"><a href="#ZakatTracker-1850"><span class="linenos">1850</span></a>                <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">age</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</span><span id="ZakatTracker-1851"><a href="#ZakatTracker-1851"><span class="linenos">1851</span></a>                <span class="k">continue</span>
</span><span id="ZakatTracker-1852"><a href="#ZakatTracker-1852"><span class="linenos">1852</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1853"><a href="#ZakatTracker-1853"><span class="linenos">1853</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="ZakatTracker-1854"><a href="#ZakatTracker-1854"><span class="linenos">1854</span></a>                    <span class="sa">f</span><span class="s2">&quot;Transfer(func) </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> from `</span><span class="si">{</span><span class="n">from_account</span><span class="si">}</span><span class="s2">` to `</span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s2">` (equivalent to </span><span class="si">{</span><span class="n">target_amount</span><span class="si">}</span><span class="s2"> `</span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s2">`).&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-1855"><a href="#ZakatTracker-1855"><span class="linenos">1855</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span>
</span><span id="ZakatTracker-1856"><a href="#ZakatTracker-1856"><span class="linenos">1856</span></a>                <span class="n">unscaled_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">target_amount</span><span class="p">)),</span>
</span><span id="ZakatTracker-1857"><a href="#ZakatTracker-1857"><span class="linenos">1857</span></a>                <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
</span><span id="ZakatTracker-1858"><a href="#ZakatTracker-1858"><span class="linenos">1858</span></a>                <span class="n">account</span><span class="o">=</span><span class="n">to_account</span><span class="p">,</span>
</span><span id="ZakatTracker-1859"><a href="#ZakatTracker-1859"><span class="linenos">1859</span></a>                <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ZakatTracker-1860"><a href="#ZakatTracker-1860"><span class="linenos">1860</span></a>                <span class="n">created</span><span class="o">=</span><span class="n">age</span><span class="p">,</span>
</span><span id="ZakatTracker-1861"><a href="#ZakatTracker-1861"><span class="linenos">1861</span></a>                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="ZakatTracker-1862"><a href="#ZakatTracker-1862"><span class="linenos">1862</span></a>            <span class="p">)</span>
</span><span id="ZakatTracker-1863"><a href="#ZakatTracker-1863"><span class="linenos">1863</span></a>            <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker-1864"><a href="#ZakatTracker-1864"><span class="linenos">1864</span></a>        <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker-1865"><a href="#ZakatTracker-1865"><span class="linenos">1865</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker-1866"><a href="#ZakatTracker-1866"><span class="linenos">1866</span></a>        <span class="k">return</span> <span class="n">times</span>
</span><span id="ZakatTracker-1867"><a href="#ZakatTracker-1867"><span class="linenos">1867</span></a>
</span><span id="ZakatTracker-1868"><a href="#ZakatTracker-1868"><span class="linenos">1868</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ZakatTracker-1869"><a href="#ZakatTracker-1869"><span class="linenos">1869</span></a>              <span class="n">silver_gram_price</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="ZakatTracker-1870"><a href="#ZakatTracker-1870"><span class="linenos">1870</span></a>              <span class="n">unscaled_nisab</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker-1871"><a href="#ZakatTracker-1871"><span class="linenos">1871</span></a>              <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ZakatTracker-1872"><a href="#ZakatTracker-1872"><span class="linenos">1872</span></a>              <span class="n">now</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker-1873"><a href="#ZakatTracker-1873"><span class="linenos">1873</span></a>              <span class="n">cycle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="ZakatTracker-1874"><a href="#ZakatTracker-1874"><span class="linenos">1874</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1875"><a href="#ZakatTracker-1875"><span class="linenos">1875</span></a><span class="sd">        Check the eligibility for Zakat based on the given parameters.</span>
</span><span id="ZakatTracker-1876"><a href="#ZakatTracker-1876"><span class="linenos">1876</span></a>
</span><span id="ZakatTracker-1877"><a href="#ZakatTracker-1877"><span class="linenos">1877</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1878"><a href="#ZakatTracker-1878"><span class="linenos">1878</span></a><span class="sd">        - silver_gram_price (float): The price of a gram of silver.</span>
</span><span id="ZakatTracker-1879"><a href="#ZakatTracker-1879"><span class="linenos">1879</span></a><span class="sd">        - unscaled_nisab (float | int | decimal.Decimal): The minimum amount of wealth required for Zakat. If not provided,</span>
</span><span id="ZakatTracker-1880"><a href="#ZakatTracker-1880"><span class="linenos">1880</span></a><span class="sd">                        it will be calculated based on the silver_gram_price.</span>
</span><span id="ZakatTracker-1881"><a href="#ZakatTracker-1881"><span class="linenos">1881</span></a><span class="sd">        - debug (bool): Flag to enable debug mode.</span>
</span><span id="ZakatTracker-1882"><a href="#ZakatTracker-1882"><span class="linenos">1882</span></a><span class="sd">        - now (int): The current timestamp. If not provided, it will be calculated using ZakatTracker.time().</span>
</span><span id="ZakatTracker-1883"><a href="#ZakatTracker-1883"><span class="linenos">1883</span></a><span class="sd">        - cycle (float): The time cycle for Zakat. If not provided, it will be calculated using ZakatTracker.TimeCycle().</span>
</span><span id="ZakatTracker-1884"><a href="#ZakatTracker-1884"><span class="linenos">1884</span></a>
</span><span id="ZakatTracker-1885"><a href="#ZakatTracker-1885"><span class="linenos">1885</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1886"><a href="#ZakatTracker-1886"><span class="linenos">1886</span></a><span class="sd">        - tuple: A tuple containing a boolean indicating the eligibility for Zakat, a list of brief statistics,</span>
</span><span id="ZakatTracker-1887"><a href="#ZakatTracker-1887"><span class="linenos">1887</span></a><span class="sd">        and a dictionary containing the Zakat plan.</span>
</span><span id="ZakatTracker-1888"><a href="#ZakatTracker-1888"><span class="linenos">1888</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1889"><a href="#ZakatTracker-1889"><span class="linenos">1889</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1890"><a href="#ZakatTracker-1890"><span class="linenos">1890</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-1891"><a href="#ZakatTracker-1891"><span class="linenos">1891</span></a>        <span class="k">if</span> <span class="n">now</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-1892"><a href="#ZakatTracker-1892"><span class="linenos">1892</span></a>            <span class="n">now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker-1893"><a href="#ZakatTracker-1893"><span class="linenos">1893</span></a>        <span class="k">if</span> <span class="n">cycle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-1894"><a href="#ZakatTracker-1894"><span class="linenos">1894</span></a>            <span class="n">cycle</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">TimeCycle</span><span class="p">()</span>
</span><span id="ZakatTracker-1895"><a href="#ZakatTracker-1895"><span class="linenos">1895</span></a>        <span class="k">if</span> <span class="n">unscaled_nisab</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-1896"><a href="#ZakatTracker-1896"><span class="linenos">1896</span></a>            <span class="n">unscaled_nisab</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">Nisab</span><span class="p">(</span><span class="n">silver_gram_price</span><span class="p">)</span>
</span><span id="ZakatTracker-1897"><a href="#ZakatTracker-1897"><span class="linenos">1897</span></a>        <span class="n">nisab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">unscaled_nisab</span><span class="p">)</span>
</span><span id="ZakatTracker-1898"><a href="#ZakatTracker-1898"><span class="linenos">1898</span></a>        <span class="n">plan</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker-1899"><a href="#ZakatTracker-1899"><span class="linenos">1899</span></a>        <span class="n">below_nisab</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-1900"><a href="#ZakatTracker-1900"><span class="linenos">1900</span></a>        <span class="n">brief</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="ZakatTracker-1901"><a href="#ZakatTracker-1901"><span class="linenos">1901</span></a>        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ZakatTracker-1902"><a href="#ZakatTracker-1902"><span class="linenos">1902</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1903"><a href="#ZakatTracker-1903"><span class="linenos">1903</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exchanges&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchanges</span><span class="p">())</span>
</span><span id="ZakatTracker-1904"><a href="#ZakatTracker-1904"><span class="linenos">1904</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-1905"><a href="#ZakatTracker-1905"><span class="linenos">1905</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">zakatable</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="ZakatTracker-1906"><a href="#ZakatTracker-1906"><span class="linenos">1906</span></a>                <span class="k">continue</span>
</span><span id="ZakatTracker-1907"><a href="#ZakatTracker-1907"><span class="linenos">1907</span></a>            <span class="n">_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1908"><a href="#ZakatTracker-1908"><span class="linenos">1908</span></a>            <span class="n">_log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1909"><a href="#ZakatTracker-1909"><span class="linenos">1909</span></a>            <span class="n">limit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_box</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ZakatTracker-1910"><a href="#ZakatTracker-1910"><span class="linenos">1910</span></a>            <span class="n">ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ZakatTracker-1911"><a href="#ZakatTracker-1911"><span class="linenos">1911</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ZakatTracker-1912"><a href="#ZakatTracker-1912"><span class="linenos">1912</span></a>                <span class="n">j</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="ZakatTracker-1913"><a href="#ZakatTracker-1913"><span class="linenos">1913</span></a>                <span class="n">rest</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-1914"><a href="#ZakatTracker-1914"><span class="linenos">1914</span></a>                <span class="k">if</span> <span class="n">rest</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1915"><a href="#ZakatTracker-1915"><span class="linenos">1915</span></a>                    <span class="k">continue</span>
</span><span id="ZakatTracker-1916"><a href="#ZakatTracker-1916"><span class="linenos">1916</span></a>                <span class="n">exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="ZakatTracker-1917"><a href="#ZakatTracker-1917"><span class="linenos">1917</span></a>                <span class="n">rest</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">exchange_calc</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ZakatTracker-1918"><a href="#ZakatTracker-1918"><span class="linenos">1918</span></a>                <span class="n">brief</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rest</span>
</span><span id="ZakatTracker-1919"><a href="#ZakatTracker-1919"><span class="linenos">1919</span></a>                <span class="n">index</span> <span class="o">=</span> <span class="n">limit</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="ZakatTracker-1920"><a href="#ZakatTracker-1920"><span class="linenos">1920</span></a>                <span class="n">epoch</span> <span class="o">=</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="n">cycle</span>
</span><span id="ZakatTracker-1921"><a href="#ZakatTracker-1921"><span class="linenos">1921</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1922"><a href="#ZakatTracker-1922"><span class="linenos">1922</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch: </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="ZakatTracker-1923"><a href="#ZakatTracker-1923"><span class="linenos">1923</span></a>                <span class="k">if</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;last&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1924"><a href="#ZakatTracker-1924"><span class="linenos">1924</span></a>                    <span class="n">epoch</span> <span class="o">=</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;last&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">cycle</span>
</span><span id="ZakatTracker-1925"><a href="#ZakatTracker-1925"><span class="linenos">1925</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1926"><a href="#ZakatTracker-1926"><span class="linenos">1926</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch: </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-1927"><a href="#ZakatTracker-1927"><span class="linenos">1927</span></a>                <span class="n">epoch</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
</span><span id="ZakatTracker-1928"><a href="#ZakatTracker-1928"><span class="linenos">1928</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1929"><a href="#ZakatTracker-1929"><span class="linenos">1929</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch: </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">epoch</span><span class="p">),</span> <span class="n">epoch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span><span id="ZakatTracker-1930"><a href="#ZakatTracker-1930"><span class="linenos">1930</span></a>                <span class="k">if</span> <span class="n">epoch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1931"><a href="#ZakatTracker-1931"><span class="linenos">1931</span></a>                    <span class="k">continue</span>
</span><span id="ZakatTracker-1932"><a href="#ZakatTracker-1932"><span class="linenos">1932</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1933"><a href="#ZakatTracker-1933"><span class="linenos">1933</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Epoch - PASSED&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-1934"><a href="#ZakatTracker-1934"><span class="linenos">1934</span></a>                <span class="n">brief</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rest</span>
</span><span id="ZakatTracker-1935"><a href="#ZakatTracker-1935"><span class="linenos">1935</span></a>                <span class="k">if</span> <span class="n">rest</span> <span class="o">&gt;=</span> <span class="n">nisab</span><span class="p">:</span>
</span><span id="ZakatTracker-1936"><a href="#ZakatTracker-1936"><span class="linenos">1936</span></a>                    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-1937"><a href="#ZakatTracker-1937"><span class="linenos">1937</span></a>                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epoch</span><span class="p">):</span>
</span><span id="ZakatTracker-1938"><a href="#ZakatTracker-1938"><span class="linenos">1938</span></a>                        <span class="n">total</span> <span class="o">+=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">ZakatCut</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">total</span><span class="p">))</span>
</span><span id="ZakatTracker-1939"><a href="#ZakatTracker-1939"><span class="linenos">1939</span></a>                    <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1940"><a href="#ZakatTracker-1940"><span class="linenos">1940</span></a>                        <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
</span><span id="ZakatTracker-1941"><a href="#ZakatTracker-1941"><span class="linenos">1941</span></a>                            <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker-1942"><a href="#ZakatTracker-1942"><span class="linenos">1942</span></a>                        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ZakatTracker-1943"><a href="#ZakatTracker-1943"><span class="linenos">1943</span></a>                        <span class="n">brief</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">total</span>
</span><span id="ZakatTracker-1944"><a href="#ZakatTracker-1944"><span class="linenos">1944</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-1945"><a href="#ZakatTracker-1945"><span class="linenos">1945</span></a>                            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">total</span><span class="p">,</span>
</span><span id="ZakatTracker-1946"><a href="#ZakatTracker-1946"><span class="linenos">1946</span></a>                            <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">epoch</span><span class="p">,</span>
</span><span id="ZakatTracker-1947"><a href="#ZakatTracker-1947"><span class="linenos">1947</span></a>                            <span class="s1">&#39;box_time&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span>
</span><span id="ZakatTracker-1948"><a href="#ZakatTracker-1948"><span class="linenos">1948</span></a>                            <span class="s1">&#39;box_capital&#39;</span><span class="p">:</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;capital&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker-1949"><a href="#ZakatTracker-1949"><span class="linenos">1949</span></a>                            <span class="s1">&#39;box_rest&#39;</span><span class="p">:</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker-1950"><a href="#ZakatTracker-1950"><span class="linenos">1950</span></a>                            <span class="s1">&#39;box_last&#39;</span><span class="p">:</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;last&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker-1951"><a href="#ZakatTracker-1951"><span class="linenos">1951</span></a>                            <span class="s1">&#39;box_total&#39;</span><span class="p">:</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker-1952"><a href="#ZakatTracker-1952"><span class="linenos">1952</span></a>                            <span class="s1">&#39;box_count&#39;</span><span class="p">:</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker-1953"><a href="#ZakatTracker-1953"><span class="linenos">1953</span></a>                            <span class="s1">&#39;box_log&#39;</span><span class="p">:</span> <span class="n">_log</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;desc&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker-1954"><a href="#ZakatTracker-1954"><span class="linenos">1954</span></a>                            <span class="s1">&#39;exchange_rate&#39;</span><span class="p">:</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker-1955"><a href="#ZakatTracker-1955"><span class="linenos">1955</span></a>                            <span class="s1">&#39;exchange_time&#39;</span><span class="p">:</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker-1956"><a href="#ZakatTracker-1956"><span class="linenos">1956</span></a>                            <span class="s1">&#39;exchange_desc&#39;</span><span class="p">:</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker-1957"><a href="#ZakatTracker-1957"><span class="linenos">1957</span></a>                        <span class="p">}</span>
</span><span id="ZakatTracker-1958"><a href="#ZakatTracker-1958"><span class="linenos">1958</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker-1959"><a href="#ZakatTracker-1959"><span class="linenos">1959</span></a>                    <span class="n">chunk</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">ZakatCut</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rest</span><span class="p">))</span>
</span><span id="ZakatTracker-1960"><a href="#ZakatTracker-1960"><span class="linenos">1960</span></a>                    <span class="k">if</span> <span class="n">chunk</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-1961"><a href="#ZakatTracker-1961"><span class="linenos">1961</span></a>                        <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
</span><span id="ZakatTracker-1962"><a href="#ZakatTracker-1962"><span class="linenos">1962</span></a>                            <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker-1963"><a href="#ZakatTracker-1963"><span class="linenos">1963</span></a>                        <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ZakatTracker-1964"><a href="#ZakatTracker-1964"><span class="linenos">1964</span></a>                            <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker-1965"><a href="#ZakatTracker-1965"><span class="linenos">1965</span></a>                        <span class="n">below_nisab</span> <span class="o">+=</span> <span class="n">rest</span>
</span><span id="ZakatTracker-1966"><a href="#ZakatTracker-1966"><span class="linenos">1966</span></a>                        <span class="n">brief</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">chunk</span>
</span><span id="ZakatTracker-1967"><a href="#ZakatTracker-1967"><span class="linenos">1967</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;below_nisab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span>
</span><span id="ZakatTracker-1968"><a href="#ZakatTracker-1968"><span class="linenos">1968</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span>
</span><span id="ZakatTracker-1969"><a href="#ZakatTracker-1969"><span class="linenos">1969</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoch</span>
</span><span id="ZakatTracker-1970"><a href="#ZakatTracker-1970"><span class="linenos">1970</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
</span><span id="ZakatTracker-1971"><a href="#ZakatTracker-1971"><span class="linenos">1971</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_capital&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;capital&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1972"><a href="#ZakatTracker-1972"><span class="linenos">1972</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_rest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1973"><a href="#ZakatTracker-1973"><span class="linenos">1973</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_last&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;last&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1974"><a href="#ZakatTracker-1974"><span class="linenos">1974</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1975"><a href="#ZakatTracker-1975"><span class="linenos">1975</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1976"><a href="#ZakatTracker-1976"><span class="linenos">1976</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_log</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1977"><a href="#ZakatTracker-1977"><span class="linenos">1977</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;exchange_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1978"><a href="#ZakatTracker-1978"><span class="linenos">1978</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;exchange_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1979"><a href="#ZakatTracker-1979"><span class="linenos">1979</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;exchange_desc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-1980"><a href="#ZakatTracker-1980"><span class="linenos">1980</span></a>        <span class="n">valid</span> <span class="o">=</span> <span class="n">valid</span> <span class="ow">or</span> <span class="n">below_nisab</span> <span class="o">&gt;=</span> <span class="n">nisab</span>
</span><span id="ZakatTracker-1981"><a href="#ZakatTracker-1981"><span class="linenos">1981</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-1982"><a href="#ZakatTracker-1982"><span class="linenos">1982</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;below_nisab(</span><span class="si">{</span><span class="n">below_nisab</span><span class="si">}</span><span class="s2">) &gt;= nisab(</span><span class="si">{</span><span class="n">nisab</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-1983"><a href="#ZakatTracker-1983"><span class="linenos">1983</span></a>        <span class="k">return</span> <span class="n">valid</span><span class="p">,</span> <span class="n">brief</span><span class="p">,</span> <span class="n">plan</span>
</span><span id="ZakatTracker-1984"><a href="#ZakatTracker-1984"><span class="linenos">1984</span></a>
</span><span id="ZakatTracker-1985"><a href="#ZakatTracker-1985"><span class="linenos">1985</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">build_payment_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scaled_demand</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">positive_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker-1986"><a href="#ZakatTracker-1986"><span class="linenos">1986</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-1987"><a href="#ZakatTracker-1987"><span class="linenos">1987</span></a><span class="sd">        Build payment parts for the Zakat distribution.</span>
</span><span id="ZakatTracker-1988"><a href="#ZakatTracker-1988"><span class="linenos">1988</span></a>
</span><span id="ZakatTracker-1989"><a href="#ZakatTracker-1989"><span class="linenos">1989</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-1990"><a href="#ZakatTracker-1990"><span class="linenos">1990</span></a><span class="sd">        - scaled_demand (int): The total demand for payment in local currency.</span>
</span><span id="ZakatTracker-1991"><a href="#ZakatTracker-1991"><span class="linenos">1991</span></a><span class="sd">        - positive_only (bool): If True, only consider accounts with positive balance. Default is True.</span>
</span><span id="ZakatTracker-1992"><a href="#ZakatTracker-1992"><span class="linenos">1992</span></a>
</span><span id="ZakatTracker-1993"><a href="#ZakatTracker-1993"><span class="linenos">1993</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-1994"><a href="#ZakatTracker-1994"><span class="linenos">1994</span></a><span class="sd">        - dict: A dictionary containing the payment parts for each account. The dictionary has the following structure:</span>
</span><span id="ZakatTracker-1995"><a href="#ZakatTracker-1995"><span class="linenos">1995</span></a><span class="sd">        {</span>
</span><span id="ZakatTracker-1996"><a href="#ZakatTracker-1996"><span class="linenos">1996</span></a><span class="sd">            &#39;account&#39;: {</span>
</span><span id="ZakatTracker-1997"><a href="#ZakatTracker-1997"><span class="linenos">1997</span></a><span class="sd">                &#39;account_id&#39;: {&#39;balance&#39;: float, &#39;rate&#39;: float, &#39;part&#39;: float},</span>
</span><span id="ZakatTracker-1998"><a href="#ZakatTracker-1998"><span class="linenos">1998</span></a><span class="sd">                ...</span>
</span><span id="ZakatTracker-1999"><a href="#ZakatTracker-1999"><span class="linenos">1999</span></a><span class="sd">            },</span>
</span><span id="ZakatTracker-2000"><a href="#ZakatTracker-2000"><span class="linenos">2000</span></a><span class="sd">            &#39;exceed&#39;: bool,</span>
</span><span id="ZakatTracker-2001"><a href="#ZakatTracker-2001"><span class="linenos">2001</span></a><span class="sd">            &#39;demand&#39;: int,</span>
</span><span id="ZakatTracker-2002"><a href="#ZakatTracker-2002"><span class="linenos">2002</span></a><span class="sd">            &#39;total&#39;: float,</span>
</span><span id="ZakatTracker-2003"><a href="#ZakatTracker-2003"><span class="linenos">2003</span></a><span class="sd">        }</span>
</span><span id="ZakatTracker-2004"><a href="#ZakatTracker-2004"><span class="linenos">2004</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2005"><a href="#ZakatTracker-2005"><span class="linenos">2005</span></a>        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2006"><a href="#ZakatTracker-2006"><span class="linenos">2006</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-2007"><a href="#ZakatTracker-2007"><span class="linenos">2007</span></a>            <span class="s1">&#39;account&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker-2008"><a href="#ZakatTracker-2008"><span class="linenos">2008</span></a>            <span class="s1">&#39;exceed&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ZakatTracker-2009"><a href="#ZakatTracker-2009"><span class="linenos">2009</span></a>            <span class="s1">&#39;demand&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">scaled_demand</span><span class="p">)),</span>
</span><span id="ZakatTracker-2010"><a href="#ZakatTracker-2010"><span class="linenos">2010</span></a>        <span class="p">}</span>
</span><span id="ZakatTracker-2011"><a href="#ZakatTracker-2011"><span class="linenos">2011</span></a>        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker-2012"><a href="#ZakatTracker-2012"><span class="linenos">2012</span></a>            <span class="k">if</span> <span class="n">positive_only</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2013"><a href="#ZakatTracker-2013"><span class="linenos">2013</span></a>                <span class="k">continue</span>
</span><span id="ZakatTracker-2014"><a href="#ZakatTracker-2014"><span class="linenos">2014</span></a>            <span class="n">total</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker-2015"><a href="#ZakatTracker-2015"><span class="linenos">2015</span></a>            <span class="n">exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker-2016"><a href="#ZakatTracker-2016"><span class="linenos">2016</span></a>            <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;balance&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="s1">&#39;part&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="ZakatTracker-2017"><a href="#ZakatTracker-2017"><span class="linenos">2017</span></a>        <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span>
</span><span id="ZakatTracker-2018"><a href="#ZakatTracker-2018"><span class="linenos">2018</span></a>        <span class="k">return</span> <span class="n">parts</span>
</span><span id="ZakatTracker-2019"><a href="#ZakatTracker-2019"><span class="linenos">2019</span></a>
</span><span id="ZakatTracker-2020"><a href="#ZakatTracker-2020"><span class="linenos">2020</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-2021"><a href="#ZakatTracker-2021"><span class="linenos">2021</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_payment_parts</span><span class="p">(</span><span class="n">parts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-2022"><a href="#ZakatTracker-2022"><span class="linenos">2022</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2023"><a href="#ZakatTracker-2023"><span class="linenos">2023</span></a><span class="sd">        Checks the validity of payment parts.</span>
</span><span id="ZakatTracker-2024"><a href="#ZakatTracker-2024"><span class="linenos">2024</span></a>
</span><span id="ZakatTracker-2025"><a href="#ZakatTracker-2025"><span class="linenos">2025</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-2026"><a href="#ZakatTracker-2026"><span class="linenos">2026</span></a><span class="sd">        - parts (dict): A dictionary containing payment parts information.</span>
</span><span id="ZakatTracker-2027"><a href="#ZakatTracker-2027"><span class="linenos">2027</span></a><span class="sd">        - debug (bool): Flag to enable debug mode.</span>
</span><span id="ZakatTracker-2028"><a href="#ZakatTracker-2028"><span class="linenos">2028</span></a>
</span><span id="ZakatTracker-2029"><a href="#ZakatTracker-2029"><span class="linenos">2029</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-2030"><a href="#ZakatTracker-2030"><span class="linenos">2030</span></a><span class="sd">        - int: Returns 0 if the payment parts are valid, otherwise returns the error code.</span>
</span><span id="ZakatTracker-2031"><a href="#ZakatTracker-2031"><span class="linenos">2031</span></a>
</span><span id="ZakatTracker-2032"><a href="#ZakatTracker-2032"><span class="linenos">2032</span></a><span class="sd">        Error Codes:</span>
</span><span id="ZakatTracker-2033"><a href="#ZakatTracker-2033"><span class="linenos">2033</span></a><span class="sd">        1: &#39;demand&#39;, &#39;account&#39;, &#39;total&#39;, or &#39;exceed&#39; key is missing in parts.</span>
</span><span id="ZakatTracker-2034"><a href="#ZakatTracker-2034"><span class="linenos">2034</span></a><span class="sd">        2: &#39;balance&#39;, &#39;rate&#39; or &#39;part&#39; key is missing in parts[&#39;account&#39;][x].</span>
</span><span id="ZakatTracker-2035"><a href="#ZakatTracker-2035"><span class="linenos">2035</span></a><span class="sd">        3: &#39;part&#39; value in parts[&#39;account&#39;][x] is less than 0.</span>
</span><span id="ZakatTracker-2036"><a href="#ZakatTracker-2036"><span class="linenos">2036</span></a><span class="sd">        4: If &#39;exceed&#39; is False, &#39;balance&#39; value in parts[&#39;account&#39;][x] is less than or equal to 0.</span>
</span><span id="ZakatTracker-2037"><a href="#ZakatTracker-2037"><span class="linenos">2037</span></a><span class="sd">        5: If &#39;exceed&#39; is False, &#39;part&#39; value in parts[&#39;account&#39;][x] is greater than &#39;balance&#39; value.</span>
</span><span id="ZakatTracker-2038"><a href="#ZakatTracker-2038"><span class="linenos">2038</span></a><span class="sd">        6: The sum of &#39;part&#39; values in parts[&#39;account&#39;] does not match with &#39;demand&#39; value.</span>
</span><span id="ZakatTracker-2039"><a href="#ZakatTracker-2039"><span class="linenos">2039</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2040"><a href="#ZakatTracker-2040"><span class="linenos">2040</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2041"><a href="#ZakatTracker-2041"><span class="linenos">2041</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_payment_parts&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2042"><a href="#ZakatTracker-2042"><span class="linenos">2042</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;demand&#39;</span><span class="p">,</span> <span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="s1">&#39;exceed&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-2043"><a href="#ZakatTracker-2043"><span class="linenos">2043</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
</span><span id="ZakatTracker-2044"><a href="#ZakatTracker-2044"><span class="linenos">2044</span></a>                <span class="k">return</span> <span class="mi">1</span>
</span><span id="ZakatTracker-2045"><a href="#ZakatTracker-2045"><span class="linenos">2045</span></a>        <span class="n">exceed</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;exceed&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-2046"><a href="#ZakatTracker-2046"><span class="linenos">2046</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-2047"><a href="#ZakatTracker-2047"><span class="linenos">2047</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;balance&#39;</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">,</span> <span class="s1">&#39;part&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-2048"><a href="#ZakatTracker-2048"><span class="linenos">2048</span></a>                <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]:</span>
</span><span id="ZakatTracker-2049"><a href="#ZakatTracker-2049"><span class="linenos">2049</span></a>                    <span class="k">return</span> <span class="mi">2</span>
</span><span id="ZakatTracker-2050"><a href="#ZakatTracker-2050"><span class="linenos">2050</span></a>                <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;part&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2051"><a href="#ZakatTracker-2051"><span class="linenos">2051</span></a>                    <span class="k">return</span> <span class="mi">3</span>
</span><span id="ZakatTracker-2052"><a href="#ZakatTracker-2052"><span class="linenos">2052</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">exceed</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2053"><a href="#ZakatTracker-2053"><span class="linenos">2053</span></a>                    <span class="k">return</span> <span class="mi">4</span>
</span><span id="ZakatTracker-2054"><a href="#ZakatTracker-2054"><span class="linenos">2054</span></a>        <span class="n">demand</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;demand&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-2055"><a href="#ZakatTracker-2055"><span class="linenos">2055</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2056"><a href="#ZakatTracker-2056"><span class="linenos">2056</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker-2057"><a href="#ZakatTracker-2057"><span class="linenos">2057</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">exceed</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;balance&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-2058"><a href="#ZakatTracker-2058"><span class="linenos">2058</span></a>                <span class="k">return</span> <span class="mi">5</span>
</span><span id="ZakatTracker-2059"><a href="#ZakatTracker-2059"><span class="linenos">2059</span></a>            <span class="n">z</span> <span class="o">+=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">exchange_calc</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ZakatTracker-2060"><a href="#ZakatTracker-2060"><span class="linenos">2060</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="ZakatTracker-2061"><a href="#ZakatTracker-2061"><span class="linenos">2061</span></a>        <span class="n">demand</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="ZakatTracker-2062"><a href="#ZakatTracker-2062"><span class="linenos">2062</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2063"><a href="#ZakatTracker-2063"><span class="linenos">2063</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_payment_parts&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;z = </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s1">, demand = </span><span class="si">{</span><span class="n">demand</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2064"><a href="#ZakatTracker-2064"><span class="linenos">2064</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_payment_parts&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">demand</span><span class="p">))</span>
</span><span id="ZakatTracker-2065"><a href="#ZakatTracker-2065"><span class="linenos">2065</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_payment_parts&#39;</span><span class="p">,</span> <span class="n">z</span> <span class="o">!=</span> <span class="n">demand</span><span class="p">)</span>
</span><span id="ZakatTracker-2066"><a href="#ZakatTracker-2066"><span class="linenos">2066</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_payment_parts&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">demand</span><span class="p">))</span>
</span><span id="ZakatTracker-2067"><a href="#ZakatTracker-2067"><span class="linenos">2067</span></a>        <span class="k">if</span> <span class="n">z</span> <span class="o">!=</span> <span class="n">demand</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">demand</span><span class="p">):</span>
</span><span id="ZakatTracker-2068"><a href="#ZakatTracker-2068"><span class="linenos">2068</span></a>            <span class="k">return</span> <span class="mi">6</span>
</span><span id="ZakatTracker-2069"><a href="#ZakatTracker-2069"><span class="linenos">2069</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2070"><a href="#ZakatTracker-2070"><span class="linenos">2070</span></a>
</span><span id="ZakatTracker-2071"><a href="#ZakatTracker-2071"><span class="linenos">2071</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">zakat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">parts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-2072"><a href="#ZakatTracker-2072"><span class="linenos">2072</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2073"><a href="#ZakatTracker-2073"><span class="linenos">2073</span></a><span class="sd">        Perform Zakat calculation based on the given report and optional parts.</span>
</span><span id="ZakatTracker-2074"><a href="#ZakatTracker-2074"><span class="linenos">2074</span></a>
</span><span id="ZakatTracker-2075"><a href="#ZakatTracker-2075"><span class="linenos">2075</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-2076"><a href="#ZakatTracker-2076"><span class="linenos">2076</span></a><span class="sd">        - report (tuple): A tuple containing the validity of the report, the report data, and the zakat plan.</span>
</span><span id="ZakatTracker-2077"><a href="#ZakatTracker-2077"><span class="linenos">2077</span></a><span class="sd">        - parts (dict): A dictionary containing the payment parts for the zakat.</span>
</span><span id="ZakatTracker-2078"><a href="#ZakatTracker-2078"><span class="linenos">2078</span></a><span class="sd">        - debug (bool): A flag indicating whether to print debug information.</span>
</span><span id="ZakatTracker-2079"><a href="#ZakatTracker-2079"><span class="linenos">2079</span></a>
</span><span id="ZakatTracker-2080"><a href="#ZakatTracker-2080"><span class="linenos">2080</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-2081"><a href="#ZakatTracker-2081"><span class="linenos">2081</span></a><span class="sd">        - bool: True if the zakat calculation is successful, False otherwise.</span>
</span><span id="ZakatTracker-2082"><a href="#ZakatTracker-2082"><span class="linenos">2082</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2083"><a href="#ZakatTracker-2083"><span class="linenos">2083</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2084"><a href="#ZakatTracker-2084"><span class="linenos">2084</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;zakat&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2085"><a href="#ZakatTracker-2085"><span class="linenos">2085</span></a>        <span class="n">valid</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">plan</span> <span class="o">=</span> <span class="n">report</span>
</span><span id="ZakatTracker-2086"><a href="#ZakatTracker-2086"><span class="linenos">2086</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
</span><span id="ZakatTracker-2087"><a href="#ZakatTracker-2087"><span class="linenos">2087</span></a>            <span class="k">return</span> <span class="n">valid</span>
</span><span id="ZakatTracker-2088"><a href="#ZakatTracker-2088"><span class="linenos">2088</span></a>        <span class="n">parts_exist</span> <span class="o">=</span> <span class="n">parts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker-2089"><a href="#ZakatTracker-2089"><span class="linenos">2089</span></a>        <span class="k">if</span> <span class="n">parts_exist</span><span class="p">:</span>
</span><span id="ZakatTracker-2090"><a href="#ZakatTracker-2090"><span class="linenos">2090</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_payment_parts</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2091"><a href="#ZakatTracker-2091"><span class="linenos">2091</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker-2092"><a href="#ZakatTracker-2092"><span class="linenos">2092</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2093"><a href="#ZakatTracker-2093"><span class="linenos">2093</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;######### zakat #######&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2094"><a href="#ZakatTracker-2094"><span class="linenos">2094</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;parts_exist&#39;</span><span class="p">,</span> <span class="n">parts_exist</span><span class="p">)</span>
</span><span id="ZakatTracker-2095"><a href="#ZakatTracker-2095"><span class="linenos">2095</span></a>        <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-2096"><a href="#ZakatTracker-2096"><span class="linenos">2096</span></a>        <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker-2097"><a href="#ZakatTracker-2097"><span class="linenos">2097</span></a>        <span class="n">report_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker-2098"><a href="#ZakatTracker-2098"><span class="linenos">2098</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">][</span><span class="n">report_time</span><span class="p">]</span> <span class="o">=</span> <span class="n">report</span>
</span><span id="ZakatTracker-2099"><a href="#ZakatTracker-2099"><span class="linenos">2099</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">REPORT</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">report_time</span><span class="p">)</span>
</span><span id="ZakatTracker-2100"><a href="#ZakatTracker-2100"><span class="linenos">2100</span></a>        <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker-2101"><a href="#ZakatTracker-2101"><span class="linenos">2101</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
</span><span id="ZakatTracker-2102"><a href="#ZakatTracker-2102"><span class="linenos">2102</span></a>            <span class="n">target_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker-2103"><a href="#ZakatTracker-2103"><span class="linenos">2103</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2104"><a href="#ZakatTracker-2104"><span class="linenos">2104</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</span><span id="ZakatTracker-2105"><a href="#ZakatTracker-2105"><span class="linenos">2105</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2106"><a href="#ZakatTracker-2106"><span class="linenos">2106</span></a>                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-2107"><a href="#ZakatTracker-2107"><span class="linenos">2107</span></a>            <span class="n">ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ZakatTracker-2108"><a href="#ZakatTracker-2108"><span class="linenos">2108</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2109"><a href="#ZakatTracker-2109"><span class="linenos">2109</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plan[x]&#39;</span><span class="p">,</span> <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</span><span id="ZakatTracker-2110"><a href="#ZakatTracker-2110"><span class="linenos">2110</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ZakatTracker-2111"><a href="#ZakatTracker-2111"><span class="linenos">2111</span></a>                <span class="n">j</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="ZakatTracker-2112"><a href="#ZakatTracker-2112"><span class="linenos">2112</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2113"><a href="#ZakatTracker-2113"><span class="linenos">2113</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
</span><span id="ZakatTracker-2114"><a href="#ZakatTracker-2114"><span class="linenos">2114</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">ZAKAT</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;last&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker-2115"><a href="#ZakatTracker-2115"><span class="linenos">2115</span></a>                           <span class="n">key</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2116"><a href="#ZakatTracker-2116"><span class="linenos">2116</span></a>                           <span class="n">math_operation</span><span class="o">=</span><span class="n">MathOperation</span><span class="o">.</span><span class="n">EQUAL</span><span class="p">)</span>
</span><span id="ZakatTracker-2117"><a href="#ZakatTracker-2117"><span class="linenos">2117</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;last&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">created</span>
</span><span id="ZakatTracker-2118"><a href="#ZakatTracker-2118"><span class="linenos">2118</span></a>                <span class="n">amount</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">exchange_calc</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">target_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]))</span>
</span><span id="ZakatTracker-2119"><a href="#ZakatTracker-2119"><span class="linenos">2119</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span>
</span><span id="ZakatTracker-2120"><a href="#ZakatTracker-2120"><span class="linenos">2120</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">ZAKAT</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;total&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2121"><a href="#ZakatTracker-2121"><span class="linenos">2121</span></a>                           <span class="n">math_operation</span><span class="o">=</span><span class="n">MathOperation</span><span class="o">.</span><span class="n">ADDITION</span><span class="p">)</span>
</span><span id="ZakatTracker-2122"><a href="#ZakatTracker-2122"><span class="linenos">2122</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-2123"><a href="#ZakatTracker-2123"><span class="linenos">2123</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">ZAKAT</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2124"><a href="#ZakatTracker-2124"><span class="linenos">2124</span></a>                           <span class="n">math_operation</span><span class="o">=</span><span class="n">MathOperation</span><span class="o">.</span><span class="n">ADDITION</span><span class="p">)</span>
</span><span id="ZakatTracker-2125"><a href="#ZakatTracker-2125"><span class="linenos">2125</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts_exist</span><span class="p">:</span>
</span><span id="ZakatTracker-2126"><a href="#ZakatTracker-2126"><span class="linenos">2126</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-2127"><a href="#ZakatTracker-2127"><span class="linenos">2127</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span>
</span><span id="ZakatTracker-2128"><a href="#ZakatTracker-2128"><span class="linenos">2128</span></a>                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="ZakatTracker-2129"><a href="#ZakatTracker-2129"><span class="linenos">2129</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="ZakatTracker-2130"><a href="#ZakatTracker-2130"><span class="linenos">2130</span></a>                    <span class="c1"># self._step(Action.ZAKAT, account=x, ref=j, value=amount, key=&#39;rest&#39;,</span>
</span><span id="ZakatTracker-2131"><a href="#ZakatTracker-2131"><span class="linenos">2131</span></a>                    <span class="c1">#            math_operation=MathOperation.SUBTRACTION)</span>
</span><span id="ZakatTracker-2132"><a href="#ZakatTracker-2132"><span class="linenos">2132</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;zakat-زكاة&#39;</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-2133"><a href="#ZakatTracker-2133"><span class="linenos">2133</span></a>        <span class="k">if</span> <span class="n">parts_exist</span><span class="p">:</span>
</span><span id="ZakatTracker-2134"><a href="#ZakatTracker-2134"><span class="linenos">2134</span></a>            <span class="k">for</span> <span class="n">account</span><span class="p">,</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker-2135"><a href="#ZakatTracker-2135"><span class="linenos">2135</span></a>                <span class="k">if</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2136"><a href="#ZakatTracker-2136"><span class="linenos">2136</span></a>                    <span class="k">continue</span>
</span><span id="ZakatTracker-2137"><a href="#ZakatTracker-2137"><span class="linenos">2137</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2138"><a href="#ZakatTracker-2138"><span class="linenos">2138</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;zakat-part&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-2139"><a href="#ZakatTracker-2139"><span class="linenos">2139</span></a>                <span class="n">target_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
</span><span id="ZakatTracker-2140"><a href="#ZakatTracker-2140"><span class="linenos">2140</span></a>                <span class="n">amount</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">exchange_calc</span><span class="p">(</span><span class="n">part</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">],</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="n">target_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-2141"><a href="#ZakatTracker-2141"><span class="linenos">2141</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
</span><span id="ZakatTracker-2142"><a href="#ZakatTracker-2142"><span class="linenos">2142</span></a>                    <span class="n">unscaled_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">amount</span><span class="p">)),</span>
</span><span id="ZakatTracker-2143"><a href="#ZakatTracker-2143"><span class="linenos">2143</span></a>                    <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;zakat-part-دفعة-زكاة&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2144"><a href="#ZakatTracker-2144"><span class="linenos">2144</span></a>                    <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span>
</span><span id="ZakatTracker-2145"><a href="#ZakatTracker-2145"><span class="linenos">2145</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="ZakatTracker-2146"><a href="#ZakatTracker-2146"><span class="linenos">2146</span></a>                <span class="p">)</span>
</span><span id="ZakatTracker-2147"><a href="#ZakatTracker-2147"><span class="linenos">2147</span></a>        <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker-2148"><a href="#ZakatTracker-2148"><span class="linenos">2148</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker-2149"><a href="#ZakatTracker-2149"><span class="linenos">2149</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker-2150"><a href="#ZakatTracker-2150"><span class="linenos">2150</span></a>
</span><span id="ZakatTracker-2151"><a href="#ZakatTracker-2151"><span class="linenos">2151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">export_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data.json&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-2152"><a href="#ZakatTracker-2152"><span class="linenos">2152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2153"><a href="#ZakatTracker-2153"><span class="linenos">2153</span></a><span class="sd">        Exports the current state of the ZakatTracker object to a JSON file.</span>
</span><span id="ZakatTracker-2154"><a href="#ZakatTracker-2154"><span class="linenos">2154</span></a>
</span><span id="ZakatTracker-2155"><a href="#ZakatTracker-2155"><span class="linenos">2155</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-2156"><a href="#ZakatTracker-2156"><span class="linenos">2156</span></a><span class="sd">        - path (str): The path where the JSON file will be saved. Default is &quot;data.json&quot;.</span>
</span><span id="ZakatTracker-2157"><a href="#ZakatTracker-2157"><span class="linenos">2157</span></a>
</span><span id="ZakatTracker-2158"><a href="#ZakatTracker-2158"><span class="linenos">2158</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-2159"><a href="#ZakatTracker-2159"><span class="linenos">2159</span></a><span class="sd">        - bool: True if the export is successful, False otherwise.</span>
</span><span id="ZakatTracker-2160"><a href="#ZakatTracker-2160"><span class="linenos">2160</span></a>
</span><span id="ZakatTracker-2161"><a href="#ZakatTracker-2161"><span class="linenos">2161</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker-2162"><a href="#ZakatTracker-2162"><span class="linenos">2162</span></a><span class="sd">        No specific exceptions are raised by this method.</span>
</span><span id="ZakatTracker-2163"><a href="#ZakatTracker-2163"><span class="linenos">2163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2164"><a href="#ZakatTracker-2164"><span class="linenos">2164</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="ZakatTracker-2165"><a href="#ZakatTracker-2165"><span class="linenos">2165</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">JSONEncoder</span><span class="p">)</span>
</span><span id="ZakatTracker-2166"><a href="#ZakatTracker-2166"><span class="linenos">2166</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker-2167"><a href="#ZakatTracker-2167"><span class="linenos">2167</span></a>
</span><span id="ZakatTracker-2168"><a href="#ZakatTracker-2168"><span class="linenos">2168</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-2169"><a href="#ZakatTracker-2169"><span class="linenos">2169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2170"><a href="#ZakatTracker-2170"><span class="linenos">2170</span></a><span class="sd">        Saves the ZakatTracker&#39;s current state to a camel file.</span>
</span><span id="ZakatTracker-2171"><a href="#ZakatTracker-2171"><span class="linenos">2171</span></a>
</span><span id="ZakatTracker-2172"><a href="#ZakatTracker-2172"><span class="linenos">2172</span></a><span class="sd">        This method serializes the internal data (`_vault`).</span>
</span><span id="ZakatTracker-2173"><a href="#ZakatTracker-2173"><span class="linenos">2173</span></a>
</span><span id="ZakatTracker-2174"><a href="#ZakatTracker-2174"><span class="linenos">2174</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-2175"><a href="#ZakatTracker-2175"><span class="linenos">2175</span></a><span class="sd">        - path (str, optional): File path for saving. Defaults to a predefined location.</span>
</span><span id="ZakatTracker-2176"><a href="#ZakatTracker-2176"><span class="linenos">2176</span></a>
</span><span id="ZakatTracker-2177"><a href="#ZakatTracker-2177"><span class="linenos">2177</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-2178"><a href="#ZakatTracker-2178"><span class="linenos">2178</span></a><span class="sd">        - bool: True if the save operation is successful, False otherwise.</span>
</span><span id="ZakatTracker-2179"><a href="#ZakatTracker-2179"><span class="linenos">2179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2180"><a href="#ZakatTracker-2180"><span class="linenos">2180</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-2181"><a href="#ZakatTracker-2181"><span class="linenos">2181</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">()</span>
</span><span id="ZakatTracker-2182"><a href="#ZakatTracker-2182"><span class="linenos">2182</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-2183"><a href="#ZakatTracker-2183"><span class="linenos">2183</span></a>            <span class="c1"># first save in tmp file</span>
</span><span id="ZakatTracker-2184"><a href="#ZakatTracker-2184"><span class="linenos">2184</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">.tmp&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker-2185"><a href="#ZakatTracker-2185"><span class="linenos">2185</span></a>                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">camel</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">))</span>
</span><span id="ZakatTracker-2186"><a href="#ZakatTracker-2186"><span class="linenos">2186</span></a>            <span class="c1"># then move tmp file to original location</span>
</span><span id="ZakatTracker-2187"><a href="#ZakatTracker-2187"><span class="linenos">2187</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">.tmp&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="ZakatTracker-2188"><a href="#ZakatTracker-2188"><span class="linenos">2188</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker-2189"><a href="#ZakatTracker-2189"><span class="linenos">2189</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ZakatTracker-2190"><a href="#ZakatTracker-2190"><span class="linenos">2190</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2191"><a href="#ZakatTracker-2191"><span class="linenos">2191</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker-2192"><a href="#ZakatTracker-2192"><span class="linenos">2192</span></a>
</span><span id="ZakatTracker-2193"><a href="#ZakatTracker-2193"><span class="linenos">2193</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-2194"><a href="#ZakatTracker-2194"><span class="linenos">2194</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2195"><a href="#ZakatTracker-2195"><span class="linenos">2195</span></a><span class="sd">        Load the current state of the ZakatTracker object from a camel file.</span>
</span><span id="ZakatTracker-2196"><a href="#ZakatTracker-2196"><span class="linenos">2196</span></a>
</span><span id="ZakatTracker-2197"><a href="#ZakatTracker-2197"><span class="linenos">2197</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-2198"><a href="#ZakatTracker-2198"><span class="linenos">2198</span></a><span class="sd">        - path (str): The path where the camel file is located. If not provided, it will use the default path.</span>
</span><span id="ZakatTracker-2199"><a href="#ZakatTracker-2199"><span class="linenos">2199</span></a>
</span><span id="ZakatTracker-2200"><a href="#ZakatTracker-2200"><span class="linenos">2200</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-2201"><a href="#ZakatTracker-2201"><span class="linenos">2201</span></a><span class="sd">        - bool: True if the load operation is successful, False otherwise.</span>
</span><span id="ZakatTracker-2202"><a href="#ZakatTracker-2202"><span class="linenos">2202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2203"><a href="#ZakatTracker-2203"><span class="linenos">2203</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-2204"><a href="#ZakatTracker-2204"><span class="linenos">2204</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">()</span>
</span><span id="ZakatTracker-2205"><a href="#ZakatTracker-2205"><span class="linenos">2205</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-2206"><a href="#ZakatTracker-2206"><span class="linenos">2206</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="ZakatTracker-2207"><a href="#ZakatTracker-2207"><span class="linenos">2207</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker-2208"><a href="#ZakatTracker-2208"><span class="linenos">2208</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span> <span class="o">=</span> <span class="n">camel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="ZakatTracker-2209"><a href="#ZakatTracker-2209"><span class="linenos">2209</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker-2210"><a href="#ZakatTracker-2210"><span class="linenos">2210</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker-2211"><a href="#ZakatTracker-2211"><span class="linenos">2211</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2212"><a href="#ZakatTracker-2212"><span class="linenos">2212</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker-2213"><a href="#ZakatTracker-2213"><span class="linenos">2213</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ZakatTracker-2214"><a href="#ZakatTracker-2214"><span class="linenos">2214</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2215"><a href="#ZakatTracker-2215"><span class="linenos">2215</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker-2216"><a href="#ZakatTracker-2216"><span class="linenos">2216</span></a>
</span><span id="ZakatTracker-2217"><a href="#ZakatTracker-2217"><span class="linenos">2217</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">import_csv_cache_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ZakatTracker-2218"><a href="#ZakatTracker-2218"><span class="linenos">2218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2219"><a href="#ZakatTracker-2219"><span class="linenos">2219</span></a><span class="sd">        Generates the cache file path for imported CSV data.</span>
</span><span id="ZakatTracker-2220"><a href="#ZakatTracker-2220"><span class="linenos">2220</span></a>
</span><span id="ZakatTracker-2221"><a href="#ZakatTracker-2221"><span class="linenos">2221</span></a><span class="sd">        This function constructs the file path where cached data from CSV imports</span>
</span><span id="ZakatTracker-2222"><a href="#ZakatTracker-2222"><span class="linenos">2222</span></a><span class="sd">        will be stored. The cache file is a camel file (.camel extension) appended</span>
</span><span id="ZakatTracker-2223"><a href="#ZakatTracker-2223"><span class="linenos">2223</span></a><span class="sd">        to the base path of the object.</span>
</span><span id="ZakatTracker-2224"><a href="#ZakatTracker-2224"><span class="linenos">2224</span></a>
</span><span id="ZakatTracker-2225"><a href="#ZakatTracker-2225"><span class="linenos">2225</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-2226"><a href="#ZakatTracker-2226"><span class="linenos">2226</span></a><span class="sd">        - str: The full path to the import CSV cache file.</span>
</span><span id="ZakatTracker-2227"><a href="#ZakatTracker-2227"><span class="linenos">2227</span></a>
</span><span id="ZakatTracker-2228"><a href="#ZakatTracker-2228"><span class="linenos">2228</span></a><span class="sd">        Example:</span>
</span><span id="ZakatTracker-2229"><a href="#ZakatTracker-2229"><span class="linenos">2229</span></a><span class="sd">            &gt;&gt;&gt; obj = ZakatTracker(&#39;/data/reports&#39;)</span>
</span><span id="ZakatTracker-2230"><a href="#ZakatTracker-2230"><span class="linenos">2230</span></a><span class="sd">            &gt;&gt;&gt; obj.import_csv_cache_path()</span>
</span><span id="ZakatTracker-2231"><a href="#ZakatTracker-2231"><span class="linenos">2231</span></a><span class="sd">            &#39;/data/reports.import_csv.camel&#39;</span>
</span><span id="ZakatTracker-2232"><a href="#ZakatTracker-2232"><span class="linenos">2232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2233"><a href="#ZakatTracker-2233"><span class="linenos">2233</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>
</span><span id="ZakatTracker-2234"><a href="#ZakatTracker-2234"><span class="linenos">2234</span></a>        <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span>
</span><span id="ZakatTracker-2235"><a href="#ZakatTracker-2235"><span class="linenos">2235</span></a>        <span class="n">ext_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
</span><span id="ZakatTracker-2236"><a href="#ZakatTracker-2236"><span class="linenos">2236</span></a>        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
</span><span id="ZakatTracker-2237"><a href="#ZakatTracker-2237"><span class="linenos">2237</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="n">ext_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker-2238"><a href="#ZakatTracker-2238"><span class="linenos">2238</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;.import_csv.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2239"><a href="#ZakatTracker-2239"><span class="linenos">2239</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="ZakatTracker-2240"><a href="#ZakatTracker-2240"><span class="linenos">2240</span></a>
</span><span id="ZakatTracker-2241"><a href="#ZakatTracker-2241"><span class="linenos">2241</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">import_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;file.csv&#39;</span><span class="p">,</span> <span class="n">scale_decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="ZakatTracker-2242"><a href="#ZakatTracker-2242"><span class="linenos">2242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2243"><a href="#ZakatTracker-2243"><span class="linenos">2243</span></a><span class="sd">        The function reads the CSV file, checks for duplicate transactions, and creates the transactions in the system.</span>
</span><span id="ZakatTracker-2244"><a href="#ZakatTracker-2244"><span class="linenos">2244</span></a>
</span><span id="ZakatTracker-2245"><a href="#ZakatTracker-2245"><span class="linenos">2245</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-2246"><a href="#ZakatTracker-2246"><span class="linenos">2246</span></a><span class="sd">        - path (str): The path to the CSV file. Default is &#39;file.csv&#39;.</span>
</span><span id="ZakatTracker-2247"><a href="#ZakatTracker-2247"><span class="linenos">2247</span></a><span class="sd">        - scale_decimal_places (int): The number of decimal places to scale the value. Default is 0.</span>
</span><span id="ZakatTracker-2248"><a href="#ZakatTracker-2248"><span class="linenos">2248</span></a><span class="sd">        - debug (bool): A flag indicating whether to print debug information.</span>
</span><span id="ZakatTracker-2249"><a href="#ZakatTracker-2249"><span class="linenos">2249</span></a>
</span><span id="ZakatTracker-2250"><a href="#ZakatTracker-2250"><span class="linenos">2250</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-2251"><a href="#ZakatTracker-2251"><span class="linenos">2251</span></a><span class="sd">        - tuple: A tuple containing the number of transactions created, the number of transactions found in the cache,</span>
</span><span id="ZakatTracker-2252"><a href="#ZakatTracker-2252"><span class="linenos">2252</span></a><span class="sd">                and a dictionary of bad transactions.</span>
</span><span id="ZakatTracker-2253"><a href="#ZakatTracker-2253"><span class="linenos">2253</span></a>
</span><span id="ZakatTracker-2254"><a href="#ZakatTracker-2254"><span class="linenos">2254</span></a><span class="sd">        Notes:</span>
</span><span id="ZakatTracker-2255"><a href="#ZakatTracker-2255"><span class="linenos">2255</span></a><span class="sd">            * Currency Pair Assumption: This function assumes that the exchange rates stored for each account</span>
</span><span id="ZakatTracker-2256"><a href="#ZakatTracker-2256"><span class="linenos">2256</span></a><span class="sd">                                        are appropriate for the currency pairs involved in the conversions.</span>
</span><span id="ZakatTracker-2257"><a href="#ZakatTracker-2257"><span class="linenos">2257</span></a><span class="sd">            * The exchange rate for each account is based on the last encountered transaction rate that is not equal</span>
</span><span id="ZakatTracker-2258"><a href="#ZakatTracker-2258"><span class="linenos">2258</span></a><span class="sd">                to 1.0 or the previous rate for that account.</span>
</span><span id="ZakatTracker-2259"><a href="#ZakatTracker-2259"><span class="linenos">2259</span></a><span class="sd">            * Those rates will be merged into the exchange rates main data, and later it will be used for all subsequent</span>
</span><span id="ZakatTracker-2260"><a href="#ZakatTracker-2260"><span class="linenos">2260</span></a><span class="sd">              transactions of the same account within the whole imported and existing dataset when doing `check` and</span>
</span><span id="ZakatTracker-2261"><a href="#ZakatTracker-2261"><span class="linenos">2261</span></a><span class="sd">              `zakat` operations.</span>
</span><span id="ZakatTracker-2262"><a href="#ZakatTracker-2262"><span class="linenos">2262</span></a>
</span><span id="ZakatTracker-2263"><a href="#ZakatTracker-2263"><span class="linenos">2263</span></a><span class="sd">        Example Usage:</span>
</span><span id="ZakatTracker-2264"><a href="#ZakatTracker-2264"><span class="linenos">2264</span></a><span class="sd">            The CSV file should have the following format, rate is optional per transaction:</span>
</span><span id="ZakatTracker-2265"><a href="#ZakatTracker-2265"><span class="linenos">2265</span></a><span class="sd">            account, desc, value, date, rate</span>
</span><span id="ZakatTracker-2266"><a href="#ZakatTracker-2266"><span class="linenos">2266</span></a><span class="sd">            For example:</span>
</span><span id="ZakatTracker-2267"><a href="#ZakatTracker-2267"><span class="linenos">2267</span></a><span class="sd">            safe-45, &quot;Some text&quot;, 34872, 1988-06-30 00:00:00, 1</span>
</span><span id="ZakatTracker-2268"><a href="#ZakatTracker-2268"><span class="linenos">2268</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2269"><a href="#ZakatTracker-2269"><span class="linenos">2269</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2270"><a href="#ZakatTracker-2270"><span class="linenos">2270</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;import_csv&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2271"><a href="#ZakatTracker-2271"><span class="linenos">2271</span></a>        <span class="n">cache</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker-2272"><a href="#ZakatTracker-2272"><span class="linenos">2272</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-2273"><a href="#ZakatTracker-2273"><span class="linenos">2273</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">import_csv_cache_path</span><span class="p">(),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker-2274"><a href="#ZakatTracker-2274"><span class="linenos">2274</span></a>                <span class="n">cache</span> <span class="o">=</span> <span class="n">camel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="ZakatTracker-2275"><a href="#ZakatTracker-2275"><span class="linenos">2275</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="ZakatTracker-2276"><a href="#ZakatTracker-2276"><span class="linenos">2276</span></a>            <span class="k">pass</span>
</span><span id="ZakatTracker-2277"><a href="#ZakatTracker-2277"><span class="linenos">2277</span></a>        <span class="n">date_formats</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ZakatTracker-2278"><a href="#ZakatTracker-2278"><span class="linenos">2278</span></a>            <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker-2279"><a href="#ZakatTracker-2279"><span class="linenos">2279</span></a>            <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker-2280"><a href="#ZakatTracker-2280"><span class="linenos">2280</span></a>            <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker-2281"><a href="#ZakatTracker-2281"><span class="linenos">2281</span></a>            <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker-2282"><a href="#ZakatTracker-2282"><span class="linenos">2282</span></a>        <span class="p">]</span>
</span><span id="ZakatTracker-2283"><a href="#ZakatTracker-2283"><span class="linenos">2283</span></a>        <span class="n">created</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">bad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{}</span>
</span><span id="ZakatTracker-2284"><a href="#ZakatTracker-2284"><span class="linenos">2284</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker-2285"><a href="#ZakatTracker-2285"><span class="linenos">2285</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ZakatTracker-2286"><a href="#ZakatTracker-2286"><span class="linenos">2286</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2287"><a href="#ZakatTracker-2287"><span class="linenos">2287</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
</span><span id="ZakatTracker-2288"><a href="#ZakatTracker-2288"><span class="linenos">2288</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-2289"><a href="#ZakatTracker-2289"><span class="linenos">2289</span></a>                <span class="n">hashed</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
</span><span id="ZakatTracker-2290"><a href="#ZakatTracker-2290"><span class="linenos">2290</span></a>                <span class="k">if</span> <span class="n">hashed</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
</span><span id="ZakatTracker-2291"><a href="#ZakatTracker-2291"><span class="linenos">2291</span></a>                    <span class="n">found</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-2292"><a href="#ZakatTracker-2292"><span class="linenos">2292</span></a>                    <span class="k">continue</span>
</span><span id="ZakatTracker-2293"><a href="#ZakatTracker-2293"><span class="linenos">2293</span></a>                <span class="n">account</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ZakatTracker-2294"><a href="#ZakatTracker-2294"><span class="linenos">2294</span></a>                <span class="n">desc</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker-2295"><a href="#ZakatTracker-2295"><span class="linenos">2295</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="ZakatTracker-2296"><a href="#ZakatTracker-2296"><span class="linenos">2296</span></a>                <span class="n">rate</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ZakatTracker-2297"><a href="#ZakatTracker-2297"><span class="linenos">2297</span></a>                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">5</span><span class="p">]:</span>  <span class="c1"># Empty list if index is out of range</span>
</span><span id="ZakatTracker-2298"><a href="#ZakatTracker-2298"><span class="linenos">2298</span></a>                    <span class="n">rate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="ZakatTracker-2299"><a href="#ZakatTracker-2299"><span class="linenos">2299</span></a>                <span class="n">date</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2300"><a href="#ZakatTracker-2300"><span class="linenos">2300</span></a>                <span class="k">for</span> <span class="n">time_format</span> <span class="ow">in</span> <span class="n">date_formats</span><span class="p">:</span>
</span><span id="ZakatTracker-2301"><a href="#ZakatTracker-2301"><span class="linenos">2301</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-2302"><a href="#ZakatTracker-2302"><span class="linenos">2302</span></a>                        <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">time_format</span><span class="p">))</span>
</span><span id="ZakatTracker-2303"><a href="#ZakatTracker-2303"><span class="linenos">2303</span></a>                        <span class="k">break</span>
</span><span id="ZakatTracker-2304"><a href="#ZakatTracker-2304"><span class="linenos">2304</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="ZakatTracker-2305"><a href="#ZakatTracker-2305"><span class="linenos">2305</span></a>                        <span class="k">pass</span>
</span><span id="ZakatTracker-2306"><a href="#ZakatTracker-2306"><span class="linenos">2306</span></a>                <span class="k">if</span> <span class="n">date</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2307"><a href="#ZakatTracker-2307"><span class="linenos">2307</span></a>                    <span class="n">bad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;invalid date&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-2308"><a href="#ZakatTracker-2308"><span class="linenos">2308</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2309"><a href="#ZakatTracker-2309"><span class="linenos">2309</span></a>                    <span class="n">bad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;invalid value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-2310"><a href="#ZakatTracker-2310"><span class="linenos">2310</span></a>                    <span class="k">continue</span>
</span><span id="ZakatTracker-2311"><a href="#ZakatTracker-2311"><span class="linenos">2311</span></a>                <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="ZakatTracker-2312"><a href="#ZakatTracker-2312"><span class="linenos">2312</span></a>                    <span class="n">data</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker-2313"><a href="#ZakatTracker-2313"><span class="linenos">2313</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">date</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">hashed</span><span class="p">))</span>
</span><span id="ZakatTracker-2314"><a href="#ZakatTracker-2314"><span class="linenos">2314</span></a>
</span><span id="ZakatTracker-2315"><a href="#ZakatTracker-2315"><span class="linenos">2315</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2316"><a href="#ZakatTracker-2316"><span class="linenos">2316</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;import_csv&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="ZakatTracker-2317"><a href="#ZakatTracker-2317"><span class="linenos">2317</span></a>
</span><span id="ZakatTracker-2318"><a href="#ZakatTracker-2318"><span class="linenos">2318</span></a>        <span class="k">if</span> <span class="n">bad</span><span class="p">:</span>
</span><span id="ZakatTracker-2319"><a href="#ZakatTracker-2319"><span class="linenos">2319</span></a>            <span class="k">return</span> <span class="n">created</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">bad</span>
</span><span id="ZakatTracker-2320"><a href="#ZakatTracker-2320"><span class="linenos">2320</span></a>
</span><span id="ZakatTracker-2321"><a href="#ZakatTracker-2321"><span class="linenos">2321</span></a>        <span class="k">for</span> <span class="n">date</span><span class="p">,</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="ZakatTracker-2322"><a href="#ZakatTracker-2322"><span class="linenos">2322</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-2323"><a href="#ZakatTracker-2323"><span class="linenos">2323</span></a>                <span class="n">len_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</span><span id="ZakatTracker-2324"><a href="#ZakatTracker-2324"><span class="linenos">2324</span></a>                <span class="k">if</span> <span class="n">len_rows</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ZakatTracker-2325"><a href="#ZakatTracker-2325"><span class="linenos">2325</span></a>                    <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">unscaled_value</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">hashed</span><span class="p">)</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ZakatTracker-2326"><a href="#ZakatTracker-2326"><span class="linenos">2326</span></a>                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span>
</span><span id="ZakatTracker-2327"><a href="#ZakatTracker-2327"><span class="linenos">2327</span></a>                        <span class="n">unscaled_value</span><span class="p">,</span>
</span><span id="ZakatTracker-2328"><a href="#ZakatTracker-2328"><span class="linenos">2328</span></a>                        <span class="n">decimal_places</span><span class="o">=</span><span class="n">scale_decimal_places</span><span class="p">,</span>
</span><span id="ZakatTracker-2329"><a href="#ZakatTracker-2329"><span class="linenos">2329</span></a>                    <span class="p">)</span> <span class="k">if</span> <span class="n">scale_decimal_places</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">unscaled_value</span>
</span><span id="ZakatTracker-2330"><a href="#ZakatTracker-2330"><span class="linenos">2330</span></a>                    <span class="k">if</span> <span class="n">rate</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2331"><a href="#ZakatTracker-2331"><span class="linenos">2331</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">rate</span><span class="p">)</span>
</span><span id="ZakatTracker-2332"><a href="#ZakatTracker-2332"><span class="linenos">2332</span></a>                    <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2333"><a href="#ZakatTracker-2333"><span class="linenos">2333</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="n">unscaled_value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
</span><span id="ZakatTracker-2334"><a href="#ZakatTracker-2334"><span class="linenos">2334</span></a>                    <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2335"><a href="#ZakatTracker-2335"><span class="linenos">2335</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">unscaled_value</span><span class="o">=-</span><span class="n">value</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
</span><span id="ZakatTracker-2336"><a href="#ZakatTracker-2336"><span class="linenos">2336</span></a>                    <span class="n">created</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-2337"><a href="#ZakatTracker-2337"><span class="linenos">2337</span></a>                    <span class="n">cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashed</span><span class="p">)</span>
</span><span id="ZakatTracker-2338"><a href="#ZakatTracker-2338"><span class="linenos">2338</span></a>                    <span class="k">continue</span>
</span><span id="ZakatTracker-2339"><a href="#ZakatTracker-2339"><span class="linenos">2339</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2340"><a href="#ZakatTracker-2340"><span class="linenos">2340</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-- Duplicated time detected&#39;</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="s1">&#39;len&#39;</span><span class="p">,</span> <span class="n">len_rows</span><span class="p">)</span>
</span><span id="ZakatTracker-2341"><a href="#ZakatTracker-2341"><span class="linenos">2341</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</span><span id="ZakatTracker-2342"><a href="#ZakatTracker-2342"><span class="linenos">2342</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2343"><a href="#ZakatTracker-2343"><span class="linenos">2343</span></a>                <span class="c1"># If records are found at the same time with different accounts in the same amount</span>
</span><span id="ZakatTracker-2344"><a href="#ZakatTracker-2344"><span class="linenos">2344</span></a>                <span class="c1"># (one positive and the other negative), this indicates it is a transfer.</span>
</span><span id="ZakatTracker-2345"><a href="#ZakatTracker-2345"><span class="linenos">2345</span></a>                <span class="k">if</span> <span class="n">len_rows</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="ZakatTracker-2346"><a href="#ZakatTracker-2346"><span class="linenos">2346</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;more than two transactions(</span><span class="si">{</span><span class="n">len_rows</span><span class="si">}</span><span class="s1">) at the same time&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2347"><a href="#ZakatTracker-2347"><span class="linenos">2347</span></a>                <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">account1</span><span class="p">,</span> <span class="n">desc1</span><span class="p">,</span> <span class="n">unscaled_value1</span><span class="p">,</span> <span class="n">date1</span><span class="p">,</span> <span class="n">rate1</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ZakatTracker-2348"><a href="#ZakatTracker-2348"><span class="linenos">2348</span></a>                <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">account2</span><span class="p">,</span> <span class="n">desc2</span><span class="p">,</span> <span class="n">unscaled_value2</span><span class="p">,</span> <span class="n">date2</span><span class="p">,</span> <span class="n">rate2</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker-2349"><a href="#ZakatTracker-2349"><span class="linenos">2349</span></a>                <span class="k">if</span> <span class="n">account1</span> <span class="o">==</span> <span class="n">account2</span> <span class="ow">or</span> <span class="n">desc1</span> <span class="o">!=</span> <span class="n">desc2</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">unscaled_value1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">abs</span><span class="p">(</span>
</span><span id="ZakatTracker-2350"><a href="#ZakatTracker-2350"><span class="linenos">2350</span></a>                        <span class="n">unscaled_value2</span><span class="p">)</span> <span class="ow">or</span> <span class="n">date1</span> <span class="o">!=</span> <span class="n">date2</span><span class="p">:</span>
</span><span id="ZakatTracker-2351"><a href="#ZakatTracker-2351"><span class="linenos">2351</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;invalid transfer&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2352"><a href="#ZakatTracker-2352"><span class="linenos">2352</span></a>                <span class="k">if</span> <span class="n">rate1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2353"><a href="#ZakatTracker-2353"><span class="linenos">2353</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account1</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">date1</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">rate1</span><span class="p">)</span>
</span><span id="ZakatTracker-2354"><a href="#ZakatTracker-2354"><span class="linenos">2354</span></a>                <span class="k">if</span> <span class="n">rate2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2355"><a href="#ZakatTracker-2355"><span class="linenos">2355</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account2</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">date2</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">rate2</span><span class="p">)</span>
</span><span id="ZakatTracker-2356"><a href="#ZakatTracker-2356"><span class="linenos">2356</span></a>                <span class="n">value1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span>
</span><span id="ZakatTracker-2357"><a href="#ZakatTracker-2357"><span class="linenos">2357</span></a>                    <span class="n">unscaled_value1</span><span class="p">,</span>
</span><span id="ZakatTracker-2358"><a href="#ZakatTracker-2358"><span class="linenos">2358</span></a>                    <span class="n">decimal_places</span><span class="o">=</span><span class="n">scale_decimal_places</span><span class="p">,</span>
</span><span id="ZakatTracker-2359"><a href="#ZakatTracker-2359"><span class="linenos">2359</span></a>                <span class="p">)</span> <span class="k">if</span> <span class="n">scale_decimal_places</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">unscaled_value1</span>
</span><span id="ZakatTracker-2360"><a href="#ZakatTracker-2360"><span class="linenos">2360</span></a>                <span class="n">value2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span>
</span><span id="ZakatTracker-2361"><a href="#ZakatTracker-2361"><span class="linenos">2361</span></a>                    <span class="n">unscaled_value2</span><span class="p">,</span>
</span><span id="ZakatTracker-2362"><a href="#ZakatTracker-2362"><span class="linenos">2362</span></a>                    <span class="n">decimal_places</span><span class="o">=</span><span class="n">scale_decimal_places</span><span class="p">,</span>
</span><span id="ZakatTracker-2363"><a href="#ZakatTracker-2363"><span class="linenos">2363</span></a>                <span class="p">)</span> <span class="k">if</span> <span class="n">scale_decimal_places</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">unscaled_value2</span>
</span><span id="ZakatTracker-2364"><a href="#ZakatTracker-2364"><span class="linenos">2364</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-2365"><a href="#ZakatTracker-2365"><span class="linenos">2365</span></a>                    <span class="n">value1</span><span class="p">:</span> <span class="n">account1</span><span class="p">,</span>
</span><span id="ZakatTracker-2366"><a href="#ZakatTracker-2366"><span class="linenos">2366</span></a>                    <span class="n">value2</span><span class="p">:</span> <span class="n">account2</span><span class="p">,</span>
</span><span id="ZakatTracker-2367"><a href="#ZakatTracker-2367"><span class="linenos">2367</span></a>                <span class="p">}</span>
</span><span id="ZakatTracker-2368"><a href="#ZakatTracker-2368"><span class="linenos">2368</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span>
</span><span id="ZakatTracker-2369"><a href="#ZakatTracker-2369"><span class="linenos">2369</span></a>                    <span class="n">unscaled_amount</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">value1</span><span class="p">),</span>
</span><span id="ZakatTracker-2370"><a href="#ZakatTracker-2370"><span class="linenos">2370</span></a>                    <span class="n">from_account</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
</span><span id="ZakatTracker-2371"><a href="#ZakatTracker-2371"><span class="linenos">2371</span></a>                    <span class="n">to_account</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
</span><span id="ZakatTracker-2372"><a href="#ZakatTracker-2372"><span class="linenos">2372</span></a>                    <span class="n">desc</span><span class="o">=</span><span class="n">desc1</span><span class="p">,</span>
</span><span id="ZakatTracker-2373"><a href="#ZakatTracker-2373"><span class="linenos">2373</span></a>                    <span class="n">created</span><span class="o">=</span><span class="n">date1</span><span class="p">,</span>
</span><span id="ZakatTracker-2374"><a href="#ZakatTracker-2374"><span class="linenos">2374</span></a>                <span class="p">)</span>
</span><span id="ZakatTracker-2375"><a href="#ZakatTracker-2375"><span class="linenos">2375</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ZakatTracker-2376"><a href="#ZakatTracker-2376"><span class="linenos">2376</span></a>                <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
</span><span id="ZakatTracker-2377"><a href="#ZakatTracker-2377"><span class="linenos">2377</span></a>                    <span class="n">bad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="ZakatTracker-2378"><a href="#ZakatTracker-2378"><span class="linenos">2378</span></a>                <span class="k">break</span>
</span><span id="ZakatTracker-2379"><a href="#ZakatTracker-2379"><span class="linenos">2379</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">import_csv_cache_path</span><span class="p">(),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker-2380"><a href="#ZakatTracker-2380"><span class="linenos">2380</span></a>            <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">camel</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cache</span><span class="p">))</span>
</span><span id="ZakatTracker-2381"><a href="#ZakatTracker-2381"><span class="linenos">2381</span></a>        <span class="k">return</span> <span class="n">created</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">bad</span>
</span><span id="ZakatTracker-2382"><a href="#ZakatTracker-2382"><span class="linenos">2382</span></a>
</span><span id="ZakatTracker-2383"><a href="#ZakatTracker-2383"><span class="linenos">2383</span></a>    <span class="c1">########</span>
</span><span id="ZakatTracker-2384"><a href="#ZakatTracker-2384"><span class="linenos">2384</span></a>    <span class="c1"># TESTS #</span>
</span><span id="ZakatTracker-2385"><a href="#ZakatTracker-2385"><span class="linenos">2385</span></a>    <span class="c1">#######</span>
</span><span id="ZakatTracker-2386"><a href="#ZakatTracker-2386"><span class="linenos">2386</span></a>
</span><span id="ZakatTracker-2387"><a href="#ZakatTracker-2387"><span class="linenos">2387</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-2388"><a href="#ZakatTracker-2388"><span class="linenos">2388</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">human_readable_size</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZakatTracker-2389"><a href="#ZakatTracker-2389"><span class="linenos">2389</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2390"><a href="#ZakatTracker-2390"><span class="linenos">2390</span></a><span class="sd">        Converts a size in bytes to a human-readable format (e.g., KB, MB, GB).</span>
</span><span id="ZakatTracker-2391"><a href="#ZakatTracker-2391"><span class="linenos">2391</span></a>
</span><span id="ZakatTracker-2392"><a href="#ZakatTracker-2392"><span class="linenos">2392</span></a><span class="sd">        This function iterates through progressively larger units of information</span>
</span><span id="ZakatTracker-2393"><a href="#ZakatTracker-2393"><span class="linenos">2393</span></a><span class="sd">        (B, KB, MB, GB, etc.) and divides the input size until it fits within a</span>
</span><span id="ZakatTracker-2394"><a href="#ZakatTracker-2394"><span class="linenos">2394</span></a><span class="sd">        range that can be expressed with a reasonable number before the unit.</span>
</span><span id="ZakatTracker-2395"><a href="#ZakatTracker-2395"><span class="linenos">2395</span></a>
</span><span id="ZakatTracker-2396"><a href="#ZakatTracker-2396"><span class="linenos">2396</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-2397"><a href="#ZakatTracker-2397"><span class="linenos">2397</span></a><span class="sd">        - size (float): The size in bytes to convert.</span>
</span><span id="ZakatTracker-2398"><a href="#ZakatTracker-2398"><span class="linenos">2398</span></a><span class="sd">        - decimal_places (int, optional): The number of decimal places to display</span>
</span><span id="ZakatTracker-2399"><a href="#ZakatTracker-2399"><span class="linenos">2399</span></a><span class="sd">            in the result. Defaults to 2.</span>
</span><span id="ZakatTracker-2400"><a href="#ZakatTracker-2400"><span class="linenos">2400</span></a>
</span><span id="ZakatTracker-2401"><a href="#ZakatTracker-2401"><span class="linenos">2401</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-2402"><a href="#ZakatTracker-2402"><span class="linenos">2402</span></a><span class="sd">        - str: A string representation of the size in a human-readable format,</span>
</span><span id="ZakatTracker-2403"><a href="#ZakatTracker-2403"><span class="linenos">2403</span></a><span class="sd">            rounded to the specified number of decimal places. For example:</span>
</span><span id="ZakatTracker-2404"><a href="#ZakatTracker-2404"><span class="linenos">2404</span></a><span class="sd">                - &quot;1.50 KB&quot; (1536 bytes)</span>
</span><span id="ZakatTracker-2405"><a href="#ZakatTracker-2405"><span class="linenos">2405</span></a><span class="sd">                - &quot;23.00 MB&quot; (24117248 bytes)</span>
</span><span id="ZakatTracker-2406"><a href="#ZakatTracker-2406"><span class="linenos">2406</span></a><span class="sd">                - &quot;1.23 GB&quot; (1325899906 bytes)</span>
</span><span id="ZakatTracker-2407"><a href="#ZakatTracker-2407"><span class="linenos">2407</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2408"><a href="#ZakatTracker-2408"><span class="linenos">2408</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="ZakatTracker-2409"><a href="#ZakatTracker-2409"><span class="linenos">2409</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;size must be a float or integer&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2410"><a href="#ZakatTracker-2410"><span class="linenos">2410</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">decimal_places</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-2411"><a href="#ZakatTracker-2411"><span class="linenos">2411</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;decimal_places must be an integer&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2412"><a href="#ZakatTracker-2412"><span class="linenos">2412</span></a>        <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;KB&#39;</span><span class="p">,</span> <span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="s1">&#39;GB&#39;</span><span class="p">,</span> <span class="s1">&#39;TB&#39;</span><span class="p">,</span> <span class="s1">&#39;PB&#39;</span><span class="p">,</span> <span class="s1">&#39;EB&#39;</span><span class="p">,</span> <span class="s1">&#39;ZB&#39;</span><span class="p">,</span> <span class="s1">&#39;YB&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-2413"><a href="#ZakatTracker-2413"><span class="linenos">2413</span></a>            <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mf">1024.0</span><span class="p">:</span>
</span><span id="ZakatTracker-2414"><a href="#ZakatTracker-2414"><span class="linenos">2414</span></a>                <span class="k">break</span>
</span><span id="ZakatTracker-2415"><a href="#ZakatTracker-2415"><span class="linenos">2415</span></a>            <span class="n">size</span> <span class="o">/=</span> <span class="mf">1024.0</span>
</span><span id="ZakatTracker-2416"><a href="#ZakatTracker-2416"><span class="linenos">2416</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">decimal_places</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ZakatTracker-2417"><a href="#ZakatTracker-2417"><span class="linenos">2417</span></a>
</span><span id="ZakatTracker-2418"><a href="#ZakatTracker-2418"><span class="linenos">2418</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-2419"><a href="#ZakatTracker-2419"><span class="linenos">2419</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_dict_size</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">seen</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ZakatTracker-2420"><a href="#ZakatTracker-2420"><span class="linenos">2420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2421"><a href="#ZakatTracker-2421"><span class="linenos">2421</span></a><span class="sd">        Recursively calculates the approximate memory size of a dictionary and its contents in bytes.</span>
</span><span id="ZakatTracker-2422"><a href="#ZakatTracker-2422"><span class="linenos">2422</span></a>
</span><span id="ZakatTracker-2423"><a href="#ZakatTracker-2423"><span class="linenos">2423</span></a><span class="sd">        This function traverses the dictionary structure, accounting for the size of keys, values,</span>
</span><span id="ZakatTracker-2424"><a href="#ZakatTracker-2424"><span class="linenos">2424</span></a><span class="sd">        and any nested objects. It handles various data types commonly found in dictionaries</span>
</span><span id="ZakatTracker-2425"><a href="#ZakatTracker-2425"><span class="linenos">2425</span></a><span class="sd">        (e.g., lists, tuples, sets, numbers, strings) and prevents infinite recursion in case</span>
</span><span id="ZakatTracker-2426"><a href="#ZakatTracker-2426"><span class="linenos">2426</span></a><span class="sd">        of circular references.</span>
</span><span id="ZakatTracker-2427"><a href="#ZakatTracker-2427"><span class="linenos">2427</span></a>
</span><span id="ZakatTracker-2428"><a href="#ZakatTracker-2428"><span class="linenos">2428</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-2429"><a href="#ZakatTracker-2429"><span class="linenos">2429</span></a><span class="sd">        - obj (dict): The dictionary whose size is to be calculated.</span>
</span><span id="ZakatTracker-2430"><a href="#ZakatTracker-2430"><span class="linenos">2430</span></a><span class="sd">        - seen (set, optional): A set used internally to track visited objects</span>
</span><span id="ZakatTracker-2431"><a href="#ZakatTracker-2431"><span class="linenos">2431</span></a><span class="sd">                             and avoid circular references. Defaults to None.</span>
</span><span id="ZakatTracker-2432"><a href="#ZakatTracker-2432"><span class="linenos">2432</span></a>
</span><span id="ZakatTracker-2433"><a href="#ZakatTracker-2433"><span class="linenos">2433</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-2434"><a href="#ZakatTracker-2434"><span class="linenos">2434</span></a><span class="sd">         - float: An approximate size of the dictionary and its contents in bytes.</span>
</span><span id="ZakatTracker-2435"><a href="#ZakatTracker-2435"><span class="linenos">2435</span></a>
</span><span id="ZakatTracker-2436"><a href="#ZakatTracker-2436"><span class="linenos">2436</span></a><span class="sd">        Note:</span>
</span><span id="ZakatTracker-2437"><a href="#ZakatTracker-2437"><span class="linenos">2437</span></a><span class="sd">        - This function is a method of the `ZakatTracker` class and is likely used to</span>
</span><span id="ZakatTracker-2438"><a href="#ZakatTracker-2438"><span class="linenos">2438</span></a><span class="sd">          estimate the memory footprint of data structures relevant to Zakat calculations.</span>
</span><span id="ZakatTracker-2439"><a href="#ZakatTracker-2439"><span class="linenos">2439</span></a><span class="sd">        - The size calculation is approximate as it relies on `sys.getsizeof()`, which might</span>
</span><span id="ZakatTracker-2440"><a href="#ZakatTracker-2440"><span class="linenos">2440</span></a><span class="sd">          not account for all memory overhead depending on the Python implementation.</span>
</span><span id="ZakatTracker-2441"><a href="#ZakatTracker-2441"><span class="linenos">2441</span></a><span class="sd">        - Circular references are handled to prevent infinite recursion.</span>
</span><span id="ZakatTracker-2442"><a href="#ZakatTracker-2442"><span class="linenos">2442</span></a><span class="sd">        - Basic numeric types (int, float, complex) are assumed to have fixed sizes.</span>
</span><span id="ZakatTracker-2443"><a href="#ZakatTracker-2443"><span class="linenos">2443</span></a><span class="sd">        - String sizes are estimated based on character length and encoding.</span>
</span><span id="ZakatTracker-2444"><a href="#ZakatTracker-2444"><span class="linenos">2444</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2445"><a href="#ZakatTracker-2445"><span class="linenos">2445</span></a>        <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2446"><a href="#ZakatTracker-2446"><span class="linenos">2446</span></a>        <span class="k">if</span> <span class="n">seen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker-2447"><a href="#ZakatTracker-2447"><span class="linenos">2447</span></a>            <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ZakatTracker-2448"><a href="#ZakatTracker-2448"><span class="linenos">2448</span></a>
</span><span id="ZakatTracker-2449"><a href="#ZakatTracker-2449"><span class="linenos">2449</span></a>        <span class="n">obj_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="ZakatTracker-2450"><a href="#ZakatTracker-2450"><span class="linenos">2450</span></a>        <span class="k">if</span> <span class="n">obj_id</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
</span><span id="ZakatTracker-2451"><a href="#ZakatTracker-2451"><span class="linenos">2451</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2452"><a href="#ZakatTracker-2452"><span class="linenos">2452</span></a>
</span><span id="ZakatTracker-2453"><a href="#ZakatTracker-2453"><span class="linenos">2453</span></a>        <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj_id</span><span class="p">)</span>
</span><span id="ZakatTracker-2454"><a href="#ZakatTracker-2454"><span class="linenos">2454</span></a>        <span class="n">size</span> <span class="o">+=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="ZakatTracker-2455"><a href="#ZakatTracker-2455"><span class="linenos">2455</span></a>
</span><span id="ZakatTracker-2456"><a href="#ZakatTracker-2456"><span class="linenos">2456</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="ZakatTracker-2457"><a href="#ZakatTracker-2457"><span class="linenos">2457</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker-2458"><a href="#ZakatTracker-2458"><span class="linenos">2458</span></a>                <span class="n">size</span> <span class="o">+=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">get_dict_size</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>
</span><span id="ZakatTracker-2459"><a href="#ZakatTracker-2459"><span class="linenos">2459</span></a>                <span class="n">size</span> <span class="o">+=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">get_dict_size</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>
</span><span id="ZakatTracker-2460"><a href="#ZakatTracker-2460"><span class="linenos">2460</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)):</span>
</span><span id="ZakatTracker-2461"><a href="#ZakatTracker-2461"><span class="linenos">2461</span></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
</span><span id="ZakatTracker-2462"><a href="#ZakatTracker-2462"><span class="linenos">2462</span></a>                <span class="n">size</span> <span class="o">+=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">get_dict_size</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>
</span><span id="ZakatTracker-2463"><a href="#ZakatTracker-2463"><span class="linenos">2463</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>  <span class="c1"># Handle numbers</span>
</span><span id="ZakatTracker-2464"><a href="#ZakatTracker-2464"><span class="linenos">2464</span></a>            <span class="k">pass</span>  <span class="c1"># Basic numbers have a fixed size, so nothing to add here</span>
</span><span id="ZakatTracker-2465"><a href="#ZakatTracker-2465"><span class="linenos">2465</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># Handle strings</span>
</span><span id="ZakatTracker-2466"><a href="#ZakatTracker-2466"><span class="linenos">2466</span></a>            <span class="n">size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">*</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="nb">str</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>  <span class="c1"># Size per character in bytes</span>
</span><span id="ZakatTracker-2467"><a href="#ZakatTracker-2467"><span class="linenos">2467</span></a>        <span class="k">return</span> <span class="n">size</span>
</span><span id="ZakatTracker-2468"><a href="#ZakatTracker-2468"><span class="linenos">2468</span></a>
</span><span id="ZakatTracker-2469"><a href="#ZakatTracker-2469"><span class="linenos">2469</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-2470"><a href="#ZakatTracker-2470"><span class="linenos">2470</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">duration_from_nanoseconds</span><span class="p">(</span><span class="n">ns</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ZakatTracker-2471"><a href="#ZakatTracker-2471"><span class="linenos">2471</span></a>                                  <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ZakatTracker-2472"><a href="#ZakatTracker-2472"><span class="linenos">2472</span></a>                                  <span class="n">spoken_time_separator</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2473"><a href="#ZakatTracker-2473"><span class="linenos">2473</span></a>                                  <span class="n">millennia</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Millennia&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2474"><a href="#ZakatTracker-2474"><span class="linenos">2474</span></a>                                  <span class="n">century</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Century&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2475"><a href="#ZakatTracker-2475"><span class="linenos">2475</span></a>                                  <span class="n">years</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Years&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2476"><a href="#ZakatTracker-2476"><span class="linenos">2476</span></a>                                  <span class="n">days</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Days&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2477"><a href="#ZakatTracker-2477"><span class="linenos">2477</span></a>                                  <span class="n">hours</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Hours&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2478"><a href="#ZakatTracker-2478"><span class="linenos">2478</span></a>                                  <span class="n">minutes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Minutes&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2479"><a href="#ZakatTracker-2479"><span class="linenos">2479</span></a>                                  <span class="n">seconds</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Seconds&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2480"><a href="#ZakatTracker-2480"><span class="linenos">2480</span></a>                                  <span class="n">milli_seconds</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;MilliSeconds&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2481"><a href="#ZakatTracker-2481"><span class="linenos">2481</span></a>                                  <span class="n">micro_seconds</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;MicroSeconds&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2482"><a href="#ZakatTracker-2482"><span class="linenos">2482</span></a>                                  <span class="n">nano_seconds</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;NanoSeconds&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2483"><a href="#ZakatTracker-2483"><span class="linenos">2483</span></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="ZakatTracker-2484"><a href="#ZakatTracker-2484"><span class="linenos">2484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2485"><a href="#ZakatTracker-2485"><span class="linenos">2485</span></a><span class="sd">        REF https://github.com/JayRizzo/Random_Scripts/blob/master/time_measure.py#L106</span>
</span><span id="ZakatTracker-2486"><a href="#ZakatTracker-2486"><span class="linenos">2486</span></a><span class="sd">        Convert NanoSeconds to Human Readable Time Format.</span>
</span><span id="ZakatTracker-2487"><a href="#ZakatTracker-2487"><span class="linenos">2487</span></a><span class="sd">        A NanoSeconds is a unit of time in the International System of Units (SI) equal</span>
</span><span id="ZakatTracker-2488"><a href="#ZakatTracker-2488"><span class="linenos">2488</span></a><span class="sd">        to one millionth (0.000001 or 10−6 or 1⁄1,000,000) of a second.</span>
</span><span id="ZakatTracker-2489"><a href="#ZakatTracker-2489"><span class="linenos">2489</span></a><span class="sd">        Its symbol is μs, sometimes simplified to us when Unicode is not available.</span>
</span><span id="ZakatTracker-2490"><a href="#ZakatTracker-2490"><span class="linenos">2490</span></a><span class="sd">        A microsecond is equal to 1000 nanoseconds or 1⁄1,000 of a millisecond.</span>
</span><span id="ZakatTracker-2491"><a href="#ZakatTracker-2491"><span class="linenos">2491</span></a>
</span><span id="ZakatTracker-2492"><a href="#ZakatTracker-2492"><span class="linenos">2492</span></a><span class="sd">        INPUT : ms (AKA: MilliSeconds)</span>
</span><span id="ZakatTracker-2493"><a href="#ZakatTracker-2493"><span class="linenos">2493</span></a><span class="sd">        OUTPUT: tuple(string time_lapsed, string spoken_time) like format.</span>
</span><span id="ZakatTracker-2494"><a href="#ZakatTracker-2494"><span class="linenos">2494</span></a><span class="sd">        OUTPUT Variables: time_lapsed, spoken_time</span>
</span><span id="ZakatTracker-2495"><a href="#ZakatTracker-2495"><span class="linenos">2495</span></a>
</span><span id="ZakatTracker-2496"><a href="#ZakatTracker-2496"><span class="linenos">2496</span></a><span class="sd">        Example  Input: duration_from_nanoseconds(ns)</span>
</span><span id="ZakatTracker-2497"><a href="#ZakatTracker-2497"><span class="linenos">2497</span></a><span class="sd">        **&quot;Millennium:Century:Years:Days:Hours:Minutes:Seconds:MilliSeconds:MicroSeconds:NanoSeconds&quot;**</span>
</span><span id="ZakatTracker-2498"><a href="#ZakatTracker-2498"><span class="linenos">2498</span></a><span class="sd">        Example Output: (&#39;039:0001:047:325:05:02:03:456:789:012&#39;, &#39; 39 Millennia,    1 Century,  47 Years,  325 Days,  5 Hours,  2 Minutes,  3 Seconds,  456 MilliSeconds,  789 MicroSeconds,  12 NanoSeconds&#39;)</span>
</span><span id="ZakatTracker-2499"><a href="#ZakatTracker-2499"><span class="linenos">2499</span></a><span class="sd">        duration_from_nanoseconds(1234567890123456789012)</span>
</span><span id="ZakatTracker-2500"><a href="#ZakatTracker-2500"><span class="linenos">2500</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2501"><a href="#ZakatTracker-2501"><span class="linenos">2501</span></a>        <span class="n">us</span><span class="p">,</span> <span class="n">ns</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</span><span id="ZakatTracker-2502"><a href="#ZakatTracker-2502"><span class="linenos">2502</span></a>        <span class="n">ms</span><span class="p">,</span> <span class="n">us</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">us</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</span><span id="ZakatTracker-2503"><a href="#ZakatTracker-2503"><span class="linenos">2503</span></a>        <span class="n">s</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</span><span id="ZakatTracker-2504"><a href="#ZakatTracker-2504"><span class="linenos">2504</span></a>        <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="ZakatTracker-2505"><a href="#ZakatTracker-2505"><span class="linenos">2505</span></a>        <span class="n">h</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="ZakatTracker-2506"><a href="#ZakatTracker-2506"><span class="linenos">2506</span></a>        <span class="n">d</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
</span><span id="ZakatTracker-2507"><a href="#ZakatTracker-2507"><span class="linenos">2507</span></a>        <span class="n">y</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">365</span><span class="p">)</span>
</span><span id="ZakatTracker-2508"><a href="#ZakatTracker-2508"><span class="linenos">2508</span></a>        <span class="n">c</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="ZakatTracker-2509"><a href="#ZakatTracker-2509"><span class="linenos">2509</span></a>        <span class="n">n</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="ZakatTracker-2510"><a href="#ZakatTracker-2510"><span class="linenos">2510</span></a>        <span class="n">time_lapsed</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">:</span><span class="s2">03.0f</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">c</span><span class="si">:</span><span class="s2">04.0f</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s2">03.0f</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">d</span><span class="si">:</span><span class="s2">03.0f</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2">02.0f</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2">02.0f</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">02.0f</span><span class="si">}</span><span class="s2">::</span><span class="si">{</span><span class="n">ms</span><span class="si">:</span><span class="s2">03.0f</span><span class="si">}</span><span class="s2">::</span><span class="si">{</span><span class="n">us</span><span class="si">:</span><span class="s2">03.0f</span><span class="si">}</span><span class="s2">::</span><span class="si">{</span><span class="n">ns</span><span class="si">:</span><span class="s2">03.0f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ZakatTracker-2511"><a href="#ZakatTracker-2511"><span class="linenos">2511</span></a>        <span class="n">spoken_time_part</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker-2512"><a href="#ZakatTracker-2512"><span class="linenos">2512</span></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker-2513"><a href="#ZakatTracker-2513"><span class="linenos">2513</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">:</span><span class="s2"> 3d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">millennia</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2514"><a href="#ZakatTracker-2514"><span class="linenos">2514</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker-2515"><a href="#ZakatTracker-2515"><span class="linenos">2515</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="si">:</span><span class="s2"> 4d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">century</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2516"><a href="#ZakatTracker-2516"><span class="linenos">2516</span></a>        <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker-2517"><a href="#ZakatTracker-2517"><span class="linenos">2517</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s2"> 3d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">years</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2518"><a href="#ZakatTracker-2518"><span class="linenos">2518</span></a>        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker-2519"><a href="#ZakatTracker-2519"><span class="linenos">2519</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="si">:</span><span class="s2"> 4d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2520"><a href="#ZakatTracker-2520"><span class="linenos">2520</span></a>        <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker-2521"><a href="#ZakatTracker-2521"><span class="linenos">2521</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2"> 2d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2522"><a href="#ZakatTracker-2522"><span class="linenos">2522</span></a>        <span class="k">if</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker-2523"><a href="#ZakatTracker-2523"><span class="linenos">2523</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2"> 2d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">minutes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2524"><a href="#ZakatTracker-2524"><span class="linenos">2524</span></a>        <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker-2525"><a href="#ZakatTracker-2525"><span class="linenos">2525</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2"> 2d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">seconds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2526"><a href="#ZakatTracker-2526"><span class="linenos">2526</span></a>        <span class="k">if</span> <span class="n">ms</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker-2527"><a href="#ZakatTracker-2527"><span class="linenos">2527</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ms</span><span class="si">:</span><span class="s2"> 3d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">milli_seconds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2528"><a href="#ZakatTracker-2528"><span class="linenos">2528</span></a>        <span class="k">if</span> <span class="n">us</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker-2529"><a href="#ZakatTracker-2529"><span class="linenos">2529</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">us</span><span class="si">:</span><span class="s2"> 3d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">micro_seconds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2530"><a href="#ZakatTracker-2530"><span class="linenos">2530</span></a>        <span class="k">if</span> <span class="n">ns</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker-2531"><a href="#ZakatTracker-2531"><span class="linenos">2531</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="si">:</span><span class="s2"> 3d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">nano_seconds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2532"><a href="#ZakatTracker-2532"><span class="linenos">2532</span></a>        <span class="k">return</span> <span class="n">time_lapsed</span><span class="p">,</span> <span class="n">spoken_time_separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">spoken_time_part</span><span class="p">)</span>
</span><span id="ZakatTracker-2533"><a href="#ZakatTracker-2533"><span class="linenos">2533</span></a>
</span><span id="ZakatTracker-2534"><a href="#ZakatTracker-2534"><span class="linenos">2534</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-2535"><a href="#ZakatTracker-2535"><span class="linenos">2535</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">day_to_time</span><span class="p">(</span><span class="n">day</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">month</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># افتراض أن الشهر هو يونيو والسنة 2024</span>
</span><span id="ZakatTracker-2536"><a href="#ZakatTracker-2536"><span class="linenos">2536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2537"><a href="#ZakatTracker-2537"><span class="linenos">2537</span></a><span class="sd">        Convert a specific day, month, and year into a timestamp.</span>
</span><span id="ZakatTracker-2538"><a href="#ZakatTracker-2538"><span class="linenos">2538</span></a>
</span><span id="ZakatTracker-2539"><a href="#ZakatTracker-2539"><span class="linenos">2539</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-2540"><a href="#ZakatTracker-2540"><span class="linenos">2540</span></a><span class="sd">        - day (int): The day of the month.</span>
</span><span id="ZakatTracker-2541"><a href="#ZakatTracker-2541"><span class="linenos">2541</span></a><span class="sd">        - month (int): The month of the year. Default is 6 (June).</span>
</span><span id="ZakatTracker-2542"><a href="#ZakatTracker-2542"><span class="linenos">2542</span></a><span class="sd">        - year (int): The year. Default is 2024.</span>
</span><span id="ZakatTracker-2543"><a href="#ZakatTracker-2543"><span class="linenos">2543</span></a>
</span><span id="ZakatTracker-2544"><a href="#ZakatTracker-2544"><span class="linenos">2544</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-2545"><a href="#ZakatTracker-2545"><span class="linenos">2545</span></a><span class="sd">        - int: The timestamp representing the given day, month, and year.</span>
</span><span id="ZakatTracker-2546"><a href="#ZakatTracker-2546"><span class="linenos">2546</span></a>
</span><span id="ZakatTracker-2547"><a href="#ZakatTracker-2547"><span class="linenos">2547</span></a><span class="sd">        Note:</span>
</span><span id="ZakatTracker-2548"><a href="#ZakatTracker-2548"><span class="linenos">2548</span></a><span class="sd">        This method assumes the default month and year if not provided.</span>
</span><span id="ZakatTracker-2549"><a href="#ZakatTracker-2549"><span class="linenos">2549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2550"><a href="#ZakatTracker-2550"><span class="linenos">2550</span></a>        <span class="k">return</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">))</span>
</span><span id="ZakatTracker-2551"><a href="#ZakatTracker-2551"><span class="linenos">2551</span></a>
</span><span id="ZakatTracker-2552"><a href="#ZakatTracker-2552"><span class="linenos">2552</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-2553"><a href="#ZakatTracker-2553"><span class="linenos">2553</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_random_date</span><span class="p">(</span><span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
</span><span id="ZakatTracker-2554"><a href="#ZakatTracker-2554"><span class="linenos">2554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2555"><a href="#ZakatTracker-2555"><span class="linenos">2555</span></a><span class="sd">        Generate a random date between two given dates.</span>
</span><span id="ZakatTracker-2556"><a href="#ZakatTracker-2556"><span class="linenos">2556</span></a>
</span><span id="ZakatTracker-2557"><a href="#ZakatTracker-2557"><span class="linenos">2557</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-2558"><a href="#ZakatTracker-2558"><span class="linenos">2558</span></a><span class="sd">        - start_date (datetime.datetime): The start date from which to generate a random date.</span>
</span><span id="ZakatTracker-2559"><a href="#ZakatTracker-2559"><span class="linenos">2559</span></a><span class="sd">        - end_date (datetime.datetime): The end date until which to generate a random date.</span>
</span><span id="ZakatTracker-2560"><a href="#ZakatTracker-2560"><span class="linenos">2560</span></a>
</span><span id="ZakatTracker-2561"><a href="#ZakatTracker-2561"><span class="linenos">2561</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-2562"><a href="#ZakatTracker-2562"><span class="linenos">2562</span></a><span class="sd">        - datetime.datetime: A random date between the start_date and end_date.</span>
</span><span id="ZakatTracker-2563"><a href="#ZakatTracker-2563"><span class="linenos">2563</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2564"><a href="#ZakatTracker-2564"><span class="linenos">2564</span></a>        <span class="n">time_between_dates</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">start_date</span>
</span><span id="ZakatTracker-2565"><a href="#ZakatTracker-2565"><span class="linenos">2565</span></a>        <span class="n">days_between_dates</span> <span class="o">=</span> <span class="n">time_between_dates</span><span class="o">.</span><span class="n">days</span>
</span><span id="ZakatTracker-2566"><a href="#ZakatTracker-2566"><span class="linenos">2566</span></a>        <span class="n">random_number_of_days</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">days_between_dates</span><span class="p">)</span>
</span><span id="ZakatTracker-2567"><a href="#ZakatTracker-2567"><span class="linenos">2567</span></a>        <span class="k">return</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random_number_of_days</span><span class="p">)</span>
</span><span id="ZakatTracker-2568"><a href="#ZakatTracker-2568"><span class="linenos">2568</span></a>
</span><span id="ZakatTracker-2569"><a href="#ZakatTracker-2569"><span class="linenos">2569</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-2570"><a href="#ZakatTracker-2570"><span class="linenos">2570</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_random_csv_file</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data.csv&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">with_rate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ZakatTracker-2571"><a href="#ZakatTracker-2571"><span class="linenos">2571</span></a>                                 <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker-2572"><a href="#ZakatTracker-2572"><span class="linenos">2572</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2573"><a href="#ZakatTracker-2573"><span class="linenos">2573</span></a><span class="sd">        Generate a random CSV file with specified parameters.</span>
</span><span id="ZakatTracker-2574"><a href="#ZakatTracker-2574"><span class="linenos">2574</span></a>
</span><span id="ZakatTracker-2575"><a href="#ZakatTracker-2575"><span class="linenos">2575</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-2576"><a href="#ZakatTracker-2576"><span class="linenos">2576</span></a><span class="sd">        - path (str): The path where the CSV file will be saved. Default is &quot;data.csv&quot;.</span>
</span><span id="ZakatTracker-2577"><a href="#ZakatTracker-2577"><span class="linenos">2577</span></a><span class="sd">        - count (int): The number of rows to generate in the CSV file. Default is 1000.</span>
</span><span id="ZakatTracker-2578"><a href="#ZakatTracker-2578"><span class="linenos">2578</span></a><span class="sd">        - with_rate (bool): If True, a random rate between 1.2% and 12% is added. Default is False.</span>
</span><span id="ZakatTracker-2579"><a href="#ZakatTracker-2579"><span class="linenos">2579</span></a><span class="sd">        - debug (bool): A flag indicating whether to print debug information.</span>
</span><span id="ZakatTracker-2580"><a href="#ZakatTracker-2580"><span class="linenos">2580</span></a>
</span><span id="ZakatTracker-2581"><a href="#ZakatTracker-2581"><span class="linenos">2581</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-2582"><a href="#ZakatTracker-2582"><span class="linenos">2582</span></a><span class="sd">        None. The function generates a CSV file at the specified path with the given count of rows.</span>
</span><span id="ZakatTracker-2583"><a href="#ZakatTracker-2583"><span class="linenos">2583</span></a><span class="sd">        Each row contains a randomly generated account, description, value, and date.</span>
</span><span id="ZakatTracker-2584"><a href="#ZakatTracker-2584"><span class="linenos">2584</span></a><span class="sd">        The value is randomly generated between 1000 and 100000,</span>
</span><span id="ZakatTracker-2585"><a href="#ZakatTracker-2585"><span class="linenos">2585</span></a><span class="sd">        and the date is randomly generated between 1950-01-01 and 2023-12-31.</span>
</span><span id="ZakatTracker-2586"><a href="#ZakatTracker-2586"><span class="linenos">2586</span></a><span class="sd">        If the row number is not divisible by 13, the value is multiplied by -1.</span>
</span><span id="ZakatTracker-2587"><a href="#ZakatTracker-2587"><span class="linenos">2587</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2588"><a href="#ZakatTracker-2588"><span class="linenos">2588</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2589"><a href="#ZakatTracker-2589"><span class="linenos">2589</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;generate_random_csv_file&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2590"><a href="#ZakatTracker-2590"><span class="linenos">2590</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2591"><a href="#ZakatTracker-2591"><span class="linenos">2591</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
</span><span id="ZakatTracker-2592"><a href="#ZakatTracker-2592"><span class="linenos">2592</span></a>            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
</span><span id="ZakatTracker-2593"><a href="#ZakatTracker-2593"><span class="linenos">2593</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span><span id="ZakatTracker-2594"><a href="#ZakatTracker-2594"><span class="linenos">2594</span></a>                <span class="n">account</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;acc-</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ZakatTracker-2595"><a href="#ZakatTracker-2595"><span class="linenos">2595</span></a>                <span class="n">desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Some text </span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ZakatTracker-2596"><a href="#ZakatTracker-2596"><span class="linenos">2596</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
</span><span id="ZakatTracker-2597"><a href="#ZakatTracker-2597"><span class="linenos">2597</span></a>                <span class="n">date</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">generate_random_date</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="ZakatTracker-2598"><a href="#ZakatTracker-2598"><span class="linenos">2598</span></a>                                                         <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2599"><a href="#ZakatTracker-2599"><span class="linenos">2599</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">13</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2600"><a href="#ZakatTracker-2600"><span class="linenos">2600</span></a>                    <span class="n">value</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="ZakatTracker-2601"><a href="#ZakatTracker-2601"><span class="linenos">2601</span></a>                <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">account</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">date</span><span class="p">]</span>
</span><span id="ZakatTracker-2602"><a href="#ZakatTracker-2602"><span class="linenos">2602</span></a>                <span class="k">if</span> <span class="n">with_rate</span><span class="p">:</span>
</span><span id="ZakatTracker-2603"><a href="#ZakatTracker-2603"><span class="linenos">2603</span></a>                    <span class="n">rate</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.12</span>
</span><span id="ZakatTracker-2604"><a href="#ZakatTracker-2604"><span class="linenos">2604</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2605"><a href="#ZakatTracker-2605"><span class="linenos">2605</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;before-append&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><span id="ZakatTracker-2606"><a href="#ZakatTracker-2606"><span class="linenos">2606</span></a>                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
</span><span id="ZakatTracker-2607"><a href="#ZakatTracker-2607"><span class="linenos">2607</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2608"><a href="#ZakatTracker-2608"><span class="linenos">2608</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after-append&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><span id="ZakatTracker-2609"><a href="#ZakatTracker-2609"><span class="linenos">2609</span></a>                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="ZakatTracker-2610"><a href="#ZakatTracker-2610"><span class="linenos">2610</span></a>                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ZakatTracker-2611"><a href="#ZakatTracker-2611"><span class="linenos">2611</span></a>        <span class="k">return</span> <span class="n">i</span>
</span><span id="ZakatTracker-2612"><a href="#ZakatTracker-2612"><span class="linenos">2612</span></a>
</span><span id="ZakatTracker-2613"><a href="#ZakatTracker-2613"><span class="linenos">2613</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker-2614"><a href="#ZakatTracker-2614"><span class="linenos">2614</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_random_list</span><span class="p">(</span><span class="n">max_sum</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
</span><span id="ZakatTracker-2615"><a href="#ZakatTracker-2615"><span class="linenos">2615</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2616"><a href="#ZakatTracker-2616"><span class="linenos">2616</span></a><span class="sd">        Creates a list of random integers whose sum does not exceed the specified maximum.</span>
</span><span id="ZakatTracker-2617"><a href="#ZakatTracker-2617"><span class="linenos">2617</span></a>
</span><span id="ZakatTracker-2618"><a href="#ZakatTracker-2618"><span class="linenos">2618</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker-2619"><a href="#ZakatTracker-2619"><span class="linenos">2619</span></a><span class="sd">        - max_sum: The maximum allowed sum of the list elements.</span>
</span><span id="ZakatTracker-2620"><a href="#ZakatTracker-2620"><span class="linenos">2620</span></a><span class="sd">        - min_value: The minimum possible value for an element (inclusive).</span>
</span><span id="ZakatTracker-2621"><a href="#ZakatTracker-2621"><span class="linenos">2621</span></a><span class="sd">        - max_value: The maximum possible value for an element (inclusive).</span>
</span><span id="ZakatTracker-2622"><a href="#ZakatTracker-2622"><span class="linenos">2622</span></a>
</span><span id="ZakatTracker-2623"><a href="#ZakatTracker-2623"><span class="linenos">2623</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker-2624"><a href="#ZakatTracker-2624"><span class="linenos">2624</span></a><span class="sd">        - A list of random integers.</span>
</span><span id="ZakatTracker-2625"><a href="#ZakatTracker-2625"><span class="linenos">2625</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker-2626"><a href="#ZakatTracker-2626"><span class="linenos">2626</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker-2627"><a href="#ZakatTracker-2627"><span class="linenos">2627</span></a>        <span class="n">current_sum</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2628"><a href="#ZakatTracker-2628"><span class="linenos">2628</span></a>
</span><span id="ZakatTracker-2629"><a href="#ZakatTracker-2629"><span class="linenos">2629</span></a>        <span class="k">while</span> <span class="n">current_sum</span> <span class="o">&lt;</span> <span class="n">max_sum</span><span class="p">:</span>
</span><span id="ZakatTracker-2630"><a href="#ZakatTracker-2630"><span class="linenos">2630</span></a>            <span class="c1"># Calculate the remaining space for the next element</span>
</span><span id="ZakatTracker-2631"><a href="#ZakatTracker-2631"><span class="linenos">2631</span></a>            <span class="n">remaining_sum</span> <span class="o">=</span> <span class="n">max_sum</span> <span class="o">-</span> <span class="n">current_sum</span>
</span><span id="ZakatTracker-2632"><a href="#ZakatTracker-2632"><span class="linenos">2632</span></a>            <span class="c1"># Determine the maximum possible value for the next element</span>
</span><span id="ZakatTracker-2633"><a href="#ZakatTracker-2633"><span class="linenos">2633</span></a>            <span class="n">next_max_value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">remaining_sum</span><span class="p">,</span> <span class="n">max_value</span><span class="p">)</span>
</span><span id="ZakatTracker-2634"><a href="#ZakatTracker-2634"><span class="linenos">2634</span></a>            <span class="c1"># Generate a random element within the allowed range</span>
</span><span id="ZakatTracker-2635"><a href="#ZakatTracker-2635"><span class="linenos">2635</span></a>            <span class="n">next_element</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">next_max_value</span><span class="p">)</span>
</span><span id="ZakatTracker-2636"><a href="#ZakatTracker-2636"><span class="linenos">2636</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_element</span><span class="p">)</span>
</span><span id="ZakatTracker-2637"><a href="#ZakatTracker-2637"><span class="linenos">2637</span></a>            <span class="n">current_sum</span> <span class="o">+=</span> <span class="n">next_element</span>
</span><span id="ZakatTracker-2638"><a href="#ZakatTracker-2638"><span class="linenos">2638</span></a>
</span><span id="ZakatTracker-2639"><a href="#ZakatTracker-2639"><span class="linenos">2639</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="ZakatTracker-2640"><a href="#ZakatTracker-2640"><span class="linenos">2640</span></a>
</span><span id="ZakatTracker-2641"><a href="#ZakatTracker-2641"><span class="linenos">2641</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_test_core</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restore</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="ZakatTracker-2642"><a href="#ZakatTracker-2642"><span class="linenos">2642</span></a>
</span><span id="ZakatTracker-2643"><a href="#ZakatTracker-2643"><span class="linenos">2643</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2644"><a href="#ZakatTracker-2644"><span class="linenos">2644</span></a>            <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234567890</span><span class="p">)</span>
</span><span id="ZakatTracker-2645"><a href="#ZakatTracker-2645"><span class="linenos">2645</span></a>
</span><span id="ZakatTracker-2646"><a href="#ZakatTracker-2646"><span class="linenos">2646</span></a>        <span class="n">test_cases</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ZakatTracker-2647"><a href="#ZakatTracker-2647"><span class="linenos">2647</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="ZakatTracker-2648"><a href="#ZakatTracker-2648"><span class="linenos">2648</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="ZakatTracker-2649"><a href="#ZakatTracker-2649"><span class="linenos">2649</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1969</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span>
</span><span id="ZakatTracker-2650"><a href="#ZakatTracker-2650"><span class="linenos">2650</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
</span><span id="ZakatTracker-2651"><a href="#ZakatTracker-2651"><span class="linenos">2651</span></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">9999</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">),</span>
</span><span id="ZakatTracker-2652"><a href="#ZakatTracker-2652"><span class="linenos">2652</span></a>        <span class="p">]</span>
</span><span id="ZakatTracker-2653"><a href="#ZakatTracker-2653"><span class="linenos">2653</span></a>        
</span><span id="ZakatTracker-2654"><a href="#ZakatTracker-2654"><span class="linenos">2654</span></a>        <span class="k">for</span> <span class="n">test_date</span> <span class="ow">in</span> <span class="n">test_cases</span><span class="p">:</span>
</span><span id="ZakatTracker-2655"><a href="#ZakatTracker-2655"><span class="linenos">2655</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">test_date</span><span class="p">)</span>
</span><span id="ZakatTracker-2656"><a href="#ZakatTracker-2656"><span class="linenos">2656</span></a>            <span class="n">converted</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time_to_datetime</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="ZakatTracker-2657"><a href="#ZakatTracker-2657"><span class="linenos">2657</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2658"><a href="#ZakatTracker-2658"><span class="linenos">2658</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2"> &lt;=&gt; </span><span class="si">{</span><span class="n">converted</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2659"><a href="#ZakatTracker-2659"><span class="linenos">2659</span></a>            <span class="k">assert</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2660"><a href="#ZakatTracker-2660"><span class="linenos">2660</span></a>            <span class="k">assert</span> <span class="n">test_date</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">converted</span><span class="o">.</span><span class="n">year</span>
</span><span id="ZakatTracker-2661"><a href="#ZakatTracker-2661"><span class="linenos">2661</span></a>            <span class="k">assert</span> <span class="n">test_date</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="n">converted</span><span class="o">.</span><span class="n">month</span>
</span><span id="ZakatTracker-2662"><a href="#ZakatTracker-2662"><span class="linenos">2662</span></a>            <span class="k">assert</span> <span class="n">test_date</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">converted</span><span class="o">.</span><span class="n">day</span>
</span><span id="ZakatTracker-2663"><a href="#ZakatTracker-2663"><span class="linenos">2663</span></a>            <span class="k">assert</span> <span class="n">test_date</span><span class="o">.</span><span class="n">hour</span> <span class="o">==</span> <span class="n">converted</span><span class="o">.</span><span class="n">hour</span>
</span><span id="ZakatTracker-2664"><a href="#ZakatTracker-2664"><span class="linenos">2664</span></a>            <span class="k">assert</span> <span class="n">test_date</span><span class="o">.</span><span class="n">minute</span> <span class="o">==</span> <span class="n">converted</span><span class="o">.</span><span class="n">minute</span>
</span><span id="ZakatTracker-2665"><a href="#ZakatTracker-2665"><span class="linenos">2665</span></a>            <span class="k">assert</span> <span class="n">test_date</span><span class="o">.</span><span class="n">second</span> <span class="ow">in</span> <span class="p">[</span><span class="n">converted</span><span class="o">.</span><span class="n">second</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">converted</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="n">converted</span><span class="o">.</span><span class="n">second</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker-2666"><a href="#ZakatTracker-2666"><span class="linenos">2666</span></a>
</span><span id="ZakatTracker-2667"><a href="#ZakatTracker-2667"><span class="linenos">2667</span></a>        <span class="c1"># sanity check - random forward time</span>
</span><span id="ZakatTracker-2668"><a href="#ZakatTracker-2668"><span class="linenos">2668</span></a>
</span><span id="ZakatTracker-2669"><a href="#ZakatTracker-2669"><span class="linenos">2669</span></a>        <span class="n">xlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker-2670"><a href="#ZakatTracker-2670"><span class="linenos">2670</span></a>        <span class="n">limit</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="ZakatTracker-2671"><a href="#ZakatTracker-2671"><span class="linenos">2671</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>
</span><span id="ZakatTracker-2672"><a href="#ZakatTracker-2672"><span class="linenos">2672</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker-2673"><a href="#ZakatTracker-2673"><span class="linenos">2673</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
</span><span id="ZakatTracker-2674"><a href="#ZakatTracker-2674"><span class="linenos">2674</span></a>            <span class="k">if</span> <span class="n">y</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xlist</span><span class="p">:</span>
</span><span id="ZakatTracker-2675"><a href="#ZakatTracker-2675"><span class="linenos">2675</span></a>                <span class="n">xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker-2676"><a href="#ZakatTracker-2676"><span class="linenos">2676</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker-2677"><a href="#ZakatTracker-2677"><span class="linenos">2677</span></a>                <span class="n">z</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
</span><span id="ZakatTracker-2678"><a href="#ZakatTracker-2678"><span class="linenos">2678</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2679"><a href="#ZakatTracker-2679"><span class="linenos">2679</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker-2680"><a href="#ZakatTracker-2680"><span class="linenos">2680</span></a>        <span class="n">xx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlist</span><span class="p">)</span>
</span><span id="ZakatTracker-2681"><a href="#ZakatTracker-2681"><span class="linenos">2681</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2682"><a href="#ZakatTracker-2682"><span class="linenos">2682</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="s1">&#39; - unique: &#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">xx</span> <span class="o">/</span> <span class="n">limit</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2683"><a href="#ZakatTracker-2683"><span class="linenos">2683</span></a>        <span class="k">assert</span> <span class="n">limit</span> <span class="o">==</span> <span class="n">xx</span>
</span><span id="ZakatTracker-2684"><a href="#ZakatTracker-2684"><span class="linenos">2684</span></a>
</span><span id="ZakatTracker-2685"><a href="#ZakatTracker-2685"><span class="linenos">2685</span></a>        <span class="c1"># sanity check - convert date since 1AD to 9999AD</span>
</span><span id="ZakatTracker-2686"><a href="#ZakatTracker-2686"><span class="linenos">2686</span></a>
</span><span id="ZakatTracker-2687"><a href="#ZakatTracker-2687"><span class="linenos">2687</span></a>        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">):</span>
</span><span id="ZakatTracker-2688"><a href="#ZakatTracker-2688"><span class="linenos">2688</span></a>            <span class="n">ns</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">-12-30 18:30:45&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">))</span>
</span><span id="ZakatTracker-2689"><a href="#ZakatTracker-2689"><span class="linenos">2689</span></a>            <span class="n">date</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time_to_datetime</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
</span><span id="ZakatTracker-2690"><a href="#ZakatTracker-2690"><span class="linenos">2690</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2691"><a href="#ZakatTracker-2691"><span class="linenos">2691</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
</span><span id="ZakatTracker-2692"><a href="#ZakatTracker-2692"><span class="linenos">2692</span></a>            <span class="k">assert</span> <span class="n">ns</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2693"><a href="#ZakatTracker-2693"><span class="linenos">2693</span></a>            <span class="k">assert</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">year</span>
</span><span id="ZakatTracker-2694"><a href="#ZakatTracker-2694"><span class="linenos">2694</span></a>            <span class="k">assert</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">12</span>
</span><span id="ZakatTracker-2695"><a href="#ZakatTracker-2695"><span class="linenos">2695</span></a>            <span class="k">assert</span> <span class="n">date</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">30</span>
</span><span id="ZakatTracker-2696"><a href="#ZakatTracker-2696"><span class="linenos">2696</span></a>            <span class="k">assert</span> <span class="n">date</span><span class="o">.</span><span class="n">hour</span> <span class="o">==</span> <span class="mi">18</span>
</span><span id="ZakatTracker-2697"><a href="#ZakatTracker-2697"><span class="linenos">2697</span></a>            <span class="k">assert</span> <span class="n">date</span><span class="o">.</span><span class="n">minute</span> <span class="o">==</span> <span class="mi">30</span>
</span><span id="ZakatTracker-2698"><a href="#ZakatTracker-2698"><span class="linenos">2698</span></a>            <span class="k">assert</span> <span class="n">date</span><span class="o">.</span><span class="n">second</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">44</span><span class="p">,</span> <span class="mi">45</span><span class="p">]</span>
</span><span id="ZakatTracker-2699"><a href="#ZakatTracker-2699"><span class="linenos">2699</span></a>
</span><span id="ZakatTracker-2700"><a href="#ZakatTracker-2700"><span class="linenos">2700</span></a>        <span class="c1"># human_readable_size</span>
</span><span id="ZakatTracker-2701"><a href="#ZakatTracker-2701"><span class="linenos">2701</span></a>
</span><span id="ZakatTracker-2702"><a href="#ZakatTracker-2702"><span class="linenos">2702</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;0.00 B&quot;</span>
</span><span id="ZakatTracker-2703"><a href="#ZakatTracker-2703"><span class="linenos">2703</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;512.00 B&quot;</span>
</span><span id="ZakatTracker-2704"><a href="#ZakatTracker-2704"><span class="linenos">2704</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mi">1023</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1023.00 B&quot;</span>
</span><span id="ZakatTracker-2705"><a href="#ZakatTracker-2705"><span class="linenos">2705</span></a>
</span><span id="ZakatTracker-2706"><a href="#ZakatTracker-2706"><span class="linenos">2706</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1.00 KB&quot;</span>
</span><span id="ZakatTracker-2707"><a href="#ZakatTracker-2707"><span class="linenos">2707</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;2.00 KB&quot;</span>
</span><span id="ZakatTracker-2708"><a href="#ZakatTracker-2708"><span class="linenos">2708</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mi">5120</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;5.00 KB&quot;</span>
</span><span id="ZakatTracker-2709"><a href="#ZakatTracker-2709"><span class="linenos">2709</span></a>
</span><span id="ZakatTracker-2710"><a href="#ZakatTracker-2710"><span class="linenos">2710</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mi">1024</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1.00 MB&quot;</span>
</span><span id="ZakatTracker-2711"><a href="#ZakatTracker-2711"><span class="linenos">2711</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;2.50 MB&quot;</span>
</span><span id="ZakatTracker-2712"><a href="#ZakatTracker-2712"><span class="linenos">2712</span></a>
</span><span id="ZakatTracker-2713"><a href="#ZakatTracker-2713"><span class="linenos">2713</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mi">1024</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1.00 GB&quot;</span>
</span><span id="ZakatTracker-2714"><a href="#ZakatTracker-2714"><span class="linenos">2714</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mi">1024</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1.00 TB&quot;</span>
</span><span id="ZakatTracker-2715"><a href="#ZakatTracker-2715"><span class="linenos">2715</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mi">1024</span> <span class="o">**</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1.00 PB&quot;</span>
</span><span id="ZakatTracker-2716"><a href="#ZakatTracker-2716"><span class="linenos">2716</span></a>
</span><span id="ZakatTracker-2717"><a href="#ZakatTracker-2717"><span class="linenos">2717</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mi">1536</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;2 KB&quot;</span>
</span><span id="ZakatTracker-2718"><a href="#ZakatTracker-2718"><span class="linenos">2718</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;2.5 MB&quot;</span>
</span><span id="ZakatTracker-2719"><a href="#ZakatTracker-2719"><span class="linenos">2719</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mi">1234567890</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1.150 GB&quot;</span>
</span><span id="ZakatTracker-2720"><a href="#ZakatTracker-2720"><span class="linenos">2720</span></a>
</span><span id="ZakatTracker-2721"><a href="#ZakatTracker-2721"><span class="linenos">2721</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-2722"><a href="#ZakatTracker-2722"><span class="linenos">2722</span></a>            <span class="c1"># noinspection PyTypeChecker</span>
</span><span id="ZakatTracker-2723"><a href="#ZakatTracker-2723"><span class="linenos">2723</span></a>            <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="s2">&quot;not a number&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2724"><a href="#ZakatTracker-2724"><span class="linenos">2724</span></a>            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Expected TypeError for invalid input&quot;</span>
</span><span id="ZakatTracker-2725"><a href="#ZakatTracker-2725"><span class="linenos">2725</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="ZakatTracker-2726"><a href="#ZakatTracker-2726"><span class="linenos">2726</span></a>            <span class="k">pass</span>
</span><span id="ZakatTracker-2727"><a href="#ZakatTracker-2727"><span class="linenos">2727</span></a>
</span><span id="ZakatTracker-2728"><a href="#ZakatTracker-2728"><span class="linenos">2728</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-2729"><a href="#ZakatTracker-2729"><span class="linenos">2729</span></a>            <span class="c1"># noinspection PyTypeChecker</span>
</span><span id="ZakatTracker-2730"><a href="#ZakatTracker-2730"><span class="linenos">2730</span></a>            <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="s2">&quot;not an int&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-2731"><a href="#ZakatTracker-2731"><span class="linenos">2731</span></a>            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Expected TypeError for invalid decimal_places&quot;</span>
</span><span id="ZakatTracker-2732"><a href="#ZakatTracker-2732"><span class="linenos">2732</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="ZakatTracker-2733"><a href="#ZakatTracker-2733"><span class="linenos">2733</span></a>            <span class="k">pass</span>
</span><span id="ZakatTracker-2734"><a href="#ZakatTracker-2734"><span class="linenos">2734</span></a>
</span><span id="ZakatTracker-2735"><a href="#ZakatTracker-2735"><span class="linenos">2735</span></a>        <span class="c1"># get_dict_size</span>
</span><span id="ZakatTracker-2736"><a href="#ZakatTracker-2736"><span class="linenos">2736</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">get_dict_size</span><span class="p">({})</span> <span class="o">==</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">({}),</span> <span class="s2">&quot;Empty dictionary size mismatch&quot;</span>
</span><span id="ZakatTracker-2737"><a href="#ZakatTracker-2737"><span class="linenos">2737</span></a>        <span class="k">assert</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">get_dict_size</span><span class="p">({</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">({}),</span> <span class="s2">&quot;Not Empty dictionary&quot;</span>
</span><span id="ZakatTracker-2738"><a href="#ZakatTracker-2738"><span class="linenos">2738</span></a>
</span><span id="ZakatTracker-2739"><a href="#ZakatTracker-2739"><span class="linenos">2739</span></a>        <span class="c1"># number scale</span>
</span><span id="ZakatTracker-2740"><a href="#ZakatTracker-2740"><span class="linenos">2740</span></a>        <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2741"><a href="#ZakatTracker-2741"><span class="linenos">2741</span></a>        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2742"><a href="#ZakatTracker-2742"><span class="linenos">2742</span></a>        <span class="k">for</span> <span class="n">sign</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-2743"><a href="#ZakatTracker-2743"><span class="linenos">2743</span></a>            <span class="k">for</span> <span class="n">max_i</span><span class="p">,</span> <span class="n">max_j</span><span class="p">,</span> <span class="n">decimal_places</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="ZakatTracker-2744"><a href="#ZakatTracker-2744"><span class="linenos">2744</span></a>                <span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>  <span class="c1"># fiat currency minimum unit took 2 decimal places</span>
</span><span id="ZakatTracker-2745"><a href="#ZakatTracker-2745"><span class="linenos">2745</span></a>                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1_000</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>  <span class="c1"># cryptocurrency like Satoshi in Bitcoin took 8 decimal places</span>
</span><span id="ZakatTracker-2746"><a href="#ZakatTracker-2746"><span class="linenos">2746</span></a>                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1_000</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>  <span class="c1"># cryptocurrency like Wei in Ethereum took 18 decimal places</span>
</span><span id="ZakatTracker-2747"><a href="#ZakatTracker-2747"><span class="linenos">2747</span></a>            <span class="p">]:</span>
</span><span id="ZakatTracker-2748"><a href="#ZakatTracker-2748"><span class="linenos">2748</span></a>                <span class="k">for</span> <span class="n">return_type</span> <span class="ow">in</span> <span class="p">(</span>
</span><span id="ZakatTracker-2749"><a href="#ZakatTracker-2749"><span class="linenos">2749</span></a>                        <span class="nb">float</span><span class="p">,</span>
</span><span id="ZakatTracker-2750"><a href="#ZakatTracker-2750"><span class="linenos">2750</span></a>                        <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">,</span>
</span><span id="ZakatTracker-2751"><a href="#ZakatTracker-2751"><span class="linenos">2751</span></a>                <span class="p">):</span>
</span><span id="ZakatTracker-2752"><a href="#ZakatTracker-2752"><span class="linenos">2752</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_i</span><span class="p">):</span>
</span><span id="ZakatTracker-2753"><a href="#ZakatTracker-2753"><span class="linenos">2753</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_j</span><span class="p">):</span>
</span><span id="ZakatTracker-2754"><a href="#ZakatTracker-2754"><span class="linenos">2754</span></a>                            <span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-2755"><a href="#ZakatTracker-2755"><span class="linenos">2755</span></a>                            <span class="n">num_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">sign</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">j</span><span class="si">:</span><span class="s1">0</span><span class="si">{</span><span class="n">decimal_places</span><span class="si">}</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ZakatTracker-2756"><a href="#ZakatTracker-2756"><span class="linenos">2756</span></a>                            <span class="n">num</span> <span class="o">=</span> <span class="n">return_type</span><span class="p">(</span><span class="n">num_str</span><span class="p">)</span>
</span><span id="ZakatTracker-2757"><a href="#ZakatTracker-2757"><span class="linenos">2757</span></a>                            <span class="n">scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">)</span>
</span><span id="ZakatTracker-2758"><a href="#ZakatTracker-2758"><span class="linenos">2758</span></a>                            <span class="n">unscaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span><span class="n">scaled</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">)</span>
</span><span id="ZakatTracker-2759"><a href="#ZakatTracker-2759"><span class="linenos">2759</span></a>                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2760"><a href="#ZakatTracker-2760"><span class="linenos">2760</span></a>                                <span class="nb">print</span><span class="p">(</span>
</span><span id="ZakatTracker-2761"><a href="#ZakatTracker-2761"><span class="linenos">2761</span></a>                                    <span class="sa">f</span><span class="s1">&#39;return_type: </span><span class="si">{</span><span class="n">return_type</span><span class="si">}</span><span class="s1">, num_str: </span><span class="si">{</span><span class="n">num_str</span><span class="si">}</span><span class="s1"> - num: </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s1"> - scaled: </span><span class="si">{</span><span class="n">scaled</span><span class="si">}</span><span class="s1"> - unscaled: </span><span class="si">{</span><span class="n">unscaled</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2762"><a href="#ZakatTracker-2762"><span class="linenos">2762</span></a>                            <span class="k">if</span> <span class="n">unscaled</span> <span class="o">!=</span> <span class="n">num</span><span class="p">:</span>
</span><span id="ZakatTracker-2763"><a href="#ZakatTracker-2763"><span class="linenos">2763</span></a>                                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2764"><a href="#ZakatTracker-2764"><span class="linenos">2764</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;***** SCALE ERROR *****&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2765"><a href="#ZakatTracker-2765"><span class="linenos">2765</span></a>                                <span class="n">error</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-2766"><a href="#ZakatTracker-2766"><span class="linenos">2766</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2767"><a href="#ZakatTracker-2767"><span class="linenos">2767</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;total: </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s1">, error(</span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s1">): </span><span class="si">{</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2768"><a href="#ZakatTracker-2768"><span class="linenos">2768</span></a>        <span class="k">assert</span> <span class="n">error</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2769"><a href="#ZakatTracker-2769"><span class="linenos">2769</span></a>
</span><span id="ZakatTracker-2770"><a href="#ZakatTracker-2770"><span class="linenos">2770</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-2771"><a href="#ZakatTracker-2771"><span class="linenos">2771</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="ZakatTracker-2772"><a href="#ZakatTracker-2772"><span class="linenos">2772</span></a>
</span><span id="ZakatTracker-2773"><a href="#ZakatTracker-2773"><span class="linenos">2773</span></a>        <span class="n">table</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-2774"><a href="#ZakatTracker-2774"><span class="linenos">2774</span></a>            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span>
</span><span id="ZakatTracker-2775"><a href="#ZakatTracker-2775"><span class="linenos">2775</span></a>                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="ZakatTracker-2776"><a href="#ZakatTracker-2776"><span class="linenos">2776</span></a>                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="ZakatTracker-2777"><a href="#ZakatTracker-2777"><span class="linenos">2777</span></a>                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">6000</span><span class="p">,</span> <span class="mi">6000</span><span class="p">,</span> <span class="mi">6000</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="ZakatTracker-2778"><a href="#ZakatTracker-2778"><span class="linenos">2778</span></a>                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">4500</span><span class="p">,</span> <span class="mi">4500</span><span class="p">,</span> <span class="mi">4500</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="ZakatTracker-2779"><a href="#ZakatTracker-2779"><span class="linenos">2779</span></a>                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span><span id="ZakatTracker-2780"><a href="#ZakatTracker-2780"><span class="linenos">2780</span></a>                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">10500</span><span class="p">,</span> <span class="o">-</span><span class="mi">10500</span><span class="p">,</span> <span class="o">-</span><span class="mi">10500</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="ZakatTracker-2781"><a href="#ZakatTracker-2781"><span class="linenos">2781</span></a>            <span class="p">],</span>
</span><span id="ZakatTracker-2782"><a href="#ZakatTracker-2782"><span class="linenos">2782</span></a>            <span class="s1">&#39;wallet&#39;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="ZakatTracker-2783"><a href="#ZakatTracker-2783"><span class="linenos">2783</span></a>                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">9000</span><span class="p">,</span> <span class="o">-</span><span class="mi">9000</span><span class="p">,</span> <span class="o">-</span><span class="mi">9000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="ZakatTracker-2784"><a href="#ZakatTracker-2784"><span class="linenos">2784</span></a>                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="ZakatTracker-2785"><a href="#ZakatTracker-2785"><span class="linenos">2785</span></a>                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="o">-</span><span class="mi">18000</span><span class="p">,</span> <span class="o">-</span><span class="mi">18000</span><span class="p">,</span> <span class="o">-</span><span class="mi">18000</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="ZakatTracker-2786"><a href="#ZakatTracker-2786"><span class="linenos">2786</span></a>                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">82000</span><span class="p">,</span> <span class="mi">82000</span><span class="p">,</span> <span class="mi">82000</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="ZakatTracker-2787"><a href="#ZakatTracker-2787"><span class="linenos">2787</span></a>            <span class="p">],</span>
</span><span id="ZakatTracker-2788"><a href="#ZakatTracker-2788"><span class="linenos">2788</span></a>        <span class="p">}</span>
</span><span id="ZakatTracker-2789"><a href="#ZakatTracker-2789"><span class="linenos">2789</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
</span><span id="ZakatTracker-2790"><a href="#ZakatTracker-2790"><span class="linenos">2790</span></a>            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">table</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span>
</span><span id="ZakatTracker-2791"><a href="#ZakatTracker-2791"><span class="linenos">2791</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker-2792"><a href="#ZakatTracker-2792"><span class="linenos">2792</span></a>                <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-2793"><a href="#ZakatTracker-2793"><span class="linenos">2793</span></a>                    <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span>
</span><span id="ZakatTracker-2794"><a href="#ZakatTracker-2794"><span class="linenos">2794</span></a>                        <span class="n">unscaled_value</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ZakatTracker-2795"><a href="#ZakatTracker-2795"><span class="linenos">2795</span></a>                        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;test-add&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2796"><a href="#ZakatTracker-2796"><span class="linenos">2796</span></a>                        <span class="n">account</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
</span><span id="ZakatTracker-2797"><a href="#ZakatTracker-2797"><span class="linenos">2797</span></a>                        <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ZakatTracker-2798"><a href="#ZakatTracker-2798"><span class="linenos">2798</span></a>                        <span class="n">created</span><span class="o">=</span><span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
</span><span id="ZakatTracker-2799"><a href="#ZakatTracker-2799"><span class="linenos">2799</span></a>                        <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="ZakatTracker-2800"><a href="#ZakatTracker-2800"><span class="linenos">2800</span></a>                    <span class="p">)</span>
</span><span id="ZakatTracker-2801"><a href="#ZakatTracker-2801"><span class="linenos">2801</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker-2802"><a href="#ZakatTracker-2802"><span class="linenos">2802</span></a>                    <span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
</span><span id="ZakatTracker-2803"><a href="#ZakatTracker-2803"><span class="linenos">2803</span></a>                        <span class="n">unscaled_value</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ZakatTracker-2804"><a href="#ZakatTracker-2804"><span class="linenos">2804</span></a>                        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;test-sub&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2805"><a href="#ZakatTracker-2805"><span class="linenos">2805</span></a>                        <span class="n">account</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
</span><span id="ZakatTracker-2806"><a href="#ZakatTracker-2806"><span class="linenos">2806</span></a>                        <span class="n">created</span><span class="o">=</span><span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
</span><span id="ZakatTracker-2807"><a href="#ZakatTracker-2807"><span class="linenos">2807</span></a>                    <span class="p">)</span>
</span><span id="ZakatTracker-2808"><a href="#ZakatTracker-2808"><span class="linenos">2808</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2809"><a href="#ZakatTracker-2809"><span class="linenos">2809</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;_sub&#39;</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="ZakatTracker-2810"><a href="#ZakatTracker-2810"><span class="linenos">2810</span></a>                <span class="k">assert</span> <span class="n">ref</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2811"><a href="#ZakatTracker-2811"><span class="linenos">2811</span></a>                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2812"><a href="#ZakatTracker-2812"><span class="linenos">2812</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="ZakatTracker-2813"><a href="#ZakatTracker-2813"><span class="linenos">2813</span></a>                    <span class="n">file_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="s1">&#39;file_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span id="ZakatTracker-2814"><a href="#ZakatTracker-2814"><span class="linenos">2814</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.0000001</span><span class="p">)</span>
</span><span id="ZakatTracker-2815"><a href="#ZakatTracker-2815"><span class="linenos">2815</span></a>                    <span class="k">assert</span> <span class="n">file_ref</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2816"><a href="#ZakatTracker-2816"><span class="linenos">2816</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2817"><a href="#ZakatTracker-2817"><span class="linenos">2817</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ref&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">file_ref</span><span class="p">)</span>
</span><span id="ZakatTracker-2818"><a href="#ZakatTracker-2818"><span class="linenos">2818</span></a>                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ZakatTracker-2819"><a href="#ZakatTracker-2819"><span class="linenos">2819</span></a>                <span class="n">file_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="s1">&#39;file_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span><span id="ZakatTracker-2820"><a href="#ZakatTracker-2820"><span class="linenos">2820</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_file</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">file_ref</span><span class="p">)</span>
</span><span id="ZakatTracker-2821"><a href="#ZakatTracker-2821"><span class="linenos">2821</span></a>                <span class="n">daily_logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daily_logs</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-2822"><a href="#ZakatTracker-2822"><span class="linenos">2822</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2823"><a href="#ZakatTracker-2823"><span class="linenos">2823</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;daily_logs&#39;</span><span class="p">,</span> <span class="n">daily_logs</span><span class="p">)</span>
</span><span id="ZakatTracker-2824"><a href="#ZakatTracker-2824"><span class="linenos">2824</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">daily_logs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker-2825"><a href="#ZakatTracker-2825"><span class="linenos">2825</span></a>                    <span class="k">assert</span> <span class="n">k</span>
</span><span id="ZakatTracker-2826"><a href="#ZakatTracker-2826"><span class="linenos">2826</span></a>                    <span class="k">assert</span> <span class="n">v</span>
</span><span id="ZakatTracker-2827"><a href="#ZakatTracker-2827"><span class="linenos">2827</span></a>                <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker-2828"><a href="#ZakatTracker-2828"><span class="linenos">2828</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2829"><a href="#ZakatTracker-2829"><span class="linenos">2829</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;debug-0&quot;</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker-2830"><a href="#ZakatTracker-2830"><span class="linenos">2830</span></a>                <span class="k">assert</span> <span class="n">z</span> <span class="o">==</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ZakatTracker-2831"><a href="#ZakatTracker-2831"><span class="linenos">2831</span></a>                <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker-2832"><a href="#ZakatTracker-2832"><span class="linenos">2832</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2833"><a href="#ZakatTracker-2833"><span class="linenos">2833</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;debug-1&quot;</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="ZakatTracker-2834"><a href="#ZakatTracker-2834"><span class="linenos">2834</span></a>                <span class="k">assert</span> <span class="n">z</span> <span class="o">==</span> <span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="ZakatTracker-2835"><a href="#ZakatTracker-2835"><span class="linenos">2835</span></a>                <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-2836"><a href="#ZakatTracker-2836"><span class="linenos">2836</span></a>                <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2837"><a href="#ZakatTracker-2837"><span class="linenos">2837</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span>
</span><span id="ZakatTracker-2838"><a href="#ZakatTracker-2838"><span class="linenos">2838</span></a>                    <span class="n">z</span> <span class="o">+=</span> <span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-2839"><a href="#ZakatTracker-2839"><span class="linenos">2839</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2840"><a href="#ZakatTracker-2840"><span class="linenos">2840</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;debug-2&quot;</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</span><span id="ZakatTracker-2841"><a href="#ZakatTracker-2841"><span class="linenos">2841</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;debug-2&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
</span><span id="ZakatTracker-2842"><a href="#ZakatTracker-2842"><span class="linenos">2842</span></a>                <span class="k">assert</span> <span class="n">z</span> <span class="o">==</span> <span class="n">y</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="ZakatTracker-2843"><a href="#ZakatTracker-2843"><span class="linenos">2843</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2844"><a href="#ZakatTracker-2844"><span class="linenos">2844</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;debug-2 - PASSED&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2845"><a href="#ZakatTracker-2845"><span class="linenos">2845</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">y</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</span><span id="ZakatTracker-2846"><a href="#ZakatTracker-2846"><span class="linenos">2846</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">y</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
</span><span id="ZakatTracker-2847"><a href="#ZakatTracker-2847"><span class="linenos">2847</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-2848"><a href="#ZakatTracker-2848"><span class="linenos">2848</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">())</span>
</span><span id="ZakatTracker-2849"><a href="#ZakatTracker-2849"><span class="linenos">2849</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-2850"><a href="#ZakatTracker-2850"><span class="linenos">2850</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">boxes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="p">{}</span>
</span><span id="ZakatTracker-2851"><a href="#ZakatTracker-2851"><span class="linenos">2851</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="p">{}</span>
</span><span id="ZakatTracker-2852"><a href="#ZakatTracker-2852"><span class="linenos">2852</span></a>
</span><span id="ZakatTracker-2853"><a href="#ZakatTracker-2853"><span class="linenos">2853</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker-2854"><a href="#ZakatTracker-2854"><span class="linenos">2854</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker-2855"><a href="#ZakatTracker-2855"><span class="linenos">2855</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker-2856"><a href="#ZakatTracker-2856"><span class="linenos">2856</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker-2857"><a href="#ZakatTracker-2857"><span class="linenos">2857</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker-2858"><a href="#ZakatTracker-2858"><span class="linenos">2858</span></a>
</span><span id="ZakatTracker-2859"><a href="#ZakatTracker-2859"><span class="linenos">2859</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">zakatable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker-2860"><a href="#ZakatTracker-2860"><span class="linenos">2860</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">zakatable</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker-2861"><a href="#ZakatTracker-2861"><span class="linenos">2861</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">zakatable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker-2862"><a href="#ZakatTracker-2862"><span class="linenos">2862</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">zakatable</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker-2863"><a href="#ZakatTracker-2863"><span class="linenos">2863</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">zakatable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker-2864"><a href="#ZakatTracker-2864"><span class="linenos">2864</span></a>
</span><span id="ZakatTracker-2865"><a href="#ZakatTracker-2865"><span class="linenos">2865</span></a>        <span class="k">if</span> <span class="n">restore</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="ZakatTracker-2866"><a href="#ZakatTracker-2866"><span class="linenos">2866</span></a>            <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-2867"><a href="#ZakatTracker-2867"><span class="linenos">2867</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2868"><a href="#ZakatTracker-2868"><span class="linenos">2868</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;history-count&#39;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="ZakatTracker-2869"><a href="#ZakatTracker-2869"><span class="linenos">2869</span></a>            <span class="k">assert</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">10</span>
</span><span id="ZakatTracker-2870"><a href="#ZakatTracker-2870"><span class="linenos">2870</span></a>            <span class="c1"># try mode</span>
</span><span id="ZakatTracker-2871"><a href="#ZakatTracker-2871"><span class="linenos">2871</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span><span id="ZakatTracker-2872"><a href="#ZakatTracker-2872"><span class="linenos">2872</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-2873"><a href="#ZakatTracker-2873"><span class="linenos">2873</span></a>            <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-2874"><a href="#ZakatTracker-2874"><span class="linenos">2874</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2875"><a href="#ZakatTracker-2875"><span class="linenos">2875</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;history-count&#39;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="ZakatTracker-2876"><a href="#ZakatTracker-2876"><span class="linenos">2876</span></a>            <span class="k">assert</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">10</span>
</span><span id="ZakatTracker-2877"><a href="#ZakatTracker-2877"><span class="linenos">2877</span></a>            <span class="n">_accounts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ZakatTracker-2878"><a href="#ZakatTracker-2878"><span class="linenos">2878</span></a>            <span class="n">accounts_limit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_accounts</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ZakatTracker-2879"><a href="#ZakatTracker-2879"><span class="linenos">2879</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">accounts_limit</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ZakatTracker-2880"><a href="#ZakatTracker-2880"><span class="linenos">2880</span></a>                <span class="n">account</span> <span class="o">=</span> <span class="n">_accounts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="ZakatTracker-2881"><a href="#ZakatTracker-2881"><span class="linenos">2881</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2882"><a href="#ZakatTracker-2882"><span class="linenos">2882</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">account</span><span class="p">]))</span>
</span><span id="ZakatTracker-2883"><a href="#ZakatTracker-2883"><span class="linenos">2883</span></a>                <span class="n">transaction_limit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">account</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ZakatTracker-2884"><a href="#ZakatTracker-2884"><span class="linenos">2884</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">transaction_limit</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ZakatTracker-2885"><a href="#ZakatTracker-2885"><span class="linenos">2885</span></a>                    <span class="n">row</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">account</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="ZakatTracker-2886"><a href="#ZakatTracker-2886"><span class="linenos">2886</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2887"><a href="#ZakatTracker-2887"><span class="linenos">2887</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">account</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</span><span id="ZakatTracker-2888"><a href="#ZakatTracker-2888"><span class="linenos">2888</span></a>                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">account</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker-2889"><a href="#ZakatTracker-2889"><span class="linenos">2889</span></a>                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">account</span><span class="p">)</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ZakatTracker-2890"><a href="#ZakatTracker-2890"><span class="linenos">2890</span></a>                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-2891"><a href="#ZakatTracker-2891"><span class="linenos">2891</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker-2892"><a href="#ZakatTracker-2892"><span class="linenos">2892</span></a>            <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-2893"><a href="#ZakatTracker-2893"><span class="linenos">2893</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2894"><a href="#ZakatTracker-2894"><span class="linenos">2894</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;history-count&#39;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="ZakatTracker-2895"><a href="#ZakatTracker-2895"><span class="linenos">2895</span></a>            <span class="k">assert</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-2896"><a href="#ZakatTracker-2896"><span class="linenos">2896</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker-2897"><a href="#ZakatTracker-2897"><span class="linenos">2897</span></a>
</span><span id="ZakatTracker-2898"><a href="#ZakatTracker-2898"><span class="linenos">2898</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker-2899"><a href="#ZakatTracker-2899"><span class="linenos">2899</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2900"><a href="#ZakatTracker-2900"><span class="linenos">2900</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2901"><a href="#ZakatTracker-2901"><span class="linenos">2901</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-2902"><a href="#ZakatTracker-2902"><span class="linenos">2902</span></a>
</span><span id="ZakatTracker-2903"><a href="#ZakatTracker-2903"><span class="linenos">2903</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_test_core</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-2904"><a href="#ZakatTracker-2904"><span class="linenos">2904</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_test_core</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-2905"><a href="#ZakatTracker-2905"><span class="linenos">2905</span></a>
</span><span id="ZakatTracker-2906"><a href="#ZakatTracker-2906"><span class="linenos">2906</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">()</span>
</span><span id="ZakatTracker-2907"><a href="#ZakatTracker-2907"><span class="linenos">2907</span></a>
</span><span id="ZakatTracker-2908"><a href="#ZakatTracker-2908"><span class="linenos">2908</span></a>            <span class="c1"># Not allowed for duplicate transactions in the same account and time</span>
</span><span id="ZakatTracker-2909"><a href="#ZakatTracker-2909"><span class="linenos">2909</span></a>
</span><span id="ZakatTracker-2910"><a href="#ZakatTracker-2910"><span class="linenos">2910</span></a>            <span class="n">created</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker-2911"><a href="#ZakatTracker-2911"><span class="linenos">2911</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;test-1&#39;</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker-2912"><a href="#ZakatTracker-2912"><span class="linenos">2912</span></a>            <span class="n">failed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ZakatTracker-2913"><a href="#ZakatTracker-2913"><span class="linenos">2913</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-2914"><a href="#ZakatTracker-2914"><span class="linenos">2914</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;test-1&#39;</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker-2915"><a href="#ZakatTracker-2915"><span class="linenos">2915</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="ZakatTracker-2916"><a href="#ZakatTracker-2916"><span class="linenos">2916</span></a>                <span class="n">failed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ZakatTracker-2917"><a href="#ZakatTracker-2917"><span class="linenos">2917</span></a>            <span class="k">assert</span> <span class="n">failed</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="ZakatTracker-2918"><a href="#ZakatTracker-2918"><span class="linenos">2918</span></a>
</span><span id="ZakatTracker-2919"><a href="#ZakatTracker-2919"><span class="linenos">2919</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker-2920"><a href="#ZakatTracker-2920"><span class="linenos">2920</span></a>
</span><span id="ZakatTracker-2921"><a href="#ZakatTracker-2921"><span class="linenos">2921</span></a>            <span class="c1"># Same account transfer</span>
</span><span id="ZakatTracker-2922"><a href="#ZakatTracker-2922"><span class="linenos">2922</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="ZakatTracker-2923"><a href="#ZakatTracker-2923"><span class="linenos">2923</span></a>                <span class="n">failed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ZakatTracker-2924"><a href="#ZakatTracker-2924"><span class="linenos">2924</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker-2925"><a href="#ZakatTracker-2925"><span class="linenos">2925</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;same-account&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-2926"><a href="#ZakatTracker-2926"><span class="linenos">2926</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="ZakatTracker-2927"><a href="#ZakatTracker-2927"><span class="linenos">2927</span></a>                    <span class="n">failed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ZakatTracker-2928"><a href="#ZakatTracker-2928"><span class="linenos">2928</span></a>                <span class="k">assert</span> <span class="n">failed</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="ZakatTracker-2929"><a href="#ZakatTracker-2929"><span class="linenos">2929</span></a>
</span><span id="ZakatTracker-2930"><a href="#ZakatTracker-2930"><span class="linenos">2930</span></a>            <span class="c1"># Always preserve box age during transfer</span>
</span><span id="ZakatTracker-2931"><a href="#ZakatTracker-2931"><span class="linenos">2931</span></a>
</span><span id="ZakatTracker-2932"><a href="#ZakatTracker-2932"><span class="linenos">2932</span></a>            <span class="n">series</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ZakatTracker-2933"><a href="#ZakatTracker-2933"><span class="linenos">2933</span></a>                <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="ZakatTracker-2934"><a href="#ZakatTracker-2934"><span class="linenos">2934</span></a>                <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="ZakatTracker-2935"><a href="#ZakatTracker-2935"><span class="linenos">2935</span></a>                <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="ZakatTracker-2936"><a href="#ZakatTracker-2936"><span class="linenos">2936</span></a>            <span class="p">]</span>
</span><span id="ZakatTracker-2937"><a href="#ZakatTracker-2937"><span class="linenos">2937</span></a>            <span class="n">case</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-2938"><a href="#ZakatTracker-2938"><span class="linenos">2938</span></a>                <span class="mi">3000</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker-2939"><a href="#ZakatTracker-2939"><span class="linenos">2939</span></a>                    <span class="s1">&#39;series&#39;</span><span class="p">:</span> <span class="n">series</span><span class="p">,</span>
</span><span id="ZakatTracker-2940"><a href="#ZakatTracker-2940"><span class="linenos">2940</span></a>                    <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span>
</span><span id="ZakatTracker-2941"><a href="#ZakatTracker-2941"><span class="linenos">2941</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker-2942"><a href="#ZakatTracker-2942"><span class="linenos">2942</span></a>                <span class="mi">6000</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker-2943"><a href="#ZakatTracker-2943"><span class="linenos">2943</span></a>                    <span class="s1">&#39;series&#39;</span><span class="p">:</span> <span class="n">series</span><span class="p">,</span>
</span><span id="ZakatTracker-2944"><a href="#ZakatTracker-2944"><span class="linenos">2944</span></a>                    <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="mi">12000</span><span class="p">,</span>
</span><span id="ZakatTracker-2945"><a href="#ZakatTracker-2945"><span class="linenos">2945</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker-2946"><a href="#ZakatTracker-2946"><span class="linenos">2946</span></a>                <span class="mi">9000</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker-2947"><a href="#ZakatTracker-2947"><span class="linenos">2947</span></a>                    <span class="s1">&#39;series&#39;</span><span class="p">:</span> <span class="n">series</span><span class="p">,</span>
</span><span id="ZakatTracker-2948"><a href="#ZakatTracker-2948"><span class="linenos">2948</span></a>                    <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="mi">9000</span><span class="p">,</span>
</span><span id="ZakatTracker-2949"><a href="#ZakatTracker-2949"><span class="linenos">2949</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker-2950"><a href="#ZakatTracker-2950"><span class="linenos">2950</span></a>                <span class="mi">18000</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker-2951"><a href="#ZakatTracker-2951"><span class="linenos">2951</span></a>                    <span class="s1">&#39;series&#39;</span><span class="p">:</span> <span class="n">series</span><span class="p">,</span>
</span><span id="ZakatTracker-2952"><a href="#ZakatTracker-2952"><span class="linenos">2952</span></a>                    <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker-2953"><a href="#ZakatTracker-2953"><span class="linenos">2953</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker-2954"><a href="#ZakatTracker-2954"><span class="linenos">2954</span></a>                <span class="mi">27000</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker-2955"><a href="#ZakatTracker-2955"><span class="linenos">2955</span></a>                    <span class="s1">&#39;series&#39;</span><span class="p">:</span> <span class="n">series</span><span class="p">,</span>
</span><span id="ZakatTracker-2956"><a href="#ZakatTracker-2956"><span class="linenos">2956</span></a>                    <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">9000</span><span class="p">,</span>
</span><span id="ZakatTracker-2957"><a href="#ZakatTracker-2957"><span class="linenos">2957</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker-2958"><a href="#ZakatTracker-2958"><span class="linenos">2958</span></a>                <span class="mi">36000</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker-2959"><a href="#ZakatTracker-2959"><span class="linenos">2959</span></a>                    <span class="s1">&#39;series&#39;</span><span class="p">:</span> <span class="n">series</span><span class="p">,</span>
</span><span id="ZakatTracker-2960"><a href="#ZakatTracker-2960"><span class="linenos">2960</span></a>                    <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">18000</span><span class="p">,</span>
</span><span id="ZakatTracker-2961"><a href="#ZakatTracker-2961"><span class="linenos">2961</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker-2962"><a href="#ZakatTracker-2962"><span class="linenos">2962</span></a>            <span class="p">}</span>
</span><span id="ZakatTracker-2963"><a href="#ZakatTracker-2963"><span class="linenos">2963</span></a>
</span><span id="ZakatTracker-2964"><a href="#ZakatTracker-2964"><span class="linenos">2964</span></a>            <span class="n">selected_time</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">TimeCycle</span><span class="p">()</span>
</span><span id="ZakatTracker-2965"><a href="#ZakatTracker-2965"><span class="linenos">2965</span></a>
</span><span id="ZakatTracker-2966"><a href="#ZakatTracker-2966"><span class="linenos">2966</span></a>            <span class="k">for</span> <span class="n">total</span> <span class="ow">in</span> <span class="n">case</span><span class="p">:</span>
</span><span id="ZakatTracker-2967"><a href="#ZakatTracker-2967"><span class="linenos">2967</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2968"><a href="#ZakatTracker-2968"><span class="linenos">2968</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------------------------------------------------------&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2969"><a href="#ZakatTracker-2969"><span class="linenos">2969</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;case[</span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="n">case</span><span class="p">[</span><span class="n">total</span><span class="p">])</span>
</span><span id="ZakatTracker-2970"><a href="#ZakatTracker-2970"><span class="linenos">2970</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">case</span><span class="p">[</span><span class="n">total</span><span class="p">][</span><span class="s1">&#39;series&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-2971"><a href="#ZakatTracker-2971"><span class="linenos">2971</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span>
</span><span id="ZakatTracker-2972"><a href="#ZakatTracker-2972"><span class="linenos">2972</span></a>                        <span class="n">unscaled_value</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ZakatTracker-2973"><a href="#ZakatTracker-2973"><span class="linenos">2973</span></a>                        <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;test-</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> ages&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker-2974"><a href="#ZakatTracker-2974"><span class="linenos">2974</span></a>                        <span class="n">account</span><span class="o">=</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2975"><a href="#ZakatTracker-2975"><span class="linenos">2975</span></a>                        <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ZakatTracker-2976"><a href="#ZakatTracker-2976"><span class="linenos">2976</span></a>                        <span class="n">created</span><span class="o">=</span><span class="n">selected_time</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ZakatTracker-2977"><a href="#ZakatTracker-2977"><span class="linenos">2977</span></a>                    <span class="p">)</span>
</span><span id="ZakatTracker-2978"><a href="#ZakatTracker-2978"><span class="linenos">2978</span></a>
</span><span id="ZakatTracker-2979"><a href="#ZakatTracker-2979"><span class="linenos">2979</span></a>                <span class="n">unscaled_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
</span><span id="ZakatTracker-2980"><a href="#ZakatTracker-2980"><span class="linenos">2980</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2981"><a href="#ZakatTracker-2981"><span class="linenos">2981</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;unscaled_total&#39;</span><span class="p">,</span> <span class="n">unscaled_total</span><span class="p">)</span>
</span><span id="ZakatTracker-2982"><a href="#ZakatTracker-2982"><span class="linenos">2982</span></a>                <span class="n">refs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span>
</span><span id="ZakatTracker-2983"><a href="#ZakatTracker-2983"><span class="linenos">2983</span></a>                    <span class="n">unscaled_amount</span><span class="o">=</span><span class="n">unscaled_total</span><span class="p">,</span>
</span><span id="ZakatTracker-2984"><a href="#ZakatTracker-2984"><span class="linenos">2984</span></a>                    <span class="n">from_account</span><span class="o">=</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2985"><a href="#ZakatTracker-2985"><span class="linenos">2985</span></a>                    <span class="n">to_account</span><span class="o">=</span><span class="s1">&#39;future&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2986"><a href="#ZakatTracker-2986"><span class="linenos">2986</span></a>                    <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Zakat Movement&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-2987"><a href="#ZakatTracker-2987"><span class="linenos">2987</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="ZakatTracker-2988"><a href="#ZakatTracker-2988"><span class="linenos">2988</span></a>                <span class="p">)</span>
</span><span id="ZakatTracker-2989"><a href="#ZakatTracker-2989"><span class="linenos">2989</span></a>
</span><span id="ZakatTracker-2990"><a href="#ZakatTracker-2990"><span class="linenos">2990</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2991"><a href="#ZakatTracker-2991"><span class="linenos">2991</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;refs&#39;</span><span class="p">,</span> <span class="n">refs</span><span class="p">)</span>
</span><span id="ZakatTracker-2992"><a href="#ZakatTracker-2992"><span class="linenos">2992</span></a>
</span><span id="ZakatTracker-2993"><a href="#ZakatTracker-2993"><span class="linenos">2993</span></a>                <span class="n">ages_cache_balance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="s1">&#39;ages&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-2994"><a href="#ZakatTracker-2994"><span class="linenos">2994</span></a>                <span class="n">ages_fresh_balance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker-2995"><a href="#ZakatTracker-2995"><span class="linenos">2995</span></a>                <span class="n">rest</span> <span class="o">=</span> <span class="n">case</span><span class="p">[</span><span class="n">total</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-2996"><a href="#ZakatTracker-2996"><span class="linenos">2996</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-2997"><a href="#ZakatTracker-2997"><span class="linenos">2997</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="n">ages_cache_balance</span><span class="p">,</span> <span class="n">ages_fresh_balance</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
</span><span id="ZakatTracker-2998"><a href="#ZakatTracker-2998"><span class="linenos">2998</span></a>                <span class="k">assert</span> <span class="n">ages_cache_balance</span> <span class="o">==</span> <span class="n">rest</span>
</span><span id="ZakatTracker-2999"><a href="#ZakatTracker-2999"><span class="linenos">2999</span></a>                <span class="k">assert</span> <span class="n">ages_fresh_balance</span> <span class="o">==</span> <span class="n">rest</span>
</span><span id="ZakatTracker-3000"><a href="#ZakatTracker-3000"><span class="linenos">3000</span></a>
</span><span id="ZakatTracker-3001"><a href="#ZakatTracker-3001"><span class="linenos">3001</span></a>                <span class="n">future_cache_balance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="s1">&#39;future&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-3002"><a href="#ZakatTracker-3002"><span class="linenos">3002</span></a>                <span class="n">future_fresh_balance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="s1">&#39;future&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker-3003"><a href="#ZakatTracker-3003"><span class="linenos">3003</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3004"><a href="#ZakatTracker-3004"><span class="linenos">3004</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="n">future_cache_balance</span><span class="p">,</span> <span class="n">future_fresh_balance</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>
</span><span id="ZakatTracker-3005"><a href="#ZakatTracker-3005"><span class="linenos">3005</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;refs&#39;</span><span class="p">,</span> <span class="n">refs</span><span class="p">)</span>
</span><span id="ZakatTracker-3006"><a href="#ZakatTracker-3006"><span class="linenos">3006</span></a>                <span class="k">assert</span> <span class="n">future_cache_balance</span> <span class="o">==</span> <span class="n">total</span>
</span><span id="ZakatTracker-3007"><a href="#ZakatTracker-3007"><span class="linenos">3007</span></a>                <span class="k">assert</span> <span class="n">future_fresh_balance</span> <span class="o">==</span> <span class="n">total</span>
</span><span id="ZakatTracker-3008"><a href="#ZakatTracker-3008"><span class="linenos">3008</span></a>
</span><span id="ZakatTracker-3009"><a href="#ZakatTracker-3009"><span class="linenos">3009</span></a>                <span class="c1"># TODO: check boxes times for `ages` should equal box times in `future`</span>
</span><span id="ZakatTracker-3010"><a href="#ZakatTracker-3010"><span class="linenos">3010</span></a>                <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;ages&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-3011"><a href="#ZakatTracker-3011"><span class="linenos">3011</span></a>                    <span class="n">ages_capital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;ages&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;capital&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3012"><a href="#ZakatTracker-3012"><span class="linenos">3012</span></a>                    <span class="n">ages_rest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;ages&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3013"><a href="#ZakatTracker-3013"><span class="linenos">3013</span></a>                    <span class="n">future_capital</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3014"><a href="#ZakatTracker-3014"><span class="linenos">3014</span></a>                    <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;future&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-3015"><a href="#ZakatTracker-3015"><span class="linenos">3015</span></a>                        <span class="n">future_capital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;future&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;capital&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3016"><a href="#ZakatTracker-3016"><span class="linenos">3016</span></a>                    <span class="n">future_rest</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3017"><a href="#ZakatTracker-3017"><span class="linenos">3017</span></a>                    <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;future&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker-3018"><a href="#ZakatTracker-3018"><span class="linenos">3018</span></a>                        <span class="n">future_rest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;future&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3019"><a href="#ZakatTracker-3019"><span class="linenos">3019</span></a>                    <span class="k">if</span> <span class="n">ages_capital</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">future_capital</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">future_rest</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-3020"><a href="#ZakatTracker-3020"><span class="linenos">3020</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3021"><a href="#ZakatTracker-3021"><span class="linenos">3021</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;================================================================&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-3022"><a href="#ZakatTracker-3022"><span class="linenos">3022</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span> <span class="n">ages_capital</span><span class="p">,</span> <span class="n">ages_rest</span><span class="p">)</span>
</span><span id="ZakatTracker-3023"><a href="#ZakatTracker-3023"><span class="linenos">3023</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;future&#39;</span><span class="p">,</span> <span class="n">future_capital</span><span class="p">,</span> <span class="n">future_rest</span><span class="p">)</span>
</span><span id="ZakatTracker-3024"><a href="#ZakatTracker-3024"><span class="linenos">3024</span></a>                        <span class="k">if</span> <span class="n">ages_rest</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-3025"><a href="#ZakatTracker-3025"><span class="linenos">3025</span></a>                            <span class="k">assert</span> <span class="n">ages_capital</span> <span class="o">==</span> <span class="n">future_capital</span>
</span><span id="ZakatTracker-3026"><a href="#ZakatTracker-3026"><span class="linenos">3026</span></a>                        <span class="k">elif</span> <span class="n">ages_rest</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-3027"><a href="#ZakatTracker-3027"><span class="linenos">3027</span></a>                            <span class="k">assert</span> <span class="o">-</span><span class="n">ages_capital</span> <span class="o">==</span> <span class="n">future_capital</span>
</span><span id="ZakatTracker-3028"><a href="#ZakatTracker-3028"><span class="linenos">3028</span></a>                        <span class="k">elif</span> <span class="n">ages_rest</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-3029"><a href="#ZakatTracker-3029"><span class="linenos">3029</span></a>                            <span class="k">assert</span> <span class="n">ages_capital</span> <span class="o">==</span> <span class="n">ages_rest</span> <span class="o">+</span> <span class="n">future_capital</span>
</span><span id="ZakatTracker-3030"><a href="#ZakatTracker-3030"><span class="linenos">3030</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker-3031"><a href="#ZakatTracker-3031"><span class="linenos">3031</span></a>                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3032"><a href="#ZakatTracker-3032"><span class="linenos">3032</span></a>
</span><span id="ZakatTracker-3033"><a href="#ZakatTracker-3033"><span class="linenos">3033</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">()</span>
</span><span id="ZakatTracker-3034"><a href="#ZakatTracker-3034"><span class="linenos">3034</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker-3035"><a href="#ZakatTracker-3035"><span class="linenos">3035</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker-3036"><a href="#ZakatTracker-3036"><span class="linenos">3036</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker-3037"><a href="#ZakatTracker-3037"><span class="linenos">3037</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">()</span>
</span><span id="ZakatTracker-3038"><a href="#ZakatTracker-3038"><span class="linenos">3038</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3039"><a href="#ZakatTracker-3039"><span class="linenos">3039</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;####################################################################&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-3040"><a href="#ZakatTracker-3040"><span class="linenos">3040</span></a>
</span><span id="ZakatTracker-3041"><a href="#ZakatTracker-3041"><span class="linenos">3041</span></a>            <span class="n">transaction</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ZakatTracker-3042"><a href="#ZakatTracker-3042"><span class="linenos">3042</span></a>                <span class="p">(</span>
</span><span id="ZakatTracker-3043"><a href="#ZakatTracker-3043"><span class="linenos">3043</span></a>                    <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;wallet&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ZakatTracker-3044"><a href="#ZakatTracker-3044"><span class="linenos">3044</span></a>                    <span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ZakatTracker-3045"><a href="#ZakatTracker-3045"><span class="linenos">3045</span></a>                <span class="p">),</span>
</span><span id="ZakatTracker-3046"><a href="#ZakatTracker-3046"><span class="linenos">3046</span></a>                <span class="p">(</span>
</span><span id="ZakatTracker-3047"><a href="#ZakatTracker-3047"><span class="linenos">3047</span></a>                    <span class="mi">750</span><span class="p">,</span> <span class="s1">&#39;wallet&#39;</span><span class="p">,</span> <span class="s1">&#39;safe&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">77000</span><span class="p">,</span> <span class="o">-</span><span class="mi">77000</span><span class="p">,</span> <span class="o">-</span><span class="mi">77000</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="ZakatTracker-3048"><a href="#ZakatTracker-3048"><span class="linenos">3048</span></a>                    <span class="mi">75000</span><span class="p">,</span> <span class="mi">75000</span><span class="p">,</span> <span class="mi">75000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ZakatTracker-3049"><a href="#ZakatTracker-3049"><span class="linenos">3049</span></a>                <span class="p">),</span>
</span><span id="ZakatTracker-3050"><a href="#ZakatTracker-3050"><span class="linenos">3050</span></a>                <span class="p">(</span>
</span><span id="ZakatTracker-3051"><a href="#ZakatTracker-3051"><span class="linenos">3051</span></a>                    <span class="mi">600</span><span class="p">,</span> <span class="s1">&#39;safe&#39;</span><span class="p">,</span> <span class="s1">&#39;bank&#39;</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="ZakatTracker-3052"><a href="#ZakatTracker-3052"><span class="linenos">3052</span></a>                    <span class="mi">60000</span><span class="p">,</span> <span class="mi">60000</span><span class="p">,</span> <span class="mi">60000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ZakatTracker-3053"><a href="#ZakatTracker-3053"><span class="linenos">3053</span></a>                <span class="p">),</span>
</span><span id="ZakatTracker-3054"><a href="#ZakatTracker-3054"><span class="linenos">3054</span></a>            <span class="p">]</span>
</span><span id="ZakatTracker-3055"><a href="#ZakatTracker-3055"><span class="linenos">3055</span></a>            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">transaction</span><span class="p">:</span>
</span><span id="ZakatTracker-3056"><a href="#ZakatTracker-3056"><span class="linenos">3056</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker-3057"><a href="#ZakatTracker-3057"><span class="linenos">3057</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker-3058"><a href="#ZakatTracker-3058"><span class="linenos">3058</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ZakatTracker-3059"><a href="#ZakatTracker-3059"><span class="linenos">3059</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span>
</span><span id="ZakatTracker-3060"><a href="#ZakatTracker-3060"><span class="linenos">3060</span></a>                    <span class="n">unscaled_amount</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ZakatTracker-3061"><a href="#ZakatTracker-3061"><span class="linenos">3061</span></a>                    <span class="n">from_account</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
</span><span id="ZakatTracker-3062"><a href="#ZakatTracker-3062"><span class="linenos">3062</span></a>                    <span class="n">to_account</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
</span><span id="ZakatTracker-3063"><a href="#ZakatTracker-3063"><span class="linenos">3063</span></a>                    <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;test-transfer&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-3064"><a href="#ZakatTracker-3064"><span class="linenos">3064</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="ZakatTracker-3065"><a href="#ZakatTracker-3065"><span class="linenos">3065</span></a>                <span class="p">)</span>
</span><span id="ZakatTracker-3066"><a href="#ZakatTracker-3066"><span class="linenos">3066</span></a>                <span class="n">zz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker-3067"><a href="#ZakatTracker-3067"><span class="linenos">3067</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3068"><a href="#ZakatTracker-3068"><span class="linenos">3068</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</span><span id="ZakatTracker-3069"><a href="#ZakatTracker-3069"><span class="linenos">3069</span></a>                <span class="k">assert</span> <span class="n">zz</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="ZakatTracker-3070"><a href="#ZakatTracker-3070"><span class="linenos">3070</span></a>                <span class="n">xx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">()[</span><span class="n">x</span><span class="p">]</span>
</span><span id="ZakatTracker-3071"><a href="#ZakatTracker-3071"><span class="linenos">3071</span></a>                <span class="k">assert</span> <span class="n">xx</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="ZakatTracker-3072"><a href="#ZakatTracker-3072"><span class="linenos">3072</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="ZakatTracker-3073"><a href="#ZakatTracker-3073"><span class="linenos">3073</span></a>                <span class="k">assert</span> <span class="n">xx</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="ZakatTracker-3074"><a href="#ZakatTracker-3074"><span class="linenos">3074</span></a>
</span><span id="ZakatTracker-3075"><a href="#ZakatTracker-3075"><span class="linenos">3075</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3076"><a href="#ZakatTracker-3076"><span class="linenos">3076</span></a>                <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3077"><a href="#ZakatTracker-3077"><span class="linenos">3077</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">log</span><span class="p">:</span>
</span><span id="ZakatTracker-3078"><a href="#ZakatTracker-3078"><span class="linenos">3078</span></a>                    <span class="n">s</span> <span class="o">+=</span> <span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3079"><a href="#ZakatTracker-3079"><span class="linenos">3079</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3080"><a href="#ZakatTracker-3080"><span class="linenos">3080</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;z[5]&#39;</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
</span><span id="ZakatTracker-3081"><a href="#ZakatTracker-3081"><span class="linenos">3081</span></a>                <span class="k">assert</span> <span class="n">s</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</span><span id="ZakatTracker-3082"><a href="#ZakatTracker-3082"><span class="linenos">3082</span></a>
</span><span id="ZakatTracker-3083"><a href="#ZakatTracker-3083"><span class="linenos">3083</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
</span><span id="ZakatTracker-3084"><a href="#ZakatTracker-3084"><span class="linenos">3084</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
</span><span id="ZakatTracker-3085"><a href="#ZakatTracker-3085"><span class="linenos">3085</span></a>
</span><span id="ZakatTracker-3086"><a href="#ZakatTracker-3086"><span class="linenos">3086</span></a>                <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">()[</span><span class="n">y</span><span class="p">]</span>
</span><span id="ZakatTracker-3087"><a href="#ZakatTracker-3087"><span class="linenos">3087</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
</span><span id="ZakatTracker-3088"><a href="#ZakatTracker-3088"><span class="linenos">3088</span></a>                <span class="k">assert</span> <span class="n">yy</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
</span><span id="ZakatTracker-3089"><a href="#ZakatTracker-3089"><span class="linenos">3089</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
</span><span id="ZakatTracker-3090"><a href="#ZakatTracker-3090"><span class="linenos">3090</span></a>                <span class="k">assert</span> <span class="n">yy</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
</span><span id="ZakatTracker-3091"><a href="#ZakatTracker-3091"><span class="linenos">3091</span></a>
</span><span id="ZakatTracker-3092"><a href="#ZakatTracker-3092"><span class="linenos">3092</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3093"><a href="#ZakatTracker-3093"><span class="linenos">3093</span></a>                <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3094"><a href="#ZakatTracker-3094"><span class="linenos">3094</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">log</span><span class="p">:</span>
</span><span id="ZakatTracker-3095"><a href="#ZakatTracker-3095"><span class="linenos">3095</span></a>                    <span class="n">s</span> <span class="o">+=</span> <span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3096"><a href="#ZakatTracker-3096"><span class="linenos">3096</span></a>                <span class="k">assert</span> <span class="n">s</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
</span><span id="ZakatTracker-3097"><a href="#ZakatTracker-3097"><span class="linenos">3097</span></a>
</span><span id="ZakatTracker-3098"><a href="#ZakatTracker-3098"><span class="linenos">3098</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
</span><span id="ZakatTracker-3099"><a href="#ZakatTracker-3099"><span class="linenos">3099</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
</span><span id="ZakatTracker-3100"><a href="#ZakatTracker-3100"><span class="linenos">3100</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">())</span>
</span><span id="ZakatTracker-3101"><a href="#ZakatTracker-3101"><span class="linenos">3101</span></a>
</span><span id="ZakatTracker-3102"><a href="#ZakatTracker-3102"><span class="linenos">3102</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3103"><a href="#ZakatTracker-3103"><span class="linenos">3103</span></a>                <span class="n">pp</span><span class="p">()</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="mf">2.17</span><span class="p">))</span>
</span><span id="ZakatTracker-3104"><a href="#ZakatTracker-3104"><span class="linenos">3104</span></a>
</span><span id="ZakatTracker-3105"><a href="#ZakatTracker-3105"><span class="linenos">3105</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-3106"><a href="#ZakatTracker-3106"><span class="linenos">3106</span></a>            <span class="n">history_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-3107"><a href="#ZakatTracker-3107"><span class="linenos">3107</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3108"><a href="#ZakatTracker-3108"><span class="linenos">3108</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;history-count&#39;</span><span class="p">,</span> <span class="n">history_count</span><span class="p">)</span>
</span><span id="ZakatTracker-3109"><a href="#ZakatTracker-3109"><span class="linenos">3109</span></a>            <span class="k">assert</span> <span class="n">history_count</span> <span class="o">==</span> <span class="mi">4</span>
</span><span id="ZakatTracker-3110"><a href="#ZakatTracker-3110"><span class="linenos">3110</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="ZakatTracker-3111"><a href="#ZakatTracker-3111"><span class="linenos">3111</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">())</span>
</span><span id="ZakatTracker-3112"><a href="#ZakatTracker-3112"><span class="linenos">3112</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-3113"><a href="#ZakatTracker-3113"><span class="linenos">3113</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="ZakatTracker-3114"><a href="#ZakatTracker-3114"><span class="linenos">3114</span></a>
</span><span id="ZakatTracker-3115"><a href="#ZakatTracker-3115"><span class="linenos">3115</span></a>            <span class="c1"># storage</span>
</span><span id="ZakatTracker-3116"><a href="#ZakatTracker-3116"><span class="linenos">3116</span></a>
</span><span id="ZakatTracker-3117"><a href="#ZakatTracker-3117"><span class="linenos">3117</span></a>            <span class="n">_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./zakat_test_db/test.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-3118"><a href="#ZakatTracker-3118"><span class="linenos">3118</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_path</span><span class="p">):</span>
</span><span id="ZakatTracker-3119"><a href="#ZakatTracker-3119"><span class="linenos">3119</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">_path</span><span class="p">)</span>
</span><span id="ZakatTracker-3120"><a href="#ZakatTracker-3120"><span class="linenos">3120</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="ZakatTracker-3121"><a href="#ZakatTracker-3121"><span class="linenos">3121</span></a>            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3122"><a href="#ZakatTracker-3122"><span class="linenos">3122</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker-3123"><a href="#ZakatTracker-3123"><span class="linenos">3123</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker-3124"><a href="#ZakatTracker-3124"><span class="linenos">3124</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span><span id="ZakatTracker-3125"><a href="#ZakatTracker-3125"><span class="linenos">3125</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3126"><a href="#ZakatTracker-3126"><span class="linenos">3126</span></a>
</span><span id="ZakatTracker-3127"><a href="#ZakatTracker-3127"><span class="linenos">3127</span></a>            <span class="c1"># recall</span>
</span><span id="ZakatTracker-3128"><a href="#ZakatTracker-3128"><span class="linenos">3128</span></a>
</span><span id="ZakatTracker-3129"><a href="#ZakatTracker-3129"><span class="linenos">3129</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-3130"><a href="#ZakatTracker-3130"><span class="linenos">3130</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="ZakatTracker-3131"><a href="#ZakatTracker-3131"><span class="linenos">3131</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="ZakatTracker-3132"><a href="#ZakatTracker-3132"><span class="linenos">3132</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
</span><span id="ZakatTracker-3133"><a href="#ZakatTracker-3133"><span class="linenos">3133</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="ZakatTracker-3134"><a href="#ZakatTracker-3134"><span class="linenos">3134</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="ZakatTracker-3135"><a href="#ZakatTracker-3135"><span class="linenos">3135</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="ZakatTracker-3136"><a href="#ZakatTracker-3136"><span class="linenos">3136</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3137"><a href="#ZakatTracker-3137"><span class="linenos">3137</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker-3138"><a href="#ZakatTracker-3138"><span class="linenos">3138</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3139"><a href="#ZakatTracker-3139"><span class="linenos">3139</span></a>
</span><span id="ZakatTracker-3140"><a href="#ZakatTracker-3140"><span class="linenos">3140</span></a>            <span class="c1"># exchange</span>
</span><span id="ZakatTracker-3141"><a href="#ZakatTracker-3141"><span class="linenos">3141</span></a>
</span><span id="ZakatTracker-3142"><a href="#ZakatTracker-3142"><span class="linenos">3142</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mf">3.75</span><span class="p">,</span> <span class="s2">&quot;2024-06-25&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3143"><a href="#ZakatTracker-3143"><span class="linenos">3143</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mf">3.73</span><span class="p">,</span> <span class="s2">&quot;2024-06-22&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3144"><a href="#ZakatTracker-3144"><span class="linenos">3144</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">3.69</span><span class="p">,</span> <span class="s2">&quot;2024-06-15&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3145"><a href="#ZakatTracker-3145"><span class="linenos">3145</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">3.66</span><span class="p">)</span>
</span><span id="ZakatTracker-3146"><a href="#ZakatTracker-3146"><span class="linenos">3146</span></a>
</span><span id="ZakatTracker-3147"><a href="#ZakatTracker-3147"><span class="linenos">3147</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
</span><span id="ZakatTracker-3148"><a href="#ZakatTracker-3148"><span class="linenos">3148</span></a>                <span class="n">exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="ZakatTracker-3149"><a href="#ZakatTracker-3149"><span class="linenos">3149</span></a>                <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3150"><a href="#ZakatTracker-3150"><span class="linenos">3150</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3151"><a href="#ZakatTracker-3151"><span class="linenos">3151</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker-3152"><a href="#ZakatTracker-3152"><span class="linenos">3152</span></a>                <span class="k">assert</span> <span class="n">created</span>
</span><span id="ZakatTracker-3153"><a href="#ZakatTracker-3153"><span class="linenos">3153</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="ZakatTracker-3154"><a href="#ZakatTracker-3154"><span class="linenos">3154</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="ZakatTracker-3155"><a href="#ZakatTracker-3155"><span class="linenos">3155</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3156"><a href="#ZakatTracker-3156"><span class="linenos">3156</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="ZakatTracker-3157"><a href="#ZakatTracker-3157"><span class="linenos">3157</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.66</span>
</span><span id="ZakatTracker-3158"><a href="#ZakatTracker-3158"><span class="linenos">3158</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3159"><a href="#ZakatTracker-3159"><span class="linenos">3159</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">:</span>
</span><span id="ZakatTracker-3160"><a href="#ZakatTracker-3160"><span class="linenos">3160</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.66</span>
</span><span id="ZakatTracker-3161"><a href="#ZakatTracker-3161"><span class="linenos">3161</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3162"><a href="#ZakatTracker-3162"><span class="linenos">3162</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>
</span><span id="ZakatTracker-3163"><a href="#ZakatTracker-3163"><span class="linenos">3163</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.69</span>
</span><span id="ZakatTracker-3164"><a href="#ZakatTracker-3164"><span class="linenos">3164</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3165"><a href="#ZakatTracker-3165"><span class="linenos">3165</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">22</span><span class="p">:</span>
</span><span id="ZakatTracker-3166"><a href="#ZakatTracker-3166"><span class="linenos">3166</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.69</span>
</span><span id="ZakatTracker-3167"><a href="#ZakatTracker-3167"><span class="linenos">3167</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3168"><a href="#ZakatTracker-3168"><span class="linenos">3168</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
</span><span id="ZakatTracker-3169"><a href="#ZakatTracker-3169"><span class="linenos">3169</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.73</span>
</span><span id="ZakatTracker-3170"><a href="#ZakatTracker-3170"><span class="linenos">3170</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3171"><a href="#ZakatTracker-3171"><span class="linenos">3171</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">:</span>
</span><span id="ZakatTracker-3172"><a href="#ZakatTracker-3172"><span class="linenos">3172</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.75</span>
</span><span id="ZakatTracker-3173"><a href="#ZakatTracker-3173"><span class="linenos">3173</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3174"><a href="#ZakatTracker-3174"><span class="linenos">3174</span></a>                <span class="n">exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;bank&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="ZakatTracker-3175"><a href="#ZakatTracker-3175"><span class="linenos">3175</span></a>                <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3176"><a href="#ZakatTracker-3176"><span class="linenos">3176</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3177"><a href="#ZakatTracker-3177"><span class="linenos">3177</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker-3178"><a href="#ZakatTracker-3178"><span class="linenos">3178</span></a>                <span class="k">assert</span> <span class="n">created</span>
</span><span id="ZakatTracker-3179"><a href="#ZakatTracker-3179"><span class="linenos">3179</span></a>                <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="ZakatTracker-3180"><a href="#ZakatTracker-3180"><span class="linenos">3180</span></a>                <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3181"><a href="#ZakatTracker-3181"><span class="linenos">3181</span></a>
</span><span id="ZakatTracker-3182"><a href="#ZakatTracker-3182"><span class="linenos">3182</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3183"><a href="#ZakatTracker-3183"><span class="linenos">3183</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchanges</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3184"><a href="#ZakatTracker-3184"><span class="linenos">3184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ZakatTracker-3185"><a href="#ZakatTracker-3185"><span class="linenos">3185</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3186"><a href="#ZakatTracker-3186"><span class="linenos">3186</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchanges</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3187"><a href="#ZakatTracker-3187"><span class="linenos">3187</span></a>
</span><span id="ZakatTracker-3188"><a href="#ZakatTracker-3188"><span class="linenos">3188</span></a>            <span class="c1"># حفظ أسعار الصرف باستخدام التواريخ بالنانو ثانية</span>
</span><span id="ZakatTracker-3189"><a href="#ZakatTracker-3189"><span class="linenos">3189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">day_to_time</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span> <span class="mf">3.75</span><span class="p">,</span> <span class="s2">&quot;2024-06-25&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3190"><a href="#ZakatTracker-3190"><span class="linenos">3190</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">day_to_time</span><span class="p">(</span><span class="mi">22</span><span class="p">),</span> <span class="mf">3.73</span><span class="p">,</span> <span class="s2">&quot;2024-06-22&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3191"><a href="#ZakatTracker-3191"><span class="linenos">3191</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">day_to_time</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span> <span class="mf">3.69</span><span class="p">,</span> <span class="s2">&quot;2024-06-15&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3192"><a href="#ZakatTracker-3192"><span class="linenos">3192</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">day_to_time</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="mf">3.66</span><span class="p">)</span>
</span><span id="ZakatTracker-3193"><a href="#ZakatTracker-3193"><span class="linenos">3193</span></a>
</span><span id="ZakatTracker-3194"><a href="#ZakatTracker-3194"><span class="linenos">3194</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.12</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">21</span><span class="p">)]:</span>
</span><span id="ZakatTracker-3195"><a href="#ZakatTracker-3195"><span class="linenos">3195</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-3196"><a href="#ZakatTracker-3196"><span class="linenos">3196</span></a>                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;range(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3197"><a href="#ZakatTracker-3197"><span class="linenos">3197</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker-3198"><a href="#ZakatTracker-3198"><span class="linenos">3198</span></a>                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;range(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3199"><a href="#ZakatTracker-3199"><span class="linenos">3199</span></a>
</span><span id="ZakatTracker-3200"><a href="#ZakatTracker-3200"><span class="linenos">3200</span></a>            <span class="c1"># اختبار النتائج باستخدام التواريخ بالنانو ثانية</span>
</span><span id="ZakatTracker-3201"><a href="#ZakatTracker-3201"><span class="linenos">3201</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">):</span>
</span><span id="ZakatTracker-3202"><a href="#ZakatTracker-3202"><span class="linenos">3202</span></a>                <span class="n">timestamp_ns</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">day_to_time</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="ZakatTracker-3203"><a href="#ZakatTracker-3203"><span class="linenos">3203</span></a>                <span class="n">exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="n">timestamp_ns</span><span class="p">)</span>
</span><span id="ZakatTracker-3204"><a href="#ZakatTracker-3204"><span class="linenos">3204</span></a>                <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3205"><a href="#ZakatTracker-3205"><span class="linenos">3205</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3206"><a href="#ZakatTracker-3206"><span class="linenos">3206</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker-3207"><a href="#ZakatTracker-3207"><span class="linenos">3207</span></a>                <span class="k">assert</span> <span class="n">created</span>
</span><span id="ZakatTracker-3208"><a href="#ZakatTracker-3208"><span class="linenos">3208</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="ZakatTracker-3209"><a href="#ZakatTracker-3209"><span class="linenos">3209</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="ZakatTracker-3210"><a href="#ZakatTracker-3210"><span class="linenos">3210</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3211"><a href="#ZakatTracker-3211"><span class="linenos">3211</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="ZakatTracker-3212"><a href="#ZakatTracker-3212"><span class="linenos">3212</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.66</span>
</span><span id="ZakatTracker-3213"><a href="#ZakatTracker-3213"><span class="linenos">3213</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3214"><a href="#ZakatTracker-3214"><span class="linenos">3214</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">:</span>
</span><span id="ZakatTracker-3215"><a href="#ZakatTracker-3215"><span class="linenos">3215</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.66</span>
</span><span id="ZakatTracker-3216"><a href="#ZakatTracker-3216"><span class="linenos">3216</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3217"><a href="#ZakatTracker-3217"><span class="linenos">3217</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>
</span><span id="ZakatTracker-3218"><a href="#ZakatTracker-3218"><span class="linenos">3218</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.69</span>
</span><span id="ZakatTracker-3219"><a href="#ZakatTracker-3219"><span class="linenos">3219</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3220"><a href="#ZakatTracker-3220"><span class="linenos">3220</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">22</span><span class="p">:</span>
</span><span id="ZakatTracker-3221"><a href="#ZakatTracker-3221"><span class="linenos">3221</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.69</span>
</span><span id="ZakatTracker-3222"><a href="#ZakatTracker-3222"><span class="linenos">3222</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3223"><a href="#ZakatTracker-3223"><span class="linenos">3223</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
</span><span id="ZakatTracker-3224"><a href="#ZakatTracker-3224"><span class="linenos">3224</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.73</span>
</span><span id="ZakatTracker-3225"><a href="#ZakatTracker-3225"><span class="linenos">3225</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3226"><a href="#ZakatTracker-3226"><span class="linenos">3226</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">:</span>
</span><span id="ZakatTracker-3227"><a href="#ZakatTracker-3227"><span class="linenos">3227</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.75</span>
</span><span id="ZakatTracker-3228"><a href="#ZakatTracker-3228"><span class="linenos">3228</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3229"><a href="#ZakatTracker-3229"><span class="linenos">3229</span></a>                <span class="n">exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;bank&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="ZakatTracker-3230"><a href="#ZakatTracker-3230"><span class="linenos">3230</span></a>                <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3231"><a href="#ZakatTracker-3231"><span class="linenos">3231</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3232"><a href="#ZakatTracker-3232"><span class="linenos">3232</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker-3233"><a href="#ZakatTracker-3233"><span class="linenos">3233</span></a>                <span class="k">assert</span> <span class="n">created</span>
</span><span id="ZakatTracker-3234"><a href="#ZakatTracker-3234"><span class="linenos">3234</span></a>                <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="ZakatTracker-3235"><a href="#ZakatTracker-3235"><span class="linenos">3235</span></a>                <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker-3236"><a href="#ZakatTracker-3236"><span class="linenos">3236</span></a>
</span><span id="ZakatTracker-3237"><a href="#ZakatTracker-3237"><span class="linenos">3237</span></a>            <span class="c1"># csv</span>
</span><span id="ZakatTracker-3238"><a href="#ZakatTracker-3238"><span class="linenos">3238</span></a>
</span><span id="ZakatTracker-3239"><a href="#ZakatTracker-3239"><span class="linenos">3239</span></a>            <span class="n">csv_count</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="ZakatTracker-3240"><a href="#ZakatTracker-3240"><span class="linenos">3240</span></a>
</span><span id="ZakatTracker-3241"><a href="#ZakatTracker-3241"><span class="linenos">3241</span></a>            <span class="k">for</span> <span class="n">with_rate</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">{</span>
</span><span id="ZakatTracker-3242"><a href="#ZakatTracker-3242"><span class="linenos">3242</span></a>                <span class="kc">False</span><span class="p">:</span> <span class="s1">&#39;test-import_csv-no-exchange&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-3243"><a href="#ZakatTracker-3243"><span class="linenos">3243</span></a>                <span class="kc">True</span><span class="p">:</span> <span class="s1">&#39;test-import_csv-with-exchange&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-3244"><a href="#ZakatTracker-3244"><span class="linenos">3244</span></a>            <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker-3245"><a href="#ZakatTracker-3245"><span class="linenos">3245</span></a>
</span><span id="ZakatTracker-3246"><a href="#ZakatTracker-3246"><span class="linenos">3246</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3247"><a href="#ZakatTracker-3247"><span class="linenos">3247</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test_import_csv&#39;</span><span class="p">,</span> <span class="n">with_rate</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="ZakatTracker-3248"><a href="#ZakatTracker-3248"><span class="linenos">3248</span></a>
</span><span id="ZakatTracker-3249"><a href="#ZakatTracker-3249"><span class="linenos">3249</span></a>                <span class="n">csv_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>
</span><span id="ZakatTracker-3250"><a href="#ZakatTracker-3250"><span class="linenos">3250</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">csv_path</span><span class="p">):</span>
</span><span id="ZakatTracker-3251"><a href="#ZakatTracker-3251"><span class="linenos">3251</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</span><span id="ZakatTracker-3252"><a href="#ZakatTracker-3252"><span class="linenos">3252</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_random_csv_file</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">csv_count</span><span class="p">,</span> <span class="n">with_rate</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-3253"><a href="#ZakatTracker-3253"><span class="linenos">3253</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3254"><a href="#ZakatTracker-3254"><span class="linenos">3254</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;generate_random_csv_file&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span><span id="ZakatTracker-3255"><a href="#ZakatTracker-3255"><span class="linenos">3255</span></a>                <span class="k">assert</span> <span class="n">c</span> <span class="o">==</span> <span class="n">csv_count</span>
</span><span id="ZakatTracker-3256"><a href="#ZakatTracker-3256"><span class="linenos">3256</span></a>                <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3257"><a href="#ZakatTracker-3257"><span class="linenos">3257</span></a>                <span class="n">cache_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_csv_cache_path</span><span class="p">()</span>
</span><span id="ZakatTracker-3258"><a href="#ZakatTracker-3258"><span class="linenos">3258</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_path</span><span class="p">):</span>
</span><span id="ZakatTracker-3259"><a href="#ZakatTracker-3259"><span class="linenos">3259</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span>
</span><span id="ZakatTracker-3260"><a href="#ZakatTracker-3260"><span class="linenos">3260</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker-3261"><a href="#ZakatTracker-3261"><span class="linenos">3261</span></a>                <span class="p">(</span><span class="n">created</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">bad</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-3262"><a href="#ZakatTracker-3262"><span class="linenos">3262</span></a>                <span class="n">bad_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span>
</span><span id="ZakatTracker-3263"><a href="#ZakatTracker-3263"><span class="linenos">3263</span></a>                <span class="k">assert</span> <span class="n">bad_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3264"><a href="#ZakatTracker-3264"><span class="linenos">3264</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3265"><a href="#ZakatTracker-3265"><span class="linenos">3265</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;csv-imported: (</span><span class="si">{</span><span class="n">created</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">found</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">bad_count</span><span class="si">}</span><span class="s2">) = count(</span><span class="si">{</span><span class="n">csv_count</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3266"><a href="#ZakatTracker-3266"><span class="linenos">3266</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bad&#39;</span><span class="p">,</span> <span class="n">bad</span><span class="p">)</span>
</span><span id="ZakatTracker-3267"><a href="#ZakatTracker-3267"><span class="linenos">3267</span></a>                <span class="n">tmp_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span>
</span><span id="ZakatTracker-3268"><a href="#ZakatTracker-3268"><span class="linenos">3268</span></a>                <span class="k">assert</span> <span class="n">tmp_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3269"><a href="#ZakatTracker-3269"><span class="linenos">3269</span></a>                <span class="c1"># TODO: assert created + found + bad_count == csv_count</span>
</span><span id="ZakatTracker-3270"><a href="#ZakatTracker-3270"><span class="linenos">3270</span></a>                <span class="c1"># TODO: assert created == csv_count</span>
</span><span id="ZakatTracker-3271"><a href="#ZakatTracker-3271"><span class="linenos">3271</span></a>                <span class="c1"># TODO: assert bad_count == 0</span>
</span><span id="ZakatTracker-3272"><a href="#ZakatTracker-3272"><span class="linenos">3272</span></a>                <span class="p">(</span><span class="n">created_2</span><span class="p">,</span> <span class="n">found_2</span><span class="p">,</span> <span class="n">bad_2</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</span><span id="ZakatTracker-3273"><a href="#ZakatTracker-3273"><span class="linenos">3273</span></a>                <span class="n">bad_2_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bad_2</span><span class="p">)</span>
</span><span id="ZakatTracker-3274"><a href="#ZakatTracker-3274"><span class="linenos">3274</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3275"><a href="#ZakatTracker-3275"><span class="linenos">3275</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;csv-imported: (</span><span class="si">{</span><span class="n">created_2</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">found_2</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">bad_2_count</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3276"><a href="#ZakatTracker-3276"><span class="linenos">3276</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bad&#39;</span><span class="p">,</span> <span class="n">bad</span><span class="p">)</span>
</span><span id="ZakatTracker-3277"><a href="#ZakatTracker-3277"><span class="linenos">3277</span></a>                <span class="k">assert</span> <span class="n">bad_2_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3278"><a href="#ZakatTracker-3278"><span class="linenos">3278</span></a>                <span class="c1"># TODO: assert tmp_size == os.path.getsize(cache_path)</span>
</span><span id="ZakatTracker-3279"><a href="#ZakatTracker-3279"><span class="linenos">3279</span></a>                <span class="c1"># TODO: assert created_2 + found_2 + bad_2_count == csv_count</span>
</span><span id="ZakatTracker-3280"><a href="#ZakatTracker-3280"><span class="linenos">3280</span></a>                <span class="c1"># TODO: assert created == found_2</span>
</span><span id="ZakatTracker-3281"><a href="#ZakatTracker-3281"><span class="linenos">3281</span></a>                <span class="c1"># TODO: assert bad_count == bad_2_count</span>
</span><span id="ZakatTracker-3282"><a href="#ZakatTracker-3282"><span class="linenos">3282</span></a>                <span class="c1"># TODO: assert found_2 == csv_count</span>
</span><span id="ZakatTracker-3283"><a href="#ZakatTracker-3283"><span class="linenos">3283</span></a>                <span class="c1"># TODO: assert bad_2_count == 0</span>
</span><span id="ZakatTracker-3284"><a href="#ZakatTracker-3284"><span class="linenos">3284</span></a>                <span class="c1"># TODO: assert created_2 == 0</span>
</span><span id="ZakatTracker-3285"><a href="#ZakatTracker-3285"><span class="linenos">3285</span></a>
</span><span id="ZakatTracker-3286"><a href="#ZakatTracker-3286"><span class="linenos">3286</span></a>                <span class="c1"># payment parts</span>
</span><span id="ZakatTracker-3287"><a href="#ZakatTracker-3287"><span class="linenos">3287</span></a>
</span><span id="ZakatTracker-3288"><a href="#ZakatTracker-3288"><span class="linenos">3288</span></a>                <span class="n">positive_parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_payment_parts</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">positive_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker-3289"><a href="#ZakatTracker-3289"><span class="linenos">3289</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_payment_parts</span><span class="p">(</span><span class="n">positive_parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3290"><a href="#ZakatTracker-3290"><span class="linenos">3290</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_payment_parts</span><span class="p">(</span><span class="n">positive_parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3291"><a href="#ZakatTracker-3291"><span class="linenos">3291</span></a>                <span class="n">all_parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_payment_parts</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="n">positive_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker-3292"><a href="#ZakatTracker-3292"><span class="linenos">3292</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_payment_parts</span><span class="p">(</span><span class="n">all_parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3293"><a href="#ZakatTracker-3293"><span class="linenos">3293</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_payment_parts</span><span class="p">(</span><span class="n">all_parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3294"><a href="#ZakatTracker-3294"><span class="linenos">3294</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3295"><a href="#ZakatTracker-3295"><span class="linenos">3295</span></a>                    <span class="n">pp</span><span class="p">()</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">positive_parts</span><span class="p">)</span>
</span><span id="ZakatTracker-3296"><a href="#ZakatTracker-3296"><span class="linenos">3296</span></a>                    <span class="n">pp</span><span class="p">()</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">all_parts</span><span class="p">)</span>
</span><span id="ZakatTracker-3297"><a href="#ZakatTracker-3297"><span class="linenos">3297</span></a>                <span class="c1"># dynamic discount</span>
</span><span id="ZakatTracker-3298"><a href="#ZakatTracker-3298"><span class="linenos">3298</span></a>                <span class="n">suite</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker-3299"><a href="#ZakatTracker-3299"><span class="linenos">3299</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="ZakatTracker-3300"><a href="#ZakatTracker-3300"><span class="linenos">3300</span></a>                <span class="k">for</span> <span class="n">exceed</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]:</span>
</span><span id="ZakatTracker-3301"><a href="#ZakatTracker-3301"><span class="linenos">3301</span></a>                    <span class="n">case</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker-3302"><a href="#ZakatTracker-3302"><span class="linenos">3302</span></a>                    <span class="k">for</span> <span class="n">parts</span> <span class="ow">in</span> <span class="p">[</span><span class="n">positive_parts</span><span class="p">,</span> <span class="n">all_parts</span><span class="p">]:</span>
</span><span id="ZakatTracker-3303"><a href="#ZakatTracker-3303"><span class="linenos">3303</span></a>                        <span class="n">part</span> <span class="o">=</span> <span class="n">parts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="ZakatTracker-3304"><a href="#ZakatTracker-3304"><span class="linenos">3304</span></a>                        <span class="n">demand</span> <span class="o">=</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;demand&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3305"><a href="#ZakatTracker-3305"><span class="linenos">3305</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3306"><a href="#ZakatTracker-3306"><span class="linenos">3306</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-3307"><a href="#ZakatTracker-3307"><span class="linenos">3307</span></a>                        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3308"><a href="#ZakatTracker-3308"><span class="linenos">3308</span></a>                        <span class="n">z</span> <span class="o">=</span> <span class="n">demand</span> <span class="o">/</span> <span class="n">count</span>
</span><span id="ZakatTracker-3309"><a href="#ZakatTracker-3309"><span class="linenos">3309</span></a>                        <span class="n">cp</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker-3310"><a href="#ZakatTracker-3310"><span class="linenos">3310</span></a>                            <span class="s1">&#39;account&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker-3311"><a href="#ZakatTracker-3311"><span class="linenos">3311</span></a>                            <span class="s1">&#39;demand&#39;</span><span class="p">:</span> <span class="n">demand</span><span class="p">,</span>
</span><span id="ZakatTracker-3312"><a href="#ZakatTracker-3312"><span class="linenos">3312</span></a>                            <span class="s1">&#39;exceed&#39;</span><span class="p">:</span> <span class="n">exceed</span><span class="p">,</span>
</span><span id="ZakatTracker-3313"><a href="#ZakatTracker-3313"><span class="linenos">3313</span></a>                            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker-3314"><a href="#ZakatTracker-3314"><span class="linenos">3314</span></a>                        <span class="p">}</span>
</span><span id="ZakatTracker-3315"><a href="#ZakatTracker-3315"><span class="linenos">3315</span></a>                        <span class="n">j</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="ZakatTracker-3316"><a href="#ZakatTracker-3316"><span class="linenos">3316</span></a>                        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker-3317"><a href="#ZakatTracker-3317"><span class="linenos">3317</span></a>                            <span class="n">x_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker-3318"><a href="#ZakatTracker-3318"><span class="linenos">3318</span></a>                            <span class="n">zz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange_calc</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-3319"><a href="#ZakatTracker-3319"><span class="linenos">3319</span></a>                            <span class="k">if</span> <span class="n">exceed</span> <span class="ow">and</span> <span class="n">zz</span> <span class="o">&lt;=</span> <span class="n">demand</span><span class="p">:</span>
</span><span id="ZakatTracker-3320"><a href="#ZakatTracker-3320"><span class="linenos">3320</span></a>                                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-3321"><a href="#ZakatTracker-3321"><span class="linenos">3321</span></a>                                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zz</span>
</span><span id="ZakatTracker-3322"><a href="#ZakatTracker-3322"><span class="linenos">3322</span></a>                                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3323"><a href="#ZakatTracker-3323"><span class="linenos">3323</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="n">exceed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker-3324"><a href="#ZakatTracker-3324"><span class="linenos">3324</span></a>                                <span class="n">cp</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
</span><span id="ZakatTracker-3325"><a href="#ZakatTracker-3325"><span class="linenos">3325</span></a>                                <span class="k">case</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker-3326"><a href="#ZakatTracker-3326"><span class="linenos">3326</span></a>                            <span class="k">elif</span> <span class="ow">not</span> <span class="n">exceed</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">zz</span><span class="p">:</span>
</span><span id="ZakatTracker-3327"><a href="#ZakatTracker-3327"><span class="linenos">3327</span></a>                                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-3328"><a href="#ZakatTracker-3328"><span class="linenos">3328</span></a>                                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zz</span>
</span><span id="ZakatTracker-3329"><a href="#ZakatTracker-3329"><span class="linenos">3329</span></a>                                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3330"><a href="#ZakatTracker-3330"><span class="linenos">3330</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="n">exceed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker-3331"><a href="#ZakatTracker-3331"><span class="linenos">3331</span></a>                                <span class="n">cp</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
</span><span id="ZakatTracker-3332"><a href="#ZakatTracker-3332"><span class="linenos">3332</span></a>                                <span class="k">case</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker-3333"><a href="#ZakatTracker-3333"><span class="linenos">3333</span></a>                            <span class="n">j</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="ZakatTracker-3334"><a href="#ZakatTracker-3334"><span class="linenos">3334</span></a>                            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">count</span><span class="p">:</span>
</span><span id="ZakatTracker-3335"><a href="#ZakatTracker-3335"><span class="linenos">3335</span></a>                                <span class="k">break</span>
</span><span id="ZakatTracker-3336"><a href="#ZakatTracker-3336"><span class="linenos">3336</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker-3337"><a href="#ZakatTracker-3337"><span class="linenos">3337</span></a>                            <span class="n">suite</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
</span><span id="ZakatTracker-3338"><a href="#ZakatTracker-3338"><span class="linenos">3338</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3339"><a href="#ZakatTracker-3339"><span class="linenos">3339</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;suite&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">suite</span><span class="p">))</span>
</span><span id="ZakatTracker-3340"><a href="#ZakatTracker-3340"><span class="linenos">3340</span></a>                <span class="c1"># vault = self._vault.copy()</span>
</span><span id="ZakatTracker-3341"><a href="#ZakatTracker-3341"><span class="linenos">3341</span></a>                <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">suite</span><span class="p">:</span>
</span><span id="ZakatTracker-3342"><a href="#ZakatTracker-3342"><span class="linenos">3342</span></a>                    <span class="c1"># self._vault = vault.copy()</span>
</span><span id="ZakatTracker-3343"><a href="#ZakatTracker-3343"><span class="linenos">3343</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3344"><a href="#ZakatTracker-3344"><span class="linenos">3344</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;case&#39;</span><span class="p">,</span> <span class="n">case</span><span class="p">)</span>
</span><span id="ZakatTracker-3345"><a href="#ZakatTracker-3345"><span class="linenos">3345</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_payment_parts</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>
</span><span id="ZakatTracker-3346"><a href="#ZakatTracker-3346"><span class="linenos">3346</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3347"><a href="#ZakatTracker-3347"><span class="linenos">3347</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_payment_parts&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;exceed: </span><span class="si">{</span><span class="n">exceed</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-3348"><a href="#ZakatTracker-3348"><span class="linenos">3348</span></a>                    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3349"><a href="#ZakatTracker-3349"><span class="linenos">3349</span></a>
</span><span id="ZakatTracker-3350"><a href="#ZakatTracker-3350"><span class="linenos">3350</span></a>                    <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="mf">2.17</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-3351"><a href="#ZakatTracker-3351"><span class="linenos">3351</span></a>                    <span class="p">(</span><span class="n">valid</span><span class="p">,</span> <span class="n">brief</span><span class="p">,</span> <span class="n">plan</span><span class="p">)</span> <span class="o">=</span> <span class="n">report</span>
</span><span id="ZakatTracker-3352"><a href="#ZakatTracker-3352"><span class="linenos">3352</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3353"><a href="#ZakatTracker-3353"><span class="linenos">3353</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span> <span class="n">valid</span><span class="p">)</span>
</span><span id="ZakatTracker-3354"><a href="#ZakatTracker-3354"><span class="linenos">3354</span></a>                    <span class="n">zakat_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zakat</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="n">case</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-3355"><a href="#ZakatTracker-3355"><span class="linenos">3355</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3356"><a href="#ZakatTracker-3356"><span class="linenos">3356</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;zakat-result&#39;</span><span class="p">,</span> <span class="n">zakat_result</span><span class="p">)</span>
</span><span id="ZakatTracker-3357"><a href="#ZakatTracker-3357"><span class="linenos">3357</span></a>                    <span class="k">assert</span> <span class="n">valid</span> <span class="o">==</span> <span class="n">zakat_result</span>
</span><span id="ZakatTracker-3358"><a href="#ZakatTracker-3358"><span class="linenos">3358</span></a>
</span><span id="ZakatTracker-3359"><a href="#ZakatTracker-3359"><span class="linenos">3359</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-3360"><a href="#ZakatTracker-3360"><span class="linenos">3360</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_json</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-3361"><a href="#ZakatTracker-3361"><span class="linenos">3361</span></a>
</span><span id="ZakatTracker-3362"><a href="#ZakatTracker-3362"><span class="linenos">3362</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_json</span><span class="p">(</span><span class="s2">&quot;1000-transactions-test.json&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3363"><a href="#ZakatTracker-3363"><span class="linenos">3363</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1000-transactions-test.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3364"><a href="#ZakatTracker-3364"><span class="linenos">3364</span></a>
</span><span id="ZakatTracker-3365"><a href="#ZakatTracker-3365"><span class="linenos">3365</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker-3366"><a href="#ZakatTracker-3366"><span class="linenos">3366</span></a>
</span><span id="ZakatTracker-3367"><a href="#ZakatTracker-3367"><span class="linenos">3367</span></a>            <span class="c1"># test transfer between accounts with different exchange rate</span>
</span><span id="ZakatTracker-3368"><a href="#ZakatTracker-3368"><span class="linenos">3368</span></a>
</span><span id="ZakatTracker-3369"><a href="#ZakatTracker-3369"><span class="linenos">3369</span></a>            <span class="n">a_SAR</span> <span class="o">=</span> <span class="s2">&quot;Bank (SAR)&quot;</span>
</span><span id="ZakatTracker-3370"><a href="#ZakatTracker-3370"><span class="linenos">3370</span></a>            <span class="n">b_USD</span> <span class="o">=</span> <span class="s2">&quot;Bank (USD)&quot;</span>
</span><span id="ZakatTracker-3371"><a href="#ZakatTracker-3371"><span class="linenos">3371</span></a>            <span class="n">c_SAR</span> <span class="o">=</span> <span class="s2">&quot;Safe (SAR)&quot;</span>
</span><span id="ZakatTracker-3372"><a href="#ZakatTracker-3372"><span class="linenos">3372</span></a>            <span class="c1"># 0: track, 1: check-exchange, 2: do-exchange, 3: transfer</span>
</span><span id="ZakatTracker-3373"><a href="#ZakatTracker-3373"><span class="linenos">3373</span></a>            <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="ZakatTracker-3374"><a href="#ZakatTracker-3374"><span class="linenos">3374</span></a>                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_SAR</span><span class="p">,</span> <span class="s2">&quot;SAR Gift&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span>
</span><span id="ZakatTracker-3375"><a href="#ZakatTracker-3375"><span class="linenos">3375</span></a>                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a_SAR</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="ZakatTracker-3376"><a href="#ZakatTracker-3376"><span class="linenos">3376</span></a>                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="s2">&quot;USD Gift&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">50000</span><span class="p">),</span>
</span><span id="ZakatTracker-3377"><a href="#ZakatTracker-3377"><span class="linenos">3377</span></a>                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="ZakatTracker-3378"><a href="#ZakatTracker-3378"><span class="linenos">3378</span></a>                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="mf">3.75</span><span class="p">),</span>
</span><span id="ZakatTracker-3379"><a href="#ZakatTracker-3379"><span class="linenos">3379</span></a>                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="mf">3.75</span><span class="p">),</span>
</span><span id="ZakatTracker-3380"><a href="#ZakatTracker-3380"><span class="linenos">3380</span></a>                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="n">a_SAR</span><span class="p">,</span> <span class="s2">&quot;100 USD -&gt; SAR&quot;</span><span class="p">,</span> <span class="mi">40000</span><span class="p">,</span> <span class="mi">137500</span><span class="p">),</span>
</span><span id="ZakatTracker-3381"><a href="#ZakatTracker-3381"><span class="linenos">3381</span></a>                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c_SAR</span><span class="p">,</span> <span class="s2">&quot;Salary&quot;</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">75000</span><span class="p">),</span>
</span><span id="ZakatTracker-3382"><a href="#ZakatTracker-3382"><span class="linenos">3382</span></a>                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="n">c_SAR</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="s2">&quot;375 SAR -&gt; USD&quot;</span><span class="p">,</span> <span class="mi">37500</span><span class="p">,</span> <span class="mi">50000</span><span class="p">),</span>
</span><span id="ZakatTracker-3383"><a href="#ZakatTracker-3383"><span class="linenos">3383</span></a>                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">3.75</span><span class="p">,</span> <span class="n">a_SAR</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="s2">&quot;3.75 SAR -&gt; USD&quot;</span><span class="p">,</span> <span class="mi">137125</span><span class="p">,</span> <span class="mi">50100</span><span class="p">),</span>
</span><span id="ZakatTracker-3384"><a href="#ZakatTracker-3384"><span class="linenos">3384</span></a>            <span class="p">]:</span>
</span><span id="ZakatTracker-3385"><a href="#ZakatTracker-3385"><span class="linenos">3385</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3386"><a href="#ZakatTracker-3386"><span class="linenos">3386</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;case&#39;</span><span class="p">,</span> <span class="n">case</span><span class="p">)</span>
</span><span id="ZakatTracker-3387"><a href="#ZakatTracker-3387"><span class="linenos">3387</span></a>                <span class="k">match</span> <span class="p">(</span><span class="n">case</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="ZakatTracker-3388"><a href="#ZakatTracker-3388"><span class="linenos">3388</span></a>                    <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># track</span>
</span><span id="ZakatTracker-3389"><a href="#ZakatTracker-3389"><span class="linenos">3389</span></a>                        <span class="n">_</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">case</span>
</span><span id="ZakatTracker-3390"><a href="#ZakatTracker-3390"><span class="linenos">3390</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="n">unscaled_value</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-3391"><a href="#ZakatTracker-3391"><span class="linenos">3391</span></a>
</span><span id="ZakatTracker-3392"><a href="#ZakatTracker-3392"><span class="linenos">3392</span></a>                        <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker-3393"><a href="#ZakatTracker-3393"><span class="linenos">3393</span></a>                        <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker-3394"><a href="#ZakatTracker-3394"><span class="linenos">3394</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3395"><a href="#ZakatTracker-3395"><span class="linenos">3395</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span> <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">)</span>
</span><span id="ZakatTracker-3396"><a href="#ZakatTracker-3396"><span class="linenos">3396</span></a>                        <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">balance</span>
</span><span id="ZakatTracker-3397"><a href="#ZakatTracker-3397"><span class="linenos">3397</span></a>                        <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">balance</span>
</span><span id="ZakatTracker-3398"><a href="#ZakatTracker-3398"><span class="linenos">3398</span></a>                    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># check-exchange</span>
</span><span id="ZakatTracker-3399"><a href="#ZakatTracker-3399"><span class="linenos">3399</span></a>                        <span class="n">_</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">expected_rate</span> <span class="o">=</span> <span class="n">case</span>
</span><span id="ZakatTracker-3400"><a href="#ZakatTracker-3400"><span class="linenos">3400</span></a>                        <span class="n">t_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-3401"><a href="#ZakatTracker-3401"><span class="linenos">3401</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3402"><a href="#ZakatTracker-3402"><span class="linenos">3402</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t-exchange&#39;</span><span class="p">,</span> <span class="n">t_exchange</span><span class="p">)</span>
</span><span id="ZakatTracker-3403"><a href="#ZakatTracker-3403"><span class="linenos">3403</span></a>                        <span class="k">assert</span> <span class="n">t_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_rate</span>
</span><span id="ZakatTracker-3404"><a href="#ZakatTracker-3404"><span class="linenos">3404</span></a>                    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># do-exchange</span>
</span><span id="ZakatTracker-3405"><a href="#ZakatTracker-3405"><span class="linenos">3405</span></a>                        <span class="n">_</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">case</span>
</span><span id="ZakatTracker-3406"><a href="#ZakatTracker-3406"><span class="linenos">3406</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-3407"><a href="#ZakatTracker-3407"><span class="linenos">3407</span></a>                        <span class="n">b_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-3408"><a href="#ZakatTracker-3408"><span class="linenos">3408</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3409"><a href="#ZakatTracker-3409"><span class="linenos">3409</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;b-exchange&#39;</span><span class="p">,</span> <span class="n">b_exchange</span><span class="p">)</span>
</span><span id="ZakatTracker-3410"><a href="#ZakatTracker-3410"><span class="linenos">3410</span></a>                        <span class="k">assert</span> <span class="n">b_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">rate</span>
</span><span id="ZakatTracker-3411"><a href="#ZakatTracker-3411"><span class="linenos">3411</span></a>                    <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># transfer</span>
</span><span id="ZakatTracker-3412"><a href="#ZakatTracker-3412"><span class="linenos">3412</span></a>                        <span class="n">_</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">a_balance</span><span class="p">,</span> <span class="n">b_balance</span> <span class="o">=</span> <span class="n">case</span>
</span><span id="ZakatTracker-3413"><a href="#ZakatTracker-3413"><span class="linenos">3413</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-3414"><a href="#ZakatTracker-3414"><span class="linenos">3414</span></a>
</span><span id="ZakatTracker-3415"><a href="#ZakatTracker-3415"><span class="linenos">3415</span></a>                        <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker-3416"><a href="#ZakatTracker-3416"><span class="linenos">3416</span></a>                        <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker-3417"><a href="#ZakatTracker-3417"><span class="linenos">3417</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3418"><a href="#ZakatTracker-3418"><span class="linenos">3418</span></a>                            <span class="nb">print</span><span class="p">(</span>
</span><span id="ZakatTracker-3419"><a href="#ZakatTracker-3419"><span class="linenos">3419</span></a>                                <span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span>
</span><span id="ZakatTracker-3420"><a href="#ZakatTracker-3420"><span class="linenos">3420</span></a>                                <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span>
</span><span id="ZakatTracker-3421"><a href="#ZakatTracker-3421"><span class="linenos">3421</span></a>                                <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">,</span>
</span><span id="ZakatTracker-3422"><a href="#ZakatTracker-3422"><span class="linenos">3422</span></a>                                <span class="s1">&#39;a_balance&#39;</span><span class="p">,</span> <span class="n">a_balance</span><span class="p">,</span>
</span><span id="ZakatTracker-3423"><a href="#ZakatTracker-3423"><span class="linenos">3423</span></a>                            <span class="p">)</span>
</span><span id="ZakatTracker-3424"><a href="#ZakatTracker-3424"><span class="linenos">3424</span></a>                        <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">a_balance</span>
</span><span id="ZakatTracker-3425"><a href="#ZakatTracker-3425"><span class="linenos">3425</span></a>                        <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">a_balance</span>
</span><span id="ZakatTracker-3426"><a href="#ZakatTracker-3426"><span class="linenos">3426</span></a>
</span><span id="ZakatTracker-3427"><a href="#ZakatTracker-3427"><span class="linenos">3427</span></a>                        <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker-3428"><a href="#ZakatTracker-3428"><span class="linenos">3428</span></a>                        <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker-3429"><a href="#ZakatTracker-3429"><span class="linenos">3429</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3430"><a href="#ZakatTracker-3430"><span class="linenos">3430</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span> <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">)</span>
</span><span id="ZakatTracker-3431"><a href="#ZakatTracker-3431"><span class="linenos">3431</span></a>                        <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">b_balance</span>
</span><span id="ZakatTracker-3432"><a href="#ZakatTracker-3432"><span class="linenos">3432</span></a>                        <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">b_balance</span>
</span><span id="ZakatTracker-3433"><a href="#ZakatTracker-3433"><span class="linenos">3433</span></a>
</span><span id="ZakatTracker-3434"><a href="#ZakatTracker-3434"><span class="linenos">3434</span></a>            <span class="c1"># Transfer all in many chunks randomly from B to A</span>
</span><span id="ZakatTracker-3435"><a href="#ZakatTracker-3435"><span class="linenos">3435</span></a>            <span class="n">a_SAR_balance</span> <span class="o">=</span> <span class="mi">137125</span>
</span><span id="ZakatTracker-3436"><a href="#ZakatTracker-3436"><span class="linenos">3436</span></a>            <span class="n">b_USD_balance</span> <span class="o">=</span> <span class="mi">50100</span>
</span><span id="ZakatTracker-3437"><a href="#ZakatTracker-3437"><span class="linenos">3437</span></a>            <span class="n">b_USD_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">b_USD</span><span class="p">)</span>
</span><span id="ZakatTracker-3438"><a href="#ZakatTracker-3438"><span class="linenos">3438</span></a>            <span class="n">amounts</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">create_random_list</span><span class="p">(</span><span class="n">b_USD_balance</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="ZakatTracker-3439"><a href="#ZakatTracker-3439"><span class="linenos">3439</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3440"><a href="#ZakatTracker-3440"><span class="linenos">3440</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;amounts&#39;</span><span class="p">,</span> <span class="n">amounts</span><span class="p">)</span>
</span><span id="ZakatTracker-3441"><a href="#ZakatTracker-3441"><span class="linenos">3441</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3442"><a href="#ZakatTracker-3442"><span class="linenos">3442</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">amounts</span><span class="p">:</span>
</span><span id="ZakatTracker-3443"><a href="#ZakatTracker-3443"><span class="linenos">3443</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3444"><a href="#ZakatTracker-3444"><span class="linenos">3444</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> - transfer-with-exchange(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-3445"><a href="#ZakatTracker-3445"><span class="linenos">3445</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span>
</span><span id="ZakatTracker-3446"><a href="#ZakatTracker-3446"><span class="linenos">3446</span></a>                    <span class="n">unscaled_amount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
</span><span id="ZakatTracker-3447"><a href="#ZakatTracker-3447"><span class="linenos">3447</span></a>                    <span class="n">from_account</span><span class="o">=</span><span class="n">b_USD</span><span class="p">,</span>
</span><span id="ZakatTracker-3448"><a href="#ZakatTracker-3448"><span class="linenos">3448</span></a>                    <span class="n">to_account</span><span class="o">=</span><span class="n">a_SAR</span><span class="p">,</span>
</span><span id="ZakatTracker-3449"><a href="#ZakatTracker-3449"><span class="linenos">3449</span></a>                    <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> USD -&gt; SAR&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker-3450"><a href="#ZakatTracker-3450"><span class="linenos">3450</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="ZakatTracker-3451"><a href="#ZakatTracker-3451"><span class="linenos">3451</span></a>                <span class="p">)</span>
</span><span id="ZakatTracker-3452"><a href="#ZakatTracker-3452"><span class="linenos">3452</span></a>
</span><span id="ZakatTracker-3453"><a href="#ZakatTracker-3453"><span class="linenos">3453</span></a>                <span class="n">b_USD_balance</span> <span class="o">-=</span> <span class="n">x</span>
</span><span id="ZakatTracker-3454"><a href="#ZakatTracker-3454"><span class="linenos">3454</span></a>                <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">b_USD</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker-3455"><a href="#ZakatTracker-3455"><span class="linenos">3455</span></a>                <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">b_USD</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker-3456"><a href="#ZakatTracker-3456"><span class="linenos">3456</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3457"><a href="#ZakatTracker-3457"><span class="linenos">3457</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span> <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">,</span> <span class="s1">&#39;excepted&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-3458"><a href="#ZakatTracker-3458"><span class="linenos">3458</span></a>                          <span class="n">b_USD_balance</span><span class="p">)</span>
</span><span id="ZakatTracker-3459"><a href="#ZakatTracker-3459"><span class="linenos">3459</span></a>                <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">b_USD_balance</span>
</span><span id="ZakatTracker-3460"><a href="#ZakatTracker-3460"><span class="linenos">3460</span></a>                <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">b_USD_balance</span>
</span><span id="ZakatTracker-3461"><a href="#ZakatTracker-3461"><span class="linenos">3461</span></a>
</span><span id="ZakatTracker-3462"><a href="#ZakatTracker-3462"><span class="linenos">3462</span></a>                <span class="n">a_SAR_balance</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">b_USD_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-3463"><a href="#ZakatTracker-3463"><span class="linenos">3463</span></a>                <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">a_SAR</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker-3464"><a href="#ZakatTracker-3464"><span class="linenos">3464</span></a>                <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">a_SAR</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker-3465"><a href="#ZakatTracker-3465"><span class="linenos">3465</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3466"><a href="#ZakatTracker-3466"><span class="linenos">3466</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">a_SAR</span><span class="p">,</span> <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span> <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">,</span> <span class="s1">&#39;expected&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-3467"><a href="#ZakatTracker-3467"><span class="linenos">3467</span></a>                          <span class="n">a_SAR_balance</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">,</span> <span class="n">b_USD_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-3468"><a href="#ZakatTracker-3468"><span class="linenos">3468</span></a>                <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">a_SAR_balance</span>
</span><span id="ZakatTracker-3469"><a href="#ZakatTracker-3469"><span class="linenos">3469</span></a>                <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">a_SAR_balance</span>
</span><span id="ZakatTracker-3470"><a href="#ZakatTracker-3470"><span class="linenos">3470</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-3471"><a href="#ZakatTracker-3471"><span class="linenos">3471</span></a>
</span><span id="ZakatTracker-3472"><a href="#ZakatTracker-3472"><span class="linenos">3472</span></a>            <span class="c1"># Transfer all in many chunks randomly from C to A</span>
</span><span id="ZakatTracker-3473"><a href="#ZakatTracker-3473"><span class="linenos">3473</span></a>            <span class="n">c_SAR_balance</span> <span class="o">=</span> <span class="mi">37500</span>
</span><span id="ZakatTracker-3474"><a href="#ZakatTracker-3474"><span class="linenos">3474</span></a>            <span class="n">amounts</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">create_random_list</span><span class="p">(</span><span class="n">c_SAR_balance</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="ZakatTracker-3475"><a href="#ZakatTracker-3475"><span class="linenos">3475</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3476"><a href="#ZakatTracker-3476"><span class="linenos">3476</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;amounts&#39;</span><span class="p">,</span> <span class="n">amounts</span><span class="p">)</span>
</span><span id="ZakatTracker-3477"><a href="#ZakatTracker-3477"><span class="linenos">3477</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3478"><a href="#ZakatTracker-3478"><span class="linenos">3478</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">amounts</span><span class="p">:</span>
</span><span id="ZakatTracker-3479"><a href="#ZakatTracker-3479"><span class="linenos">3479</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3480"><a href="#ZakatTracker-3480"><span class="linenos">3480</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> - transfer-with-exchange(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker-3481"><a href="#ZakatTracker-3481"><span class="linenos">3481</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span>
</span><span id="ZakatTracker-3482"><a href="#ZakatTracker-3482"><span class="linenos">3482</span></a>                    <span class="n">unscaled_amount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
</span><span id="ZakatTracker-3483"><a href="#ZakatTracker-3483"><span class="linenos">3483</span></a>                    <span class="n">from_account</span><span class="o">=</span><span class="n">c_SAR</span><span class="p">,</span>
</span><span id="ZakatTracker-3484"><a href="#ZakatTracker-3484"><span class="linenos">3484</span></a>                    <span class="n">to_account</span><span class="o">=</span><span class="n">a_SAR</span><span class="p">,</span>
</span><span id="ZakatTracker-3485"><a href="#ZakatTracker-3485"><span class="linenos">3485</span></a>                    <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> SAR -&gt; a_SAR&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker-3486"><a href="#ZakatTracker-3486"><span class="linenos">3486</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="ZakatTracker-3487"><a href="#ZakatTracker-3487"><span class="linenos">3487</span></a>                <span class="p">)</span>
</span><span id="ZakatTracker-3488"><a href="#ZakatTracker-3488"><span class="linenos">3488</span></a>
</span><span id="ZakatTracker-3489"><a href="#ZakatTracker-3489"><span class="linenos">3489</span></a>                <span class="n">c_SAR_balance</span> <span class="o">-=</span> <span class="n">x</span>
</span><span id="ZakatTracker-3490"><a href="#ZakatTracker-3490"><span class="linenos">3490</span></a>                <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">c_SAR</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker-3491"><a href="#ZakatTracker-3491"><span class="linenos">3491</span></a>                <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">c_SAR</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker-3492"><a href="#ZakatTracker-3492"><span class="linenos">3492</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3493"><a href="#ZakatTracker-3493"><span class="linenos">3493</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">c_SAR</span><span class="p">,</span> <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span> <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">,</span> <span class="s1">&#39;excepted&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-3494"><a href="#ZakatTracker-3494"><span class="linenos">3494</span></a>                          <span class="n">c_SAR_balance</span><span class="p">)</span>
</span><span id="ZakatTracker-3495"><a href="#ZakatTracker-3495"><span class="linenos">3495</span></a>                <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">c_SAR_balance</span>
</span><span id="ZakatTracker-3496"><a href="#ZakatTracker-3496"><span class="linenos">3496</span></a>                <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">c_SAR_balance</span>
</span><span id="ZakatTracker-3497"><a href="#ZakatTracker-3497"><span class="linenos">3497</span></a>
</span><span id="ZakatTracker-3498"><a href="#ZakatTracker-3498"><span class="linenos">3498</span></a>                <span class="n">a_SAR_balance</span> <span class="o">+=</span> <span class="n">x</span>
</span><span id="ZakatTracker-3499"><a href="#ZakatTracker-3499"><span class="linenos">3499</span></a>                <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">a_SAR</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker-3500"><a href="#ZakatTracker-3500"><span class="linenos">3500</span></a>                <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">a_SAR</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker-3501"><a href="#ZakatTracker-3501"><span class="linenos">3501</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3502"><a href="#ZakatTracker-3502"><span class="linenos">3502</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">a_SAR</span><span class="p">,</span> <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span> <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">,</span> <span class="s1">&#39;expected&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-3503"><a href="#ZakatTracker-3503"><span class="linenos">3503</span></a>                          <span class="n">a_SAR_balance</span><span class="p">)</span>
</span><span id="ZakatTracker-3504"><a href="#ZakatTracker-3504"><span class="linenos">3504</span></a>                <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">a_SAR_balance</span>
</span><span id="ZakatTracker-3505"><a href="#ZakatTracker-3505"><span class="linenos">3505</span></a>                <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">a_SAR_balance</span>
</span><span id="ZakatTracker-3506"><a href="#ZakatTracker-3506"><span class="linenos">3506</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker-3507"><a href="#ZakatTracker-3507"><span class="linenos">3507</span></a>
</span><span id="ZakatTracker-3508"><a href="#ZakatTracker-3508"><span class="linenos">3508</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_json</span><span class="p">(</span><span class="s2">&quot;accounts-transfer-with-exchange-rates.json&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3509"><a href="#ZakatTracker-3509"><span class="linenos">3509</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;accounts-transfer-with-exchange-rates.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3510"><a href="#ZakatTracker-3510"><span class="linenos">3510</span></a>
</span><span id="ZakatTracker-3511"><a href="#ZakatTracker-3511"><span class="linenos">3511</span></a>            <span class="c1"># check &amp; zakat with exchange rates for many cycles</span>
</span><span id="ZakatTracker-3512"><a href="#ZakatTracker-3512"><span class="linenos">3512</span></a>
</span><span id="ZakatTracker-3513"><a href="#ZakatTracker-3513"><span class="linenos">3513</span></a>            <span class="k">for</span> <span class="n">rate</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="p">{</span>
</span><span id="ZakatTracker-3514"><a href="#ZakatTracker-3514"><span class="linenos">3514</span></a>                <span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker-3515"><a href="#ZakatTracker-3515"><span class="linenos">3515</span></a>                    <span class="s1">&#39;in&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">],</span>
</span><span id="ZakatTracker-3516"><a href="#ZakatTracker-3516"><span class="linenos">3516</span></a>                    <span class="s1">&#39;exchanged&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">200000</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">],</span>
</span><span id="ZakatTracker-3517"><a href="#ZakatTracker-3517"><span class="linenos">3517</span></a>                    <span class="s1">&#39;out&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2500</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">73140</span><span class="p">],</span>
</span><span id="ZakatTracker-3518"><a href="#ZakatTracker-3518"><span class="linenos">3518</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker-3519"><a href="#ZakatTracker-3519"><span class="linenos">3519</span></a>                <span class="mf">3.75</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker-3520"><a href="#ZakatTracker-3520"><span class="linenos">3520</span></a>                    <span class="s1">&#39;in&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">],</span>
</span><span id="ZakatTracker-3521"><a href="#ZakatTracker-3521"><span class="linenos">3521</span></a>                    <span class="s1">&#39;exchanged&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">75000</span><span class="p">,</span> <span class="mi">375000</span><span class="p">,</span> <span class="mi">1875000</span><span class="p">],</span>
</span><span id="ZakatTracker-3522"><a href="#ZakatTracker-3522"><span class="linenos">3522</span></a>                    <span class="s1">&#39;out&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1875</span><span class="p">,</span> <span class="mi">9375</span><span class="p">,</span> <span class="mi">137138</span><span class="p">],</span>
</span><span id="ZakatTracker-3523"><a href="#ZakatTracker-3523"><span class="linenos">3523</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker-3524"><a href="#ZakatTracker-3524"><span class="linenos">3524</span></a>            <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker-3525"><a href="#ZakatTracker-3525"><span class="linenos">3525</span></a>                <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;in&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3526"><a href="#ZakatTracker-3526"><span class="linenos">3526</span></a>                <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;exchanged&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3527"><a href="#ZakatTracker-3527"><span class="linenos">3527</span></a>                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3528"><a href="#ZakatTracker-3528"><span class="linenos">3528</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3529"><a href="#ZakatTracker-3529"><span class="linenos">3529</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;rate&#39;</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="ZakatTracker-3530"><a href="#ZakatTracker-3530"><span class="linenos">3530</span></a>                <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="ZakatTracker-3531"><a href="#ZakatTracker-3531"><span class="linenos">3531</span></a>                    <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;safe&#39;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">TimeCycle</span><span class="p">(),</span> <span class="p">[</span>
</span><span id="ZakatTracker-3532"><a href="#ZakatTracker-3532"><span class="linenos">3532</span></a>                        <span class="p">{</span><span class="s1">&#39;safe&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;below_nisab&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">}}},</span>
</span><span id="ZakatTracker-3533"><a href="#ZakatTracker-3533"><span class="linenos">3533</span></a>                    <span class="p">],</span> <span class="kc">False</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span>
</span><span id="ZakatTracker-3534"><a href="#ZakatTracker-3534"><span class="linenos">3534</span></a>                    <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;safe&#39;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">TimeCycle</span><span class="p">(),</span> <span class="p">[</span>
</span><span id="ZakatTracker-3535"><a href="#ZakatTracker-3535"><span class="linenos">3535</span></a>                        <span class="p">{</span><span class="s1">&#39;safe&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">}}},</span>
</span><span id="ZakatTracker-3536"><a href="#ZakatTracker-3536"><span class="linenos">3536</span></a>                    <span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span>
</span><span id="ZakatTracker-3537"><a href="#ZakatTracker-3537"><span class="linenos">3537</span></a>                    <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;cave&#39;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="n">ZakatTracker</span><span class="o">.</span><span class="n">TimeCycle</span><span class="p">()</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span> <span class="p">[</span>
</span><span id="ZakatTracker-3538"><a href="#ZakatTracker-3538"><span class="linenos">3538</span></a>                        <span class="p">{</span><span class="s1">&#39;cave&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">}}},</span>
</span><span id="ZakatTracker-3539"><a href="#ZakatTracker-3539"><span class="linenos">3539</span></a>                    <span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">o</span><span class="p">),</span>
</span><span id="ZakatTracker-3540"><a href="#ZakatTracker-3540"><span class="linenos">3540</span></a>                <span class="p">]:</span>
</span><span id="ZakatTracker-3541"><a href="#ZakatTracker-3541"><span class="linenos">3541</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3542"><a href="#ZakatTracker-3542"><span class="linenos">3542</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;############# check(rate: </span><span class="si">{</span><span class="n">rate</span><span class="si">}</span><span class="s2">) #############&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3543"><a href="#ZakatTracker-3543"><span class="linenos">3543</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;case&#39;</span><span class="p">,</span> <span class="n">case</span><span class="p">)</span>
</span><span id="ZakatTracker-3544"><a href="#ZakatTracker-3544"><span class="linenos">3544</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker-3545"><a href="#ZakatTracker-3545"><span class="linenos">3545</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">created</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rate</span><span class="o">=</span><span class="n">rate</span><span class="p">)</span>
</span><span id="ZakatTracker-3546"><a href="#ZakatTracker-3546"><span class="linenos">3546</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span>
</span><span id="ZakatTracker-3547"><a href="#ZakatTracker-3547"><span class="linenos">3547</span></a>                        <span class="n">unscaled_value</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ZakatTracker-3548"><a href="#ZakatTracker-3548"><span class="linenos">3548</span></a>                        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;test-check&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker-3549"><a href="#ZakatTracker-3549"><span class="linenos">3549</span></a>                        <span class="n">account</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ZakatTracker-3550"><a href="#ZakatTracker-3550"><span class="linenos">3550</span></a>                        <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ZakatTracker-3551"><a href="#ZakatTracker-3551"><span class="linenos">3551</span></a>                        <span class="n">created</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="ZakatTracker-3552"><a href="#ZakatTracker-3552"><span class="linenos">3552</span></a>                    <span class="p">)</span>
</span><span id="ZakatTracker-3553"><a href="#ZakatTracker-3553"><span class="linenos">3553</span></a>                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot</span><span class="p">()</span>
</span><span id="ZakatTracker-3554"><a href="#ZakatTracker-3554"><span class="linenos">3554</span></a>
</span><span id="ZakatTracker-3555"><a href="#ZakatTracker-3555"><span class="linenos">3555</span></a>                    <span class="c1"># assert self.nolock()</span>
</span><span id="ZakatTracker-3556"><a href="#ZakatTracker-3556"><span class="linenos">3556</span></a>                    <span class="c1"># history_size = len(self._vault[&#39;history&#39;])</span>
</span><span id="ZakatTracker-3557"><a href="#ZakatTracker-3557"><span class="linenos">3557</span></a>                    <span class="c1"># print(&#39;history_size&#39;, history_size)</span>
</span><span id="ZakatTracker-3558"><a href="#ZakatTracker-3558"><span class="linenos">3558</span></a>                    <span class="c1"># assert history_size == 2</span>
</span><span id="ZakatTracker-3559"><a href="#ZakatTracker-3559"><span class="linenos">3559</span></a>                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker-3560"><a href="#ZakatTracker-3560"><span class="linenos">3560</span></a>                    <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-3561"><a href="#ZakatTracker-3561"><span class="linenos">3561</span></a>                    <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="mf">2.17</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-3562"><a href="#ZakatTracker-3562"><span class="linenos">3562</span></a>                    <span class="p">(</span><span class="n">valid</span><span class="p">,</span> <span class="n">brief</span><span class="p">,</span> <span class="n">plan</span><span class="p">)</span> <span class="o">=</span> <span class="n">report</span>
</span><span id="ZakatTracker-3563"><a href="#ZakatTracker-3563"><span class="linenos">3563</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3564"><a href="#ZakatTracker-3564"><span class="linenos">3564</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;brief&#39;</span><span class="p">,</span> <span class="n">brief</span><span class="p">)</span>
</span><span id="ZakatTracker-3565"><a href="#ZakatTracker-3565"><span class="linenos">3565</span></a>                    <span class="k">assert</span> <span class="n">valid</span> <span class="o">==</span> <span class="n">case</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="ZakatTracker-3566"><a href="#ZakatTracker-3566"><span class="linenos">3566</span></a>                    <span class="k">assert</span> <span class="n">case</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="n">brief</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ZakatTracker-3567"><a href="#ZakatTracker-3567"><span class="linenos">3567</span></a>                    <span class="k">assert</span> <span class="n">case</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="n">brief</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker-3568"><a href="#ZakatTracker-3568"><span class="linenos">3568</span></a>
</span><span id="ZakatTracker-3569"><a href="#ZakatTracker-3569"><span class="linenos">3569</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3570"><a href="#ZakatTracker-3570"><span class="linenos">3570</span></a>                        <span class="n">pp</span><span class="p">()</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">plan</span><span class="p">)</span>
</span><span id="ZakatTracker-3571"><a href="#ZakatTracker-3571"><span class="linenos">3571</span></a>
</span><span id="ZakatTracker-3572"><a href="#ZakatTracker-3572"><span class="linenos">3572</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
</span><span id="ZakatTracker-3573"><a href="#ZakatTracker-3573"><span class="linenos">3573</span></a>                        <span class="k">assert</span> <span class="n">case</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span>
</span><span id="ZakatTracker-3574"><a href="#ZakatTracker-3574"><span class="linenos">3574</span></a>                        <span class="k">if</span> <span class="s1">&#39;total&#39;</span> <span class="ow">in</span> <span class="n">case</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ZakatTracker-3575"><a href="#ZakatTracker-3575"><span class="linenos">3575</span></a>                            <span class="k">assert</span> <span class="n">case</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">brief</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="ZakatTracker-3576"><a href="#ZakatTracker-3576"><span class="linenos">3576</span></a>                            <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">case</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3577"><a href="#ZakatTracker-3577"><span class="linenos">3577</span></a>                            <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">case</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3578"><a href="#ZakatTracker-3578"><span class="linenos">3578</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker-3579"><a href="#ZakatTracker-3579"><span class="linenos">3579</span></a>                            <span class="k">assert</span> <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;below_nisab&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">case</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;below_nisab&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker-3580"><a href="#ZakatTracker-3580"><span class="linenos">3580</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3581"><a href="#ZakatTracker-3581"><span class="linenos">3581</span></a>                        <span class="n">pp</span><span class="p">()</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</span><span id="ZakatTracker-3582"><a href="#ZakatTracker-3582"><span class="linenos">3582</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zakat</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-3583"><a href="#ZakatTracker-3583"><span class="linenos">3583</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3584"><a href="#ZakatTracker-3584"><span class="linenos">3584</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;zakat-result&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">case</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="ZakatTracker-3585"><a href="#ZakatTracker-3585"><span class="linenos">3585</span></a>                    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="n">case</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="ZakatTracker-3586"><a href="#ZakatTracker-3586"><span class="linenos">3586</span></a>                    <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="mf">2.17</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker-3587"><a href="#ZakatTracker-3587"><span class="linenos">3587</span></a>                    <span class="p">(</span><span class="n">valid</span><span class="p">,</span> <span class="n">brief</span><span class="p">,</span> <span class="n">plan</span><span class="p">)</span> <span class="o">=</span> <span class="n">report</span>
</span><span id="ZakatTracker-3588"><a href="#ZakatTracker-3588"><span class="linenos">3588</span></a>                    <span class="k">assert</span> <span class="n">valid</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker-3589"><a href="#ZakatTracker-3589"><span class="linenos">3589</span></a>
</span><span id="ZakatTracker-3590"><a href="#ZakatTracker-3590"><span class="linenos">3590</span></a>            <span class="n">history_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-3591"><a href="#ZakatTracker-3591"><span class="linenos">3591</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3592"><a href="#ZakatTracker-3592"><span class="linenos">3592</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;history_size&#39;</span><span class="p">,</span> <span class="n">history_size</span><span class="p">)</span>
</span><span id="ZakatTracker-3593"><a href="#ZakatTracker-3593"><span class="linenos">3593</span></a>            <span class="k">assert</span> <span class="n">history_size</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="ZakatTracker-3594"><a href="#ZakatTracker-3594"><span class="linenos">3594</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-3595"><a href="#ZakatTracker-3595"><span class="linenos">3595</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker-3596"><a href="#ZakatTracker-3596"><span class="linenos">3596</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">())</span>
</span><span id="ZakatTracker-3597"><a href="#ZakatTracker-3597"><span class="linenos">3597</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-3598"><a href="#ZakatTracker-3598"><span class="linenos">3598</span></a>
</span><span id="ZakatTracker-3599"><a href="#ZakatTracker-3599"><span class="linenos">3599</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ZakatTracker-3600"><a href="#ZakatTracker-3600"><span class="linenos">3600</span></a>                <span class="n">history_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-3601"><a href="#ZakatTracker-3601"><span class="linenos">3601</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3602"><a href="#ZakatTracker-3602"><span class="linenos">3602</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;history_size&#39;</span><span class="p">,</span> <span class="n">history_size</span><span class="p">)</span>
</span><span id="ZakatTracker-3603"><a href="#ZakatTracker-3603"><span class="linenos">3603</span></a>                <span class="k">assert</span> <span class="n">history_size</span> <span class="o">==</span> <span class="n">i</span>
</span><span id="ZakatTracker-3604"><a href="#ZakatTracker-3604"><span class="linenos">3604</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="ZakatTracker-3605"><a href="#ZakatTracker-3605"><span class="linenos">3605</span></a>
</span><span id="ZakatTracker-3606"><a href="#ZakatTracker-3606"><span class="linenos">3606</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-3607"><a href="#ZakatTracker-3607"><span class="linenos">3607</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker-3608"><a href="#ZakatTracker-3608"><span class="linenos">3608</span></a>
</span><span id="ZakatTracker-3609"><a href="#ZakatTracker-3609"><span class="linenos">3609</span></a>            <span class="n">history_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-3610"><a href="#ZakatTracker-3610"><span class="linenos">3610</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3611"><a href="#ZakatTracker-3611"><span class="linenos">3611</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;history_size&#39;</span><span class="p">,</span> <span class="n">history_size</span><span class="p">)</span>
</span><span id="ZakatTracker-3612"><a href="#ZakatTracker-3612"><span class="linenos">3612</span></a>            <span class="k">assert</span> <span class="n">history_size</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3613"><a href="#ZakatTracker-3613"><span class="linenos">3613</span></a>
</span><span id="ZakatTracker-3614"><a href="#ZakatTracker-3614"><span class="linenos">3614</span></a>            <span class="n">account_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-3615"><a href="#ZakatTracker-3615"><span class="linenos">3615</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3616"><a href="#ZakatTracker-3616"><span class="linenos">3616</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account_size&#39;</span><span class="p">,</span> <span class="n">account_size</span><span class="p">)</span>
</span><span id="ZakatTracker-3617"><a href="#ZakatTracker-3617"><span class="linenos">3617</span></a>            <span class="k">assert</span> <span class="n">account_size</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3618"><a href="#ZakatTracker-3618"><span class="linenos">3618</span></a>
</span><span id="ZakatTracker-3619"><a href="#ZakatTracker-3619"><span class="linenos">3619</span></a>            <span class="n">report_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker-3620"><a href="#ZakatTracker-3620"><span class="linenos">3620</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker-3621"><a href="#ZakatTracker-3621"><span class="linenos">3621</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;report_size&#39;</span><span class="p">,</span> <span class="n">report_size</span><span class="p">)</span>
</span><span id="ZakatTracker-3622"><a href="#ZakatTracker-3622"><span class="linenos">3622</span></a>            <span class="k">assert</span> <span class="n">report_size</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker-3623"><a href="#ZakatTracker-3623"><span class="linenos">3623</span></a>
</span><span id="ZakatTracker-3624"><a href="#ZakatTracker-3624"><span class="linenos">3624</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker-3625"><a href="#ZakatTracker-3625"><span class="linenos">3625</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker-3626"><a href="#ZakatTracker-3626"><span class="linenos">3626</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ZakatTracker-3627"><a href="#ZakatTracker-3627"><span class="linenos">3627</span></a>            <span class="c1"># pp().pprint(self._vault)</span>
</span><span id="ZakatTracker-3628"><a href="#ZakatTracker-3628"><span class="linenos">3628</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_json</span><span class="p">(</span><span class="s2">&quot;test-snapshot.json&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3629"><a href="#ZakatTracker-3629"><span class="linenos">3629</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test-snapshot.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker-3630"><a href="#ZakatTracker-3630"><span class="linenos">3630</span></a>            <span class="k">raise</span> <span class="n">e</span>
</span></pre></div>


            <div class="docstring"><p>A class for tracking and calculating Zakat.</p>

<p>This class provides functionalities for recording transactions, calculating Zakat due,
and managing account balances. It also offers features like importing transactions from
CSV files, exporting data to JSON format, and saving/loading the tracker state.</p>

<p>The <code><a href="#ZakatTracker">ZakatTracker</a></code> class is designed to handle both positive and negative transactions,
allowing for flexible tracking of financial activities related to Zakat. It also supports
the concept of a "Nisab" (minimum threshold for Zakat) and a "haul" (complete one year for Transaction) can calculate Zakat due
based on the current silver price.</p>

<p>The class uses a camel file as its database to persist the tracker state,
ensuring data integrity across sessions. It also provides options for enabling or
disabling history tracking, allowing users to choose their preferred level of detail.</p>

<p>In addition, the <code><a href="#ZakatTracker">ZakatTracker</a></code> class includes various helper methods like
<code><a href="#ZakatTracker.time">time</a></code>, <code><a href="#ZakatTracker.time_to_datetime">time_to_datetime</a></code>, <code><a href="#ZakatTracker.lock">lock</a></code>, <code><a href="#ZakatTracker.free">free</a></code>, <code><a href="#ZakatTracker.recall">recall</a></code>, <code><a href="#ZakatTracker.export_json">export_json</a></code>,
and more. These methods provide additional functionalities and flexibility
for interacting with and managing the Zakat tracker.</p>

<p>Attributes:
    <a href="#ZakatTracker.ZakatCut">ZakatTracker.ZakatCut</a> (function): A function to calculate the Zakat percentage.
    <a href="#ZakatTracker.TimeCycle">ZakatTracker.TimeCycle</a> (function): A function to determine the time cycle for Zakat.
    <a href="#ZakatTracker.Nisab">ZakatTracker.Nisab</a> (function): A function to calculate the Nisab based on the silver price.
    <a href="#ZakatTracker.Version">ZakatTracker.Version</a> (function): The version of the ZakatTracker class.</p>

<p>Data Structure:
    The ZakatTracker class utilizes a nested dictionary structure called "_vault" to store and manage data.</p>

<pre><code>_vault (dict):
    - account (dict):
        - {account_name} (dict):
            - balance (int): The current balance of the account.
            - box (dict): A dictionary storing transaction details.
                - {timestamp} (dict):
                    - capital (int): The initial amount of the transaction.
                    - count (int): The number of times Zakat has been calculated for this transaction.
                    - last (int): The timestamp of the last Zakat calculation.
                    - rest (int): The remaining amount after Zakat deductions and withdrawal.
                    - total (int): The total Zakat deducted from this transaction.
            - count (int): The total number of transactions for the account.
            - log (dict): A dictionary storing transaction logs.
                - {timestamp} (dict):
                    - value (int): The transaction amount (positive or negative).
                    - desc (str): The description of the transaction.
                    - ref (int): The box reference (positive or None).
                    - file (dict): A dictionary storing file references associated with the transaction.
            - hide (bool): Indicates whether the account is hidden or not.
            - zakatable (bool): Indicates whether the account is subject to Zakat.
    - exchange (dict):
        - {account_name} (dict):
            - {timestamps} (dict):
                - rate (float): Exchange rate when compared to local currency.
                - description (str): The description of the exchange rate.
    - history (dict):
        - {timestamp} (list): A list of dictionaries storing the history of actions performed.
            - {action_dict} (dict):
                - action (Action): The type of action (CREATE, TRACK, LOG, SUB, ADD_FILE, REMOVE_FILE, BOX_TRANSFER, EXCHANGE, REPORT, ZAKAT).
                - account (str): The account number associated with the action.
                - ref (int): The reference number of the transaction.
                - file (int): The reference number of the file (if applicable).
                - key (str): The key associated with the action (e.g., 'rest', 'total').
                - value (int): The value associated with the action.
                - math (MathOperation): The mathematical operation performed (if applicable).
    - lock (int or None): The timestamp indicating the current lock status (None if not locked).
    - report (dict):
        - {timestamp} (tuple): A tuple storing Zakat report details.
</code></pre>
</div>


                            <div id="ZakatTracker.__init__" class="classattr">
                                        <input id="ZakatTracker.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ZakatTracker</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;./zakat_db/&#39;</span>, </span><span class="param"><span class="n">history_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="ZakatTracker.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.__init__-361"><a href="#ZakatTracker.__init__-361"><span class="linenos">361</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;./zakat_db/&quot;</span><span class="p">,</span> <span class="n">history_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="ZakatTracker.__init__-362"><a href="#ZakatTracker.__init__-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.__init__-363"><a href="#ZakatTracker.__init__-363"><span class="linenos">363</span></a><span class="sd">        Initialize ZakatTracker with database path and history mode.</span>
</span><span id="ZakatTracker.__init__-364"><a href="#ZakatTracker.__init__-364"><span class="linenos">364</span></a>
</span><span id="ZakatTracker.__init__-365"><a href="#ZakatTracker.__init__-365"><span class="linenos">365</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.__init__-366"><a href="#ZakatTracker.__init__-366"><span class="linenos">366</span></a><span class="sd">        - db_path (str): The path to the database  directory. Default is &quot;./zakat_db&quot;.</span>
</span><span id="ZakatTracker.__init__-367"><a href="#ZakatTracker.__init__-367"><span class="linenos">367</span></a><span class="sd">        - history_mode (bool): The mode for tracking history. Default is True.</span>
</span><span id="ZakatTracker.__init__-368"><a href="#ZakatTracker.__init__-368"><span class="linenos">368</span></a>
</span><span id="ZakatTracker.__init__-369"><a href="#ZakatTracker.__init__-369"><span class="linenos">369</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.__init__-370"><a href="#ZakatTracker.__init__-370"><span class="linenos">370</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker.__init__-371"><a href="#ZakatTracker.__init__-371"><span class="linenos">371</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.__init__-372"><a href="#ZakatTracker.__init__-372"><span class="linenos">372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_base_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ZakatTracker.__init__-373"><a href="#ZakatTracker.__init__-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ZakatTracker.__init__-374"><a href="#ZakatTracker.__init__-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ZakatTracker.__init__-375"><a href="#ZakatTracker.__init__-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker.__init__-376"><a href="#ZakatTracker.__init__-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">(</span><span class="n">history_mode</span><span class="p">)</span>
</span><span id="ZakatTracker.__init__-377"><a href="#ZakatTracker.__init__-377"><span class="linenos">377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">db_path</span><span class="si">}</span><span class="s1">/db.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize ZakatTracker with database path and history mode.</p>

<p>Parameters:</p>

<ul>
<li>db_path (str): The path to the database  directory. Default is "./zakat_db".</li>
<li>history_mode (bool): The mode for tracking history. Default is True.</li>
</ul>

<p>Returns:
None</p>
</div>


                            </div>
                            <div id="ZakatTracker.Version" class="classattr">
                                        <input id="ZakatTracker.Version-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">Version</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.Version-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.Version"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.Version-285"><a href="#ZakatTracker.Version-285"><span class="linenos">285</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.Version-286"><a href="#ZakatTracker.Version-286"><span class="linenos">286</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">Version</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZakatTracker.Version-287"><a href="#ZakatTracker.Version-287"><span class="linenos">287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.Version-288"><a href="#ZakatTracker.Version-288"><span class="linenos">288</span></a><span class="sd">        Returns the current version of the software.</span>
</span><span id="ZakatTracker.Version-289"><a href="#ZakatTracker.Version-289"><span class="linenos">289</span></a>
</span><span id="ZakatTracker.Version-290"><a href="#ZakatTracker.Version-290"><span class="linenos">290</span></a><span class="sd">        This function returns a string representing the current version of the software,</span>
</span><span id="ZakatTracker.Version-291"><a href="#ZakatTracker.Version-291"><span class="linenos">291</span></a><span class="sd">        including major, minor, and patch version numbers in the format &quot;X.Y.Z&quot;.</span>
</span><span id="ZakatTracker.Version-292"><a href="#ZakatTracker.Version-292"><span class="linenos">292</span></a>
</span><span id="ZakatTracker.Version-293"><a href="#ZakatTracker.Version-293"><span class="linenos">293</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.Version-294"><a href="#ZakatTracker.Version-294"><span class="linenos">294</span></a><span class="sd">        - str: The current version of the software.</span>
</span><span id="ZakatTracker.Version-295"><a href="#ZakatTracker.Version-295"><span class="linenos">295</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.Version-296"><a href="#ZakatTracker.Version-296"><span class="linenos">296</span></a>        <span class="k">return</span> <span class="s1">&#39;0.2.98&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Returns the current version of the software.</p>

<p>This function returns a string representing the current version of the software,
including major, minor, and patch version numbers in the format "X.Y.Z".</p>

<p>Returns:</p>

<ul>
<li>str: The current version of the software.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.ZakatCut" class="classattr">
                                        <input id="ZakatTracker.ZakatCut-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">ZakatCut</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.ZakatCut-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.ZakatCut"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.ZakatCut-298"><a href="#ZakatTracker.ZakatCut-298"><span class="linenos">298</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.ZakatCut-299"><a href="#ZakatTracker.ZakatCut-299"><span class="linenos">299</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ZakatCut</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ZakatTracker.ZakatCut-300"><a href="#ZakatTracker.ZakatCut-300"><span class="linenos">300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.ZakatCut-301"><a href="#ZakatTracker.ZakatCut-301"><span class="linenos">301</span></a><span class="sd">        Calculates the Zakat amount due on an asset.</span>
</span><span id="ZakatTracker.ZakatCut-302"><a href="#ZakatTracker.ZakatCut-302"><span class="linenos">302</span></a>
</span><span id="ZakatTracker.ZakatCut-303"><a href="#ZakatTracker.ZakatCut-303"><span class="linenos">303</span></a><span class="sd">        This function calculates the zakat amount due on a given asset value over one lunar year.</span>
</span><span id="ZakatTracker.ZakatCut-304"><a href="#ZakatTracker.ZakatCut-304"><span class="linenos">304</span></a><span class="sd">        Zakat is an Islamic obligatory alms-giving, calculated as a fixed percentage of an individual&#39;s wealth</span>
</span><span id="ZakatTracker.ZakatCut-305"><a href="#ZakatTracker.ZakatCut-305"><span class="linenos">305</span></a><span class="sd">        that exceeds a certain threshold (Nisab).</span>
</span><span id="ZakatTracker.ZakatCut-306"><a href="#ZakatTracker.ZakatCut-306"><span class="linenos">306</span></a>
</span><span id="ZakatTracker.ZakatCut-307"><a href="#ZakatTracker.ZakatCut-307"><span class="linenos">307</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.ZakatCut-308"><a href="#ZakatTracker.ZakatCut-308"><span class="linenos">308</span></a><span class="sd">        - x (float): The total value of the asset on which Zakat is to be calculated.</span>
</span><span id="ZakatTracker.ZakatCut-309"><a href="#ZakatTracker.ZakatCut-309"><span class="linenos">309</span></a>
</span><span id="ZakatTracker.ZakatCut-310"><a href="#ZakatTracker.ZakatCut-310"><span class="linenos">310</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.ZakatCut-311"><a href="#ZakatTracker.ZakatCut-311"><span class="linenos">311</span></a><span class="sd">        - float: The amount of Zakat due on the asset, calculated as 2.5% of the asset&#39;s value.</span>
</span><span id="ZakatTracker.ZakatCut-312"><a href="#ZakatTracker.ZakatCut-312"><span class="linenos">312</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.ZakatCut-313"><a href="#ZakatTracker.ZakatCut-313"><span class="linenos">313</span></a>        <span class="k">return</span> <span class="mf">0.025</span> <span class="o">*</span> <span class="n">x</span>  <span class="c1"># Zakat Cut in one Lunar Year</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the Zakat amount due on an asset.</p>

<p>This function calculates the zakat amount due on a given asset value over one lunar year.
Zakat is an Islamic obligatory alms-giving, calculated as a fixed percentage of an individual's wealth
that exceeds a certain threshold (Nisab).</p>

<p>Parameters:</p>

<ul>
<li>x (float): The total value of the asset on which Zakat is to be calculated.</li>
</ul>

<p>Returns:</p>

<ul>
<li>float: The amount of Zakat due on the asset, calculated as 2.5% of the asset's value.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.TimeCycle" class="classattr">
                                        <input id="ZakatTracker.TimeCycle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">TimeCycle</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">355</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.TimeCycle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.TimeCycle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.TimeCycle-315"><a href="#ZakatTracker.TimeCycle-315"><span class="linenos">315</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.TimeCycle-316"><a href="#ZakatTracker.TimeCycle-316"><span class="linenos">316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">TimeCycle</span><span class="p">(</span><span class="n">days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">355</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker.TimeCycle-317"><a href="#ZakatTracker.TimeCycle-317"><span class="linenos">317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.TimeCycle-318"><a href="#ZakatTracker.TimeCycle-318"><span class="linenos">318</span></a><span class="sd">        Calculates the approximate duration of a lunar year in nanoseconds.</span>
</span><span id="ZakatTracker.TimeCycle-319"><a href="#ZakatTracker.TimeCycle-319"><span class="linenos">319</span></a>
</span><span id="ZakatTracker.TimeCycle-320"><a href="#ZakatTracker.TimeCycle-320"><span class="linenos">320</span></a><span class="sd">        This function calculates the approximate duration of a lunar year based on the given number of days.</span>
</span><span id="ZakatTracker.TimeCycle-321"><a href="#ZakatTracker.TimeCycle-321"><span class="linenos">321</span></a><span class="sd">        It converts the given number of days into nanoseconds for use in high-precision timing applications.</span>
</span><span id="ZakatTracker.TimeCycle-322"><a href="#ZakatTracker.TimeCycle-322"><span class="linenos">322</span></a>
</span><span id="ZakatTracker.TimeCycle-323"><a href="#ZakatTracker.TimeCycle-323"><span class="linenos">323</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.TimeCycle-324"><a href="#ZakatTracker.TimeCycle-324"><span class="linenos">324</span></a><span class="sd">        - days (int): The number of days in a lunar year. Defaults to 355,</span>
</span><span id="ZakatTracker.TimeCycle-325"><a href="#ZakatTracker.TimeCycle-325"><span class="linenos">325</span></a><span class="sd">              which is an approximation of the average length of a lunar year.</span>
</span><span id="ZakatTracker.TimeCycle-326"><a href="#ZakatTracker.TimeCycle-326"><span class="linenos">326</span></a>
</span><span id="ZakatTracker.TimeCycle-327"><a href="#ZakatTracker.TimeCycle-327"><span class="linenos">327</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.TimeCycle-328"><a href="#ZakatTracker.TimeCycle-328"><span class="linenos">328</span></a><span class="sd">        - int: The approximate duration of a lunar year in nanoseconds.</span>
</span><span id="ZakatTracker.TimeCycle-329"><a href="#ZakatTracker.TimeCycle-329"><span class="linenos">329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.TimeCycle-330"><a href="#ZakatTracker.TimeCycle-330"><span class="linenos">330</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">days</span> <span class="o">*</span> <span class="mf">1e9</span><span class="p">)</span>  <span class="c1"># Lunar Year in nanoseconds</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the approximate duration of a lunar year in nanoseconds.</p>

<p>This function calculates the approximate duration of a lunar year based on the given number of days.
It converts the given number of days into nanoseconds for use in high-precision timing applications.</p>

<p>Parameters:</p>

<ul>
<li>days (int): The number of days in a lunar year. Defaults to 355,
which is an approximation of the average length of a lunar year.</li>
</ul>

<p>Returns:</p>

<ul>
<li>int: The approximate duration of a lunar year in nanoseconds.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.Nisab" class="classattr">
                                        <input id="ZakatTracker.Nisab-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">Nisab</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">gram_price</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">gram_quantity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">595</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.Nisab-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.Nisab"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.Nisab-332"><a href="#ZakatTracker.Nisab-332"><span class="linenos">332</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.Nisab-333"><a href="#ZakatTracker.Nisab-333"><span class="linenos">333</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">Nisab</span><span class="p">(</span><span class="n">gram_price</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">gram_quantity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">595</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ZakatTracker.Nisab-334"><a href="#ZakatTracker.Nisab-334"><span class="linenos">334</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.Nisab-335"><a href="#ZakatTracker.Nisab-335"><span class="linenos">335</span></a><span class="sd">        Calculate the total value of Nisab (a unit of weight in Islamic jurisprudence) based on the given price per gram.</span>
</span><span id="ZakatTracker.Nisab-336"><a href="#ZakatTracker.Nisab-336"><span class="linenos">336</span></a>
</span><span id="ZakatTracker.Nisab-337"><a href="#ZakatTracker.Nisab-337"><span class="linenos">337</span></a><span class="sd">        This function calculates the Nisab value, which is the minimum threshold of wealth,</span>
</span><span id="ZakatTracker.Nisab-338"><a href="#ZakatTracker.Nisab-338"><span class="linenos">338</span></a><span class="sd">        that makes an individual liable for paying Zakat.</span>
</span><span id="ZakatTracker.Nisab-339"><a href="#ZakatTracker.Nisab-339"><span class="linenos">339</span></a><span class="sd">        The Nisab value is determined by the equivalent value of a specific amount</span>
</span><span id="ZakatTracker.Nisab-340"><a href="#ZakatTracker.Nisab-340"><span class="linenos">340</span></a><span class="sd">        of gold or silver (currently 595 grams in silver) in the local currency.</span>
</span><span id="ZakatTracker.Nisab-341"><a href="#ZakatTracker.Nisab-341"><span class="linenos">341</span></a>
</span><span id="ZakatTracker.Nisab-342"><a href="#ZakatTracker.Nisab-342"><span class="linenos">342</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.Nisab-343"><a href="#ZakatTracker.Nisab-343"><span class="linenos">343</span></a><span class="sd">        - gram_price (float): The price per gram of Nisab.</span>
</span><span id="ZakatTracker.Nisab-344"><a href="#ZakatTracker.Nisab-344"><span class="linenos">344</span></a><span class="sd">        - gram_quantity (float): The quantity of grams in a Nisab. Default is 595 grams of silver.</span>
</span><span id="ZakatTracker.Nisab-345"><a href="#ZakatTracker.Nisab-345"><span class="linenos">345</span></a>
</span><span id="ZakatTracker.Nisab-346"><a href="#ZakatTracker.Nisab-346"><span class="linenos">346</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.Nisab-347"><a href="#ZakatTracker.Nisab-347"><span class="linenos">347</span></a><span class="sd">        - float: The total value of Nisab based on the given price per gram.</span>
</span><span id="ZakatTracker.Nisab-348"><a href="#ZakatTracker.Nisab-348"><span class="linenos">348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.Nisab-349"><a href="#ZakatTracker.Nisab-349"><span class="linenos">349</span></a>        <span class="k">return</span> <span class="n">gram_price</span> <span class="o">*</span> <span class="n">gram_quantity</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the total value of Nisab (a unit of weight in Islamic jurisprudence) based on the given price per gram.</p>

<p>This function calculates the Nisab value, which is the minimum threshold of wealth,
that makes an individual liable for paying Zakat.
The Nisab value is determined by the equivalent value of a specific amount
of gold or silver (currently 595 grams in silver) in the local currency.</p>

<p>Parameters:</p>

<ul>
<li>gram_price (float): The price per gram of Nisab.</li>
<li>gram_quantity (float): The quantity of grams in a Nisab. Default is 595 grams of silver.</li>
</ul>

<p>Returns:</p>

<ul>
<li>float: The total value of Nisab based on the given price per gram.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.ext" class="classattr">
                                        <input id="ZakatTracker.ext-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">ext</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.ext-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.ext"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.ext-351"><a href="#ZakatTracker.ext-351"><span class="linenos">351</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.ext-352"><a href="#ZakatTracker.ext-352"><span class="linenos">352</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ext</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZakatTracker.ext-353"><a href="#ZakatTracker.ext-353"><span class="linenos">353</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.ext-354"><a href="#ZakatTracker.ext-354"><span class="linenos">354</span></a><span class="sd">        Returns the file extension used by the ZakatTracker class.</span>
</span><span id="ZakatTracker.ext-355"><a href="#ZakatTracker.ext-355"><span class="linenos">355</span></a>
</span><span id="ZakatTracker.ext-356"><a href="#ZakatTracker.ext-356"><span class="linenos">356</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.ext-357"><a href="#ZakatTracker.ext-357"><span class="linenos">357</span></a><span class="sd">        - str: The file extension used by the ZakatTracker class, which is &#39;camel&#39;.</span>
</span><span id="ZakatTracker.ext-358"><a href="#ZakatTracker.ext-358"><span class="linenos">358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.ext-359"><a href="#ZakatTracker.ext-359"><span class="linenos">359</span></a>        <span class="k">return</span> <span class="s1">&#39;camel&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Returns the file extension used by the ZakatTracker class.</p>

<p>Returns:</p>

<ul>
<li>str: The file extension used by the ZakatTracker class, which is 'camel'.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.path" class="classattr">
                                        <input id="ZakatTracker.path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.path-379"><a href="#ZakatTracker.path-379"><span class="linenos">379</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZakatTracker.path-380"><a href="#ZakatTracker.path-380"><span class="linenos">380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.path-381"><a href="#ZakatTracker.path-381"><span class="linenos">381</span></a><span class="sd">        Set or get the path to the database file.</span>
</span><span id="ZakatTracker.path-382"><a href="#ZakatTracker.path-382"><span class="linenos">382</span></a>
</span><span id="ZakatTracker.path-383"><a href="#ZakatTracker.path-383"><span class="linenos">383</span></a><span class="sd">        If no path is provided, the current path is returned.</span>
</span><span id="ZakatTracker.path-384"><a href="#ZakatTracker.path-384"><span class="linenos">384</span></a><span class="sd">        If a path is provided, it is set as the new path.</span>
</span><span id="ZakatTracker.path-385"><a href="#ZakatTracker.path-385"><span class="linenos">385</span></a><span class="sd">        The function also creates the necessary directories if the provided path is a file.</span>
</span><span id="ZakatTracker.path-386"><a href="#ZakatTracker.path-386"><span class="linenos">386</span></a>
</span><span id="ZakatTracker.path-387"><a href="#ZakatTracker.path-387"><span class="linenos">387</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.path-388"><a href="#ZakatTracker.path-388"><span class="linenos">388</span></a><span class="sd">        - path (str): The new path to the database file. If not provided, the current path is returned.</span>
</span><span id="ZakatTracker.path-389"><a href="#ZakatTracker.path-389"><span class="linenos">389</span></a>
</span><span id="ZakatTracker.path-390"><a href="#ZakatTracker.path-390"><span class="linenos">390</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.path-391"><a href="#ZakatTracker.path-391"><span class="linenos">391</span></a><span class="sd">        - str: The current or new path to the database file.</span>
</span><span id="ZakatTracker.path-392"><a href="#ZakatTracker.path-392"><span class="linenos">392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.path-393"><a href="#ZakatTracker.path-393"><span class="linenos">393</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.path-394"><a href="#ZakatTracker.path-394"><span class="linenos">394</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault_path</span>
</span><span id="ZakatTracker.path-395"><a href="#ZakatTracker.path-395"><span class="linenos">395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
</span><span id="ZakatTracker.path-396"><a href="#ZakatTracker.path-396"><span class="linenos">396</span></a>        <span class="n">base_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
</span><span id="ZakatTracker.path-397"><a href="#ZakatTracker.path-397"><span class="linenos">397</span></a>        <span class="k">if</span> <span class="n">base_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">or</span> <span class="n">base_path</span><span class="o">.</span><span class="n">suffix</span><span class="p">:</span>
</span><span id="ZakatTracker.path-398"><a href="#ZakatTracker.path-398"><span class="linenos">398</span></a>            <span class="n">base_path</span> <span class="o">=</span> <span class="n">base_path</span><span class="o">.</span><span class="n">parent</span>
</span><span id="ZakatTracker.path-399"><a href="#ZakatTracker.path-399"><span class="linenos">399</span></a>        <span class="n">base_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker.path-400"><a href="#ZakatTracker.path-400"><span class="linenos">400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_base_path</span> <span class="o">=</span> <span class="n">base_path</span>
</span><span id="ZakatTracker.path-401"><a href="#ZakatTracker.path-401"><span class="linenos">401</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set or get the path to the database file.</p>

<p>If no path is provided, the current path is returned.
If a path is provided, it is set as the new path.
The function also creates the necessary directories if the provided path is a file.</p>

<p>Parameters:</p>

<ul>
<li>path (str): The new path to the database file. If not provided, the current path is returned.</li>
</ul>

<p>Returns:</p>

<ul>
<li>str: The current or new path to the database file.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.base_path" class="classattr">
                                        <input id="ZakatTracker.base_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">base_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.base_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.base_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.base_path-403"><a href="#ZakatTracker.base_path-403"><span class="linenos">403</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">base_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZakatTracker.base_path-404"><a href="#ZakatTracker.base_path-404"><span class="linenos">404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.base_path-405"><a href="#ZakatTracker.base_path-405"><span class="linenos">405</span></a><span class="sd">        Generate a base path by joining the provided arguments with the existing base path.</span>
</span><span id="ZakatTracker.base_path-406"><a href="#ZakatTracker.base_path-406"><span class="linenos">406</span></a>
</span><span id="ZakatTracker.base_path-407"><a href="#ZakatTracker.base_path-407"><span class="linenos">407</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.base_path-408"><a href="#ZakatTracker.base_path-408"><span class="linenos">408</span></a><span class="sd">        - *args (str): Variable length argument list of strings to be joined with the base path.</span>
</span><span id="ZakatTracker.base_path-409"><a href="#ZakatTracker.base_path-409"><span class="linenos">409</span></a>
</span><span id="ZakatTracker.base_path-410"><a href="#ZakatTracker.base_path-410"><span class="linenos">410</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.base_path-411"><a href="#ZakatTracker.base_path-411"><span class="linenos">411</span></a><span class="sd">        - str: The generated base path. If no arguments are provided, the existing base path is returned.</span>
</span><span id="ZakatTracker.base_path-412"><a href="#ZakatTracker.base_path-412"><span class="linenos">412</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.base_path-413"><a href="#ZakatTracker.base_path-413"><span class="linenos">413</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
</span><span id="ZakatTracker.base_path-414"><a href="#ZakatTracker.base_path-414"><span class="linenos">414</span></a>            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_path</span><span class="p">)</span>
</span><span id="ZakatTracker.base_path-415"><a href="#ZakatTracker.base_path-415"><span class="linenos">415</span></a>        <span class="n">filtered_args</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker.base_path-416"><a href="#ZakatTracker.base_path-416"><span class="linenos">416</span></a>        <span class="n">ignored_filename</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ZakatTracker.base_path-417"><a href="#ZakatTracker.base_path-417"><span class="linenos">417</span></a>        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="ZakatTracker.base_path-418"><a href="#ZakatTracker.base_path-418"><span class="linenos">418</span></a>            <span class="k">if</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="p">:</span>
</span><span id="ZakatTracker.base_path-419"><a href="#ZakatTracker.base_path-419"><span class="linenos">419</span></a>                <span class="n">ignored_filename</span> <span class="o">=</span> <span class="n">arg</span>
</span><span id="ZakatTracker.base_path-420"><a href="#ZakatTracker.base_path-420"><span class="linenos">420</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker.base_path-421"><a href="#ZakatTracker.base_path-421"><span class="linenos">421</span></a>                <span class="n">filtered_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span><span id="ZakatTracker.base_path-422"><a href="#ZakatTracker.base_path-422"><span class="linenos">422</span></a>        <span class="n">base_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_path</span><span class="p">)</span>
</span><span id="ZakatTracker.base_path-423"><a href="#ZakatTracker.base_path-423"><span class="linenos">423</span></a>        <span class="n">full_path</span> <span class="o">=</span> <span class="n">base_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="o">*</span><span class="n">filtered_args</span><span class="p">)</span>
</span><span id="ZakatTracker.base_path-424"><a href="#ZakatTracker.base_path-424"><span class="linenos">424</span></a>        <span class="n">full_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker.base_path-425"><a href="#ZakatTracker.base_path-425"><span class="linenos">425</span></a>        <span class="k">if</span> <span class="n">ignored_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.base_path-426"><a href="#ZakatTracker.base_path-426"><span class="linenos">426</span></a>            <span class="k">return</span> <span class="n">full_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="n">ignored_filename</span>  <span class="c1"># Join with the ignored filename</span>
</span><span id="ZakatTracker.base_path-427"><a href="#ZakatTracker.base_path-427"><span class="linenos">427</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Generate a base path by joining the provided arguments with the existing base path.</p>

<p>Parameters:</p>

<ul>
<li>*args (str): Variable length argument list of strings to be joined with the base path.</li>
</ul>

<p>Returns:</p>

<ul>
<li>str: The generated base path. If no arguments are provided, the existing base path is returned.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.scale" class="classattr">
                                        <input id="ZakatTracker.scale-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">scale</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span>, </span><span class="param"><span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.scale-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.scale"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.scale-429"><a href="#ZakatTracker.scale-429"><span class="linenos">429</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.scale-430"><a href="#ZakatTracker.scale-430"><span class="linenos">430</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker.scale-431"><a href="#ZakatTracker.scale-431"><span class="linenos">431</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.scale-432"><a href="#ZakatTracker.scale-432"><span class="linenos">432</span></a><span class="sd">        Scales a numerical value by a specified power of 10, returning an integer.</span>
</span><span id="ZakatTracker.scale-433"><a href="#ZakatTracker.scale-433"><span class="linenos">433</span></a>
</span><span id="ZakatTracker.scale-434"><a href="#ZakatTracker.scale-434"><span class="linenos">434</span></a><span class="sd">        This function is designed to handle various numeric types (`float`, `int`, or `decimal.Decimal`) and</span>
</span><span id="ZakatTracker.scale-435"><a href="#ZakatTracker.scale-435"><span class="linenos">435</span></a><span class="sd">        facilitate precise scaling operations, particularly useful in financial or scientific calculations.</span>
</span><span id="ZakatTracker.scale-436"><a href="#ZakatTracker.scale-436"><span class="linenos">436</span></a>
</span><span id="ZakatTracker.scale-437"><a href="#ZakatTracker.scale-437"><span class="linenos">437</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.scale-438"><a href="#ZakatTracker.scale-438"><span class="linenos">438</span></a><span class="sd">        - x (float | int | decimal.Decimal): The numeric value to scale. Can be a floating-point number, integer, or decimal.</span>
</span><span id="ZakatTracker.scale-439"><a href="#ZakatTracker.scale-439"><span class="linenos">439</span></a><span class="sd">        - decimal_places (int): The exponent for the scaling factor (10**y). Defaults to 2, meaning the input is scaled</span>
</span><span id="ZakatTracker.scale-440"><a href="#ZakatTracker.scale-440"><span class="linenos">440</span></a><span class="sd">            by a factor of 100 (e.g., converts 1.23 to 123).</span>
</span><span id="ZakatTracker.scale-441"><a href="#ZakatTracker.scale-441"><span class="linenos">441</span></a>
</span><span id="ZakatTracker.scale-442"><a href="#ZakatTracker.scale-442"><span class="linenos">442</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.scale-443"><a href="#ZakatTracker.scale-443"><span class="linenos">443</span></a><span class="sd">        - The scaled value, rounded to the nearest integer.</span>
</span><span id="ZakatTracker.scale-444"><a href="#ZakatTracker.scale-444"><span class="linenos">444</span></a>
</span><span id="ZakatTracker.scale-445"><a href="#ZakatTracker.scale-445"><span class="linenos">445</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker.scale-446"><a href="#ZakatTracker.scale-446"><span class="linenos">446</span></a><span class="sd">        - TypeError: If the input `x` is not a valid numeric type.</span>
</span><span id="ZakatTracker.scale-447"><a href="#ZakatTracker.scale-447"><span class="linenos">447</span></a>
</span><span id="ZakatTracker.scale-448"><a href="#ZakatTracker.scale-448"><span class="linenos">448</span></a><span class="sd">        Examples:</span>
</span><span id="ZakatTracker.scale-449"><a href="#ZakatTracker.scale-449"><span class="linenos">449</span></a><span class="sd">        &gt;&gt;&gt; ZakatTracker.scale(3.14159)</span>
</span><span id="ZakatTracker.scale-450"><a href="#ZakatTracker.scale-450"><span class="linenos">450</span></a><span class="sd">        314</span>
</span><span id="ZakatTracker.scale-451"><a href="#ZakatTracker.scale-451"><span class="linenos">451</span></a><span class="sd">        &gt;&gt;&gt; ZakatTracker.scale(1234, decimal_places=3)</span>
</span><span id="ZakatTracker.scale-452"><a href="#ZakatTracker.scale-452"><span class="linenos">452</span></a><span class="sd">        1234000</span>
</span><span id="ZakatTracker.scale-453"><a href="#ZakatTracker.scale-453"><span class="linenos">453</span></a><span class="sd">        &gt;&gt;&gt; ZakatTracker.scale(Decimal(&quot;0.005&quot;), decimal_places=4)</span>
</span><span id="ZakatTracker.scale-454"><a href="#ZakatTracker.scale-454"><span class="linenos">454</span></a><span class="sd">        50</span>
</span><span id="ZakatTracker.scale-455"><a href="#ZakatTracker.scale-455"><span class="linenos">455</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.scale-456"><a href="#ZakatTracker.scale-456"><span class="linenos">456</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">)):</span>
</span><span id="ZakatTracker.scale-457"><a href="#ZakatTracker.scale-457"><span class="linenos">457</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input &#39;x&#39; must be a float, int, or decimal.Decimal.&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.scale-458"><a href="#ZakatTracker.scale-458"><span class="linenos">458</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">decimal_places</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">decimal_places</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Scales a numerical value by a specified power of 10, returning an integer.</p>

<p>This function is designed to handle various numeric types (<code>float</code>, <code>int</code>, or <code>decimal.Decimal</code>) and
facilitate precise scaling operations, particularly useful in financial or scientific calculations.</p>

<p>Parameters:</p>

<ul>
<li>x (float | int | decimal.Decimal): The numeric value to scale. Can be a floating-point number, integer, or decimal.</li>
<li>decimal_places (int): The exponent for the scaling factor (10**y). Defaults to 2, meaning the input is scaled
by a factor of 100 (e.g., converts 1.23 to 123).</li>
</ul>

<p>Returns:</p>

<ul>
<li>The scaled value, rounded to the nearest integer.</li>
</ul>

<p>Raises:</p>

<ul>
<li>TypeError: If the input <code>x</code> is not a valid numeric type.</li>
</ul>

<p>Examples:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n"><a href="#ZakatTracker.scale">ZakatTracker.scale</a></span><span class="p">(</span><span class="mf">3.14159</span><span class="p">)</span>
<span class="go">314</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n"><a href="#ZakatTracker.scale">ZakatTracker.scale</a></span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="go">1234000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n"><a href="#ZakatTracker.scale">ZakatTracker.scale</a></span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0.005&quot;</span><span class="p">),</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">50</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="ZakatTracker.unscale" class="classattr">
                                        <input id="ZakatTracker.unscale-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">unscale</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">x</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	return_type: type = &lt;class &#x27;float&#x27;&gt;,</span><span class="param">	<span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span></span><span class="return-annotation">) -> <span class="nb">float</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.unscale-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.unscale"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.unscale-460"><a href="#ZakatTracker.unscale-460"><span class="linenos">460</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.unscale-461"><a href="#ZakatTracker.unscale-461"><span class="linenos">461</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unscale</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">return_type</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="nb">float</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">:</span>
</span><span id="ZakatTracker.unscale-462"><a href="#ZakatTracker.unscale-462"><span class="linenos">462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.unscale-463"><a href="#ZakatTracker.unscale-463"><span class="linenos">463</span></a><span class="sd">        Unscales an integer by a power of 10.</span>
</span><span id="ZakatTracker.unscale-464"><a href="#ZakatTracker.unscale-464"><span class="linenos">464</span></a>
</span><span id="ZakatTracker.unscale-465"><a href="#ZakatTracker.unscale-465"><span class="linenos">465</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.unscale-466"><a href="#ZakatTracker.unscale-466"><span class="linenos">466</span></a><span class="sd">        - x (int): The integer to unscale.</span>
</span><span id="ZakatTracker.unscale-467"><a href="#ZakatTracker.unscale-467"><span class="linenos">467</span></a><span class="sd">        - return_type (type): The desired type for the returned value. Can be float, int, or decimal.Decimal. Defaults to float.</span>
</span><span id="ZakatTracker.unscale-468"><a href="#ZakatTracker.unscale-468"><span class="linenos">468</span></a><span class="sd">        - decimal_places (int): The power of 10 to use. Defaults to 2.</span>
</span><span id="ZakatTracker.unscale-469"><a href="#ZakatTracker.unscale-469"><span class="linenos">469</span></a>
</span><span id="ZakatTracker.unscale-470"><a href="#ZakatTracker.unscale-470"><span class="linenos">470</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.unscale-471"><a href="#ZakatTracker.unscale-471"><span class="linenos">471</span></a><span class="sd">        - float | int | decimal.Decimal: The unscaled number, converted to the specified return_type.</span>
</span><span id="ZakatTracker.unscale-472"><a href="#ZakatTracker.unscale-472"><span class="linenos">472</span></a>
</span><span id="ZakatTracker.unscale-473"><a href="#ZakatTracker.unscale-473"><span class="linenos">473</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker.unscale-474"><a href="#ZakatTracker.unscale-474"><span class="linenos">474</span></a><span class="sd">        - TypeError: If the return_type is not float or decimal.Decimal.</span>
</span><span id="ZakatTracker.unscale-475"><a href="#ZakatTracker.unscale-475"><span class="linenos">475</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.unscale-476"><a href="#ZakatTracker.unscale-476"><span class="linenos">476</span></a>        <span class="k">if</span> <span class="n">return_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">):</span>
</span><span id="ZakatTracker.unscale-477"><a href="#ZakatTracker.unscale-477"><span class="linenos">477</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid return_type(</span><span class="si">{</span><span class="n">return_type</span><span class="si">}</span><span class="s1">). Supported types are float, int, and decimal.Decimal.&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.unscale-478"><a href="#ZakatTracker.unscale-478"><span class="linenos">478</span></a>        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">return_type</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">decimal_places</span><span class="p">)),</span> <span class="n">decimal_places</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Unscales an integer by a power of 10.</p>

<p>Parameters:</p>

<ul>
<li>x (int): The integer to unscale.</li>
<li>return_type (type): The desired type for the returned value. Can be float, int, or decimal.Decimal. Defaults to float.</li>
<li>decimal_places (int): The power of 10 to use. Defaults to 2.</li>
</ul>

<p>Returns:</p>

<ul>
<li>float | int | decimal.Decimal: The unscaled number, converted to the specified return_type.</li>
</ul>

<p>Raises:</p>

<ul>
<li>TypeError: If the return_type is not float or decimal.Decimal.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.reset" class="classattr">
                                        <input id="ZakatTracker.reset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.reset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.reset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.reset-480"><a href="#ZakatTracker.reset-480"><span class="linenos">480</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.reset-481"><a href="#ZakatTracker.reset-481"><span class="linenos">481</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.reset-482"><a href="#ZakatTracker.reset-482"><span class="linenos">482</span></a><span class="sd">        Reset the internal data structure to its initial state.</span>
</span><span id="ZakatTracker.reset-483"><a href="#ZakatTracker.reset-483"><span class="linenos">483</span></a>
</span><span id="ZakatTracker.reset-484"><a href="#ZakatTracker.reset-484"><span class="linenos">484</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.reset-485"><a href="#ZakatTracker.reset-485"><span class="linenos">485</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker.reset-486"><a href="#ZakatTracker.reset-486"><span class="linenos">486</span></a>
</span><span id="ZakatTracker.reset-487"><a href="#ZakatTracker.reset-487"><span class="linenos">487</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.reset-488"><a href="#ZakatTracker.reset-488"><span class="linenos">488</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker.reset-489"><a href="#ZakatTracker.reset-489"><span class="linenos">489</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.reset-490"><a href="#ZakatTracker.reset-490"><span class="linenos">490</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker.reset-491"><a href="#ZakatTracker.reset-491"><span class="linenos">491</span></a>            <span class="s1">&#39;account&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker.reset-492"><a href="#ZakatTracker.reset-492"><span class="linenos">492</span></a>            <span class="s1">&#39;exchange&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker.reset-493"><a href="#ZakatTracker.reset-493"><span class="linenos">493</span></a>            <span class="s1">&#39;history&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker.reset-494"><a href="#ZakatTracker.reset-494"><span class="linenos">494</span></a>            <span class="s1">&#39;lock&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker.reset-495"><a href="#ZakatTracker.reset-495"><span class="linenos">495</span></a>            <span class="s1">&#39;report&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker.reset-496"><a href="#ZakatTracker.reset-496"><span class="linenos">496</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Reset the internal data structure to its initial state.</p>

<p>Parameters:
None</p>

<p>Returns:
None</p>
</div>


                            </div>
                            <div id="ZakatTracker.minimum_time_diff_ns" class="classattr">
                                        <input id="ZakatTracker.minimum_time_diff_ns-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">minimum_time_diff_ns</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.minimum_time_diff_ns-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.minimum_time_diff_ns"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.minimum_time_diff_ns-501"><a href="#ZakatTracker.minimum_time_diff_ns-501"><span class="linenos">501</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-502"><a href="#ZakatTracker.minimum_time_diff_ns-502"><span class="linenos">502</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">minimum_time_diff_ns</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-503"><a href="#ZakatTracker.minimum_time_diff_ns-503"><span class="linenos">503</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-504"><a href="#ZakatTracker.minimum_time_diff_ns-504"><span class="linenos">504</span></a><span class="sd">        Calculates the minimum time difference between two consecutive calls to</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-505"><a href="#ZakatTracker.minimum_time_diff_ns-505"><span class="linenos">505</span></a><span class="sd">        `ZakatTracker._time()` in nanoseconds.</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-506"><a href="#ZakatTracker.minimum_time_diff_ns-506"><span class="linenos">506</span></a>
</span><span id="ZakatTracker.minimum_time_diff_ns-507"><a href="#ZakatTracker.minimum_time_diff_ns-507"><span class="linenos">507</span></a><span class="sd">        This method is used internally to determine the minimum granularity of</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-508"><a href="#ZakatTracker.minimum_time_diff_ns-508"><span class="linenos">508</span></a><span class="sd">        time measurements within the system.</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-509"><a href="#ZakatTracker.minimum_time_diff_ns-509"><span class="linenos">509</span></a>
</span><span id="ZakatTracker.minimum_time_diff_ns-510"><a href="#ZakatTracker.minimum_time_diff_ns-510"><span class="linenos">510</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-511"><a href="#ZakatTracker.minimum_time_diff_ns-511"><span class="linenos">511</span></a><span class="sd">        tuple[int, int]:</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-512"><a href="#ZakatTracker.minimum_time_diff_ns-512"><span class="linenos">512</span></a><span class="sd">            - The minimum time difference in nanoseconds.</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-513"><a href="#ZakatTracker.minimum_time_diff_ns-513"><span class="linenos">513</span></a><span class="sd">            - The number of iterations required to measure the difference.</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-514"><a href="#ZakatTracker.minimum_time_diff_ns-514"><span class="linenos">514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-515"><a href="#ZakatTracker.minimum_time_diff_ns-515"><span class="linenos">515</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-516"><a href="#ZakatTracker.minimum_time_diff_ns-516"><span class="linenos">516</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time</span><span class="p">()</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-517"><a href="#ZakatTracker.minimum_time_diff_ns-517"><span class="linenos">517</span></a>        <span class="k">while</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-518"><a href="#ZakatTracker.minimum_time_diff_ns-518"><span class="linenos">518</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time</span><span class="p">()</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-519"><a href="#ZakatTracker.minimum_time_diff_ns-519"><span class="linenos">519</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker.minimum_time_diff_ns-520"><a href="#ZakatTracker.minimum_time_diff_ns-520"><span class="linenos">520</span></a>        <span class="k">return</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">i</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the minimum time difference between two consecutive calls to
<code>ZakatTracker._time()</code> in nanoseconds.</p>

<p>This method is used internally to determine the minimum granularity of
time measurements within the system.</p>

<p>Returns:
tuple[int, int]:
    - The minimum time difference in nanoseconds.
    - The number of iterations required to measure the difference.</p>
</div>


                            </div>
                            <div id="ZakatTracker.time" class="classattr">
                                        <input id="ZakatTracker.time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">time</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">now</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.time-539"><a href="#ZakatTracker.time-539"><span class="linenos">539</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.time-540"><a href="#ZakatTracker.time-540"><span class="linenos">540</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">time</span><span class="p">(</span><span class="n">now</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker.time-541"><a href="#ZakatTracker.time-541"><span class="linenos">541</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.time-542"><a href="#ZakatTracker.time-542"><span class="linenos">542</span></a><span class="sd">        Generates a unique, monotonically increasing timestamp based on the provided</span>
</span><span id="ZakatTracker.time-543"><a href="#ZakatTracker.time-543"><span class="linenos">543</span></a><span class="sd">        datetime object or the current datetime.</span>
</span><span id="ZakatTracker.time-544"><a href="#ZakatTracker.time-544"><span class="linenos">544</span></a>
</span><span id="ZakatTracker.time-545"><a href="#ZakatTracker.time-545"><span class="linenos">545</span></a><span class="sd">        This method ensures that timestamps are unique even if called in rapid succession</span>
</span><span id="ZakatTracker.time-546"><a href="#ZakatTracker.time-546"><span class="linenos">546</span></a><span class="sd">        by introducing a small delay if necessary, based on the system&#39;s minimum</span>
</span><span id="ZakatTracker.time-547"><a href="#ZakatTracker.time-547"><span class="linenos">547</span></a><span class="sd">        time resolution.</span>
</span><span id="ZakatTracker.time-548"><a href="#ZakatTracker.time-548"><span class="linenos">548</span></a>
</span><span id="ZakatTracker.time-549"><a href="#ZakatTracker.time-549"><span class="linenos">549</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.time-550"><a href="#ZakatTracker.time-550"><span class="linenos">550</span></a><span class="sd">        - now (datetime.datetime, optional): The datetime object to generate the timestamp from.</span>
</span><span id="ZakatTracker.time-551"><a href="#ZakatTracker.time-551"><span class="linenos">551</span></a><span class="sd">        If not provided, the current datetime is used.</span>
</span><span id="ZakatTracker.time-552"><a href="#ZakatTracker.time-552"><span class="linenos">552</span></a>
</span><span id="ZakatTracker.time-553"><a href="#ZakatTracker.time-553"><span class="linenos">553</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.time-554"><a href="#ZakatTracker.time-554"><span class="linenos">554</span></a><span class="sd">        - int: The unique timestamp in nanoseconds since the epoch (January 1, 1AD).</span>
</span><span id="ZakatTracker.time-555"><a href="#ZakatTracker.time-555"><span class="linenos">555</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.time-556"><a href="#ZakatTracker.time-556"><span class="linenos">556</span></a>        <span class="n">new_time</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
</span><span id="ZakatTracker.time-557"><a href="#ZakatTracker.time-557"><span class="linenos">557</span></a>        <span class="k">if</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_last_time_ns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.time-558"><a href="#ZakatTracker.time-558"><span class="linenos">558</span></a>            <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_last_time_ns</span> <span class="o">=</span> <span class="n">new_time</span>
</span><span id="ZakatTracker.time-559"><a href="#ZakatTracker.time-559"><span class="linenos">559</span></a>            <span class="k">return</span> <span class="n">new_time</span>
</span><span id="ZakatTracker.time-560"><a href="#ZakatTracker.time-560"><span class="linenos">560</span></a>        <span class="k">while</span> <span class="n">new_time</span> <span class="o">==</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_last_time_ns</span><span class="p">:</span>
</span><span id="ZakatTracker.time-561"><a href="#ZakatTracker.time-561"><span class="linenos">561</span></a>            <span class="k">if</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time_diff_ns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.time-562"><a href="#ZakatTracker.time-562"><span class="linenos">562</span></a>                <span class="n">diff</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">minimum_time_diff_ns</span><span class="p">()</span>
</span><span id="ZakatTracker.time-563"><a href="#ZakatTracker.time-563"><span class="linenos">563</span></a>                <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time_diff_ns</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
</span><span id="ZakatTracker.time-564"><a href="#ZakatTracker.time-564"><span class="linenos">564</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time_diff_ns</span> <span class="o">/</span> <span class="mi">1_000_000_000</span><span class="p">)</span>
</span><span id="ZakatTracker.time-565"><a href="#ZakatTracker.time-565"><span class="linenos">565</span></a>            <span class="n">new_time</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_time</span><span class="p">()</span>
</span><span id="ZakatTracker.time-566"><a href="#ZakatTracker.time-566"><span class="linenos">566</span></a>        <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">_last_time_ns</span> <span class="o">=</span> <span class="n">new_time</span>
</span><span id="ZakatTracker.time-567"><a href="#ZakatTracker.time-567"><span class="linenos">567</span></a>        <span class="k">return</span> <span class="n">new_time</span>
</span></pre></div>


            <div class="docstring"><p>Generates a unique, monotonically increasing timestamp based on the provided
datetime object or the current datetime.</p>

<p>This method ensures that timestamps are unique even if called in rapid succession
by introducing a small delay if necessary, based on the system's minimum
time resolution.</p>

<p>Parameters:</p>

<ul>
<li>now (datetime.datetime, optional): The datetime object to generate the timestamp from.
If not provided, the current datetime is used.</li>
</ul>

<p>Returns:</p>

<ul>
<li>int: The unique timestamp in nanoseconds since the epoch (January 1, 1AD).</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.time_to_datetime" class="classattr">
                                        <input id="ZakatTracker.time_to_datetime-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">time_to_datetime</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">ordinal_ns</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.time_to_datetime-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.time_to_datetime"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.time_to_datetime-569"><a href="#ZakatTracker.time_to_datetime-569"><span class="linenos">569</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.time_to_datetime-570"><a href="#ZakatTracker.time_to_datetime-570"><span class="linenos">570</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">time_to_datetime</span><span class="p">(</span><span class="n">ordinal_ns</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
</span><span id="ZakatTracker.time_to_datetime-571"><a href="#ZakatTracker.time_to_datetime-571"><span class="linenos">571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.time_to_datetime-572"><a href="#ZakatTracker.time_to_datetime-572"><span class="linenos">572</span></a><span class="sd">        Converts a nanosecond-precision timestamp (ordinal number of nanoseconds since 1AD)</span>
</span><span id="ZakatTracker.time_to_datetime-573"><a href="#ZakatTracker.time_to_datetime-573"><span class="linenos">573</span></a><span class="sd">        back to a datetime object.</span>
</span><span id="ZakatTracker.time_to_datetime-574"><a href="#ZakatTracker.time_to_datetime-574"><span class="linenos">574</span></a>
</span><span id="ZakatTracker.time_to_datetime-575"><a href="#ZakatTracker.time_to_datetime-575"><span class="linenos">575</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.time_to_datetime-576"><a href="#ZakatTracker.time_to_datetime-576"><span class="linenos">576</span></a><span class="sd">        - ordinal_ns (int): The timestamp in nanoseconds since the epoch (January 1, 1AD).</span>
</span><span id="ZakatTracker.time_to_datetime-577"><a href="#ZakatTracker.time_to_datetime-577"><span class="linenos">577</span></a>
</span><span id="ZakatTracker.time_to_datetime-578"><a href="#ZakatTracker.time_to_datetime-578"><span class="linenos">578</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.time_to_datetime-579"><a href="#ZakatTracker.time_to_datetime-579"><span class="linenos">579</span></a><span class="sd">        - datetime.datetime: The corresponding datetime object.</span>
</span><span id="ZakatTracker.time_to_datetime-580"><a href="#ZakatTracker.time_to_datetime-580"><span class="linenos">580</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.time_to_datetime-581"><a href="#ZakatTracker.time_to_datetime-581"><span class="linenos">581</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromordinal</span><span class="p">(</span><span class="n">ordinal_ns</span> <span class="o">//</span> <span class="mi">86_400_000_000_000</span><span class="p">)</span>
</span><span id="ZakatTracker.time_to_datetime-582"><a href="#ZakatTracker.time_to_datetime-582"><span class="linenos">582</span></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="p">(</span><span class="n">ordinal_ns</span> <span class="o">%</span> <span class="mi">86_400_000_000_000</span><span class="p">)</span> <span class="o">//</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="ZakatTracker.time_to_datetime-583"><a href="#ZakatTracker.time_to_datetime-583"><span class="linenos">583</span></a>        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="n">t</span>
</span></pre></div>


            <div class="docstring"><p>Converts a nanosecond-precision timestamp (ordinal number of nanoseconds since 1AD)
back to a datetime object.</p>

<p>Parameters:</p>

<ul>
<li>ordinal_ns (int): The timestamp in nanoseconds since the epoch (January 1, 1AD).</li>
</ul>

<p>Returns:</p>

<ul>
<li>datetime.datetime: The corresponding datetime object.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.clean_history" class="classattr">
                                        <input id="ZakatTracker.clean_history-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clean_history</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">lock</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.clean_history-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.clean_history"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.clean_history-585"><a href="#ZakatTracker.clean_history-585"><span class="linenos">585</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clean_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lock</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker.clean_history-586"><a href="#ZakatTracker.clean_history-586"><span class="linenos">586</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.clean_history-587"><a href="#ZakatTracker.clean_history-587"><span class="linenos">587</span></a><span class="sd">        Cleans up the empty history records of actions performed on the ZakatTracker instance.</span>
</span><span id="ZakatTracker.clean_history-588"><a href="#ZakatTracker.clean_history-588"><span class="linenos">588</span></a>
</span><span id="ZakatTracker.clean_history-589"><a href="#ZakatTracker.clean_history-589"><span class="linenos">589</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.clean_history-590"><a href="#ZakatTracker.clean_history-590"><span class="linenos">590</span></a><span class="sd">        - lock (int, optional): The lock ID is used to clean up the empty history.</span>
</span><span id="ZakatTracker.clean_history-591"><a href="#ZakatTracker.clean_history-591"><span class="linenos">591</span></a><span class="sd">            If not provided, it cleans up the empty history records for all locks.</span>
</span><span id="ZakatTracker.clean_history-592"><a href="#ZakatTracker.clean_history-592"><span class="linenos">592</span></a>
</span><span id="ZakatTracker.clean_history-593"><a href="#ZakatTracker.clean_history-593"><span class="linenos">593</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.clean_history-594"><a href="#ZakatTracker.clean_history-594"><span class="linenos">594</span></a><span class="sd">        - int: The number of locks cleaned up.</span>
</span><span id="ZakatTracker.clean_history-595"><a href="#ZakatTracker.clean_history-595"><span class="linenos">595</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.clean_history-596"><a href="#ZakatTracker.clean_history-596"><span class="linenos">596</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.clean_history-597"><a href="#ZakatTracker.clean_history-597"><span class="linenos">597</span></a>        <span class="k">if</span> <span class="n">lock</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.clean_history-598"><a href="#ZakatTracker.clean_history-598"><span class="linenos">598</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">lock</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.clean_history-599"><a href="#ZakatTracker.clean_history-599"><span class="linenos">599</span></a>                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker.clean_history-600"><a href="#ZakatTracker.clean_history-600"><span class="linenos">600</span></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">lock</span><span class="p">]</span>
</span><span id="ZakatTracker.clean_history-601"><a href="#ZakatTracker.clean_history-601"><span class="linenos">601</span></a>            <span class="k">return</span> <span class="n">count</span>
</span><span id="ZakatTracker.clean_history-602"><a href="#ZakatTracker.clean_history-602"><span class="linenos">602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">())</span>
</span><span id="ZakatTracker.clean_history-603"><a href="#ZakatTracker.clean_history-603"><span class="linenos">603</span></a>        <span class="k">for</span> <span class="n">lock</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.clean_history-604"><a href="#ZakatTracker.clean_history-604"><span class="linenos">604</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">lock</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.clean_history-605"><a href="#ZakatTracker.clean_history-605"><span class="linenos">605</span></a>                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker.clean_history-606"><a href="#ZakatTracker.clean_history-606"><span class="linenos">606</span></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">lock</span><span class="p">]</span>
</span><span id="ZakatTracker.clean_history-607"><a href="#ZakatTracker.clean_history-607"><span class="linenos">607</span></a>        <span class="k">return</span> <span class="n">count</span>
</span></pre></div>


            <div class="docstring"><p>Cleans up the empty history records of actions performed on the ZakatTracker instance.</p>

<p>Parameters:</p>

<ul>
<li>lock (int, optional): The lock ID is used to clean up the empty history.
If not provided, it cleans up the empty history records for all locks.</li>
</ul>

<p>Returns:</p>

<ul>
<li>int: The number of locks cleaned up.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.nolock" class="classattr">
                                        <input id="ZakatTracker.nolock-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nolock</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.nolock-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.nolock"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.nolock-663"><a href="#ZakatTracker.nolock-663"><span class="linenos">663</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nolock</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.nolock-664"><a href="#ZakatTracker.nolock-664"><span class="linenos">664</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.nolock-665"><a href="#ZakatTracker.nolock-665"><span class="linenos">665</span></a><span class="sd">        Check if the vault lock is currently not set.</span>
</span><span id="ZakatTracker.nolock-666"><a href="#ZakatTracker.nolock-666"><span class="linenos">666</span></a>
</span><span id="ZakatTracker.nolock-667"><a href="#ZakatTracker.nolock-667"><span class="linenos">667</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.nolock-668"><a href="#ZakatTracker.nolock-668"><span class="linenos">668</span></a><span class="sd">        - bool: True if the vault lock is not set, False otherwise.</span>
</span><span id="ZakatTracker.nolock-669"><a href="#ZakatTracker.nolock-669"><span class="linenos">669</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.nolock-670"><a href="#ZakatTracker.nolock-670"><span class="linenos">670</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;lock&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Check if the vault lock is currently not set.</p>

<p>Returns:</p>

<ul>
<li>bool: True if the vault lock is not set, False otherwise.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.lock" class="classattr">
                                        <input id="ZakatTracker.lock-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lock</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.lock-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.lock"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.lock-672"><a href="#ZakatTracker.lock-672"><span class="linenos">672</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker.lock-673"><a href="#ZakatTracker.lock-673"><span class="linenos">673</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.lock-674"><a href="#ZakatTracker.lock-674"><span class="linenos">674</span></a><span class="sd">        Acquires a lock on the ZakatTracker instance.</span>
</span><span id="ZakatTracker.lock-675"><a href="#ZakatTracker.lock-675"><span class="linenos">675</span></a>
</span><span id="ZakatTracker.lock-676"><a href="#ZakatTracker.lock-676"><span class="linenos">676</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.lock-677"><a href="#ZakatTracker.lock-677"><span class="linenos">677</span></a><span class="sd">        - int: The lock ID. This ID can be used to release the lock later.</span>
</span><span id="ZakatTracker.lock-678"><a href="#ZakatTracker.lock-678"><span class="linenos">678</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.lock-679"><a href="#ZakatTracker.lock-679"><span class="linenos">679</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Acquires a lock on the ZakatTracker instance.</p>

<p>Returns:</p>

<ul>
<li>int: The lock ID. This ID can be used to release the lock later.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.steps" class="classattr">
                                        <input id="ZakatTracker.steps-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">steps</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.steps-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.steps"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.steps-681"><a href="#ZakatTracker.steps-681"><span class="linenos">681</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">steps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker.steps-682"><a href="#ZakatTracker.steps-682"><span class="linenos">682</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.steps-683"><a href="#ZakatTracker.steps-683"><span class="linenos">683</span></a><span class="sd">        Returns a copy of the history of steps taken in the ZakatTracker.</span>
</span><span id="ZakatTracker.steps-684"><a href="#ZakatTracker.steps-684"><span class="linenos">684</span></a>
</span><span id="ZakatTracker.steps-685"><a href="#ZakatTracker.steps-685"><span class="linenos">685</span></a><span class="sd">        The history is a dictionary where each key is a unique identifier for a step,</span>
</span><span id="ZakatTracker.steps-686"><a href="#ZakatTracker.steps-686"><span class="linenos">686</span></a><span class="sd">        and the corresponding value is a dictionary containing information about the step.</span>
</span><span id="ZakatTracker.steps-687"><a href="#ZakatTracker.steps-687"><span class="linenos">687</span></a>
</span><span id="ZakatTracker.steps-688"><a href="#ZakatTracker.steps-688"><span class="linenos">688</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.steps-689"><a href="#ZakatTracker.steps-689"><span class="linenos">689</span></a><span class="sd">        - dict: A copy of the history of steps taken in the ZakatTracker.</span>
</span><span id="ZakatTracker.steps-690"><a href="#ZakatTracker.steps-690"><span class="linenos">690</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.steps-691"><a href="#ZakatTracker.steps-691"><span class="linenos">691</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Returns a copy of the history of steps taken in the ZakatTracker.</p>

<p>The history is a dictionary where each key is a unique identifier for a step,
and the corresponding value is a dictionary containing information about the step.</p>

<p>Returns:</p>

<ul>
<li>dict: A copy of the history of steps taken in the ZakatTracker.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.free" class="classattr">
                                        <input id="ZakatTracker.free-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">free</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">lock</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">auto_save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.free-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.free"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.free-693"><a href="#ZakatTracker.free-693"><span class="linenos">693</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">free</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lock</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">auto_save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.free-694"><a href="#ZakatTracker.free-694"><span class="linenos">694</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.free-695"><a href="#ZakatTracker.free-695"><span class="linenos">695</span></a><span class="sd">        Releases the lock on the database.</span>
</span><span id="ZakatTracker.free-696"><a href="#ZakatTracker.free-696"><span class="linenos">696</span></a>
</span><span id="ZakatTracker.free-697"><a href="#ZakatTracker.free-697"><span class="linenos">697</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.free-698"><a href="#ZakatTracker.free-698"><span class="linenos">698</span></a><span class="sd">        - lock (int): The lock ID to be released.</span>
</span><span id="ZakatTracker.free-699"><a href="#ZakatTracker.free-699"><span class="linenos">699</span></a><span class="sd">        - auto_save (bool): Whether to automatically save the database after releasing the lock.</span>
</span><span id="ZakatTracker.free-700"><a href="#ZakatTracker.free-700"><span class="linenos">700</span></a>
</span><span id="ZakatTracker.free-701"><a href="#ZakatTracker.free-701"><span class="linenos">701</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.free-702"><a href="#ZakatTracker.free-702"><span class="linenos">702</span></a><span class="sd">        - bool: True if the lock is successfully released and (optionally) saved, False otherwise.</span>
</span><span id="ZakatTracker.free-703"><a href="#ZakatTracker.free-703"><span class="linenos">703</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.free-704"><a href="#ZakatTracker.free-704"><span class="linenos">704</span></a>        <span class="k">if</span> <span class="n">lock</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;lock&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.free-705"><a href="#ZakatTracker.free-705"><span class="linenos">705</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;lock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ZakatTracker.free-706"><a href="#ZakatTracker.free-706"><span class="linenos">706</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">clean_history</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker.free-707"><a href="#ZakatTracker.free-707"><span class="linenos">707</span></a>            <span class="k">if</span> <span class="n">auto_save</span><span class="p">:</span>
</span><span id="ZakatTracker.free-708"><a href="#ZakatTracker.free-708"><span class="linenos">708</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>
</span><span id="ZakatTracker.free-709"><a href="#ZakatTracker.free-709"><span class="linenos">709</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker.free-710"><a href="#ZakatTracker.free-710"><span class="linenos">710</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Releases the lock on the database.</p>

<p>Parameters:</p>

<ul>
<li>lock (int): The lock ID to be released.</li>
<li>auto_save (bool): Whether to automatically save the database after releasing the lock.</li>
</ul>

<p>Returns:</p>

<ul>
<li>bool: True if the lock is successfully released and (optionally) saved, False otherwise.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.recall" class="classattr">
                                        <input id="ZakatTracker.recall-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">recall</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>, </span><span class="param"><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.recall-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.recall"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.recall-712"><a href="#ZakatTracker.recall-712"><span class="linenos">712</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-713"><a href="#ZakatTracker.recall-713"><span class="linenos">713</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.recall-714"><a href="#ZakatTracker.recall-714"><span class="linenos">714</span></a><span class="sd">        Revert the last operation.</span>
</span><span id="ZakatTracker.recall-715"><a href="#ZakatTracker.recall-715"><span class="linenos">715</span></a>
</span><span id="ZakatTracker.recall-716"><a href="#ZakatTracker.recall-716"><span class="linenos">716</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.recall-717"><a href="#ZakatTracker.recall-717"><span class="linenos">717</span></a><span class="sd">        - dry (bool): If True, the function will not modify the data, but will simulate the operation. Default is True.</span>
</span><span id="ZakatTracker.recall-718"><a href="#ZakatTracker.recall-718"><span class="linenos">718</span></a><span class="sd">        - debug (bool): If True, the function will print debug information. Default is False.</span>
</span><span id="ZakatTracker.recall-719"><a href="#ZakatTracker.recall-719"><span class="linenos">719</span></a>
</span><span id="ZakatTracker.recall-720"><a href="#ZakatTracker.recall-720"><span class="linenos">720</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.recall-721"><a href="#ZakatTracker.recall-721"><span class="linenos">721</span></a><span class="sd">        - bool: True if the operation was successful, False otherwise.</span>
</span><span id="ZakatTracker.recall-722"><a href="#ZakatTracker.recall-722"><span class="linenos">722</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.recall-723"><a href="#ZakatTracker.recall-723"><span class="linenos">723</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-724"><a href="#ZakatTracker.recall-724"><span class="linenos">724</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker.recall-725"><a href="#ZakatTracker.recall-725"><span class="linenos">725</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-726"><a href="#ZakatTracker.recall-726"><span class="linenos">726</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker.recall-727"><a href="#ZakatTracker.recall-727"><span class="linenos">727</span></a>        <span class="n">ref</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-728"><a href="#ZakatTracker.recall-728"><span class="linenos">728</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-729"><a href="#ZakatTracker.recall-729"><span class="linenos">729</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
</span><span id="ZakatTracker.recall-730"><a href="#ZakatTracker.recall-730"><span class="linenos">730</span></a>        <span class="n">memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-731"><a href="#ZakatTracker.recall-731"><span class="linenos">731</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-732"><a href="#ZakatTracker.recall-732"><span class="linenos">732</span></a>            <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">memory</span><span class="p">),</span> <span class="s1">&#39;memory&#39;</span><span class="p">,</span> <span class="n">memory</span><span class="p">)</span>
</span><span id="ZakatTracker.recall-733"><a href="#ZakatTracker.recall-733"><span class="linenos">733</span></a>        <span class="n">limit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ZakatTracker.recall-734"><a href="#ZakatTracker.recall-734"><span class="linenos">734</span></a>        <span class="n">sub_positive_log_negative</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.recall-735"><a href="#ZakatTracker.recall-735"><span class="linenos">735</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ZakatTracker.recall-736"><a href="#ZakatTracker.recall-736"><span class="linenos">736</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">memory</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-737"><a href="#ZakatTracker.recall-737"><span class="linenos">737</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-738"><a href="#ZakatTracker.recall-738"><span class="linenos">738</span></a>                <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker.recall-739"><a href="#ZakatTracker.recall-739"><span class="linenos">739</span></a>            <span class="k">match</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.recall-740"><a href="#ZakatTracker.recall-740"><span class="linenos">740</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">CREATE</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-741"><a href="#ZakatTracker.recall-741"><span class="linenos">741</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-742"><a href="#ZakatTracker.recall-742"><span class="linenos">742</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker.recall-743"><a href="#ZakatTracker.recall-743"><span class="linenos">743</span></a>                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-744"><a href="#ZakatTracker.recall-744"><span class="linenos">744</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]])</span>
</span><span id="ZakatTracker.recall-745"><a href="#ZakatTracker.recall-745"><span class="linenos">745</span></a>                            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker.recall-746"><a href="#ZakatTracker.recall-746"><span class="linenos">746</span></a>                            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker.recall-747"><a href="#ZakatTracker.recall-747"><span class="linenos">747</span></a>                            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker.recall-748"><a href="#ZakatTracker.recall-748"><span class="linenos">748</span></a>                            <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-749"><a href="#ZakatTracker.recall-749"><span class="linenos">749</span></a>                                <span class="k">continue</span>
</span><span id="ZakatTracker.recall-750"><a href="#ZakatTracker.recall-750"><span class="linenos">750</span></a>                            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]]</span>
</span><span id="ZakatTracker.recall-751"><a href="#ZakatTracker.recall-751"><span class="linenos">751</span></a>
</span><span id="ZakatTracker.recall-752"><a href="#ZakatTracker.recall-752"><span class="linenos">752</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">TRACK</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-753"><a href="#ZakatTracker.recall-753"><span class="linenos">753</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-754"><a href="#ZakatTracker.recall-754"><span class="linenos">754</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker.recall-755"><a href="#ZakatTracker.recall-755"><span class="linenos">755</span></a>                            <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-756"><a href="#ZakatTracker.recall-756"><span class="linenos">756</span></a>                                <span class="k">continue</span>
</span><span id="ZakatTracker.recall-757"><a href="#ZakatTracker.recall-757"><span class="linenos">757</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-758"><a href="#ZakatTracker.recall-758"><span class="linenos">758</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="ZakatTracker.recall-759"><a href="#ZakatTracker.recall-759"><span class="linenos">759</span></a>                            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]]</span>
</span><span id="ZakatTracker.recall-760"><a href="#ZakatTracker.recall-760"><span class="linenos">760</span></a>
</span><span id="ZakatTracker.recall-761"><a href="#ZakatTracker.recall-761"><span class="linenos">761</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">LOG</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-762"><a href="#ZakatTracker.recall-762"><span class="linenos">762</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-763"><a href="#ZakatTracker.recall-763"><span class="linenos">763</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker.recall-764"><a href="#ZakatTracker.recall-764"><span class="linenos">764</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.recall-765"><a href="#ZakatTracker.recall-765"><span class="linenos">765</span></a>                                <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-766"><a href="#ZakatTracker.recall-766"><span class="linenos">766</span></a>                                    <span class="k">continue</span>
</span><span id="ZakatTracker.recall-767"><a href="#ZakatTracker.recall-767"><span class="linenos">767</span></a>                                <span class="k">if</span> <span class="n">sub_positive_log_negative</span> <span class="o">==</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.recall-768"><a href="#ZakatTracker.recall-768"><span class="linenos">768</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="ZakatTracker.recall-769"><a href="#ZakatTracker.recall-769"><span class="linenos">769</span></a>                                    <span class="n">sub_positive_log_negative</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.recall-770"><a href="#ZakatTracker.recall-770"><span class="linenos">770</span></a>                                <span class="n">box_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-771"><a href="#ZakatTracker.recall-771"><span class="linenos">771</span></a>                                <span class="k">if</span> <span class="ow">not</span> <span class="n">box_ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-772"><a href="#ZakatTracker.recall-772"><span class="linenos">772</span></a>                                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">],</span> <span class="n">box_ref</span><span class="p">)</span>
</span><span id="ZakatTracker.recall-773"><a href="#ZakatTracker.recall-773"><span class="linenos">773</span></a>                                    <span class="n">box_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-774"><a href="#ZakatTracker.recall-774"><span class="linenos">774</span></a>                                    <span class="k">assert</span> <span class="n">box_value</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker.recall-775"><a href="#ZakatTracker.recall-775"><span class="linenos">775</span></a>
</span><span id="ZakatTracker.recall-776"><a href="#ZakatTracker.recall-776"><span class="linenos">776</span></a>                                    <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-777"><a href="#ZakatTracker.recall-777"><span class="linenos">777</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">box_ref</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">box_value</span>
</span><span id="ZakatTracker.recall-778"><a href="#ZakatTracker.recall-778"><span class="linenos">778</span></a>                                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-779"><a href="#ZakatTracker.recall-779"><span class="linenos">779</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">box_ref</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span>
</span><span id="ZakatTracker.recall-780"><a href="#ZakatTracker.recall-780"><span class="linenos">780</span></a>                                            <span class="o">-</span><span class="n">box_value</span><span class="p">)</span>
</span><span id="ZakatTracker.recall-781"><a href="#ZakatTracker.recall-781"><span class="linenos">781</span></a>
</span><span id="ZakatTracker.recall-782"><a href="#ZakatTracker.recall-782"><span class="linenos">782</span></a>                                    <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-783"><a href="#ZakatTracker.recall-783"><span class="linenos">783</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">box_value</span>
</span><span id="ZakatTracker.recall-784"><a href="#ZakatTracker.recall-784"><span class="linenos">784</span></a>                                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-785"><a href="#ZakatTracker.recall-785"><span class="linenos">785</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="o">-</span><span class="n">box_value</span><span class="p">)</span>
</span><span id="ZakatTracker.recall-786"><a href="#ZakatTracker.recall-786"><span class="linenos">786</span></a>
</span><span id="ZakatTracker.recall-787"><a href="#ZakatTracker.recall-787"><span class="linenos">787</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="ZakatTracker.recall-788"><a href="#ZakatTracker.recall-788"><span class="linenos">788</span></a>                                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]]</span>
</span><span id="ZakatTracker.recall-789"><a href="#ZakatTracker.recall-789"><span class="linenos">789</span></a>
</span><span id="ZakatTracker.recall-790"><a href="#ZakatTracker.recall-790"><span class="linenos">790</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">SUB</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-791"><a href="#ZakatTracker.recall-791"><span class="linenos">791</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-792"><a href="#ZakatTracker.recall-792"><span class="linenos">792</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker.recall-793"><a href="#ZakatTracker.recall-793"><span class="linenos">793</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.recall-794"><a href="#ZakatTracker.recall-794"><span class="linenos">794</span></a>                                <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-795"><a href="#ZakatTracker.recall-795"><span class="linenos">795</span></a>                                    <span class="k">continue</span>
</span><span id="ZakatTracker.recall-796"><a href="#ZakatTracker.recall-796"><span class="linenos">796</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-797"><a href="#ZakatTracker.recall-797"><span class="linenos">797</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-798"><a href="#ZakatTracker.recall-798"><span class="linenos">798</span></a>                                <span class="n">sub_positive_log_negative</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-799"><a href="#ZakatTracker.recall-799"><span class="linenos">799</span></a>
</span><span id="ZakatTracker.recall-800"><a href="#ZakatTracker.recall-800"><span class="linenos">800</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">ADD_FILE</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-801"><a href="#ZakatTracker.recall-801"><span class="linenos">801</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-802"><a href="#ZakatTracker.recall-802"><span class="linenos">802</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker.recall-803"><a href="#ZakatTracker.recall-803"><span class="linenos">803</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.recall-804"><a href="#ZakatTracker.recall-804"><span class="linenos">804</span></a>                                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;file&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.recall-805"><a href="#ZakatTracker.recall-805"><span class="linenos">805</span></a>                                    <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-806"><a href="#ZakatTracker.recall-806"><span class="linenos">806</span></a>                                        <span class="k">continue</span>
</span><span id="ZakatTracker.recall-807"><a href="#ZakatTracker.recall-807"><span class="linenos">807</span></a>                                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]]</span>
</span><span id="ZakatTracker.recall-808"><a href="#ZakatTracker.recall-808"><span class="linenos">808</span></a>
</span><span id="ZakatTracker.recall-809"><a href="#ZakatTracker.recall-809"><span class="linenos">809</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">REMOVE_FILE</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-810"><a href="#ZakatTracker.recall-810"><span class="linenos">810</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-811"><a href="#ZakatTracker.recall-811"><span class="linenos">811</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker.recall-812"><a href="#ZakatTracker.recall-812"><span class="linenos">812</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.recall-813"><a href="#ZakatTracker.recall-813"><span class="linenos">813</span></a>                                <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-814"><a href="#ZakatTracker.recall-814"><span class="linenos">814</span></a>                                    <span class="k">continue</span>
</span><span id="ZakatTracker.recall-815"><a href="#ZakatTracker.recall-815"><span class="linenos">815</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-816"><a href="#ZakatTracker.recall-816"><span class="linenos">816</span></a>
</span><span id="ZakatTracker.recall-817"><a href="#ZakatTracker.recall-817"><span class="linenos">817</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">BOX_TRANSFER</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-818"><a href="#ZakatTracker.recall-818"><span class="linenos">818</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-819"><a href="#ZakatTracker.recall-819"><span class="linenos">819</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker.recall-820"><a href="#ZakatTracker.recall-820"><span class="linenos">820</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.recall-821"><a href="#ZakatTracker.recall-821"><span class="linenos">821</span></a>                                <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-822"><a href="#ZakatTracker.recall-822"><span class="linenos">822</span></a>                                    <span class="k">continue</span>
</span><span id="ZakatTracker.recall-823"><a href="#ZakatTracker.recall-823"><span class="linenos">823</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-824"><a href="#ZakatTracker.recall-824"><span class="linenos">824</span></a>
</span><span id="ZakatTracker.recall-825"><a href="#ZakatTracker.recall-825"><span class="linenos">825</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">EXCHANGE</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-826"><a href="#ZakatTracker.recall-826"><span class="linenos">826</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-827"><a href="#ZakatTracker.recall-827"><span class="linenos">827</span></a>                        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.recall-828"><a href="#ZakatTracker.recall-828"><span class="linenos">828</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]]:</span>
</span><span id="ZakatTracker.recall-829"><a href="#ZakatTracker.recall-829"><span class="linenos">829</span></a>                                <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-830"><a href="#ZakatTracker.recall-830"><span class="linenos">830</span></a>                                    <span class="k">continue</span>
</span><span id="ZakatTracker.recall-831"><a href="#ZakatTracker.recall-831"><span class="linenos">831</span></a>                                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]]</span>
</span><span id="ZakatTracker.recall-832"><a href="#ZakatTracker.recall-832"><span class="linenos">832</span></a>
</span><span id="ZakatTracker.recall-833"><a href="#ZakatTracker.recall-833"><span class="linenos">833</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">REPORT</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-834"><a href="#ZakatTracker.recall-834"><span class="linenos">834</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.recall-835"><a href="#ZakatTracker.recall-835"><span class="linenos">835</span></a>                        <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-836"><a href="#ZakatTracker.recall-836"><span class="linenos">836</span></a>                            <span class="k">continue</span>
</span><span id="ZakatTracker.recall-837"><a href="#ZakatTracker.recall-837"><span class="linenos">837</span></a>                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]]</span>
</span><span id="ZakatTracker.recall-838"><a href="#ZakatTracker.recall-838"><span class="linenos">838</span></a>
</span><span id="ZakatTracker.recall-839"><a href="#ZakatTracker.recall-839"><span class="linenos">839</span></a>                <span class="k">case</span> <span class="n">Action</span><span class="o">.</span><span class="n">ZAKAT</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-840"><a href="#ZakatTracker.recall-840"><span class="linenos">840</span></a>                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-841"><a href="#ZakatTracker.recall-841"><span class="linenos">841</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]):</span>
</span><span id="ZakatTracker.recall-842"><a href="#ZakatTracker.recall-842"><span class="linenos">842</span></a>                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.recall-843"><a href="#ZakatTracker.recall-843"><span class="linenos">843</span></a>                                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]]:</span>
</span><span id="ZakatTracker.recall-844"><a href="#ZakatTracker.recall-844"><span class="linenos">844</span></a>                                    <span class="k">if</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-845"><a href="#ZakatTracker.recall-845"><span class="linenos">845</span></a>                                        <span class="k">continue</span>
</span><span id="ZakatTracker.recall-846"><a href="#ZakatTracker.recall-846"><span class="linenos">846</span></a>                                    <span class="k">match</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;math&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.recall-847"><a href="#ZakatTracker.recall-847"><span class="linenos">847</span></a>                                        <span class="k">case</span> <span class="n">MathOperation</span><span class="o">.</span><span class="n">ADDITION</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-848"><a href="#ZakatTracker.recall-848"><span class="linenos">848</span></a>                                            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]]</span> <span class="o">-=</span> <span class="n">x</span><span class="p">[</span>
</span><span id="ZakatTracker.recall-849"><a href="#ZakatTracker.recall-849"><span class="linenos">849</span></a>                                                <span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-850"><a href="#ZakatTracker.recall-850"><span class="linenos">850</span></a>                                        <span class="k">case</span> <span class="n">MathOperation</span><span class="o">.</span><span class="n">EQUAL</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-851"><a href="#ZakatTracker.recall-851"><span class="linenos">851</span></a>                                            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-852"><a href="#ZakatTracker.recall-852"><span class="linenos">852</span></a>                                        <span class="k">case</span> <span class="n">MathOperation</span><span class="o">.</span><span class="n">SUBTRACTION</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-853"><a href="#ZakatTracker.recall-853"><span class="linenos">853</span></a>                                            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]][</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span>
</span><span id="ZakatTracker.recall-854"><a href="#ZakatTracker.recall-854"><span class="linenos">854</span></a>                                                <span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-855"><a href="#ZakatTracker.recall-855"><span class="linenos">855</span></a>
</span><span id="ZakatTracker.recall-856"><a href="#ZakatTracker.recall-856"><span class="linenos">856</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">dry</span><span class="p">:</span>
</span><span id="ZakatTracker.recall-857"><a href="#ZakatTracker.recall-857"><span class="linenos">857</span></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">]</span>
</span><span id="ZakatTracker.recall-858"><a href="#ZakatTracker.recall-858"><span class="linenos">858</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Revert the last operation.</p>

<p>Parameters:</p>

<ul>
<li>dry (bool): If True, the function will not modify the data, but will simulate the operation. Default is True.</li>
<li>debug (bool): If True, the function will print debug information. Default is False.</li>
</ul>

<p>Returns:</p>

<ul>
<li>bool: True if the operation was successful, False otherwise.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.vault" class="classattr">
                                        <input id="ZakatTracker.vault-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">vault</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.vault-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.vault"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.vault-860"><a href="#ZakatTracker.vault-860"><span class="linenos">860</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">vault</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker.vault-861"><a href="#ZakatTracker.vault-861"><span class="linenos">861</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.vault-862"><a href="#ZakatTracker.vault-862"><span class="linenos">862</span></a><span class="sd">        Returns a copy of the internal vault dictionary.</span>
</span><span id="ZakatTracker.vault-863"><a href="#ZakatTracker.vault-863"><span class="linenos">863</span></a>
</span><span id="ZakatTracker.vault-864"><a href="#ZakatTracker.vault-864"><span class="linenos">864</span></a><span class="sd">        This method is used to retrieve the current state of the ZakatTracker object.</span>
</span><span id="ZakatTracker.vault-865"><a href="#ZakatTracker.vault-865"><span class="linenos">865</span></a><span class="sd">        It provides a snapshot of the internal data structure, allowing for further</span>
</span><span id="ZakatTracker.vault-866"><a href="#ZakatTracker.vault-866"><span class="linenos">866</span></a><span class="sd">        processing or analysis.</span>
</span><span id="ZakatTracker.vault-867"><a href="#ZakatTracker.vault-867"><span class="linenos">867</span></a>
</span><span id="ZakatTracker.vault-868"><a href="#ZakatTracker.vault-868"><span class="linenos">868</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.vault-869"><a href="#ZakatTracker.vault-869"><span class="linenos">869</span></a><span class="sd">        - dict: A copy of the internal vault dictionary.</span>
</span><span id="ZakatTracker.vault-870"><a href="#ZakatTracker.vault-870"><span class="linenos">870</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.vault-871"><a href="#ZakatTracker.vault-871"><span class="linenos">871</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Returns a copy of the internal vault dictionary.</p>

<p>This method is used to retrieve the current state of the ZakatTracker object.
It provides a snapshot of the internal data structure, allowing for further
processing or analysis.</p>

<p>Returns:</p>

<ul>
<li>dict: A copy of the internal vault dictionary.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.stats_init" class="classattr">
                                        <input id="ZakatTracker.stats_init-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stats_init</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.stats_init-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.stats_init"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.stats_init-873"><a href="#ZakatTracker.stats_init-873"><span class="linenos">873</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stats_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
</span><span id="ZakatTracker.stats_init-874"><a href="#ZakatTracker.stats_init-874"><span class="linenos">874</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.stats_init-875"><a href="#ZakatTracker.stats_init-875"><span class="linenos">875</span></a><span class="sd">        Initialize and return a dictionary containing initial statistics for the ZakatTracker instance.</span>
</span><span id="ZakatTracker.stats_init-876"><a href="#ZakatTracker.stats_init-876"><span class="linenos">876</span></a>
</span><span id="ZakatTracker.stats_init-877"><a href="#ZakatTracker.stats_init-877"><span class="linenos">877</span></a><span class="sd">        The dictionary contains two keys: &#39;database&#39; and &#39;ram&#39;. Each key maps to a tuple containing two elements:</span>
</span><span id="ZakatTracker.stats_init-878"><a href="#ZakatTracker.stats_init-878"><span class="linenos">878</span></a><span class="sd">        - The initial size of the respective statistic in bytes (int).</span>
</span><span id="ZakatTracker.stats_init-879"><a href="#ZakatTracker.stats_init-879"><span class="linenos">879</span></a><span class="sd">        - The initial size of the respective statistic in a human-readable format (str).</span>
</span><span id="ZakatTracker.stats_init-880"><a href="#ZakatTracker.stats_init-880"><span class="linenos">880</span></a>
</span><span id="ZakatTracker.stats_init-881"><a href="#ZakatTracker.stats_init-881"><span class="linenos">881</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.stats_init-882"><a href="#ZakatTracker.stats_init-882"><span class="linenos">882</span></a><span class="sd">        - dict[str, tuple]: A dictionary with initial statistics for the ZakatTracker instance.</span>
</span><span id="ZakatTracker.stats_init-883"><a href="#ZakatTracker.stats_init-883"><span class="linenos">883</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.stats_init-884"><a href="#ZakatTracker.stats_init-884"><span class="linenos">884</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ZakatTracker.stats_init-885"><a href="#ZakatTracker.stats_init-885"><span class="linenos">885</span></a>            <span class="s1">&#39;database&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">),</span>
</span><span id="ZakatTracker.stats_init-886"><a href="#ZakatTracker.stats_init-886"><span class="linenos">886</span></a>            <span class="s1">&#39;ram&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">),</span>
</span><span id="ZakatTracker.stats_init-887"><a href="#ZakatTracker.stats_init-887"><span class="linenos">887</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Initialize and return a dictionary containing initial statistics for the ZakatTracker instance.</p>

<p>The dictionary contains two keys: 'database' and 'ram'. Each key maps to a tuple containing two elements:</p>

<ul>
<li>The initial size of the respective statistic in bytes (int).</li>
<li>The initial size of the respective statistic in a human-readable format (str).</li>
</ul>

<p>Returns:</p>

<ul>
<li>dict[str, tuple]: A dictionary with initial statistics for the ZakatTracker instance.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.stats" class="classattr">
                                        <input id="ZakatTracker.stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ignore_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.stats-889"><a href="#ZakatTracker.stats-889"><span class="linenos">889</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_ram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
</span><span id="ZakatTracker.stats-890"><a href="#ZakatTracker.stats-890"><span class="linenos">890</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.stats-891"><a href="#ZakatTracker.stats-891"><span class="linenos">891</span></a><span class="sd">        Calculates and returns statistics about the object&#39;s data storage.</span>
</span><span id="ZakatTracker.stats-892"><a href="#ZakatTracker.stats-892"><span class="linenos">892</span></a>
</span><span id="ZakatTracker.stats-893"><a href="#ZakatTracker.stats-893"><span class="linenos">893</span></a><span class="sd">        This method determines the size of the database file on disk and the</span>
</span><span id="ZakatTracker.stats-894"><a href="#ZakatTracker.stats-894"><span class="linenos">894</span></a><span class="sd">        size of the data currently held in RAM (likely within a dictionary).</span>
</span><span id="ZakatTracker.stats-895"><a href="#ZakatTracker.stats-895"><span class="linenos">895</span></a><span class="sd">        Both sizes are reported in bytes and in a human-readable format</span>
</span><span id="ZakatTracker.stats-896"><a href="#ZakatTracker.stats-896"><span class="linenos">896</span></a><span class="sd">        (e.g., KB, MB).</span>
</span><span id="ZakatTracker.stats-897"><a href="#ZakatTracker.stats-897"><span class="linenos">897</span></a>
</span><span id="ZakatTracker.stats-898"><a href="#ZakatTracker.stats-898"><span class="linenos">898</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.stats-899"><a href="#ZakatTracker.stats-899"><span class="linenos">899</span></a><span class="sd">        - ignore_ram (bool): Whether to ignore the RAM size. Default is True</span>
</span><span id="ZakatTracker.stats-900"><a href="#ZakatTracker.stats-900"><span class="linenos">900</span></a>
</span><span id="ZakatTracker.stats-901"><a href="#ZakatTracker.stats-901"><span class="linenos">901</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.stats-902"><a href="#ZakatTracker.stats-902"><span class="linenos">902</span></a><span class="sd">        - dict[str, tuple]: A dictionary containing the following statistics:</span>
</span><span id="ZakatTracker.stats-903"><a href="#ZakatTracker.stats-903"><span class="linenos">903</span></a>
</span><span id="ZakatTracker.stats-904"><a href="#ZakatTracker.stats-904"><span class="linenos">904</span></a><span class="sd">            * &#39;database&#39;: A tuple with two elements:</span>
</span><span id="ZakatTracker.stats-905"><a href="#ZakatTracker.stats-905"><span class="linenos">905</span></a><span class="sd">                - The database file size in bytes (int).</span>
</span><span id="ZakatTracker.stats-906"><a href="#ZakatTracker.stats-906"><span class="linenos">906</span></a><span class="sd">                - The database file size in human-readable format (str).</span>
</span><span id="ZakatTracker.stats-907"><a href="#ZakatTracker.stats-907"><span class="linenos">907</span></a><span class="sd">            * &#39;ram&#39;: A tuple with two elements:</span>
</span><span id="ZakatTracker.stats-908"><a href="#ZakatTracker.stats-908"><span class="linenos">908</span></a><span class="sd">                - The RAM usage (dictionary size) in bytes (int).</span>
</span><span id="ZakatTracker.stats-909"><a href="#ZakatTracker.stats-909"><span class="linenos">909</span></a><span class="sd">                - The RAM usage in human-readable format (str).</span>
</span><span id="ZakatTracker.stats-910"><a href="#ZakatTracker.stats-910"><span class="linenos">910</span></a>
</span><span id="ZakatTracker.stats-911"><a href="#ZakatTracker.stats-911"><span class="linenos">911</span></a><span class="sd">        Example:</span>
</span><span id="ZakatTracker.stats-912"><a href="#ZakatTracker.stats-912"><span class="linenos">912</span></a><span class="sd">        &gt;&gt;&gt; stats = my_object.stats()</span>
</span><span id="ZakatTracker.stats-913"><a href="#ZakatTracker.stats-913"><span class="linenos">913</span></a><span class="sd">        &gt;&gt;&gt; print(stats[&#39;database&#39;])</span>
</span><span id="ZakatTracker.stats-914"><a href="#ZakatTracker.stats-914"><span class="linenos">914</span></a><span class="sd">        (256000, &#39;250.0 KB&#39;)</span>
</span><span id="ZakatTracker.stats-915"><a href="#ZakatTracker.stats-915"><span class="linenos">915</span></a><span class="sd">        &gt;&gt;&gt; print(stats[&#39;ram&#39;])</span>
</span><span id="ZakatTracker.stats-916"><a href="#ZakatTracker.stats-916"><span class="linenos">916</span></a><span class="sd">        (12345, &#39;12.1 KB&#39;)</span>
</span><span id="ZakatTracker.stats-917"><a href="#ZakatTracker.stats-917"><span class="linenos">917</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.stats-918"><a href="#ZakatTracker.stats-918"><span class="linenos">918</span></a>        <span class="n">ram_size</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="k">if</span> <span class="n">ignore_ram</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dict_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vault</span><span class="p">())</span>
</span><span id="ZakatTracker.stats-919"><a href="#ZakatTracker.stats-919"><span class="linenos">919</span></a>        <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>
</span><span id="ZakatTracker.stats-920"><a href="#ZakatTracker.stats-920"><span class="linenos">920</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ZakatTracker.stats-921"><a href="#ZakatTracker.stats-921"><span class="linenos">921</span></a>            <span class="s1">&#39;database&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">file_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="n">file_size</span><span class="p">)),</span>
</span><span id="ZakatTracker.stats-922"><a href="#ZakatTracker.stats-922"><span class="linenos">922</span></a>            <span class="s1">&#39;ram&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">ram_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="n">ram_size</span><span class="p">)),</span>
</span><span id="ZakatTracker.stats-923"><a href="#ZakatTracker.stats-923"><span class="linenos">923</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Calculates and returns statistics about the object's data storage.</p>

<p>This method determines the size of the database file on disk and the
size of the data currently held in RAM (likely within a dictionary).
Both sizes are reported in bytes and in a human-readable format
(e.g., KB, MB).</p>

<p>Parameters:</p>

<ul>
<li>ignore_ram (bool): Whether to ignore the RAM size. Default is True</li>
</ul>

<p>Returns:</p>

<ul>
<li>dict[str, tuple]: A dictionary containing the following statistics:</li>
</ul>

<pre><code>* 'database': A tuple with two elements:
    - The database file size in bytes (int).
    - The database file size in human-readable format (str).
* 'ram': A tuple with two elements:
    - The RAM usage (dictionary size) in bytes (int).
    - The RAM usage in human-readable format (str).
</code></pre>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span> <span class="o">=</span> <span class="n">my_object</span><span class="o">.</span><span class="n">stats</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">])</span>
<span class="go">(256000, &#39;250.0 KB&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ram&#39;</span><span class="p">])</span>
<span class="go">(12345, &#39;12.1 KB&#39;)</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="ZakatTracker.files" class="classattr">
                                        <input id="ZakatTracker.files-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">files</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.files-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.files"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.files-925"><a href="#ZakatTracker.files-925"><span class="linenos">925</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="ZakatTracker.files-926"><a href="#ZakatTracker.files-926"><span class="linenos">926</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.files-927"><a href="#ZakatTracker.files-927"><span class="linenos">927</span></a><span class="sd">        Retrieves information about files associated with this class.</span>
</span><span id="ZakatTracker.files-928"><a href="#ZakatTracker.files-928"><span class="linenos">928</span></a>
</span><span id="ZakatTracker.files-929"><a href="#ZakatTracker.files-929"><span class="linenos">929</span></a><span class="sd">        This class method provides a standardized way to gather details about</span>
</span><span id="ZakatTracker.files-930"><a href="#ZakatTracker.files-930"><span class="linenos">930</span></a><span class="sd">        files used by the class for storage, snapshots, and CSV imports.</span>
</span><span id="ZakatTracker.files-931"><a href="#ZakatTracker.files-931"><span class="linenos">931</span></a>
</span><span id="ZakatTracker.files-932"><a href="#ZakatTracker.files-932"><span class="linenos">932</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.files-933"><a href="#ZakatTracker.files-933"><span class="linenos">933</span></a><span class="sd">        - list[dict[str, str | int]]: A list of dictionaries, each containing information</span>
</span><span id="ZakatTracker.files-934"><a href="#ZakatTracker.files-934"><span class="linenos">934</span></a><span class="sd">            about a specific file:</span>
</span><span id="ZakatTracker.files-935"><a href="#ZakatTracker.files-935"><span class="linenos">935</span></a>
</span><span id="ZakatTracker.files-936"><a href="#ZakatTracker.files-936"><span class="linenos">936</span></a><span class="sd">            * type (str): The type of file (&#39;database&#39;, &#39;snapshot&#39;, &#39;import_csv&#39;).</span>
</span><span id="ZakatTracker.files-937"><a href="#ZakatTracker.files-937"><span class="linenos">937</span></a><span class="sd">            * path (str): The full file path.</span>
</span><span id="ZakatTracker.files-938"><a href="#ZakatTracker.files-938"><span class="linenos">938</span></a><span class="sd">            * exists (bool): Whether the file exists on the filesystem.</span>
</span><span id="ZakatTracker.files-939"><a href="#ZakatTracker.files-939"><span class="linenos">939</span></a><span class="sd">            * size (int): The file size in bytes (0 if the file doesn&#39;t exist).</span>
</span><span id="ZakatTracker.files-940"><a href="#ZakatTracker.files-940"><span class="linenos">940</span></a><span class="sd">            * human_readable_size (str): A human-friendly representation of the file size (e.g., &#39;10 KB&#39;, &#39;2.5 MB&#39;).</span>
</span><span id="ZakatTracker.files-941"><a href="#ZakatTracker.files-941"><span class="linenos">941</span></a>
</span><span id="ZakatTracker.files-942"><a href="#ZakatTracker.files-942"><span class="linenos">942</span></a><span class="sd">        Example:</span>
</span><span id="ZakatTracker.files-943"><a href="#ZakatTracker.files-943"><span class="linenos">943</span></a><span class="sd">        ```</span>
</span><span id="ZakatTracker.files-944"><a href="#ZakatTracker.files-944"><span class="linenos">944</span></a><span class="sd">        file_info = MyClass.files()</span>
</span><span id="ZakatTracker.files-945"><a href="#ZakatTracker.files-945"><span class="linenos">945</span></a><span class="sd">        for info in file_info:</span>
</span><span id="ZakatTracker.files-946"><a href="#ZakatTracker.files-946"><span class="linenos">946</span></a><span class="sd">            print(f&quot;Type: {info[&#39;type&#39;]}, Exists: {info[&#39;exists&#39;]}, Size: {info[&#39;human_readable_size&#39;]}&quot;)</span>
</span><span id="ZakatTracker.files-947"><a href="#ZakatTracker.files-947"><span class="linenos">947</span></a><span class="sd">        ```</span>
</span><span id="ZakatTracker.files-948"><a href="#ZakatTracker.files-948"><span class="linenos">948</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.files-949"><a href="#ZakatTracker.files-949"><span class="linenos">949</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker.files-950"><a href="#ZakatTracker.files-950"><span class="linenos">950</span></a>        <span class="k">for</span> <span class="n">file_type</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">{</span>
</span><span id="ZakatTracker.files-951"><a href="#ZakatTracker.files-951"><span class="linenos">951</span></a>            <span class="s1">&#39;database&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">(),</span>
</span><span id="ZakatTracker.files-952"><a href="#ZakatTracker.files-952"><span class="linenos">952</span></a>            <span class="s1">&#39;snapshot&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_cache_path</span><span class="p">(),</span>
</span><span id="ZakatTracker.files-953"><a href="#ZakatTracker.files-953"><span class="linenos">953</span></a>            <span class="s1">&#39;import_csv&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_csv_cache_path</span><span class="p">(),</span>
</span><span id="ZakatTracker.files-954"><a href="#ZakatTracker.files-954"><span class="linenos">954</span></a>        <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker.files-955"><a href="#ZakatTracker.files-955"><span class="linenos">955</span></a>            <span class="n">exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="ZakatTracker.files-956"><a href="#ZakatTracker.files-956"><span class="linenos">956</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">exists</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="ZakatTracker.files-957"><a href="#ZakatTracker.files-957"><span class="linenos">957</span></a>            <span class="n">human_readable_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">human_readable_size</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="k">if</span> <span class="n">exists</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="ZakatTracker.files-958"><a href="#ZakatTracker.files-958"><span class="linenos">958</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="ZakatTracker.files-959"><a href="#ZakatTracker.files-959"><span class="linenos">959</span></a>                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">file_type</span><span class="p">,</span>
</span><span id="ZakatTracker.files-960"><a href="#ZakatTracker.files-960"><span class="linenos">960</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
</span><span id="ZakatTracker.files-961"><a href="#ZakatTracker.files-961"><span class="linenos">961</span></a>                <span class="s1">&#39;exists&#39;</span><span class="p">:</span> <span class="n">exists</span><span class="p">,</span>
</span><span id="ZakatTracker.files-962"><a href="#ZakatTracker.files-962"><span class="linenos">962</span></a>                <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
</span><span id="ZakatTracker.files-963"><a href="#ZakatTracker.files-963"><span class="linenos">963</span></a>                <span class="s1">&#39;human_readable_size&#39;</span><span class="p">:</span> <span class="n">human_readable_size</span><span class="p">,</span>
</span><span id="ZakatTracker.files-964"><a href="#ZakatTracker.files-964"><span class="linenos">964</span></a>            <span class="p">})</span>
</span><span id="ZakatTracker.files-965"><a href="#ZakatTracker.files-965"><span class="linenos">965</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves information about files associated with this class.</p>

<p>This class method provides a standardized way to gather details about
files used by the class for storage, snapshots, and CSV imports.</p>

<p>Returns:</p>

<ul>
<li>list[dict[str, str | int]]: A list of dictionaries, each containing information
about a specific file:</li>
</ul>

<pre><code>* type (str): The type of file ('database', 'snapshot', 'import_csv').
* path (str): The full file path.
* exists (bool): Whether the file exists on the filesystem.
* size (int): The file size in bytes (0 if the file doesn't exist).
* human_readable_size (str): A human-friendly representation of the file size (e.g., '10 KB', '2.5 MB').
</code></pre>

<p>Example:</p>

<pre><code>file_info = MyClass.files()
for info in file_info:
    print(f"Type: {info['type']}, Exists: {info['exists']}, Size: {info['human_readable_size']}")
</code></pre>
</div>


                            </div>
                            <div id="ZakatTracker.account_exists" class="classattr">
                                        <input id="ZakatTracker.account_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">account_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.account_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.account_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.account_exists-967"><a href="#ZakatTracker.account_exists-967"><span class="linenos">967</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">account_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.account_exists-968"><a href="#ZakatTracker.account_exists-968"><span class="linenos">968</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.account_exists-969"><a href="#ZakatTracker.account_exists-969"><span class="linenos">969</span></a><span class="sd">        Check if the given account exists in the vault.</span>
</span><span id="ZakatTracker.account_exists-970"><a href="#ZakatTracker.account_exists-970"><span class="linenos">970</span></a>
</span><span id="ZakatTracker.account_exists-971"><a href="#ZakatTracker.account_exists-971"><span class="linenos">971</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.account_exists-972"><a href="#ZakatTracker.account_exists-972"><span class="linenos">972</span></a><span class="sd">        - account (str): The account number to check.</span>
</span><span id="ZakatTracker.account_exists-973"><a href="#ZakatTracker.account_exists-973"><span class="linenos">973</span></a>
</span><span id="ZakatTracker.account_exists-974"><a href="#ZakatTracker.account_exists-974"><span class="linenos">974</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.account_exists-975"><a href="#ZakatTracker.account_exists-975"><span class="linenos">975</span></a><span class="sd">        - bool: True if the account exists, False otherwise.</span>
</span><span id="ZakatTracker.account_exists-976"><a href="#ZakatTracker.account_exists-976"><span class="linenos">976</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.account_exists-977"><a href="#ZakatTracker.account_exists-977"><span class="linenos">977</span></a>        <span class="k">return</span> <span class="n">account</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Check if the given account exists in the vault.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number to check.</li>
</ul>

<p>Returns:</p>

<ul>
<li>bool: True if the account exists, False otherwise.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.box_size" class="classattr">
                                        <input id="ZakatTracker.box_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">box_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.box_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.box_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.box_size-979"><a href="#ZakatTracker.box_size-979"><span class="linenos">979</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">box_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker.box_size-980"><a href="#ZakatTracker.box_size-980"><span class="linenos">980</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.box_size-981"><a href="#ZakatTracker.box_size-981"><span class="linenos">981</span></a><span class="sd">        Calculate the size of the box for a specific account.</span>
</span><span id="ZakatTracker.box_size-982"><a href="#ZakatTracker.box_size-982"><span class="linenos">982</span></a>
</span><span id="ZakatTracker.box_size-983"><a href="#ZakatTracker.box_size-983"><span class="linenos">983</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.box_size-984"><a href="#ZakatTracker.box_size-984"><span class="linenos">984</span></a><span class="sd">        - account (str): The account number for which the box size needs to be calculated.</span>
</span><span id="ZakatTracker.box_size-985"><a href="#ZakatTracker.box_size-985"><span class="linenos">985</span></a>
</span><span id="ZakatTracker.box_size-986"><a href="#ZakatTracker.box_size-986"><span class="linenos">986</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.box_size-987"><a href="#ZakatTracker.box_size-987"><span class="linenos">987</span></a><span class="sd">        - int: The size of the box for the given account. If the account does not exist, -1 is returned.</span>
</span><span id="ZakatTracker.box_size-988"><a href="#ZakatTracker.box_size-988"><span class="linenos">988</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.box_size-989"><a href="#ZakatTracker.box_size-989"><span class="linenos">989</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker.box_size-990"><a href="#ZakatTracker.box_size-990"><span class="linenos">990</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.box_size-991"><a href="#ZakatTracker.box_size-991"><span class="linenos">991</span></a>        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the size of the box for a specific account.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number for which the box size needs to be calculated.</li>
</ul>

<p>Returns:</p>

<ul>
<li>int: The size of the box for the given account. If the account does not exist, -1 is returned.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.log_size" class="classattr">
                                        <input id="ZakatTracker.log_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">log_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.log_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.log_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.log_size-993"><a href="#ZakatTracker.log_size-993"><span class="linenos"> 993</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">log_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker.log_size-994"><a href="#ZakatTracker.log_size-994"><span class="linenos"> 994</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.log_size-995"><a href="#ZakatTracker.log_size-995"><span class="linenos"> 995</span></a><span class="sd">        Get the size of the log for a specific account.</span>
</span><span id="ZakatTracker.log_size-996"><a href="#ZakatTracker.log_size-996"><span class="linenos"> 996</span></a>
</span><span id="ZakatTracker.log_size-997"><a href="#ZakatTracker.log_size-997"><span class="linenos"> 997</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.log_size-998"><a href="#ZakatTracker.log_size-998"><span class="linenos"> 998</span></a><span class="sd">        - account (str): The account number for which the log size needs to be calculated.</span>
</span><span id="ZakatTracker.log_size-999"><a href="#ZakatTracker.log_size-999"><span class="linenos"> 999</span></a>
</span><span id="ZakatTracker.log_size-1000"><a href="#ZakatTracker.log_size-1000"><span class="linenos">1000</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.log_size-1001"><a href="#ZakatTracker.log_size-1001"><span class="linenos">1001</span></a><span class="sd">        - int: The size of the log for the given account. If the account does not exist, -1 is returned.</span>
</span><span id="ZakatTracker.log_size-1002"><a href="#ZakatTracker.log_size-1002"><span class="linenos">1002</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.log_size-1003"><a href="#ZakatTracker.log_size-1003"><span class="linenos">1003</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker.log_size-1004"><a href="#ZakatTracker.log_size-1004"><span class="linenos">1004</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.log_size-1005"><a href="#ZakatTracker.log_size-1005"><span class="linenos">1005</span></a>        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Get the size of the log for a specific account.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number for which the log size needs to be calculated.</li>
</ul>

<p>Returns:</p>

<ul>
<li>int: The size of the log for the given account. If the account does not exist, -1 is returned.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.file_hash" class="classattr">
                                        <input id="ZakatTracker.file_hash-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">file_hash</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;blake2b&#39;</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.file_hash-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.file_hash"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.file_hash-1007"><a href="#ZakatTracker.file_hash-1007"><span class="linenos">1007</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.file_hash-1008"><a href="#ZakatTracker.file_hash-1008"><span class="linenos">1008</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">file_hash</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;blake2b&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZakatTracker.file_hash-1009"><a href="#ZakatTracker.file_hash-1009"><span class="linenos">1009</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.file_hash-1010"><a href="#ZakatTracker.file_hash-1010"><span class="linenos">1010</span></a><span class="sd">        Calculates the hash of a file using the specified algorithm.</span>
</span><span id="ZakatTracker.file_hash-1011"><a href="#ZakatTracker.file_hash-1011"><span class="linenos">1011</span></a>
</span><span id="ZakatTracker.file_hash-1012"><a href="#ZakatTracker.file_hash-1012"><span class="linenos">1012</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.file_hash-1013"><a href="#ZakatTracker.file_hash-1013"><span class="linenos">1013</span></a><span class="sd">        - file_path (str): The path to the file.</span>
</span><span id="ZakatTracker.file_hash-1014"><a href="#ZakatTracker.file_hash-1014"><span class="linenos">1014</span></a><span class="sd">        - algorithm (str, optional): The hashing algorithm to use. Defaults to &quot;blake2b&quot;.</span>
</span><span id="ZakatTracker.file_hash-1015"><a href="#ZakatTracker.file_hash-1015"><span class="linenos">1015</span></a>
</span><span id="ZakatTracker.file_hash-1016"><a href="#ZakatTracker.file_hash-1016"><span class="linenos">1016</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.file_hash-1017"><a href="#ZakatTracker.file_hash-1017"><span class="linenos">1017</span></a><span class="sd">        - str: The hexadecimal representation of the file&#39;s hash.</span>
</span><span id="ZakatTracker.file_hash-1018"><a href="#ZakatTracker.file_hash-1018"><span class="linenos">1018</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.file_hash-1019"><a href="#ZakatTracker.file_hash-1019"><span class="linenos">1019</span></a>        <span class="n">hash_obj</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">algorithm</span><span class="p">)</span>  <span class="c1"># Create the hash object</span>
</span><span id="ZakatTracker.file_hash-1020"><a href="#ZakatTracker.file_hash-1020"><span class="linenos">1020</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># Open file in binary mode for reading</span>
</span><span id="ZakatTracker.file_hash-1021"><a href="#ZakatTracker.file_hash-1021"><span class="linenos">1021</span></a>            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4096</span><span class="p">),</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>  <span class="c1"># Read file in chunks</span>
</span><span id="ZakatTracker.file_hash-1022"><a href="#ZakatTracker.file_hash-1022"><span class="linenos">1022</span></a>                <span class="n">hash_obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="ZakatTracker.file_hash-1023"><a href="#ZakatTracker.file_hash-1023"><span class="linenos">1023</span></a>        <span class="k">return</span> <span class="n">hash_obj</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>  <span class="c1"># Return the hash as a hexadecimal string</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the hash of a file using the specified algorithm.</p>

<p>Parameters:</p>

<ul>
<li>file_path (str): The path to the file.</li>
<li>algorithm (str, optional): The hashing algorithm to use. Defaults to "blake2b".</li>
</ul>

<p>Returns:</p>

<ul>
<li>str: The hexadecimal representation of the file's hash.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.snapshot_cache_path" class="classattr">
                                        <input id="ZakatTracker.snapshot_cache_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">snapshot_cache_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ZakatTracker.snapshot_cache_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.snapshot_cache_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.snapshot_cache_path-1025"><a href="#ZakatTracker.snapshot_cache_path-1025"><span class="linenos">1025</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">snapshot_cache_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ZakatTracker.snapshot_cache_path-1026"><a href="#ZakatTracker.snapshot_cache_path-1026"><span class="linenos">1026</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.snapshot_cache_path-1027"><a href="#ZakatTracker.snapshot_cache_path-1027"><span class="linenos">1027</span></a><span class="sd">        Generate the path for the cache file used to store snapshots.</span>
</span><span id="ZakatTracker.snapshot_cache_path-1028"><a href="#ZakatTracker.snapshot_cache_path-1028"><span class="linenos">1028</span></a>
</span><span id="ZakatTracker.snapshot_cache_path-1029"><a href="#ZakatTracker.snapshot_cache_path-1029"><span class="linenos">1029</span></a><span class="sd">        The cache file is a camel file that stores the timestamps of the snapshots.</span>
</span><span id="ZakatTracker.snapshot_cache_path-1030"><a href="#ZakatTracker.snapshot_cache_path-1030"><span class="linenos">1030</span></a><span class="sd">        The file name is derived from the main database file name by replacing the &quot;.camel&quot; extension with &quot;.snapshots.camel&quot;.</span>
</span><span id="ZakatTracker.snapshot_cache_path-1031"><a href="#ZakatTracker.snapshot_cache_path-1031"><span class="linenos">1031</span></a>
</span><span id="ZakatTracker.snapshot_cache_path-1032"><a href="#ZakatTracker.snapshot_cache_path-1032"><span class="linenos">1032</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.snapshot_cache_path-1033"><a href="#ZakatTracker.snapshot_cache_path-1033"><span class="linenos">1033</span></a><span class="sd">        - str: The path to the cache file.</span>
</span><span id="ZakatTracker.snapshot_cache_path-1034"><a href="#ZakatTracker.snapshot_cache_path-1034"><span class="linenos">1034</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.snapshot_cache_path-1035"><a href="#ZakatTracker.snapshot_cache_path-1035"><span class="linenos">1035</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>
</span><span id="ZakatTracker.snapshot_cache_path-1036"><a href="#ZakatTracker.snapshot_cache_path-1036"><span class="linenos">1036</span></a>        <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span>
</span><span id="ZakatTracker.snapshot_cache_path-1037"><a href="#ZakatTracker.snapshot_cache_path-1037"><span class="linenos">1037</span></a>        <span class="n">ext_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
</span><span id="ZakatTracker.snapshot_cache_path-1038"><a href="#ZakatTracker.snapshot_cache_path-1038"><span class="linenos">1038</span></a>        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
</span><span id="ZakatTracker.snapshot_cache_path-1039"><a href="#ZakatTracker.snapshot_cache_path-1039"><span class="linenos">1039</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="n">ext_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker.snapshot_cache_path-1040"><a href="#ZakatTracker.snapshot_cache_path-1040"><span class="linenos">1040</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;.snapshots.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.snapshot_cache_path-1041"><a href="#ZakatTracker.snapshot_cache_path-1041"><span class="linenos">1041</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate the path for the cache file used to store snapshots.</p>

<p>The cache file is a camel file that stores the timestamps of the snapshots.
The file name is derived from the main database file name by replacing the ".camel" extension with ".snapshots.camel".</p>

<p>Returns:</p>

<ul>
<li>str: The path to the cache file.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.snapshot" class="classattr">
                                        <input id="ZakatTracker.snapshot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">snapshot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.snapshot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.snapshot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.snapshot-1043"><a href="#ZakatTracker.snapshot-1043"><span class="linenos">1043</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">snapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.snapshot-1044"><a href="#ZakatTracker.snapshot-1044"><span class="linenos">1044</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.snapshot-1045"><a href="#ZakatTracker.snapshot-1045"><span class="linenos">1045</span></a><span class="sd">        This function creates a snapshot of the current database state.</span>
</span><span id="ZakatTracker.snapshot-1046"><a href="#ZakatTracker.snapshot-1046"><span class="linenos">1046</span></a>
</span><span id="ZakatTracker.snapshot-1047"><a href="#ZakatTracker.snapshot-1047"><span class="linenos">1047</span></a><span class="sd">        The function calculates the hash of the current database file and checks if a snapshot with the same hash already exists.</span>
</span><span id="ZakatTracker.snapshot-1048"><a href="#ZakatTracker.snapshot-1048"><span class="linenos">1048</span></a><span class="sd">        If a snapshot with the same hash exists, the function returns True without creating a new snapshot.</span>
</span><span id="ZakatTracker.snapshot-1049"><a href="#ZakatTracker.snapshot-1049"><span class="linenos">1049</span></a><span class="sd">        If a snapshot with the same hash does not exist, the function creates a new snapshot by saving the current database state</span>
</span><span id="ZakatTracker.snapshot-1050"><a href="#ZakatTracker.snapshot-1050"><span class="linenos">1050</span></a><span class="sd">        in a new camel file with a unique timestamp as the file name. The function also updates the snapshot cache file with the new snapshot&#39;s hash and timestamp.</span>
</span><span id="ZakatTracker.snapshot-1051"><a href="#ZakatTracker.snapshot-1051"><span class="linenos">1051</span></a>
</span><span id="ZakatTracker.snapshot-1052"><a href="#ZakatTracker.snapshot-1052"><span class="linenos">1052</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.snapshot-1053"><a href="#ZakatTracker.snapshot-1053"><span class="linenos">1053</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker.snapshot-1054"><a href="#ZakatTracker.snapshot-1054"><span class="linenos">1054</span></a>
</span><span id="ZakatTracker.snapshot-1055"><a href="#ZakatTracker.snapshot-1055"><span class="linenos">1055</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.snapshot-1056"><a href="#ZakatTracker.snapshot-1056"><span class="linenos">1056</span></a><span class="sd">        - bool: True if a snapshot with the same hash already exists or if the snapshot is successfully created. False if the snapshot creation fails.</span>
</span><span id="ZakatTracker.snapshot-1057"><a href="#ZakatTracker.snapshot-1057"><span class="linenos">1057</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.snapshot-1058"><a href="#ZakatTracker.snapshot-1058"><span class="linenos">1058</span></a>        <span class="n">current_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>
</span><span id="ZakatTracker.snapshot-1059"><a href="#ZakatTracker.snapshot-1059"><span class="linenos">1059</span></a>        <span class="n">cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># hash: time_ns</span>
</span><span id="ZakatTracker.snapshot-1060"><a href="#ZakatTracker.snapshot-1060"><span class="linenos">1060</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker.snapshot-1061"><a href="#ZakatTracker.snapshot-1061"><span class="linenos">1061</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapshot_cache_path</span><span class="p">(),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker.snapshot-1062"><a href="#ZakatTracker.snapshot-1062"><span class="linenos">1062</span></a>                <span class="n">cache</span> <span class="o">=</span> <span class="n">camel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="ZakatTracker.snapshot-1063"><a href="#ZakatTracker.snapshot-1063"><span class="linenos">1063</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="ZakatTracker.snapshot-1064"><a href="#ZakatTracker.snapshot-1064"><span class="linenos">1064</span></a>            <span class="k">pass</span>
</span><span id="ZakatTracker.snapshot-1065"><a href="#ZakatTracker.snapshot-1065"><span class="linenos">1065</span></a>        <span class="k">if</span> <span class="n">current_hash</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
</span><span id="ZakatTracker.snapshot-1066"><a href="#ZakatTracker.snapshot-1066"><span class="linenos">1066</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker.snapshot-1067"><a href="#ZakatTracker.snapshot-1067"><span class="linenos">1067</span></a>        <span class="n">ref</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="ZakatTracker.snapshot-1068"><a href="#ZakatTracker.snapshot-1068"><span class="linenos">1068</span></a>        <span class="n">cache</span><span class="p">[</span><span class="n">current_hash</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span>
</span><span id="ZakatTracker.snapshot-1069"><a href="#ZakatTracker.snapshot-1069"><span class="linenos">1069</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">(</span><span class="s1">&#39;snapshots&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ref</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)):</span>
</span><span id="ZakatTracker.snapshot-1070"><a href="#ZakatTracker.snapshot-1070"><span class="linenos">1070</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker.snapshot-1071"><a href="#ZakatTracker.snapshot-1071"><span class="linenos">1071</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapshot_cache_path</span><span class="p">(),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker.snapshot-1072"><a href="#ZakatTracker.snapshot-1072"><span class="linenos">1072</span></a>            <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">camel</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cache</span><span class="p">))</span>
</span><span id="ZakatTracker.snapshot-1073"><a href="#ZakatTracker.snapshot-1073"><span class="linenos">1073</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>This function creates a snapshot of the current database state.</p>

<p>The function calculates the hash of the current database file and checks if a snapshot with the same hash already exists.
If a snapshot with the same hash exists, the function returns True without creating a new snapshot.
If a snapshot with the same hash does not exist, the function creates a new snapshot by saving the current database state
in a new camel file with a unique timestamp as the file name. The function also updates the snapshot cache file with the new snapshot's hash and timestamp.</p>

<p>Parameters:
None</p>

<p>Returns:</p>

<ul>
<li>bool: True if a snapshot with the same hash already exists or if the snapshot is successfully created. False if the snapshot creation fails.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.snapshots" class="classattr">
                                        <input id="ZakatTracker.snapshots-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">snapshots</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">hide_missing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">verified_hash_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.snapshots-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.snapshots"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.snapshots-1075"><a href="#ZakatTracker.snapshots-1075"><span class="linenos">1075</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">snapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hide_missing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verified_hash_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> \
</span><span id="ZakatTracker.snapshots-1076"><a href="#ZakatTracker.snapshots-1076"><span class="linenos">1076</span></a>            <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]:</span>
</span><span id="ZakatTracker.snapshots-1077"><a href="#ZakatTracker.snapshots-1077"><span class="linenos">1077</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.snapshots-1078"><a href="#ZakatTracker.snapshots-1078"><span class="linenos">1078</span></a><span class="sd">        Retrieve a dictionary of snapshots, with their respective hashes, paths, and existence status.</span>
</span><span id="ZakatTracker.snapshots-1079"><a href="#ZakatTracker.snapshots-1079"><span class="linenos">1079</span></a>
</span><span id="ZakatTracker.snapshots-1080"><a href="#ZakatTracker.snapshots-1080"><span class="linenos">1080</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.snapshots-1081"><a href="#ZakatTracker.snapshots-1081"><span class="linenos">1081</span></a><span class="sd">        - hide_missing (bool): If True, only include snapshots that exist in the dictionary. Default is True.</span>
</span><span id="ZakatTracker.snapshots-1082"><a href="#ZakatTracker.snapshots-1082"><span class="linenos">1082</span></a><span class="sd">        - verified_hash_only (bool): If True, only include snapshots with a valid hash. Default is False.</span>
</span><span id="ZakatTracker.snapshots-1083"><a href="#ZakatTracker.snapshots-1083"><span class="linenos">1083</span></a>
</span><span id="ZakatTracker.snapshots-1084"><a href="#ZakatTracker.snapshots-1084"><span class="linenos">1084</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.snapshots-1085"><a href="#ZakatTracker.snapshots-1085"><span class="linenos">1085</span></a><span class="sd">        - dict[int, tuple[str, str, bool]]: A dictionary where the keys are the timestamps of the snapshots,</span>
</span><span id="ZakatTracker.snapshots-1086"><a href="#ZakatTracker.snapshots-1086"><span class="linenos">1086</span></a><span class="sd">        and the values are tuples containing the snapshot&#39;s hash, path, and existence status.</span>
</span><span id="ZakatTracker.snapshots-1087"><a href="#ZakatTracker.snapshots-1087"><span class="linenos">1087</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.snapshots-1088"><a href="#ZakatTracker.snapshots-1088"><span class="linenos">1088</span></a>        <span class="n">cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># hash: time_ns</span>
</span><span id="ZakatTracker.snapshots-1089"><a href="#ZakatTracker.snapshots-1089"><span class="linenos">1089</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker.snapshots-1090"><a href="#ZakatTracker.snapshots-1090"><span class="linenos">1090</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapshot_cache_path</span><span class="p">(),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker.snapshots-1091"><a href="#ZakatTracker.snapshots-1091"><span class="linenos">1091</span></a>                <span class="n">cache</span> <span class="o">=</span> <span class="n">camel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="ZakatTracker.snapshots-1092"><a href="#ZakatTracker.snapshots-1092"><span class="linenos">1092</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="ZakatTracker.snapshots-1093"><a href="#ZakatTracker.snapshots-1093"><span class="linenos">1093</span></a>            <span class="k">pass</span>
</span><span id="ZakatTracker.snapshots-1094"><a href="#ZakatTracker.snapshots-1094"><span class="linenos">1094</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cache</span><span class="p">:</span>
</span><span id="ZakatTracker.snapshots-1095"><a href="#ZakatTracker.snapshots-1095"><span class="linenos">1095</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="ZakatTracker.snapshots-1096"><a href="#ZakatTracker.snapshots-1096"><span class="linenos">1096</span></a>        <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># time_ns: (hash, path, exists)</span>
</span><span id="ZakatTracker.snapshots-1097"><a href="#ZakatTracker.snapshots-1097"><span class="linenos">1097</span></a>        <span class="k">for</span> <span class="n">file_hash</span><span class="p">,</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">cache</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker.snapshots-1098"><a href="#ZakatTracker.snapshots-1098"><span class="linenos">1098</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">(</span><span class="s1">&#39;snapshots&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ref</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.snapshots-1099"><a href="#ZakatTracker.snapshots-1099"><span class="linenos">1099</span></a>            <span class="n">exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="ZakatTracker.snapshots-1100"><a href="#ZakatTracker.snapshots-1100"><span class="linenos">1100</span></a>            <span class="n">valid_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_hash</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="n">file_hash</span> <span class="k">if</span> <span class="n">verified_hash_only</span> <span class="k">else</span> <span class="kc">True</span>
</span><span id="ZakatTracker.snapshots-1101"><a href="#ZakatTracker.snapshots-1101"><span class="linenos">1101</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">verified_hash_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">valid_hash</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">verified_hash_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">):</span>
</span><span id="ZakatTracker.snapshots-1102"><a href="#ZakatTracker.snapshots-1102"><span class="linenos">1102</span></a>                <span class="k">continue</span>
</span><span id="ZakatTracker.snapshots-1103"><a href="#ZakatTracker.snapshots-1103"><span class="linenos">1103</span></a>            <span class="k">if</span> <span class="n">exists</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">hide_missing</span><span class="p">:</span>
</span><span id="ZakatTracker.snapshots-1104"><a href="#ZakatTracker.snapshots-1104"><span class="linenos">1104</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_hash</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">exists</span><span class="p">)</span>
</span><span id="ZakatTracker.snapshots-1105"><a href="#ZakatTracker.snapshots-1105"><span class="linenos">1105</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve a dictionary of snapshots, with their respective hashes, paths, and existence status.</p>

<p>Parameters:</p>

<ul>
<li>hide_missing (bool): If True, only include snapshots that exist in the dictionary. Default is True.</li>
<li>verified_hash_only (bool): If True, only include snapshots with a valid hash. Default is False.</li>
</ul>

<p>Returns:</p>

<ul>
<li>dict[int, tuple[str, str, bool]]: A dictionary where the keys are the timestamps of the snapshots,
and the values are tuples containing the snapshot's hash, path, and existence status.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.ref_exists" class="classattr">
                                        <input id="ZakatTracker.ref_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ref_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">ref_type</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">ref</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.ref_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.ref_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.ref_exists-1107"><a href="#ZakatTracker.ref_exists-1107"><span class="linenos">1107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ref_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.ref_exists-1108"><a href="#ZakatTracker.ref_exists-1108"><span class="linenos">1108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.ref_exists-1109"><a href="#ZakatTracker.ref_exists-1109"><span class="linenos">1109</span></a><span class="sd">        Check if a specific reference (transaction) exists in the vault for a given account and reference type.</span>
</span><span id="ZakatTracker.ref_exists-1110"><a href="#ZakatTracker.ref_exists-1110"><span class="linenos">1110</span></a>
</span><span id="ZakatTracker.ref_exists-1111"><a href="#ZakatTracker.ref_exists-1111"><span class="linenos">1111</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.ref_exists-1112"><a href="#ZakatTracker.ref_exists-1112"><span class="linenos">1112</span></a><span class="sd">        - account (str): The account number for which to check the existence of the reference.</span>
</span><span id="ZakatTracker.ref_exists-1113"><a href="#ZakatTracker.ref_exists-1113"><span class="linenos">1113</span></a><span class="sd">        - ref_type (str): The type of reference (e.g., &#39;box&#39;, &#39;log&#39;, etc.).</span>
</span><span id="ZakatTracker.ref_exists-1114"><a href="#ZakatTracker.ref_exists-1114"><span class="linenos">1114</span></a><span class="sd">        - ref (int): The reference (transaction) number to check for existence.</span>
</span><span id="ZakatTracker.ref_exists-1115"><a href="#ZakatTracker.ref_exists-1115"><span class="linenos">1115</span></a>
</span><span id="ZakatTracker.ref_exists-1116"><a href="#ZakatTracker.ref_exists-1116"><span class="linenos">1116</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.ref_exists-1117"><a href="#ZakatTracker.ref_exists-1117"><span class="linenos">1117</span></a><span class="sd">        - bool: True if the reference exists for the given account and reference type, False otherwise.</span>
</span><span id="ZakatTracker.ref_exists-1118"><a href="#ZakatTracker.ref_exists-1118"><span class="linenos">1118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.ref_exists-1119"><a href="#ZakatTracker.ref_exists-1119"><span class="linenos">1119</span></a>        <span class="k">if</span> <span class="n">account</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.ref_exists-1120"><a href="#ZakatTracker.ref_exists-1120"><span class="linenos">1120</span></a>            <span class="k">return</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="n">ref_type</span><span class="p">]</span>
</span><span id="ZakatTracker.ref_exists-1121"><a href="#ZakatTracker.ref_exists-1121"><span class="linenos">1121</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Check if a specific reference (transaction) exists in the vault for a given account and reference type.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number for which to check the existence of the reference.</li>
<li>ref_type (str): The type of reference (e.g., 'box', 'log', etc.).</li>
<li>ref (int): The reference (transaction) number to check for existence.</li>
</ul>

<p>Returns:</p>

<ul>
<li>bool: True if the reference exists for the given account and reference type, False otherwise.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.box_exists" class="classattr">
                                        <input id="ZakatTracker.box_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">box_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">ref</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.box_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.box_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.box_exists-1123"><a href="#ZakatTracker.box_exists-1123"><span class="linenos">1123</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">box_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.box_exists-1124"><a href="#ZakatTracker.box_exists-1124"><span class="linenos">1124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.box_exists-1125"><a href="#ZakatTracker.box_exists-1125"><span class="linenos">1125</span></a><span class="sd">        Check if a specific box (transaction) exists in the vault for a given account and reference.</span>
</span><span id="ZakatTracker.box_exists-1126"><a href="#ZakatTracker.box_exists-1126"><span class="linenos">1126</span></a>
</span><span id="ZakatTracker.box_exists-1127"><a href="#ZakatTracker.box_exists-1127"><span class="linenos">1127</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.box_exists-1128"><a href="#ZakatTracker.box_exists-1128"><span class="linenos">1128</span></a><span class="sd">        - account (str): The account number for which to check the existence of the box.</span>
</span><span id="ZakatTracker.box_exists-1129"><a href="#ZakatTracker.box_exists-1129"><span class="linenos">1129</span></a><span class="sd">        - ref (int): The reference (transaction) number to check for existence.</span>
</span><span id="ZakatTracker.box_exists-1130"><a href="#ZakatTracker.box_exists-1130"><span class="linenos">1130</span></a>
</span><span id="ZakatTracker.box_exists-1131"><a href="#ZakatTracker.box_exists-1131"><span class="linenos">1131</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.box_exists-1132"><a href="#ZakatTracker.box_exists-1132"><span class="linenos">1132</span></a><span class="sd">        - bool: True if the box exists for the given account and reference, False otherwise.</span>
</span><span id="ZakatTracker.box_exists-1133"><a href="#ZakatTracker.box_exists-1133"><span class="linenos">1133</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.box_exists-1134"><a href="#ZakatTracker.box_exists-1134"><span class="linenos">1134</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_exists</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Check if a specific box (transaction) exists in the vault for a given account and reference.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number for which to check the existence of the box.</li>
<li>ref (int): The reference (transaction) number to check for existence.</li>
</ul>

<p>Returns:</p>

<ul>
<li>bool: True if the box exists for the given account and reference, False otherwise.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.track" class="classattr">
                                        <input id="ZakatTracker.track-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">track</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">unscaled_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">account</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">created</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.track-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.track"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.track-1136"><a href="#ZakatTracker.track-1136"><span class="linenos">1136</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unscaled_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ZakatTracker.track-1137"><a href="#ZakatTracker.track-1137"><span class="linenos">1137</span></a>              <span class="n">created</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker.track-1138"><a href="#ZakatTracker.track-1138"><span class="linenos">1138</span></a>              <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker.track-1139"><a href="#ZakatTracker.track-1139"><span class="linenos">1139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.track-1140"><a href="#ZakatTracker.track-1140"><span class="linenos">1140</span></a><span class="sd">        This function tracks a transaction for a specific account, so it do creates a new account if it doesn&#39;t exist, logs the transaction if logging is True, and updates the account&#39;s balance and box.</span>
</span><span id="ZakatTracker.track-1141"><a href="#ZakatTracker.track-1141"><span class="linenos">1141</span></a>
</span><span id="ZakatTracker.track-1142"><a href="#ZakatTracker.track-1142"><span class="linenos">1142</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.track-1143"><a href="#ZakatTracker.track-1143"><span class="linenos">1143</span></a><span class="sd">        - unscaled_value (float | int | decimal.Decimal): The value of the transaction. Default is 0.</span>
</span><span id="ZakatTracker.track-1144"><a href="#ZakatTracker.track-1144"><span class="linenos">1144</span></a><span class="sd">        - desc (str): The description of the transaction. Default is an empty string.</span>
</span><span id="ZakatTracker.track-1145"><a href="#ZakatTracker.track-1145"><span class="linenos">1145</span></a><span class="sd">        - account (str): The account for which the transaction is being tracked. Default is &#39;1&#39;.</span>
</span><span id="ZakatTracker.track-1146"><a href="#ZakatTracker.track-1146"><span class="linenos">1146</span></a><span class="sd">        - logging (bool): Whether to log the transaction. Default is True.</span>
</span><span id="ZakatTracker.track-1147"><a href="#ZakatTracker.track-1147"><span class="linenos">1147</span></a><span class="sd">        - created (int): The timestamp of the transaction. If not provided, it will be generated. Default is None.</span>
</span><span id="ZakatTracker.track-1148"><a href="#ZakatTracker.track-1148"><span class="linenos">1148</span></a><span class="sd">        - debug (bool): Whether to print debug information. Default is False.</span>
</span><span id="ZakatTracker.track-1149"><a href="#ZakatTracker.track-1149"><span class="linenos">1149</span></a>
</span><span id="ZakatTracker.track-1150"><a href="#ZakatTracker.track-1150"><span class="linenos">1150</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.track-1151"><a href="#ZakatTracker.track-1151"><span class="linenos">1151</span></a><span class="sd">        - int: The timestamp of the transaction.</span>
</span><span id="ZakatTracker.track-1152"><a href="#ZakatTracker.track-1152"><span class="linenos">1152</span></a>
</span><span id="ZakatTracker.track-1153"><a href="#ZakatTracker.track-1153"><span class="linenos">1153</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker.track-1154"><a href="#ZakatTracker.track-1154"><span class="linenos">1154</span></a><span class="sd">        - ValueError: The created should be greater than zero.</span>
</span><span id="ZakatTracker.track-1155"><a href="#ZakatTracker.track-1155"><span class="linenos">1155</span></a><span class="sd">        - ValueError: The log transaction happened again in the same nanosecond time.</span>
</span><span id="ZakatTracker.track-1156"><a href="#ZakatTracker.track-1156"><span class="linenos">1156</span></a><span class="sd">        - ValueError: The box transaction happened again in the same nanosecond time.</span>
</span><span id="ZakatTracker.track-1157"><a href="#ZakatTracker.track-1157"><span class="linenos">1157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.track-1158"><a href="#ZakatTracker.track-1158"><span class="linenos">1158</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.track-1159"><a href="#ZakatTracker.track-1159"><span class="linenos">1159</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;track&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;unscaled_value=</span><span class="si">{</span><span class="n">unscaled_value</span><span class="si">}</span><span class="s1">, debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.track-1160"><a href="#ZakatTracker.track-1160"><span class="linenos">1160</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.track-1161"><a href="#ZakatTracker.track-1161"><span class="linenos">1161</span></a>            <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker.track-1162"><a href="#ZakatTracker.track-1162"><span class="linenos">1162</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.track-1163"><a href="#ZakatTracker.track-1163"><span class="linenos">1163</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The created should be greater than zero.&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.track-1164"><a href="#ZakatTracker.track-1164"><span class="linenos">1164</span></a>        <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.track-1165"><a href="#ZakatTracker.track-1165"><span class="linenos">1165</span></a>        <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker.track-1166"><a href="#ZakatTracker.track-1166"><span class="linenos">1166</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker.track-1167"><a href="#ZakatTracker.track-1167"><span class="linenos">1167</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.track-1168"><a href="#ZakatTracker.track-1168"><span class="linenos">1168</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;account </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s2"> created&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.track-1169"><a href="#ZakatTracker.track-1169"><span class="linenos">1169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker.track-1170"><a href="#ZakatTracker.track-1170"><span class="linenos">1170</span></a>                <span class="s1">&#39;balance&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.track-1171"><a href="#ZakatTracker.track-1171"><span class="linenos">1171</span></a>                <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker.track-1172"><a href="#ZakatTracker.track-1172"><span class="linenos">1172</span></a>                <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.track-1173"><a href="#ZakatTracker.track-1173"><span class="linenos">1173</span></a>                <span class="s1">&#39;log&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker.track-1174"><a href="#ZakatTracker.track-1174"><span class="linenos">1174</span></a>                <span class="s1">&#39;hide&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ZakatTracker.track-1175"><a href="#ZakatTracker.track-1175"><span class="linenos">1175</span></a>                <span class="s1">&#39;zakatable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ZakatTracker.track-1176"><a href="#ZakatTracker.track-1176"><span class="linenos">1176</span></a>                <span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="n">created</span><span class="p">,</span>
</span><span id="ZakatTracker.track-1177"><a href="#ZakatTracker.track-1177"><span class="linenos">1177</span></a>            <span class="p">}</span>
</span><span id="ZakatTracker.track-1178"><a href="#ZakatTracker.track-1178"><span class="linenos">1178</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">CREATE</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</span><span id="ZakatTracker.track-1179"><a href="#ZakatTracker.track-1179"><span class="linenos">1179</span></a>        <span class="k">if</span> <span class="n">unscaled_value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.track-1180"><a href="#ZakatTracker.track-1180"><span class="linenos">1180</span></a>            <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker.track-1181"><a href="#ZakatTracker.track-1181"><span class="linenos">1181</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker.track-1182"><a href="#ZakatTracker.track-1182"><span class="linenos">1182</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="ZakatTracker.track-1183"><a href="#ZakatTracker.track-1183"><span class="linenos">1183</span></a>        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">unscaled_value</span><span class="p">)</span>
</span><span id="ZakatTracker.track-1184"><a href="#ZakatTracker.track-1184"><span class="linenos">1184</span></a>        <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
</span><span id="ZakatTracker.track-1185"><a href="#ZakatTracker.track-1185"><span class="linenos">1185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">created</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.track-1186"><a href="#ZakatTracker.track-1186"><span class="linenos">1186</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.track-1187"><a href="#ZakatTracker.track-1187"><span class="linenos">1187</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;create-box&#39;</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker.track-1188"><a href="#ZakatTracker.track-1188"><span class="linenos">1188</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_exists</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="p">):</span>
</span><span id="ZakatTracker.track-1189"><a href="#ZakatTracker.track-1189"><span class="linenos">1189</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The box transaction happened again in the same nanosecond time(</span><span class="si">{</span><span class="n">created</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.track-1190"><a href="#ZakatTracker.track-1190"><span class="linenos">1190</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.track-1191"><a href="#ZakatTracker.track-1191"><span class="linenos">1191</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;created-box&#39;</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker.track-1192"><a href="#ZakatTracker.track-1192"><span class="linenos">1192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">created</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker.track-1193"><a href="#ZakatTracker.track-1193"><span class="linenos">1193</span></a>            <span class="s1">&#39;capital&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
</span><span id="ZakatTracker.track-1194"><a href="#ZakatTracker.track-1194"><span class="linenos">1194</span></a>            <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.track-1195"><a href="#ZakatTracker.track-1195"><span class="linenos">1195</span></a>            <span class="s1">&#39;last&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.track-1196"><a href="#ZakatTracker.track-1196"><span class="linenos">1196</span></a>            <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
</span><span id="ZakatTracker.track-1197"><a href="#ZakatTracker.track-1197"><span class="linenos">1197</span></a>            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.track-1198"><a href="#ZakatTracker.track-1198"><span class="linenos">1198</span></a>        <span class="p">}</span>
</span><span id="ZakatTracker.track-1199"><a href="#ZakatTracker.track-1199"><span class="linenos">1199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">TRACK</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">created</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
</span><span id="ZakatTracker.track-1200"><a href="#ZakatTracker.track-1200"><span class="linenos">1200</span></a>        <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker.track-1201"><a href="#ZakatTracker.track-1201"><span class="linenos">1201</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker.track-1202"><a href="#ZakatTracker.track-1202"><span class="linenos">1202</span></a>        <span class="k">return</span> <span class="n">created</span>
</span></pre></div>


            <div class="docstring"><p>This function tracks a transaction for a specific account, so it do creates a new account if it doesn't exist, logs the transaction if logging is True, and updates the account's balance and box.</p>

<p>Parameters:</p>

<ul>
<li>unscaled_value (float | int | decimal.Decimal): The value of the transaction. Default is 0.</li>
<li>desc (str): The description of the transaction. Default is an empty string.</li>
<li>account (str): The account for which the transaction is being tracked. Default is '1'.</li>
<li>logging (bool): Whether to log the transaction. Default is True.</li>
<li>created (int): The timestamp of the transaction. If not provided, it will be generated. Default is None.</li>
<li>debug (bool): Whether to print debug information. Default is False.</li>
</ul>

<p>Returns:</p>

<ul>
<li>int: The timestamp of the transaction.</li>
</ul>

<p>Raises:</p>

<ul>
<li>ValueError: The created should be greater than zero.</li>
<li>ValueError: The log transaction happened again in the same nanosecond time.</li>
<li>ValueError: The box transaction happened again in the same nanosecond time.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.log_exists" class="classattr">
                                        <input id="ZakatTracker.log_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">log_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">ref</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.log_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.log_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.log_exists-1204"><a href="#ZakatTracker.log_exists-1204"><span class="linenos">1204</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">log_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.log_exists-1205"><a href="#ZakatTracker.log_exists-1205"><span class="linenos">1205</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.log_exists-1206"><a href="#ZakatTracker.log_exists-1206"><span class="linenos">1206</span></a><span class="sd">        Checks if a specific transaction log entry exists for a given account.</span>
</span><span id="ZakatTracker.log_exists-1207"><a href="#ZakatTracker.log_exists-1207"><span class="linenos">1207</span></a>
</span><span id="ZakatTracker.log_exists-1208"><a href="#ZakatTracker.log_exists-1208"><span class="linenos">1208</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.log_exists-1209"><a href="#ZakatTracker.log_exists-1209"><span class="linenos">1209</span></a><span class="sd">        - account (str): The account number associated with the transaction log.</span>
</span><span id="ZakatTracker.log_exists-1210"><a href="#ZakatTracker.log_exists-1210"><span class="linenos">1210</span></a><span class="sd">        - ref (int): The reference to the transaction log entry.</span>
</span><span id="ZakatTracker.log_exists-1211"><a href="#ZakatTracker.log_exists-1211"><span class="linenos">1211</span></a>
</span><span id="ZakatTracker.log_exists-1212"><a href="#ZakatTracker.log_exists-1212"><span class="linenos">1212</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.log_exists-1213"><a href="#ZakatTracker.log_exists-1213"><span class="linenos">1213</span></a><span class="sd">        - bool: True if the transaction log entry exists, False otherwise.</span>
</span><span id="ZakatTracker.log_exists-1214"><a href="#ZakatTracker.log_exists-1214"><span class="linenos">1214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.log_exists-1215"><a href="#ZakatTracker.log_exists-1215"><span class="linenos">1215</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_exists</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Checks if a specific transaction log entry exists for a given account.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number associated with the transaction log.</li>
<li>ref (int): The reference to the transaction log entry.</li>
</ul>

<p>Returns:</p>

<ul>
<li>bool: True if the transaction log entry exists, False otherwise.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.exchange" class="classattr">
                                        <input id="ZakatTracker.exchange-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">exchange</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">account</span>,</span><span class="param">	<span class="n">created</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.exchange-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.exchange"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.exchange-1264"><a href="#ZakatTracker.exchange-1264"><span class="linenos">1264</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exchange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker.exchange-1265"><a href="#ZakatTracker.exchange-1265"><span class="linenos">1265</span></a>                 <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker.exchange-1266"><a href="#ZakatTracker.exchange-1266"><span class="linenos">1266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.exchange-1267"><a href="#ZakatTracker.exchange-1267"><span class="linenos">1267</span></a><span class="sd">        This method is used to record or retrieve exchange rates for a specific account.</span>
</span><span id="ZakatTracker.exchange-1268"><a href="#ZakatTracker.exchange-1268"><span class="linenos">1268</span></a>
</span><span id="ZakatTracker.exchange-1269"><a href="#ZakatTracker.exchange-1269"><span class="linenos">1269</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.exchange-1270"><a href="#ZakatTracker.exchange-1270"><span class="linenos">1270</span></a><span class="sd">        - account (str): The account number for which the exchange rate is being recorded or retrieved.</span>
</span><span id="ZakatTracker.exchange-1271"><a href="#ZakatTracker.exchange-1271"><span class="linenos">1271</span></a><span class="sd">        - created (int): The timestamp of the exchange rate. If not provided, the current timestamp will be used.</span>
</span><span id="ZakatTracker.exchange-1272"><a href="#ZakatTracker.exchange-1272"><span class="linenos">1272</span></a><span class="sd">        - rate (float): The exchange rate to be recorded. If not provided, the method will retrieve the latest exchange rate.</span>
</span><span id="ZakatTracker.exchange-1273"><a href="#ZakatTracker.exchange-1273"><span class="linenos">1273</span></a><span class="sd">        - description (str): A description of the exchange rate.</span>
</span><span id="ZakatTracker.exchange-1274"><a href="#ZakatTracker.exchange-1274"><span class="linenos">1274</span></a><span class="sd">        - debug (bool): Whether to print debug information. Default is False.</span>
</span><span id="ZakatTracker.exchange-1275"><a href="#ZakatTracker.exchange-1275"><span class="linenos">1275</span></a>
</span><span id="ZakatTracker.exchange-1276"><a href="#ZakatTracker.exchange-1276"><span class="linenos">1276</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.exchange-1277"><a href="#ZakatTracker.exchange-1277"><span class="linenos">1277</span></a><span class="sd">        - dict: A dictionary containing the latest exchange rate and its description. If no exchange rate is found,</span>
</span><span id="ZakatTracker.exchange-1278"><a href="#ZakatTracker.exchange-1278"><span class="linenos">1278</span></a><span class="sd">        it returns a dictionary with default values for the rate and description.</span>
</span><span id="ZakatTracker.exchange-1279"><a href="#ZakatTracker.exchange-1279"><span class="linenos">1279</span></a>
</span><span id="ZakatTracker.exchange-1280"><a href="#ZakatTracker.exchange-1280"><span class="linenos">1280</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker.exchange-1281"><a href="#ZakatTracker.exchange-1281"><span class="linenos">1281</span></a><span class="sd">        - ValueError: The created should be greater than zero.</span>
</span><span id="ZakatTracker.exchange-1282"><a href="#ZakatTracker.exchange-1282"><span class="linenos">1282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.exchange-1283"><a href="#ZakatTracker.exchange-1283"><span class="linenos">1283</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.exchange-1284"><a href="#ZakatTracker.exchange-1284"><span class="linenos">1284</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exchange&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.exchange-1285"><a href="#ZakatTracker.exchange-1285"><span class="linenos">1285</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.exchange-1286"><a href="#ZakatTracker.exchange-1286"><span class="linenos">1286</span></a>            <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker.exchange-1287"><a href="#ZakatTracker.exchange-1287"><span class="linenos">1287</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.exchange-1288"><a href="#ZakatTracker.exchange-1288"><span class="linenos">1288</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The created should be greater than zero.&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.exchange-1289"><a href="#ZakatTracker.exchange-1289"><span class="linenos">1289</span></a>        <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.exchange-1290"><a href="#ZakatTracker.exchange-1290"><span class="linenos">1290</span></a>        <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker.exchange-1291"><a href="#ZakatTracker.exchange-1291"><span class="linenos">1291</span></a>        <span class="k">if</span> <span class="n">rate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.exchange-1292"><a href="#ZakatTracker.exchange-1292"><span class="linenos">1292</span></a>            <span class="k">if</span> <span class="n">rate</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.exchange-1293"><a href="#ZakatTracker.exchange-1293"><span class="linenos">1293</span></a>                <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="ZakatTracker.exchange-1294"><a href="#ZakatTracker.exchange-1294"><span class="linenos">1294</span></a>            <span class="k">if</span> <span class="n">account</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.exchange-1295"><a href="#ZakatTracker.exchange-1295"><span class="linenos">1295</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker.exchange-1296"><a href="#ZakatTracker.exchange-1296"><span class="linenos">1296</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">rate</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ZakatTracker.exchange-1297"><a href="#ZakatTracker.exchange-1297"><span class="linenos">1297</span></a>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">created</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="ZakatTracker.exchange-1298"><a href="#ZakatTracker.exchange-1298"><span class="linenos">1298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="n">created</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="n">rate</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">}</span>
</span><span id="ZakatTracker.exchange-1299"><a href="#ZakatTracker.exchange-1299"><span class="linenos">1299</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">EXCHANGE</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">created</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">rate</span><span class="p">)</span>
</span><span id="ZakatTracker.exchange-1300"><a href="#ZakatTracker.exchange-1300"><span class="linenos">1300</span></a>            <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker.exchange-1301"><a href="#ZakatTracker.exchange-1301"><span class="linenos">1301</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker.exchange-1302"><a href="#ZakatTracker.exchange-1302"><span class="linenos">1302</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.exchange-1303"><a href="#ZakatTracker.exchange-1303"><span class="linenos">1303</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exchange-created-1&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker.exchange-1304"><a href="#ZakatTracker.exchange-1304"><span class="linenos">1304</span></a>                      <span class="sa">f</span><span class="s1">&#39;account: </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s1">, created: </span><span class="si">{</span><span class="n">created</span><span class="si">}</span><span class="s1">, rate:</span><span class="si">{</span><span class="n">rate</span><span class="si">}</span><span class="s1">, description:</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.exchange-1305"><a href="#ZakatTracker.exchange-1305"><span class="linenos">1305</span></a>
</span><span id="ZakatTracker.exchange-1306"><a href="#ZakatTracker.exchange-1306"><span class="linenos">1306</span></a>        <span class="k">if</span> <span class="n">account</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.exchange-1307"><a href="#ZakatTracker.exchange-1307"><span class="linenos">1307</span></a>            <span class="n">valid_rates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ts</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">ts</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">ts</span> <span class="o">&lt;=</span> <span class="n">created</span><span class="p">]</span>
</span><span id="ZakatTracker.exchange-1308"><a href="#ZakatTracker.exchange-1308"><span class="linenos">1308</span></a>            <span class="k">if</span> <span class="n">valid_rates</span><span class="p">:</span>
</span><span id="ZakatTracker.exchange-1309"><a href="#ZakatTracker.exchange-1309"><span class="linenos">1309</span></a>                <span class="n">latest_rate</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">valid_rates</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="ZakatTracker.exchange-1310"><a href="#ZakatTracker.exchange-1310"><span class="linenos">1310</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.exchange-1311"><a href="#ZakatTracker.exchange-1311"><span class="linenos">1311</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exchange-read-1&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker.exchange-1312"><a href="#ZakatTracker.exchange-1312"><span class="linenos">1312</span></a>                          <span class="sa">f</span><span class="s1">&#39;account: </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s1">, created: </span><span class="si">{</span><span class="n">created</span><span class="si">}</span><span class="s1">, rate:</span><span class="si">{</span><span class="n">rate</span><span class="si">}</span><span class="s1">, description:</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.exchange-1313"><a href="#ZakatTracker.exchange-1313"><span class="linenos">1313</span></a>                          <span class="s1">&#39;latest_rate&#39;</span><span class="p">,</span> <span class="n">latest_rate</span><span class="p">)</span>
</span><span id="ZakatTracker.exchange-1314"><a href="#ZakatTracker.exchange-1314"><span class="linenos">1314</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">latest_rate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker.exchange-1315"><a href="#ZakatTracker.exchange-1315"><span class="linenos">1315</span></a>                <span class="n">result</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">latest_rate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ZakatTracker.exchange-1316"><a href="#ZakatTracker.exchange-1316"><span class="linenos">1316</span></a>                <span class="k">return</span> <span class="n">result</span>  <span class="c1"># إرجاع قاموس يحتوي على المعدل والوصف</span>
</span><span id="ZakatTracker.exchange-1317"><a href="#ZakatTracker.exchange-1317"><span class="linenos">1317</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.exchange-1318"><a href="#ZakatTracker.exchange-1318"><span class="linenos">1318</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exchange-read-0&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;account: </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s1">, created: </span><span class="si">{</span><span class="n">created</span><span class="si">}</span><span class="s1">, rate:</span><span class="si">{</span><span class="n">rate</span><span class="si">}</span><span class="s1">, description:</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.exchange-1319"><a href="#ZakatTracker.exchange-1319"><span class="linenos">1319</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">created</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>  <span class="c1"># إرجاع القيمة الافتراضية مع وصف فارغ</span>
</span></pre></div>


            <div class="docstring"><p>This method is used to record or retrieve exchange rates for a specific account.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number for which the exchange rate is being recorded or retrieved.</li>
<li>created (int): The timestamp of the exchange rate. If not provided, the current timestamp will be used.</li>
<li>rate (float): The exchange rate to be recorded. If not provided, the method will retrieve the latest exchange rate.</li>
<li>description (str): A description of the exchange rate.</li>
<li>debug (bool): Whether to print debug information. Default is False.</li>
</ul>

<p>Returns:</p>

<ul>
<li>dict: A dictionary containing the latest exchange rate and its description. If no exchange rate is found,
it returns a dictionary with default values for the rate and description.</li>
</ul>

<p>Raises:</p>

<ul>
<li>ValueError: The created should be greater than zero.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.exchange_calc" class="classattr">
                                        <input id="ZakatTracker.exchange_calc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">exchange_calc</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">x_rate</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">y_rate</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.exchange_calc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.exchange_calc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.exchange_calc-1321"><a href="#ZakatTracker.exchange_calc-1321"><span class="linenos">1321</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.exchange_calc-1322"><a href="#ZakatTracker.exchange_calc-1322"><span class="linenos">1322</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exchange_calc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ZakatTracker.exchange_calc-1323"><a href="#ZakatTracker.exchange_calc-1323"><span class="linenos">1323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.exchange_calc-1324"><a href="#ZakatTracker.exchange_calc-1324"><span class="linenos">1324</span></a><span class="sd">        This function calculates the exchanged amount of a currency.</span>
</span><span id="ZakatTracker.exchange_calc-1325"><a href="#ZakatTracker.exchange_calc-1325"><span class="linenos">1325</span></a>
</span><span id="ZakatTracker.exchange_calc-1326"><a href="#ZakatTracker.exchange_calc-1326"><span class="linenos">1326</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.exchange_calc-1327"><a href="#ZakatTracker.exchange_calc-1327"><span class="linenos">1327</span></a><span class="sd">        - x (float): The original amount of the currency.</span>
</span><span id="ZakatTracker.exchange_calc-1328"><a href="#ZakatTracker.exchange_calc-1328"><span class="linenos">1328</span></a><span class="sd">        - x_rate (float): The exchange rate of the original currency.</span>
</span><span id="ZakatTracker.exchange_calc-1329"><a href="#ZakatTracker.exchange_calc-1329"><span class="linenos">1329</span></a><span class="sd">         - y_rate (float): The exchange rate of the target currency.</span>
</span><span id="ZakatTracker.exchange_calc-1330"><a href="#ZakatTracker.exchange_calc-1330"><span class="linenos">1330</span></a>
</span><span id="ZakatTracker.exchange_calc-1331"><a href="#ZakatTracker.exchange_calc-1331"><span class="linenos">1331</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.exchange_calc-1332"><a href="#ZakatTracker.exchange_calc-1332"><span class="linenos">1332</span></a><span class="sd">        - float: The exchanged amount of the target currency.</span>
</span><span id="ZakatTracker.exchange_calc-1333"><a href="#ZakatTracker.exchange_calc-1333"><span class="linenos">1333</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.exchange_calc-1334"><a href="#ZakatTracker.exchange_calc-1334"><span class="linenos">1334</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_rate</span>
</span></pre></div>


            <div class="docstring"><p>This function calculates the exchanged amount of a currency.</p>

<p>Parameters:</p>

<ul>
<li>x (float): The original amount of the currency.</li>
<li>x_rate (float): The exchange rate of the original currency.
<ul>
<li>y_rate (float): The exchange rate of the target currency.</li>
</ul></li>
</ul>

<p>Returns:</p>

<ul>
<li>float: The exchanged amount of the target currency.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.exchanges" class="classattr">
                                        <input id="ZakatTracker.exchanges-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">exchanges</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.exchanges-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.exchanges"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.exchanges-1336"><a href="#ZakatTracker.exchanges-1336"><span class="linenos">1336</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exchanges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker.exchanges-1337"><a href="#ZakatTracker.exchanges-1337"><span class="linenos">1337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.exchanges-1338"><a href="#ZakatTracker.exchanges-1338"><span class="linenos">1338</span></a><span class="sd">        Retrieve the recorded exchange rates for all accounts.</span>
</span><span id="ZakatTracker.exchanges-1339"><a href="#ZakatTracker.exchanges-1339"><span class="linenos">1339</span></a>
</span><span id="ZakatTracker.exchanges-1340"><a href="#ZakatTracker.exchanges-1340"><span class="linenos">1340</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.exchanges-1341"><a href="#ZakatTracker.exchanges-1341"><span class="linenos">1341</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker.exchanges-1342"><a href="#ZakatTracker.exchanges-1342"><span class="linenos">1342</span></a>
</span><span id="ZakatTracker.exchanges-1343"><a href="#ZakatTracker.exchanges-1343"><span class="linenos">1343</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.exchanges-1344"><a href="#ZakatTracker.exchanges-1344"><span class="linenos">1344</span></a><span class="sd">        - dict: A dictionary containing all recorded exchange rates.</span>
</span><span id="ZakatTracker.exchanges-1345"><a href="#ZakatTracker.exchanges-1345"><span class="linenos">1345</span></a><span class="sd">        The keys are account names or numbers, and the values are dictionaries containing the exchange rates.</span>
</span><span id="ZakatTracker.exchanges-1346"><a href="#ZakatTracker.exchanges-1346"><span class="linenos">1346</span></a><span class="sd">        Each exchange rate dictionary has timestamps as keys and exchange rate details as values.</span>
</span><span id="ZakatTracker.exchanges-1347"><a href="#ZakatTracker.exchanges-1347"><span class="linenos">1347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.exchanges-1348"><a href="#ZakatTracker.exchanges-1348"><span class="linenos">1348</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the recorded exchange rates for all accounts.</p>

<p>Parameters:
None</p>

<p>Returns:</p>

<ul>
<li>dict: A dictionary containing all recorded exchange rates.
The keys are account names or numbers, and the values are dictionaries containing the exchange rates.
Each exchange rate dictionary has timestamps as keys and exchange rate details as values.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.accounts" class="classattr">
                                        <input id="ZakatTracker.accounts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">accounts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.accounts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.accounts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.accounts-1350"><a href="#ZakatTracker.accounts-1350"><span class="linenos">1350</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">accounts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker.accounts-1351"><a href="#ZakatTracker.accounts-1351"><span class="linenos">1351</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.accounts-1352"><a href="#ZakatTracker.accounts-1352"><span class="linenos">1352</span></a><span class="sd">        Returns a dictionary containing account numbers as keys and their respective balances as values.</span>
</span><span id="ZakatTracker.accounts-1353"><a href="#ZakatTracker.accounts-1353"><span class="linenos">1353</span></a>
</span><span id="ZakatTracker.accounts-1354"><a href="#ZakatTracker.accounts-1354"><span class="linenos">1354</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.accounts-1355"><a href="#ZakatTracker.accounts-1355"><span class="linenos">1355</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker.accounts-1356"><a href="#ZakatTracker.accounts-1356"><span class="linenos">1356</span></a>
</span><span id="ZakatTracker.accounts-1357"><a href="#ZakatTracker.accounts-1357"><span class="linenos">1357</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.accounts-1358"><a href="#ZakatTracker.accounts-1358"><span class="linenos">1358</span></a><span class="sd">        - dict: A dictionary where keys are account numbers and values are their respective balances.</span>
</span><span id="ZakatTracker.accounts-1359"><a href="#ZakatTracker.accounts-1359"><span class="linenos">1359</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.accounts-1360"><a href="#ZakatTracker.accounts-1360"><span class="linenos">1360</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker.accounts-1361"><a href="#ZakatTracker.accounts-1361"><span class="linenos">1361</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.accounts-1362"><a href="#ZakatTracker.accounts-1362"><span class="linenos">1362</span></a>            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.accounts-1363"><a href="#ZakatTracker.accounts-1363"><span class="linenos">1363</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Returns a dictionary containing account numbers as keys and their respective balances as values.</p>

<p>Parameters:
None</p>

<p>Returns:</p>

<ul>
<li>dict: A dictionary where keys are account numbers and values are their respective balances.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.boxes" class="classattr">
                                        <input id="ZakatTracker.boxes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">boxes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.boxes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.boxes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.boxes-1365"><a href="#ZakatTracker.boxes-1365"><span class="linenos">1365</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">boxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker.boxes-1366"><a href="#ZakatTracker.boxes-1366"><span class="linenos">1366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.boxes-1367"><a href="#ZakatTracker.boxes-1367"><span class="linenos">1367</span></a><span class="sd">        Retrieve the boxes (transactions) associated with a specific account.</span>
</span><span id="ZakatTracker.boxes-1368"><a href="#ZakatTracker.boxes-1368"><span class="linenos">1368</span></a>
</span><span id="ZakatTracker.boxes-1369"><a href="#ZakatTracker.boxes-1369"><span class="linenos">1369</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.boxes-1370"><a href="#ZakatTracker.boxes-1370"><span class="linenos">1370</span></a><span class="sd">        - account (str): The account number for which to retrieve the boxes.</span>
</span><span id="ZakatTracker.boxes-1371"><a href="#ZakatTracker.boxes-1371"><span class="linenos">1371</span></a>
</span><span id="ZakatTracker.boxes-1372"><a href="#ZakatTracker.boxes-1372"><span class="linenos">1372</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.boxes-1373"><a href="#ZakatTracker.boxes-1373"><span class="linenos">1373</span></a><span class="sd">        - dict: A dictionary containing the boxes associated with the given account.</span>
</span><span id="ZakatTracker.boxes-1374"><a href="#ZakatTracker.boxes-1374"><span class="linenos">1374</span></a><span class="sd">        If the account does not exist, an empty dictionary is returned.</span>
</span><span id="ZakatTracker.boxes-1375"><a href="#ZakatTracker.boxes-1375"><span class="linenos">1375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.boxes-1376"><a href="#ZakatTracker.boxes-1376"><span class="linenos">1376</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker.boxes-1377"><a href="#ZakatTracker.boxes-1377"><span class="linenos">1377</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.boxes-1378"><a href="#ZakatTracker.boxes-1378"><span class="linenos">1378</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the boxes (transactions) associated with a specific account.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number for which to retrieve the boxes.</li>
</ul>

<p>Returns:</p>

<ul>
<li>dict: A dictionary containing the boxes associated with the given account.
If the account does not exist, an empty dictionary is returned.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.logs" class="classattr">
                                        <input id="ZakatTracker.logs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">logs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.logs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.logs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.logs-1380"><a href="#ZakatTracker.logs-1380"><span class="linenos">1380</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker.logs-1381"><a href="#ZakatTracker.logs-1381"><span class="linenos">1381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.logs-1382"><a href="#ZakatTracker.logs-1382"><span class="linenos">1382</span></a><span class="sd">        Retrieve the logs (transactions) associated with a specific account.</span>
</span><span id="ZakatTracker.logs-1383"><a href="#ZakatTracker.logs-1383"><span class="linenos">1383</span></a>
</span><span id="ZakatTracker.logs-1384"><a href="#ZakatTracker.logs-1384"><span class="linenos">1384</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.logs-1385"><a href="#ZakatTracker.logs-1385"><span class="linenos">1385</span></a><span class="sd">        - account (str): The account number for which to retrieve the logs.</span>
</span><span id="ZakatTracker.logs-1386"><a href="#ZakatTracker.logs-1386"><span class="linenos">1386</span></a>
</span><span id="ZakatTracker.logs-1387"><a href="#ZakatTracker.logs-1387"><span class="linenos">1387</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.logs-1388"><a href="#ZakatTracker.logs-1388"><span class="linenos">1388</span></a><span class="sd">        - dict: A dictionary containing the logs associated with the given account.</span>
</span><span id="ZakatTracker.logs-1389"><a href="#ZakatTracker.logs-1389"><span class="linenos">1389</span></a><span class="sd">        If the account does not exist, an empty dictionary is returned.</span>
</span><span id="ZakatTracker.logs-1390"><a href="#ZakatTracker.logs-1390"><span class="linenos">1390</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.logs-1391"><a href="#ZakatTracker.logs-1391"><span class="linenos">1391</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker.logs-1392"><a href="#ZakatTracker.logs-1392"><span class="linenos">1392</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.logs-1393"><a href="#ZakatTracker.logs-1393"><span class="linenos">1393</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the logs (transactions) associated with a specific account.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number for which to retrieve the logs.</li>
</ul>

<p>Returns:</p>

<ul>
<li>dict: A dictionary containing the logs associated with the given account.
If the account does not exist, an empty dictionary is returned.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.daily_logs_init" class="classattr">
                                        <input id="ZakatTracker.daily_logs_init-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">daily_logs_init</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.daily_logs_init-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.daily_logs_init"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.daily_logs_init-1395"><a href="#ZakatTracker.daily_logs_init-1395"><span class="linenos">1395</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">daily_logs_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
</span><span id="ZakatTracker.daily_logs_init-1396"><a href="#ZakatTracker.daily_logs_init-1396"><span class="linenos">1396</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.daily_logs_init-1397"><a href="#ZakatTracker.daily_logs_init-1397"><span class="linenos">1397</span></a><span class="sd">        Initialize a dictionary to store daily, weekly, monthly, and yearly logs.</span>
</span><span id="ZakatTracker.daily_logs_init-1398"><a href="#ZakatTracker.daily_logs_init-1398"><span class="linenos">1398</span></a>
</span><span id="ZakatTracker.daily_logs_init-1399"><a href="#ZakatTracker.daily_logs_init-1399"><span class="linenos">1399</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.daily_logs_init-1400"><a href="#ZakatTracker.daily_logs_init-1400"><span class="linenos">1400</span></a><span class="sd">        dict: A dictionary with keys &#39;daily&#39;, &#39;weekly&#39;, &#39;monthly&#39;, and &#39;yearly&#39;, each containing an empty dictionary.</span>
</span><span id="ZakatTracker.daily_logs_init-1401"><a href="#ZakatTracker.daily_logs_init-1401"><span class="linenos">1401</span></a><span class="sd">            Later each key maps to another dictionary, which will store the logs for the corresponding time period.</span>
</span><span id="ZakatTracker.daily_logs_init-1402"><a href="#ZakatTracker.daily_logs_init-1402"><span class="linenos">1402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.daily_logs_init-1403"><a href="#ZakatTracker.daily_logs_init-1403"><span class="linenos">1403</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ZakatTracker.daily_logs_init-1404"><a href="#ZakatTracker.daily_logs_init-1404"><span class="linenos">1404</span></a>            <span class="s1">&#39;daily&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker.daily_logs_init-1405"><a href="#ZakatTracker.daily_logs_init-1405"><span class="linenos">1405</span></a>            <span class="s1">&#39;weekly&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker.daily_logs_init-1406"><a href="#ZakatTracker.daily_logs_init-1406"><span class="linenos">1406</span></a>            <span class="s1">&#39;monthly&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker.daily_logs_init-1407"><a href="#ZakatTracker.daily_logs_init-1407"><span class="linenos">1407</span></a>            <span class="s1">&#39;yearly&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker.daily_logs_init-1408"><a href="#ZakatTracker.daily_logs_init-1408"><span class="linenos">1408</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a dictionary to store daily, weekly, monthly, and yearly logs.</p>

<p>Returns:
dict: A dictionary with keys 'daily', 'weekly', 'monthly', and 'yearly', each containing an empty dictionary.
    Later each key maps to another dictionary, which will store the logs for the corresponding time period.</p>
</div>


                            </div>
                            <div id="ZakatTracker.daily_logs" class="classattr">
                                        <input id="ZakatTracker.daily_logs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">daily_logs</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">weekday</span><span class="p">:</span> <span class="n"><a href="#WeekDay">WeekDay</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#WeekDay.Friday">WeekDay.Friday</a></span><span class="p">:</span> <span class="mi">4</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ZakatTracker.daily_logs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.daily_logs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.daily_logs-1410"><a href="#ZakatTracker.daily_logs-1410"><span class="linenos">1410</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">daily_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weekday</span><span class="p">:</span> <span class="n">WeekDay</span> <span class="o">=</span> <span class="n">WeekDay</span><span class="o">.</span><span class="n">Friday</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="ZakatTracker.daily_logs-1411"><a href="#ZakatTracker.daily_logs-1411"><span class="linenos">1411</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.daily_logs-1412"><a href="#ZakatTracker.daily_logs-1412"><span class="linenos">1412</span></a><span class="sd">        Retrieve the daily logs (transactions) from all accounts.</span>
</span><span id="ZakatTracker.daily_logs-1413"><a href="#ZakatTracker.daily_logs-1413"><span class="linenos">1413</span></a>
</span><span id="ZakatTracker.daily_logs-1414"><a href="#ZakatTracker.daily_logs-1414"><span class="linenos">1414</span></a><span class="sd">        The function groups the logs by day, month, and year, and calculates the total value for each group.</span>
</span><span id="ZakatTracker.daily_logs-1415"><a href="#ZakatTracker.daily_logs-1415"><span class="linenos">1415</span></a><span class="sd">        It returns a dictionary where the keys are the timestamps of the daily groups,</span>
</span><span id="ZakatTracker.daily_logs-1416"><a href="#ZakatTracker.daily_logs-1416"><span class="linenos">1416</span></a><span class="sd">        and the values are dictionaries containing the total value and the logs for that group.</span>
</span><span id="ZakatTracker.daily_logs-1417"><a href="#ZakatTracker.daily_logs-1417"><span class="linenos">1417</span></a>
</span><span id="ZakatTracker.daily_logs-1418"><a href="#ZakatTracker.daily_logs-1418"><span class="linenos">1418</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.daily_logs-1419"><a href="#ZakatTracker.daily_logs-1419"><span class="linenos">1419</span></a><span class="sd">        - weekday (WeekDay): Select the weekday is collected for the week data. Default is WeekDay.Friday.</span>
</span><span id="ZakatTracker.daily_logs-1420"><a href="#ZakatTracker.daily_logs-1420"><span class="linenos">1420</span></a><span class="sd">        - debug (bool): Whether to print debug information. Default is False.</span>
</span><span id="ZakatTracker.daily_logs-1421"><a href="#ZakatTracker.daily_logs-1421"><span class="linenos">1421</span></a>
</span><span id="ZakatTracker.daily_logs-1422"><a href="#ZakatTracker.daily_logs-1422"><span class="linenos">1422</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.daily_logs-1423"><a href="#ZakatTracker.daily_logs-1423"><span class="linenos">1423</span></a><span class="sd">        dict: A dictionary containing the daily logs.</span>
</span><span id="ZakatTracker.daily_logs-1424"><a href="#ZakatTracker.daily_logs-1424"><span class="linenos">1424</span></a>
</span><span id="ZakatTracker.daily_logs-1425"><a href="#ZakatTracker.daily_logs-1425"><span class="linenos">1425</span></a><span class="sd">        Example:</span>
</span><span id="ZakatTracker.daily_logs-1426"><a href="#ZakatTracker.daily_logs-1426"><span class="linenos">1426</span></a><span class="sd">        &gt;&gt;&gt; tracker = ZakatTracker()</span>
</span><span id="ZakatTracker.daily_logs-1427"><a href="#ZakatTracker.daily_logs-1427"><span class="linenos">1427</span></a><span class="sd">        &gt;&gt;&gt; tracker.sub(51, &#39;desc&#39;, &#39;account1&#39;)</span>
</span><span id="ZakatTracker.daily_logs-1428"><a href="#ZakatTracker.daily_logs-1428"><span class="linenos">1428</span></a><span class="sd">        &gt;&gt;&gt; ref = tracker.track(100, &#39;desc&#39;, &#39;account2&#39;)</span>
</span><span id="ZakatTracker.daily_logs-1429"><a href="#ZakatTracker.daily_logs-1429"><span class="linenos">1429</span></a><span class="sd">        &gt;&gt;&gt; tracker.add_file(&#39;account2&#39;, ref, &#39;file_0&#39;)</span>
</span><span id="ZakatTracker.daily_logs-1430"><a href="#ZakatTracker.daily_logs-1430"><span class="linenos">1430</span></a><span class="sd">        &gt;&gt;&gt; tracker.add_file(&#39;account2&#39;, ref, &#39;file_1&#39;)</span>
</span><span id="ZakatTracker.daily_logs-1431"><a href="#ZakatTracker.daily_logs-1431"><span class="linenos">1431</span></a><span class="sd">        &gt;&gt;&gt; tracker.add_file(&#39;account2&#39;, ref, &#39;file_2&#39;)</span>
</span><span id="ZakatTracker.daily_logs-1432"><a href="#ZakatTracker.daily_logs-1432"><span class="linenos">1432</span></a><span class="sd">        &gt;&gt;&gt; tracker.daily_logs()</span>
</span><span id="ZakatTracker.daily_logs-1433"><a href="#ZakatTracker.daily_logs-1433"><span class="linenos">1433</span></a><span class="sd">        {</span>
</span><span id="ZakatTracker.daily_logs-1434"><a href="#ZakatTracker.daily_logs-1434"><span class="linenos">1434</span></a><span class="sd">            &#39;daily&#39;: {</span>
</span><span id="ZakatTracker.daily_logs-1435"><a href="#ZakatTracker.daily_logs-1435"><span class="linenos">1435</span></a><span class="sd">                &#39;2024-06-30&#39;: {</span>
</span><span id="ZakatTracker.daily_logs-1436"><a href="#ZakatTracker.daily_logs-1436"><span class="linenos">1436</span></a><span class="sd">                    &#39;positive&#39;: 100,</span>
</span><span id="ZakatTracker.daily_logs-1437"><a href="#ZakatTracker.daily_logs-1437"><span class="linenos">1437</span></a><span class="sd">                    &#39;negative&#39;: 51,</span>
</span><span id="ZakatTracker.daily_logs-1438"><a href="#ZakatTracker.daily_logs-1438"><span class="linenos">1438</span></a><span class="sd">                    &#39;total&#39;: 99,</span>
</span><span id="ZakatTracker.daily_logs-1439"><a href="#ZakatTracker.daily_logs-1439"><span class="linenos">1439</span></a><span class="sd">                    &#39;rows&#39;: [</span>
</span><span id="ZakatTracker.daily_logs-1440"><a href="#ZakatTracker.daily_logs-1440"><span class="linenos">1440</span></a><span class="sd">                        {</span>
</span><span id="ZakatTracker.daily_logs-1441"><a href="#ZakatTracker.daily_logs-1441"><span class="linenos">1441</span></a><span class="sd">                            &#39;account&#39;: &#39;account1&#39;,</span>
</span><span id="ZakatTracker.daily_logs-1442"><a href="#ZakatTracker.daily_logs-1442"><span class="linenos">1442</span></a><span class="sd">                            &#39;desc&#39;: &#39;desc&#39;,</span>
</span><span id="ZakatTracker.daily_logs-1443"><a href="#ZakatTracker.daily_logs-1443"><span class="linenos">1443</span></a><span class="sd">                            &#39;file&#39;: {},</span>
</span><span id="ZakatTracker.daily_logs-1444"><a href="#ZakatTracker.daily_logs-1444"><span class="linenos">1444</span></a><span class="sd">                            &#39;ref&#39;: None,</span>
</span><span id="ZakatTracker.daily_logs-1445"><a href="#ZakatTracker.daily_logs-1445"><span class="linenos">1445</span></a><span class="sd">                            &#39;value&#39;: -51,</span>
</span><span id="ZakatTracker.daily_logs-1446"><a href="#ZakatTracker.daily_logs-1446"><span class="linenos">1446</span></a><span class="sd">                            &#39;time&#39;: 1690977015000000000,</span>
</span><span id="ZakatTracker.daily_logs-1447"><a href="#ZakatTracker.daily_logs-1447"><span class="linenos">1447</span></a><span class="sd">                            &#39;transfer&#39;: False,</span>
</span><span id="ZakatTracker.daily_logs-1448"><a href="#ZakatTracker.daily_logs-1448"><span class="linenos">1448</span></a><span class="sd">                        },</span>
</span><span id="ZakatTracker.daily_logs-1449"><a href="#ZakatTracker.daily_logs-1449"><span class="linenos">1449</span></a><span class="sd">                        {</span>
</span><span id="ZakatTracker.daily_logs-1450"><a href="#ZakatTracker.daily_logs-1450"><span class="linenos">1450</span></a><span class="sd">                            &#39;account&#39;: &#39;account2&#39;,</span>
</span><span id="ZakatTracker.daily_logs-1451"><a href="#ZakatTracker.daily_logs-1451"><span class="linenos">1451</span></a><span class="sd">                            &#39;desc&#39;: &#39;desc&#39;,</span>
</span><span id="ZakatTracker.daily_logs-1452"><a href="#ZakatTracker.daily_logs-1452"><span class="linenos">1452</span></a><span class="sd">                            &#39;file&#39;: {</span>
</span><span id="ZakatTracker.daily_logs-1453"><a href="#ZakatTracker.daily_logs-1453"><span class="linenos">1453</span></a><span class="sd">                                1722919011626770944: &#39;file_0&#39;,</span>
</span><span id="ZakatTracker.daily_logs-1454"><a href="#ZakatTracker.daily_logs-1454"><span class="linenos">1454</span></a><span class="sd">                                1722919011626812928: &#39;file_1&#39;,</span>
</span><span id="ZakatTracker.daily_logs-1455"><a href="#ZakatTracker.daily_logs-1455"><span class="linenos">1455</span></a><span class="sd">                                1722919011626846976: &#39;file_2&#39;,</span>
</span><span id="ZakatTracker.daily_logs-1456"><a href="#ZakatTracker.daily_logs-1456"><span class="linenos">1456</span></a><span class="sd">                            },</span>
</span><span id="ZakatTracker.daily_logs-1457"><a href="#ZakatTracker.daily_logs-1457"><span class="linenos">1457</span></a><span class="sd">                            &#39;ref&#39;: None,</span>
</span><span id="ZakatTracker.daily_logs-1458"><a href="#ZakatTracker.daily_logs-1458"><span class="linenos">1458</span></a><span class="sd">                            &#39;value&#39;: 100,</span>
</span><span id="ZakatTracker.daily_logs-1459"><a href="#ZakatTracker.daily_logs-1459"><span class="linenos">1459</span></a><span class="sd">                            &#39;time&#39;: 1690977015000000000,</span>
</span><span id="ZakatTracker.daily_logs-1460"><a href="#ZakatTracker.daily_logs-1460"><span class="linenos">1460</span></a><span class="sd">                            &#39;transfer&#39;: False,</span>
</span><span id="ZakatTracker.daily_logs-1461"><a href="#ZakatTracker.daily_logs-1461"><span class="linenos">1461</span></a><span class="sd">                        },</span>
</span><span id="ZakatTracker.daily_logs-1462"><a href="#ZakatTracker.daily_logs-1462"><span class="linenos">1462</span></a><span class="sd">                    ],</span>
</span><span id="ZakatTracker.daily_logs-1463"><a href="#ZakatTracker.daily_logs-1463"><span class="linenos">1463</span></a><span class="sd">                },</span>
</span><span id="ZakatTracker.daily_logs-1464"><a href="#ZakatTracker.daily_logs-1464"><span class="linenos">1464</span></a><span class="sd">            },</span>
</span><span id="ZakatTracker.daily_logs-1465"><a href="#ZakatTracker.daily_logs-1465"><span class="linenos">1465</span></a><span class="sd">            &#39;weekly&#39;: {</span>
</span><span id="ZakatTracker.daily_logs-1466"><a href="#ZakatTracker.daily_logs-1466"><span class="linenos">1466</span></a><span class="sd">                datetime: {</span>
</span><span id="ZakatTracker.daily_logs-1467"><a href="#ZakatTracker.daily_logs-1467"><span class="linenos">1467</span></a><span class="sd">                    &#39;positive&#39;: 100,</span>
</span><span id="ZakatTracker.daily_logs-1468"><a href="#ZakatTracker.daily_logs-1468"><span class="linenos">1468</span></a><span class="sd">                    &#39;negative&#39;: 51,</span>
</span><span id="ZakatTracker.daily_logs-1469"><a href="#ZakatTracker.daily_logs-1469"><span class="linenos">1469</span></a><span class="sd">                    &#39;total&#39;: 99,</span>
</span><span id="ZakatTracker.daily_logs-1470"><a href="#ZakatTracker.daily_logs-1470"><span class="linenos">1470</span></a><span class="sd">                },</span>
</span><span id="ZakatTracker.daily_logs-1471"><a href="#ZakatTracker.daily_logs-1471"><span class="linenos">1471</span></a><span class="sd">            },</span>
</span><span id="ZakatTracker.daily_logs-1472"><a href="#ZakatTracker.daily_logs-1472"><span class="linenos">1472</span></a><span class="sd">            &#39;monthly&#39;: {</span>
</span><span id="ZakatTracker.daily_logs-1473"><a href="#ZakatTracker.daily_logs-1473"><span class="linenos">1473</span></a><span class="sd">                &#39;2024-06&#39;: {</span>
</span><span id="ZakatTracker.daily_logs-1474"><a href="#ZakatTracker.daily_logs-1474"><span class="linenos">1474</span></a><span class="sd">                    &#39;positive&#39;: 100,</span>
</span><span id="ZakatTracker.daily_logs-1475"><a href="#ZakatTracker.daily_logs-1475"><span class="linenos">1475</span></a><span class="sd">                    &#39;negative&#39;: 51,</span>
</span><span id="ZakatTracker.daily_logs-1476"><a href="#ZakatTracker.daily_logs-1476"><span class="linenos">1476</span></a><span class="sd">                    &#39;total&#39;: 99,</span>
</span><span id="ZakatTracker.daily_logs-1477"><a href="#ZakatTracker.daily_logs-1477"><span class="linenos">1477</span></a><span class="sd">                },</span>
</span><span id="ZakatTracker.daily_logs-1478"><a href="#ZakatTracker.daily_logs-1478"><span class="linenos">1478</span></a><span class="sd">            },</span>
</span><span id="ZakatTracker.daily_logs-1479"><a href="#ZakatTracker.daily_logs-1479"><span class="linenos">1479</span></a><span class="sd">            &#39;yearly&#39;: {</span>
</span><span id="ZakatTracker.daily_logs-1480"><a href="#ZakatTracker.daily_logs-1480"><span class="linenos">1480</span></a><span class="sd">                2024: {</span>
</span><span id="ZakatTracker.daily_logs-1481"><a href="#ZakatTracker.daily_logs-1481"><span class="linenos">1481</span></a><span class="sd">                    &#39;positive&#39;: 100,</span>
</span><span id="ZakatTracker.daily_logs-1482"><a href="#ZakatTracker.daily_logs-1482"><span class="linenos">1482</span></a><span class="sd">                    &#39;negative&#39;: 51,</span>
</span><span id="ZakatTracker.daily_logs-1483"><a href="#ZakatTracker.daily_logs-1483"><span class="linenos">1483</span></a><span class="sd">                    &#39;total&#39;: 99,</span>
</span><span id="ZakatTracker.daily_logs-1484"><a href="#ZakatTracker.daily_logs-1484"><span class="linenos">1484</span></a><span class="sd">                },</span>
</span><span id="ZakatTracker.daily_logs-1485"><a href="#ZakatTracker.daily_logs-1485"><span class="linenos">1485</span></a><span class="sd">            },</span>
</span><span id="ZakatTracker.daily_logs-1486"><a href="#ZakatTracker.daily_logs-1486"><span class="linenos">1486</span></a><span class="sd">        }</span>
</span><span id="ZakatTracker.daily_logs-1487"><a href="#ZakatTracker.daily_logs-1487"><span class="linenos">1487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.daily_logs-1488"><a href="#ZakatTracker.daily_logs-1488"><span class="linenos">1488</span></a>        <span class="n">logs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker.daily_logs-1489"><a href="#ZakatTracker.daily_logs-1489"><span class="linenos">1489</span></a>        <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">():</span>
</span><span id="ZakatTracker.daily_logs-1490"><a href="#ZakatTracker.daily_logs-1490"><span class="linenos">1490</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">(</span><span class="n">account</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker.daily_logs-1491"><a href="#ZakatTracker.daily_logs-1491"><span class="linenos">1491</span></a>                <span class="n">v</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="ZakatTracker.daily_logs-1492"><a href="#ZakatTracker.daily_logs-1492"><span class="linenos">1492</span></a>                <span class="n">v</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">account</span>
</span><span id="ZakatTracker.daily_logs-1493"><a href="#ZakatTracker.daily_logs-1493"><span class="linenos">1493</span></a>                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
</span><span id="ZakatTracker.daily_logs-1494"><a href="#ZakatTracker.daily_logs-1494"><span class="linenos">1494</span></a>                    <span class="n">logs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker.daily_logs-1495"><a href="#ZakatTracker.daily_logs-1495"><span class="linenos">1495</span></a>                <span class="n">logs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="ZakatTracker.daily_logs-1496"><a href="#ZakatTracker.daily_logs-1496"><span class="linenos">1496</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.daily_logs-1497"><a href="#ZakatTracker.daily_logs-1497"><span class="linenos">1497</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="n">logs</span><span class="p">)</span>
</span><span id="ZakatTracker.daily_logs-1498"><a href="#ZakatTracker.daily_logs-1498"><span class="linenos">1498</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daily_logs_init</span><span class="p">()</span>
</span><span id="ZakatTracker.daily_logs-1499"><a href="#ZakatTracker.daily_logs-1499"><span class="linenos">1499</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">logs</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="ZakatTracker.daily_logs-1500"><a href="#ZakatTracker.daily_logs-1500"><span class="linenos">1500</span></a>            <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_to_datetime</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="ZakatTracker.daily_logs-1501"><a href="#ZakatTracker.daily_logs-1501"><span class="linenos">1501</span></a>            <span class="n">daily</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ZakatTracker.daily_logs-1502"><a href="#ZakatTracker.daily_logs-1502"><span class="linenos">1502</span></a>            <span class="n">weekly</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">weekday</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="ZakatTracker.daily_logs-1503"><a href="#ZakatTracker.daily_logs-1503"><span class="linenos">1503</span></a>            <span class="n">monthly</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="ZakatTracker.daily_logs-1504"><a href="#ZakatTracker.daily_logs-1504"><span class="linenos">1504</span></a>            <span class="n">yearly</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">year</span>
</span><span id="ZakatTracker.daily_logs-1505"><a href="#ZakatTracker.daily_logs-1505"><span class="linenos">1505</span></a>            <span class="c1"># daily</span>
</span><span id="ZakatTracker.daily_logs-1506"><a href="#ZakatTracker.daily_logs-1506"><span class="linenos">1506</span></a>            <span class="k">if</span> <span class="n">daily</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.daily_logs-1507"><a href="#ZakatTracker.daily_logs-1507"><span class="linenos">1507</span></a>                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">][</span><span class="n">daily</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker.daily_logs-1508"><a href="#ZakatTracker.daily_logs-1508"><span class="linenos">1508</span></a>                    <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.daily_logs-1509"><a href="#ZakatTracker.daily_logs-1509"><span class="linenos">1509</span></a>                    <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.daily_logs-1510"><a href="#ZakatTracker.daily_logs-1510"><span class="linenos">1510</span></a>                    <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.daily_logs-1511"><a href="#ZakatTracker.daily_logs-1511"><span class="linenos">1511</span></a>                    <span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="ZakatTracker.daily_logs-1512"><a href="#ZakatTracker.daily_logs-1512"><span class="linenos">1512</span></a>                <span class="p">}</span>
</span><span id="ZakatTracker.daily_logs-1513"><a href="#ZakatTracker.daily_logs-1513"><span class="linenos">1513</span></a>            <span class="n">transfer</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">logs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span><span id="ZakatTracker.daily_logs-1514"><a href="#ZakatTracker.daily_logs-1514"><span class="linenos">1514</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.daily_logs-1515"><a href="#ZakatTracker.daily_logs-1515"><span class="linenos">1515</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;logs[i]&#39;</span><span class="p">,</span> <span class="n">logs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="ZakatTracker.daily_logs-1516"><a href="#ZakatTracker.daily_logs-1516"><span class="linenos">1516</span></a>            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="ZakatTracker.daily_logs-1517"><a href="#ZakatTracker.daily_logs-1517"><span class="linenos">1517</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.daily_logs-1518"><a href="#ZakatTracker.daily_logs-1518"><span class="linenos">1518</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</span><span id="ZakatTracker.daily_logs-1519"><a href="#ZakatTracker.daily_logs-1519"><span class="linenos">1519</span></a>                <span class="c1"># daily</span>
</span><span id="ZakatTracker.daily_logs-1520"><a href="#ZakatTracker.daily_logs-1520"><span class="linenos">1520</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.daily_logs-1521"><a href="#ZakatTracker.daily_logs-1521"><span class="linenos">1521</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.daily_logs-1522"><a href="#ZakatTracker.daily_logs-1522"><span class="linenos">1522</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">][</span><span class="n">daily</span><span class="p">][</span><span class="s1">&#39;positive&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker.daily_logs-1523"><a href="#ZakatTracker.daily_logs-1523"><span class="linenos">1523</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker.daily_logs-1524"><a href="#ZakatTracker.daily_logs-1524"><span class="linenos">1524</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">][</span><span class="n">daily</span><span class="p">][</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">value</span>
</span><span id="ZakatTracker.daily_logs-1525"><a href="#ZakatTracker.daily_logs-1525"><span class="linenos">1525</span></a>                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">][</span><span class="n">daily</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker.daily_logs-1526"><a href="#ZakatTracker.daily_logs-1526"><span class="linenos">1526</span></a>                <span class="n">z</span><span class="p">[</span><span class="s1">&#39;transfer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transfer</span>
</span><span id="ZakatTracker.daily_logs-1527"><a href="#ZakatTracker.daily_logs-1527"><span class="linenos">1527</span></a>                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">][</span><span class="n">daily</span><span class="p">][</span><span class="s1">&#39;rows&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="ZakatTracker.daily_logs-1528"><a href="#ZakatTracker.daily_logs-1528"><span class="linenos">1528</span></a>                <span class="c1"># weekly</span>
</span><span id="ZakatTracker.daily_logs-1529"><a href="#ZakatTracker.daily_logs-1529"><span class="linenos">1529</span></a>                <span class="k">if</span> <span class="n">weekly</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;weekly&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.daily_logs-1530"><a href="#ZakatTracker.daily_logs-1530"><span class="linenos">1530</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;weekly&#39;</span><span class="p">][</span><span class="n">weekly</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker.daily_logs-1531"><a href="#ZakatTracker.daily_logs-1531"><span class="linenos">1531</span></a>                        <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.daily_logs-1532"><a href="#ZakatTracker.daily_logs-1532"><span class="linenos">1532</span></a>                        <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.daily_logs-1533"><a href="#ZakatTracker.daily_logs-1533"><span class="linenos">1533</span></a>                        <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.daily_logs-1534"><a href="#ZakatTracker.daily_logs-1534"><span class="linenos">1534</span></a>                    <span class="p">}</span>
</span><span id="ZakatTracker.daily_logs-1535"><a href="#ZakatTracker.daily_logs-1535"><span class="linenos">1535</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.daily_logs-1536"><a href="#ZakatTracker.daily_logs-1536"><span class="linenos">1536</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;weekly&#39;</span><span class="p">][</span><span class="n">weekly</span><span class="p">][</span><span class="s1">&#39;positive&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker.daily_logs-1537"><a href="#ZakatTracker.daily_logs-1537"><span class="linenos">1537</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker.daily_logs-1538"><a href="#ZakatTracker.daily_logs-1538"><span class="linenos">1538</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;weekly&#39;</span><span class="p">][</span><span class="n">weekly</span><span class="p">][</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">value</span>
</span><span id="ZakatTracker.daily_logs-1539"><a href="#ZakatTracker.daily_logs-1539"><span class="linenos">1539</span></a>                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;weekly&#39;</span><span class="p">][</span><span class="n">weekly</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker.daily_logs-1540"><a href="#ZakatTracker.daily_logs-1540"><span class="linenos">1540</span></a>                <span class="c1"># monthly</span>
</span><span id="ZakatTracker.daily_logs-1541"><a href="#ZakatTracker.daily_logs-1541"><span class="linenos">1541</span></a>                <span class="k">if</span> <span class="n">monthly</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;monthly&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.daily_logs-1542"><a href="#ZakatTracker.daily_logs-1542"><span class="linenos">1542</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;monthly&#39;</span><span class="p">][</span><span class="n">monthly</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker.daily_logs-1543"><a href="#ZakatTracker.daily_logs-1543"><span class="linenos">1543</span></a>                        <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.daily_logs-1544"><a href="#ZakatTracker.daily_logs-1544"><span class="linenos">1544</span></a>                        <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.daily_logs-1545"><a href="#ZakatTracker.daily_logs-1545"><span class="linenos">1545</span></a>                        <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.daily_logs-1546"><a href="#ZakatTracker.daily_logs-1546"><span class="linenos">1546</span></a>                    <span class="p">}</span>
</span><span id="ZakatTracker.daily_logs-1547"><a href="#ZakatTracker.daily_logs-1547"><span class="linenos">1547</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.daily_logs-1548"><a href="#ZakatTracker.daily_logs-1548"><span class="linenos">1548</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;monthly&#39;</span><span class="p">][</span><span class="n">monthly</span><span class="p">][</span><span class="s1">&#39;positive&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker.daily_logs-1549"><a href="#ZakatTracker.daily_logs-1549"><span class="linenos">1549</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker.daily_logs-1550"><a href="#ZakatTracker.daily_logs-1550"><span class="linenos">1550</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;monthly&#39;</span><span class="p">][</span><span class="n">monthly</span><span class="p">][</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">value</span>
</span><span id="ZakatTracker.daily_logs-1551"><a href="#ZakatTracker.daily_logs-1551"><span class="linenos">1551</span></a>                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;monthly&#39;</span><span class="p">][</span><span class="n">monthly</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker.daily_logs-1552"><a href="#ZakatTracker.daily_logs-1552"><span class="linenos">1552</span></a>                <span class="c1"># yearly</span>
</span><span id="ZakatTracker.daily_logs-1553"><a href="#ZakatTracker.daily_logs-1553"><span class="linenos">1553</span></a>                <span class="k">if</span> <span class="n">yearly</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;yearly&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.daily_logs-1554"><a href="#ZakatTracker.daily_logs-1554"><span class="linenos">1554</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;yearly&#39;</span><span class="p">][</span><span class="n">yearly</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker.daily_logs-1555"><a href="#ZakatTracker.daily_logs-1555"><span class="linenos">1555</span></a>                        <span class="s1">&#39;positive&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.daily_logs-1556"><a href="#ZakatTracker.daily_logs-1556"><span class="linenos">1556</span></a>                        <span class="s1">&#39;negative&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.daily_logs-1557"><a href="#ZakatTracker.daily_logs-1557"><span class="linenos">1557</span></a>                        <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.daily_logs-1558"><a href="#ZakatTracker.daily_logs-1558"><span class="linenos">1558</span></a>                    <span class="p">}</span>
</span><span id="ZakatTracker.daily_logs-1559"><a href="#ZakatTracker.daily_logs-1559"><span class="linenos">1559</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.daily_logs-1560"><a href="#ZakatTracker.daily_logs-1560"><span class="linenos">1560</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;yearly&#39;</span><span class="p">][</span><span class="n">yearly</span><span class="p">][</span><span class="s1">&#39;positive&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker.daily_logs-1561"><a href="#ZakatTracker.daily_logs-1561"><span class="linenos">1561</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker.daily_logs-1562"><a href="#ZakatTracker.daily_logs-1562"><span class="linenos">1562</span></a>                    <span class="n">y</span><span class="p">[</span><span class="s1">&#39;yearly&#39;</span><span class="p">][</span><span class="n">yearly</span><span class="p">][</span><span class="s1">&#39;negative&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">value</span>
</span><span id="ZakatTracker.daily_logs-1563"><a href="#ZakatTracker.daily_logs-1563"><span class="linenos">1563</span></a>                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;yearly&#39;</span><span class="p">][</span><span class="n">yearly</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
</span><span id="ZakatTracker.daily_logs-1564"><a href="#ZakatTracker.daily_logs-1564"><span class="linenos">1564</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.daily_logs-1565"><a href="#ZakatTracker.daily_logs-1565"><span class="linenos">1565</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker.daily_logs-1566"><a href="#ZakatTracker.daily_logs-1566"><span class="linenos">1566</span></a>        <span class="k">return</span> <span class="n">y</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the daily logs (transactions) from all accounts.</p>

<p>The function groups the logs by day, month, and year, and calculates the total value for each group.
It returns a dictionary where the keys are the timestamps of the daily groups,
and the values are dictionaries containing the total value and the logs for that group.</p>

<p>Parameters:</p>

<ul>
<li>weekday (WeekDay): Select the weekday is collected for the week data. Default is <a href="#WeekDay.Friday">WeekDay.Friday</a>.</li>
<li>debug (bool): Whether to print debug information. Default is False.</li>
</ul>

<p>Returns:
dict: A dictionary containing the daily logs.</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">,</span> <span class="s1">&#39;account1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ref</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">,</span> <span class="s1">&#39;account2&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="s1">&#39;account2&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="s1">&#39;file_0&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="s1">&#39;account2&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="s1">&#39;file_1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="s1">&#39;account2&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="s1">&#39;file_2&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">daily_logs</span><span class="p">()</span>
<span class="go">{</span>
<span class="go">    &#39;daily&#39;: {</span>
<span class="go">        &#39;2024-06-30&#39;: {</span>
<span class="go">            &#39;positive&#39;: 100,</span>
<span class="go">            &#39;negative&#39;: 51,</span>
<span class="go">            &#39;total&#39;: 99,</span>
<span class="go">            &#39;rows&#39;: [</span>
<span class="go">                {</span>
<span class="go">                    &#39;account&#39;: &#39;account1&#39;,</span>
<span class="go">                    &#39;desc&#39;: &#39;desc&#39;,</span>
<span class="go">                    &#39;file&#39;: {},</span>
<span class="go">                    &#39;ref&#39;: None,</span>
<span class="go">                    &#39;value&#39;: -51,</span>
<span class="go">                    &#39;time&#39;: 1690977015000000000,</span>
<span class="go">                    &#39;transfer&#39;: False,</span>
<span class="go">                },</span>
<span class="go">                {</span>
<span class="go">                    &#39;account&#39;: &#39;account2&#39;,</span>
<span class="go">                    &#39;desc&#39;: &#39;desc&#39;,</span>
<span class="go">                    &#39;file&#39;: {</span>
<span class="go">                        1722919011626770944: &#39;file_0&#39;,</span>
<span class="go">                        1722919011626812928: &#39;file_1&#39;,</span>
<span class="go">                        1722919011626846976: &#39;file_2&#39;,</span>
<span class="go">                    },</span>
<span class="go">                    &#39;ref&#39;: None,</span>
<span class="go">                    &#39;value&#39;: 100,</span>
<span class="go">                    &#39;time&#39;: 1690977015000000000,</span>
<span class="go">                    &#39;transfer&#39;: False,</span>
<span class="go">                },</span>
<span class="go">            ],</span>
<span class="go">        },</span>
<span class="go">    },</span>
<span class="go">    &#39;weekly&#39;: {</span>
<span class="go">        datetime: {</span>
<span class="go">            &#39;positive&#39;: 100,</span>
<span class="go">            &#39;negative&#39;: 51,</span>
<span class="go">            &#39;total&#39;: 99,</span>
<span class="go">        },</span>
<span class="go">    },</span>
<span class="go">    &#39;monthly&#39;: {</span>
<span class="go">        &#39;2024-06&#39;: {</span>
<span class="go">            &#39;positive&#39;: 100,</span>
<span class="go">            &#39;negative&#39;: 51,</span>
<span class="go">            &#39;total&#39;: 99,</span>
<span class="go">        },</span>
<span class="go">    },</span>
<span class="go">    &#39;yearly&#39;: {</span>
<span class="go">        2024: {</span>
<span class="go">            &#39;positive&#39;: 100,</span>
<span class="go">            &#39;negative&#39;: 51,</span>
<span class="go">            &#39;total&#39;: 99,</span>
<span class="go">        },</span>
<span class="go">    },</span>
<span class="go">}</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="ZakatTracker.add_file" class="classattr">
                                        <input id="ZakatTracker.add_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">ref</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.add_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.add_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.add_file-1568"><a href="#ZakatTracker.add_file-1568"><span class="linenos">1568</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker.add_file-1569"><a href="#ZakatTracker.add_file-1569"><span class="linenos">1569</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.add_file-1570"><a href="#ZakatTracker.add_file-1570"><span class="linenos">1570</span></a><span class="sd">        Adds a file reference to a specific transaction log entry in the vault.</span>
</span><span id="ZakatTracker.add_file-1571"><a href="#ZakatTracker.add_file-1571"><span class="linenos">1571</span></a>
</span><span id="ZakatTracker.add_file-1572"><a href="#ZakatTracker.add_file-1572"><span class="linenos">1572</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.add_file-1573"><a href="#ZakatTracker.add_file-1573"><span class="linenos">1573</span></a><span class="sd">        - account (str): The account number associated with the transaction log.</span>
</span><span id="ZakatTracker.add_file-1574"><a href="#ZakatTracker.add_file-1574"><span class="linenos">1574</span></a><span class="sd">        - ref (int): The reference to the transaction log entry.</span>
</span><span id="ZakatTracker.add_file-1575"><a href="#ZakatTracker.add_file-1575"><span class="linenos">1575</span></a><span class="sd">        - path (str): The path of the file to be added.</span>
</span><span id="ZakatTracker.add_file-1576"><a href="#ZakatTracker.add_file-1576"><span class="linenos">1576</span></a>
</span><span id="ZakatTracker.add_file-1577"><a href="#ZakatTracker.add_file-1577"><span class="linenos">1577</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.add_file-1578"><a href="#ZakatTracker.add_file-1578"><span class="linenos">1578</span></a><span class="sd">        - int: The reference of the added file. If the account or transaction log entry does not exist, returns 0.</span>
</span><span id="ZakatTracker.add_file-1579"><a href="#ZakatTracker.add_file-1579"><span class="linenos">1579</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.add_file-1580"><a href="#ZakatTracker.add_file-1580"><span class="linenos">1580</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker.add_file-1581"><a href="#ZakatTracker.add_file-1581"><span class="linenos">1581</span></a>            <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.add_file-1582"><a href="#ZakatTracker.add_file-1582"><span class="linenos">1582</span></a>                <span class="n">file_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker.add_file-1583"><a href="#ZakatTracker.add_file-1583"><span class="linenos">1583</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">file_ref</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>
</span><span id="ZakatTracker.add_file-1584"><a href="#ZakatTracker.add_file-1584"><span class="linenos">1584</span></a>                <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.add_file-1585"><a href="#ZakatTracker.add_file-1585"><span class="linenos">1585</span></a>                <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker.add_file-1586"><a href="#ZakatTracker.add_file-1586"><span class="linenos">1586</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">ADD_FILE</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file_ref</span><span class="p">)</span>
</span><span id="ZakatTracker.add_file-1587"><a href="#ZakatTracker.add_file-1587"><span class="linenos">1587</span></a>                <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker.add_file-1588"><a href="#ZakatTracker.add_file-1588"><span class="linenos">1588</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker.add_file-1589"><a href="#ZakatTracker.add_file-1589"><span class="linenos">1589</span></a>                <span class="k">return</span> <span class="n">file_ref</span>
</span><span id="ZakatTracker.add_file-1590"><a href="#ZakatTracker.add_file-1590"><span class="linenos">1590</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>Adds a file reference to a specific transaction log entry in the vault.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number associated with the transaction log.</li>
<li>ref (int): The reference to the transaction log entry.</li>
<li>path (str): The path of the file to be added.</li>
</ul>

<p>Returns:</p>

<ul>
<li>int: The reference of the added file. If the account or transaction log entry does not exist, returns 0.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.remove_file" class="classattr">
                                        <input id="ZakatTracker.remove_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">ref</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">file_ref</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.remove_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.remove_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.remove_file-1592"><a href="#ZakatTracker.remove_file-1592"><span class="linenos">1592</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_ref</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.remove_file-1593"><a href="#ZakatTracker.remove_file-1593"><span class="linenos">1593</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.remove_file-1594"><a href="#ZakatTracker.remove_file-1594"><span class="linenos">1594</span></a><span class="sd">        Removes a file reference from a specific transaction log entry in the vault.</span>
</span><span id="ZakatTracker.remove_file-1595"><a href="#ZakatTracker.remove_file-1595"><span class="linenos">1595</span></a>
</span><span id="ZakatTracker.remove_file-1596"><a href="#ZakatTracker.remove_file-1596"><span class="linenos">1596</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.remove_file-1597"><a href="#ZakatTracker.remove_file-1597"><span class="linenos">1597</span></a><span class="sd">        - account (str): The account number associated with the transaction log.</span>
</span><span id="ZakatTracker.remove_file-1598"><a href="#ZakatTracker.remove_file-1598"><span class="linenos">1598</span></a><span class="sd">        - ref (int): The reference to the transaction log entry.</span>
</span><span id="ZakatTracker.remove_file-1599"><a href="#ZakatTracker.remove_file-1599"><span class="linenos">1599</span></a><span class="sd">        - file_ref (int): The reference of the file to be removed.</span>
</span><span id="ZakatTracker.remove_file-1600"><a href="#ZakatTracker.remove_file-1600"><span class="linenos">1600</span></a>
</span><span id="ZakatTracker.remove_file-1601"><a href="#ZakatTracker.remove_file-1601"><span class="linenos">1601</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.remove_file-1602"><a href="#ZakatTracker.remove_file-1602"><span class="linenos">1602</span></a><span class="sd">        - bool: True if the file reference is successfully removed, False otherwise.</span>
</span><span id="ZakatTracker.remove_file-1603"><a href="#ZakatTracker.remove_file-1603"><span class="linenos">1603</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.remove_file-1604"><a href="#ZakatTracker.remove_file-1604"><span class="linenos">1604</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker.remove_file-1605"><a href="#ZakatTracker.remove_file-1605"><span class="linenos">1605</span></a>            <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.remove_file-1606"><a href="#ZakatTracker.remove_file-1606"><span class="linenos">1606</span></a>                <span class="k">if</span> <span class="n">file_ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.remove_file-1607"><a href="#ZakatTracker.remove_file-1607"><span class="linenos">1607</span></a>                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">file_ref</span><span class="p">]</span>
</span><span id="ZakatTracker.remove_file-1608"><a href="#ZakatTracker.remove_file-1608"><span class="linenos">1608</span></a>                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">file_ref</span><span class="p">]</span>
</span><span id="ZakatTracker.remove_file-1609"><a href="#ZakatTracker.remove_file-1609"><span class="linenos">1609</span></a>                    <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.remove_file-1610"><a href="#ZakatTracker.remove_file-1610"><span class="linenos">1610</span></a>                    <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker.remove_file-1611"><a href="#ZakatTracker.remove_file-1611"><span class="linenos">1611</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">REMOVE_FILE</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file_ref</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker.remove_file-1612"><a href="#ZakatTracker.remove_file-1612"><span class="linenos">1612</span></a>                    <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker.remove_file-1613"><a href="#ZakatTracker.remove_file-1613"><span class="linenos">1613</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker.remove_file-1614"><a href="#ZakatTracker.remove_file-1614"><span class="linenos">1614</span></a>                    <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker.remove_file-1615"><a href="#ZakatTracker.remove_file-1615"><span class="linenos">1615</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Removes a file reference from a specific transaction log entry in the vault.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number associated with the transaction log.</li>
<li>ref (int): The reference to the transaction log entry.</li>
<li>file_ref (int): The reference of the file to be removed.</li>
</ul>

<p>Returns:</p>

<ul>
<li>bool: True if the file reference is successfully removed, False otherwise.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.balance" class="classattr">
                                        <input id="ZakatTracker.balance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">balance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="mi">1</span>, </span><span class="param"><span class="n">cached</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.balance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.balance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.balance-1617"><a href="#ZakatTracker.balance-1617"><span class="linenos">1617</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cached</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker.balance-1618"><a href="#ZakatTracker.balance-1618"><span class="linenos">1618</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.balance-1619"><a href="#ZakatTracker.balance-1619"><span class="linenos">1619</span></a><span class="sd">        Calculate and return the balance of a specific account.</span>
</span><span id="ZakatTracker.balance-1620"><a href="#ZakatTracker.balance-1620"><span class="linenos">1620</span></a>
</span><span id="ZakatTracker.balance-1621"><a href="#ZakatTracker.balance-1621"><span class="linenos">1621</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.balance-1622"><a href="#ZakatTracker.balance-1622"><span class="linenos">1622</span></a><span class="sd">        - account (str): The account number. Default is &#39;1&#39;.</span>
</span><span id="ZakatTracker.balance-1623"><a href="#ZakatTracker.balance-1623"><span class="linenos">1623</span></a><span class="sd">        - cached (bool): If True, use the cached balance. If False, calculate the balance from the box. Default is True.</span>
</span><span id="ZakatTracker.balance-1624"><a href="#ZakatTracker.balance-1624"><span class="linenos">1624</span></a>
</span><span id="ZakatTracker.balance-1625"><a href="#ZakatTracker.balance-1625"><span class="linenos">1625</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.balance-1626"><a href="#ZakatTracker.balance-1626"><span class="linenos">1626</span></a><span class="sd">        - int: The balance of the account.</span>
</span><span id="ZakatTracker.balance-1627"><a href="#ZakatTracker.balance-1627"><span class="linenos">1627</span></a>
</span><span id="ZakatTracker.balance-1628"><a href="#ZakatTracker.balance-1628"><span class="linenos">1628</span></a><span class="sd">        Notes:</span>
</span><span id="ZakatTracker.balance-1629"><a href="#ZakatTracker.balance-1629"><span class="linenos">1629</span></a><span class="sd">        - If cached is True, the function returns the cached balance.</span>
</span><span id="ZakatTracker.balance-1630"><a href="#ZakatTracker.balance-1630"><span class="linenos">1630</span></a><span class="sd">        - If cached is False, the function calculates the balance from the box by summing up the &#39;rest&#39; values of all box items.</span>
</span><span id="ZakatTracker.balance-1631"><a href="#ZakatTracker.balance-1631"><span class="linenos">1631</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.balance-1632"><a href="#ZakatTracker.balance-1632"><span class="linenos">1632</span></a>        <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
</span><span id="ZakatTracker.balance-1633"><a href="#ZakatTracker.balance-1633"><span class="linenos">1633</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.balance-1634"><a href="#ZakatTracker.balance-1634"><span class="linenos">1634</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.balance-1635"><a href="#ZakatTracker.balance-1635"><span class="linenos">1635</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="o">:=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Calculate and return the balance of a specific account.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number. Default is '1'.</li>
<li>cached (bool): If True, use the cached balance. If False, calculate the balance from the box. Default is True.</li>
</ul>

<p>Returns:</p>

<ul>
<li>int: The balance of the account.</li>
</ul>

<p>Notes:</p>

<ul>
<li>If cached is True, the function returns the cached balance.</li>
<li>If cached is False, the function calculates the balance from the box by summing up the 'rest' values of all box items.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.hide" class="classattr">
                                        <input id="ZakatTracker.hide-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">hide</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span>, </span><span class="param"><span class="n">status</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.hide-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.hide"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.hide-1637"><a href="#ZakatTracker.hide-1637"><span class="linenos">1637</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">hide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.hide-1638"><a href="#ZakatTracker.hide-1638"><span class="linenos">1638</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.hide-1639"><a href="#ZakatTracker.hide-1639"><span class="linenos">1639</span></a><span class="sd">        Check or set the hide status of a specific account.</span>
</span><span id="ZakatTracker.hide-1640"><a href="#ZakatTracker.hide-1640"><span class="linenos">1640</span></a>
</span><span id="ZakatTracker.hide-1641"><a href="#ZakatTracker.hide-1641"><span class="linenos">1641</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.hide-1642"><a href="#ZakatTracker.hide-1642"><span class="linenos">1642</span></a><span class="sd">        - account (str): The account number.</span>
</span><span id="ZakatTracker.hide-1643"><a href="#ZakatTracker.hide-1643"><span class="linenos">1643</span></a><span class="sd">        - status (bool, optional): The new hide status. If not provided, the function will return the current status.</span>
</span><span id="ZakatTracker.hide-1644"><a href="#ZakatTracker.hide-1644"><span class="linenos">1644</span></a>
</span><span id="ZakatTracker.hide-1645"><a href="#ZakatTracker.hide-1645"><span class="linenos">1645</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.hide-1646"><a href="#ZakatTracker.hide-1646"><span class="linenos">1646</span></a><span class="sd">        - bool: The current or updated hide status of the account.</span>
</span><span id="ZakatTracker.hide-1647"><a href="#ZakatTracker.hide-1647"><span class="linenos">1647</span></a>
</span><span id="ZakatTracker.hide-1648"><a href="#ZakatTracker.hide-1648"><span class="linenos">1648</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker.hide-1649"><a href="#ZakatTracker.hide-1649"><span class="linenos">1649</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker.hide-1650"><a href="#ZakatTracker.hide-1650"><span class="linenos">1650</span></a>
</span><span id="ZakatTracker.hide-1651"><a href="#ZakatTracker.hide-1651"><span class="linenos">1651</span></a><span class="sd">        Example:</span>
</span><span id="ZakatTracker.hide-1652"><a href="#ZakatTracker.hide-1652"><span class="linenos">1652</span></a><span class="sd">        &gt;&gt;&gt; tracker = ZakatTracker()</span>
</span><span id="ZakatTracker.hide-1653"><a href="#ZakatTracker.hide-1653"><span class="linenos">1653</span></a><span class="sd">        &gt;&gt;&gt; ref = tracker.track(51, &#39;desc&#39;, &#39;account1&#39;)</span>
</span><span id="ZakatTracker.hide-1654"><a href="#ZakatTracker.hide-1654"><span class="linenos">1654</span></a><span class="sd">        &gt;&gt;&gt; tracker.hide(&#39;account1&#39;)  # Set the hide status of &#39;account1&#39; to True</span>
</span><span id="ZakatTracker.hide-1655"><a href="#ZakatTracker.hide-1655"><span class="linenos">1655</span></a><span class="sd">        False</span>
</span><span id="ZakatTracker.hide-1656"><a href="#ZakatTracker.hide-1656"><span class="linenos">1656</span></a><span class="sd">        &gt;&gt;&gt; tracker.hide(&#39;account1&#39;, True)  # Set the hide status of &#39;account1&#39; to True</span>
</span><span id="ZakatTracker.hide-1657"><a href="#ZakatTracker.hide-1657"><span class="linenos">1657</span></a><span class="sd">        True</span>
</span><span id="ZakatTracker.hide-1658"><a href="#ZakatTracker.hide-1658"><span class="linenos">1658</span></a><span class="sd">        &gt;&gt;&gt; tracker.hide(&#39;account1&#39;)  # Get the hide status of &#39;account1&#39; by default</span>
</span><span id="ZakatTracker.hide-1659"><a href="#ZakatTracker.hide-1659"><span class="linenos">1659</span></a><span class="sd">        True</span>
</span><span id="ZakatTracker.hide-1660"><a href="#ZakatTracker.hide-1660"><span class="linenos">1660</span></a><span class="sd">        &gt;&gt;&gt; tracker.hide(&#39;account1&#39;, False)</span>
</span><span id="ZakatTracker.hide-1661"><a href="#ZakatTracker.hide-1661"><span class="linenos">1661</span></a><span class="sd">        False</span>
</span><span id="ZakatTracker.hide-1662"><a href="#ZakatTracker.hide-1662"><span class="linenos">1662</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.hide-1663"><a href="#ZakatTracker.hide-1663"><span class="linenos">1663</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker.hide-1664"><a href="#ZakatTracker.hide-1664"><span class="linenos">1664</span></a>            <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.hide-1665"><a href="#ZakatTracker.hide-1665"><span class="linenos">1665</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;hide&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.hide-1666"><a href="#ZakatTracker.hide-1666"><span class="linenos">1666</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;hide&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
</span><span id="ZakatTracker.hide-1667"><a href="#ZakatTracker.hide-1667"><span class="linenos">1667</span></a>            <span class="k">return</span> <span class="n">status</span>
</span><span id="ZakatTracker.hide-1668"><a href="#ZakatTracker.hide-1668"><span class="linenos">1668</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Check or set the hide status of a specific account.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number.</li>
<li>status (bool, optional): The new hide status. If not provided, the function will return the current status.</li>
</ul>

<p>Returns:</p>

<ul>
<li>bool: The current or updated hide status of the account.</li>
</ul>

<p>Raises:
None</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ref</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">,</span> <span class="s1">&#39;account1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="s1">&#39;account1&#39;</span><span class="p">)</span>  <span class="c1"># Set the hide status of &#39;account1&#39; to True</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="s1">&#39;account1&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># Set the hide status of &#39;account1&#39; to True</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="s1">&#39;account1&#39;</span><span class="p">)</span>  <span class="c1"># Get the hide status of &#39;account1&#39; by default</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="s1">&#39;account1&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">False</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="ZakatTracker.zakatable" class="classattr">
                                        <input id="ZakatTracker.zakatable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">zakatable</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">account</span>, </span><span class="param"><span class="n">status</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.zakatable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.zakatable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.zakatable-1670"><a href="#ZakatTracker.zakatable-1670"><span class="linenos">1670</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">zakatable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.zakatable-1671"><a href="#ZakatTracker.zakatable-1671"><span class="linenos">1671</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.zakatable-1672"><a href="#ZakatTracker.zakatable-1672"><span class="linenos">1672</span></a><span class="sd">        Check or set the zakatable status of a specific account.</span>
</span><span id="ZakatTracker.zakatable-1673"><a href="#ZakatTracker.zakatable-1673"><span class="linenos">1673</span></a>
</span><span id="ZakatTracker.zakatable-1674"><a href="#ZakatTracker.zakatable-1674"><span class="linenos">1674</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.zakatable-1675"><a href="#ZakatTracker.zakatable-1675"><span class="linenos">1675</span></a><span class="sd">        - account (str): The account number.</span>
</span><span id="ZakatTracker.zakatable-1676"><a href="#ZakatTracker.zakatable-1676"><span class="linenos">1676</span></a><span class="sd">        - status (bool, optional): The new zakatable status. If not provided, the function will return the current status.</span>
</span><span id="ZakatTracker.zakatable-1677"><a href="#ZakatTracker.zakatable-1677"><span class="linenos">1677</span></a>
</span><span id="ZakatTracker.zakatable-1678"><a href="#ZakatTracker.zakatable-1678"><span class="linenos">1678</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.zakatable-1679"><a href="#ZakatTracker.zakatable-1679"><span class="linenos">1679</span></a><span class="sd">        - bool: The current or updated zakatable status of the account.</span>
</span><span id="ZakatTracker.zakatable-1680"><a href="#ZakatTracker.zakatable-1680"><span class="linenos">1680</span></a>
</span><span id="ZakatTracker.zakatable-1681"><a href="#ZakatTracker.zakatable-1681"><span class="linenos">1681</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker.zakatable-1682"><a href="#ZakatTracker.zakatable-1682"><span class="linenos">1682</span></a><span class="sd">        None</span>
</span><span id="ZakatTracker.zakatable-1683"><a href="#ZakatTracker.zakatable-1683"><span class="linenos">1683</span></a>
</span><span id="ZakatTracker.zakatable-1684"><a href="#ZakatTracker.zakatable-1684"><span class="linenos">1684</span></a><span class="sd">        Example:</span>
</span><span id="ZakatTracker.zakatable-1685"><a href="#ZakatTracker.zakatable-1685"><span class="linenos">1685</span></a><span class="sd">        &gt;&gt;&gt; tracker = ZakatTracker()</span>
</span><span id="ZakatTracker.zakatable-1686"><a href="#ZakatTracker.zakatable-1686"><span class="linenos">1686</span></a><span class="sd">        &gt;&gt;&gt; ref = tracker.track(51, &#39;desc&#39;, &#39;account1&#39;)</span>
</span><span id="ZakatTracker.zakatable-1687"><a href="#ZakatTracker.zakatable-1687"><span class="linenos">1687</span></a><span class="sd">        &gt;&gt;&gt; tracker.zakatable(&#39;account1&#39;)  # Set the zakatable status of &#39;account1&#39; to True</span>
</span><span id="ZakatTracker.zakatable-1688"><a href="#ZakatTracker.zakatable-1688"><span class="linenos">1688</span></a><span class="sd">        True</span>
</span><span id="ZakatTracker.zakatable-1689"><a href="#ZakatTracker.zakatable-1689"><span class="linenos">1689</span></a><span class="sd">        &gt;&gt;&gt; tracker.zakatable(&#39;account1&#39;, True)  # Set the zakatable status of &#39;account1&#39; to True</span>
</span><span id="ZakatTracker.zakatable-1690"><a href="#ZakatTracker.zakatable-1690"><span class="linenos">1690</span></a><span class="sd">        True</span>
</span><span id="ZakatTracker.zakatable-1691"><a href="#ZakatTracker.zakatable-1691"><span class="linenos">1691</span></a><span class="sd">        &gt;&gt;&gt; tracker.zakatable(&#39;account1&#39;)  # Get the zakatable status of &#39;account1&#39; by default</span>
</span><span id="ZakatTracker.zakatable-1692"><a href="#ZakatTracker.zakatable-1692"><span class="linenos">1692</span></a><span class="sd">        True</span>
</span><span id="ZakatTracker.zakatable-1693"><a href="#ZakatTracker.zakatable-1693"><span class="linenos">1693</span></a><span class="sd">        &gt;&gt;&gt; tracker.zakatable(&#39;account1&#39;, False)</span>
</span><span id="ZakatTracker.zakatable-1694"><a href="#ZakatTracker.zakatable-1694"><span class="linenos">1694</span></a><span class="sd">        False</span>
</span><span id="ZakatTracker.zakatable-1695"><a href="#ZakatTracker.zakatable-1695"><span class="linenos">1695</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.zakatable-1696"><a href="#ZakatTracker.zakatable-1696"><span class="linenos">1696</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">account_exists</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span><span id="ZakatTracker.zakatable-1697"><a href="#ZakatTracker.zakatable-1697"><span class="linenos">1697</span></a>            <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.zakatable-1698"><a href="#ZakatTracker.zakatable-1698"><span class="linenos">1698</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;zakatable&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.zakatable-1699"><a href="#ZakatTracker.zakatable-1699"><span class="linenos">1699</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;zakatable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
</span><span id="ZakatTracker.zakatable-1700"><a href="#ZakatTracker.zakatable-1700"><span class="linenos">1700</span></a>            <span class="k">return</span> <span class="n">status</span>
</span><span id="ZakatTracker.zakatable-1701"><a href="#ZakatTracker.zakatable-1701"><span class="linenos">1701</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Check or set the zakatable status of a specific account.</p>

<p>Parameters:</p>

<ul>
<li>account (str): The account number.</li>
<li>status (bool, optional): The new zakatable status. If not provided, the function will return the current status.</li>
</ul>

<p>Returns:</p>

<ul>
<li>bool: The current or updated zakatable status of the account.</li>
</ul>

<p>Raises:
None</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ref</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">,</span> <span class="s1">&#39;account1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">zakatable</span><span class="p">(</span><span class="s1">&#39;account1&#39;</span><span class="p">)</span>  <span class="c1"># Set the zakatable status of &#39;account1&#39; to True</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">zakatable</span><span class="p">(</span><span class="s1">&#39;account1&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># Set the zakatable status of &#39;account1&#39; to True</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">zakatable</span><span class="p">(</span><span class="s1">&#39;account1&#39;</span><span class="p">)</span>  <span class="c1"># Get the zakatable status of &#39;account1&#39; by default</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span><span class="o">.</span><span class="n">zakatable</span><span class="p">(</span><span class="s1">&#39;account1&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">False</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="ZakatTracker.sub" class="classattr">
                                        <input id="ZakatTracker.sub-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sub</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">unscaled_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span>,</span><span class="param">	<span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">account</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">created</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">|</span> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.sub-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.sub"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.sub-1703"><a href="#ZakatTracker.sub-1703"><span class="linenos">1703</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unscaled_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">created</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker.sub-1704"><a href="#ZakatTracker.sub-1704"><span class="linenos">1704</span></a>            <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> \
</span><span id="ZakatTracker.sub-1705"><a href="#ZakatTracker.sub-1705"><span class="linenos">1705</span></a>            <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
</span><span id="ZakatTracker.sub-1706"><a href="#ZakatTracker.sub-1706"><span class="linenos">1706</span></a>                   <span class="nb">int</span><span class="p">,</span>
</span><span id="ZakatTracker.sub-1707"><a href="#ZakatTracker.sub-1707"><span class="linenos">1707</span></a>                   <span class="nb">list</span><span class="p">[</span>
</span><span id="ZakatTracker.sub-1708"><a href="#ZakatTracker.sub-1708"><span class="linenos">1708</span></a>                       <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="ZakatTracker.sub-1709"><a href="#ZakatTracker.sub-1709"><span class="linenos">1709</span></a>                   <span class="p">],</span>
</span><span id="ZakatTracker.sub-1710"><a href="#ZakatTracker.sub-1710"><span class="linenos">1710</span></a>               <span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="ZakatTracker.sub-1711"><a href="#ZakatTracker.sub-1711"><span class="linenos">1711</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.sub-1712"><a href="#ZakatTracker.sub-1712"><span class="linenos">1712</span></a><span class="sd">        Subtracts a specified value from an account&#39;s balance.</span>
</span><span id="ZakatTracker.sub-1713"><a href="#ZakatTracker.sub-1713"><span class="linenos">1713</span></a>
</span><span id="ZakatTracker.sub-1714"><a href="#ZakatTracker.sub-1714"><span class="linenos">1714</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.sub-1715"><a href="#ZakatTracker.sub-1715"><span class="linenos">1715</span></a><span class="sd">        - unscaled_value (float | int | decimal.Decimal): The amount to be subtracted.</span>
</span><span id="ZakatTracker.sub-1716"><a href="#ZakatTracker.sub-1716"><span class="linenos">1716</span></a><span class="sd">        - desc (str): A description for the transaction. Defaults to an empty string.</span>
</span><span id="ZakatTracker.sub-1717"><a href="#ZakatTracker.sub-1717"><span class="linenos">1717</span></a><span class="sd">        - account (str): The account from which the value will be subtracted. Defaults to &#39;1&#39;.</span>
</span><span id="ZakatTracker.sub-1718"><a href="#ZakatTracker.sub-1718"><span class="linenos">1718</span></a><span class="sd">        - created (int): The timestamp of the transaction. If not provided, the current timestamp will be used.</span>
</span><span id="ZakatTracker.sub-1719"><a href="#ZakatTracker.sub-1719"><span class="linenos">1719</span></a><span class="sd">        - debug (bool): A flag indicating whether to print debug information. Defaults to False.</span>
</span><span id="ZakatTracker.sub-1720"><a href="#ZakatTracker.sub-1720"><span class="linenos">1720</span></a>
</span><span id="ZakatTracker.sub-1721"><a href="#ZakatTracker.sub-1721"><span class="linenos">1721</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.sub-1722"><a href="#ZakatTracker.sub-1722"><span class="linenos">1722</span></a><span class="sd">        - tuple: A tuple containing the timestamp of the transaction and a list of tuples representing the age of each transaction.</span>
</span><span id="ZakatTracker.sub-1723"><a href="#ZakatTracker.sub-1723"><span class="linenos">1723</span></a>
</span><span id="ZakatTracker.sub-1724"><a href="#ZakatTracker.sub-1724"><span class="linenos">1724</span></a><span class="sd">        If the amount to subtract is greater than the account&#39;s balance,</span>
</span><span id="ZakatTracker.sub-1725"><a href="#ZakatTracker.sub-1725"><span class="linenos">1725</span></a><span class="sd">        the remaining amount will be transferred to a new transaction with a negative value.</span>
</span><span id="ZakatTracker.sub-1726"><a href="#ZakatTracker.sub-1726"><span class="linenos">1726</span></a>
</span><span id="ZakatTracker.sub-1727"><a href="#ZakatTracker.sub-1727"><span class="linenos">1727</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker.sub-1728"><a href="#ZakatTracker.sub-1728"><span class="linenos">1728</span></a><span class="sd">        - ValueError: The created should be greater than zero.</span>
</span><span id="ZakatTracker.sub-1729"><a href="#ZakatTracker.sub-1729"><span class="linenos">1729</span></a><span class="sd">        - ValueError: The box transaction happened again in the same nanosecond time.</span>
</span><span id="ZakatTracker.sub-1730"><a href="#ZakatTracker.sub-1730"><span class="linenos">1730</span></a><span class="sd">        - ValueError: The log transaction happened again in the same nanosecond time.</span>
</span><span id="ZakatTracker.sub-1731"><a href="#ZakatTracker.sub-1731"><span class="linenos">1731</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.sub-1732"><a href="#ZakatTracker.sub-1732"><span class="linenos">1732</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.sub-1733"><a href="#ZakatTracker.sub-1733"><span class="linenos">1733</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.sub-1734"><a href="#ZakatTracker.sub-1734"><span class="linenos">1734</span></a>        <span class="k">if</span> <span class="n">unscaled_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.sub-1735"><a href="#ZakatTracker.sub-1735"><span class="linenos">1735</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>
</span><span id="ZakatTracker.sub-1736"><a href="#ZakatTracker.sub-1736"><span class="linenos">1736</span></a>        <span class="k">if</span> <span class="n">unscaled_value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.sub-1737"><a href="#ZakatTracker.sub-1737"><span class="linenos">1737</span></a>            <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="n">unscaled_value</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</span><span id="ZakatTracker.sub-1738"><a href="#ZakatTracker.sub-1738"><span class="linenos">1738</span></a>            <span class="k">return</span> <span class="n">ref</span><span class="p">,</span> <span class="n">ref</span>
</span><span id="ZakatTracker.sub-1739"><a href="#ZakatTracker.sub-1739"><span class="linenos">1739</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.sub-1740"><a href="#ZakatTracker.sub-1740"><span class="linenos">1740</span></a>            <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker.sub-1741"><a href="#ZakatTracker.sub-1741"><span class="linenos">1741</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.sub-1742"><a href="#ZakatTracker.sub-1742"><span class="linenos">1742</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The created should be greater than zero.&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.sub-1743"><a href="#ZakatTracker.sub-1743"><span class="linenos">1743</span></a>        <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.sub-1744"><a href="#ZakatTracker.sub-1744"><span class="linenos">1744</span></a>        <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker.sub-1745"><a href="#ZakatTracker.sub-1745"><span class="linenos">1745</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</span><span id="ZakatTracker.sub-1746"><a href="#ZakatTracker.sub-1746"><span class="linenos">1746</span></a>        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">unscaled_value</span><span class="p">)</span>
</span><span id="ZakatTracker.sub-1747"><a href="#ZakatTracker.sub-1747"><span class="linenos">1747</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">value</span><span class="o">=-</span><span class="n">value</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">created</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.sub-1748"><a href="#ZakatTracker.sub-1748"><span class="linenos">1748</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ZakatTracker.sub-1749"><a href="#ZakatTracker.sub-1749"><span class="linenos">1749</span></a>        <span class="n">limit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ZakatTracker.sub-1750"><a href="#ZakatTracker.sub-1750"><span class="linenos">1750</span></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="ZakatTracker.sub-1751"><a href="#ZakatTracker.sub-1751"><span class="linenos">1751</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.sub-1752"><a href="#ZakatTracker.sub-1752"><span class="linenos">1752</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ids&#39;</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>
</span><span id="ZakatTracker.sub-1753"><a href="#ZakatTracker.sub-1753"><span class="linenos">1753</span></a>        <span class="n">ages</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker.sub-1754"><a href="#ZakatTracker.sub-1754"><span class="linenos">1754</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ZakatTracker.sub-1755"><a href="#ZakatTracker.sub-1755"><span class="linenos">1755</span></a>            <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.sub-1756"><a href="#ZakatTracker.sub-1756"><span class="linenos">1756</span></a>                <span class="k">break</span>
</span><span id="ZakatTracker.sub-1757"><a href="#ZakatTracker.sub-1757"><span class="linenos">1757</span></a>            <span class="n">j</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="ZakatTracker.sub-1758"><a href="#ZakatTracker.sub-1758"><span class="linenos">1758</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.sub-1759"><a href="#ZakatTracker.sub-1759"><span class="linenos">1759</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
</span><span id="ZakatTracker.sub-1760"><a href="#ZakatTracker.sub-1760"><span class="linenos">1760</span></a>            <span class="n">rest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.sub-1761"><a href="#ZakatTracker.sub-1761"><span class="linenos">1761</span></a>            <span class="k">if</span> <span class="n">rest</span> <span class="o">&gt;=</span> <span class="n">target</span><span class="p">:</span>
</span><span id="ZakatTracker.sub-1762"><a href="#ZakatTracker.sub-1762"><span class="linenos">1762</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">target</span>
</span><span id="ZakatTracker.sub-1763"><a href="#ZakatTracker.sub-1763"><span class="linenos">1763</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">SUB</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
</span><span id="ZakatTracker.sub-1764"><a href="#ZakatTracker.sub-1764"><span class="linenos">1764</span></a>                <span class="n">ages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">j</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
</span><span id="ZakatTracker.sub-1765"><a href="#ZakatTracker.sub-1765"><span class="linenos">1765</span></a>                <span class="n">target</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.sub-1766"><a href="#ZakatTracker.sub-1766"><span class="linenos">1766</span></a>                <span class="k">break</span>
</span><span id="ZakatTracker.sub-1767"><a href="#ZakatTracker.sub-1767"><span class="linenos">1767</span></a>            <span class="k">elif</span> <span class="n">target</span> <span class="o">&gt;</span> <span class="n">rest</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.sub-1768"><a href="#ZakatTracker.sub-1768"><span class="linenos">1768</span></a>                <span class="n">chunk</span> <span class="o">=</span> <span class="n">rest</span>
</span><span id="ZakatTracker.sub-1769"><a href="#ZakatTracker.sub-1769"><span class="linenos">1769</span></a>                <span class="n">target</span> <span class="o">-=</span> <span class="n">chunk</span>
</span><span id="ZakatTracker.sub-1770"><a href="#ZakatTracker.sub-1770"><span class="linenos">1770</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">SUB</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="ZakatTracker.sub-1771"><a href="#ZakatTracker.sub-1771"><span class="linenos">1771</span></a>                <span class="n">ages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">j</span><span class="p">,</span> <span class="n">chunk</span><span class="p">))</span>
</span><span id="ZakatTracker.sub-1772"><a href="#ZakatTracker.sub-1772"><span class="linenos">1772</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.sub-1773"><a href="#ZakatTracker.sub-1773"><span class="linenos">1773</span></a>        <span class="k">if</span> <span class="n">target</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.sub-1774"><a href="#ZakatTracker.sub-1774"><span class="linenos">1774</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span>
</span><span id="ZakatTracker.sub-1775"><a href="#ZakatTracker.sub-1775"><span class="linenos">1775</span></a>                <span class="n">unscaled_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span><span class="o">-</span><span class="n">target</span><span class="p">),</span>
</span><span id="ZakatTracker.sub-1776"><a href="#ZakatTracker.sub-1776"><span class="linenos">1776</span></a>                <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
</span><span id="ZakatTracker.sub-1777"><a href="#ZakatTracker.sub-1777"><span class="linenos">1777</span></a>                <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span>
</span><span id="ZakatTracker.sub-1778"><a href="#ZakatTracker.sub-1778"><span class="linenos">1778</span></a>                <span class="n">logging</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ZakatTracker.sub-1779"><a href="#ZakatTracker.sub-1779"><span class="linenos">1779</span></a>                <span class="n">created</span><span class="o">=</span><span class="n">created</span><span class="p">,</span>
</span><span id="ZakatTracker.sub-1780"><a href="#ZakatTracker.sub-1780"><span class="linenos">1780</span></a>            <span class="p">)</span>
</span><span id="ZakatTracker.sub-1781"><a href="#ZakatTracker.sub-1781"><span class="linenos">1781</span></a>            <span class="n">ages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">created</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
</span><span id="ZakatTracker.sub-1782"><a href="#ZakatTracker.sub-1782"><span class="linenos">1782</span></a>        <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker.sub-1783"><a href="#ZakatTracker.sub-1783"><span class="linenos">1783</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker.sub-1784"><a href="#ZakatTracker.sub-1784"><span class="linenos">1784</span></a>        <span class="k">return</span> <span class="n">created</span><span class="p">,</span> <span class="n">ages</span>
</span></pre></div>


            <div class="docstring"><p>Subtracts a specified value from an account's balance.</p>

<p>Parameters:</p>

<ul>
<li>unscaled_value (float | int | decimal.Decimal): The amount to be subtracted.</li>
<li>desc (str): A description for the transaction. Defaults to an empty string.</li>
<li>account (str): The account from which the value will be subtracted. Defaults to '1'.</li>
<li>created (int): The timestamp of the transaction. If not provided, the current timestamp will be used.</li>
<li>debug (bool): A flag indicating whether to print debug information. Defaults to False.</li>
</ul>

<p>Returns:</p>

<ul>
<li>tuple: A tuple containing the timestamp of the transaction and a list of tuples representing the age of each transaction.</li>
</ul>

<p>If the amount to subtract is greater than the account's balance,
the remaining amount will be transferred to a new transaction with a negative value.</p>

<p>Raises:</p>

<ul>
<li>ValueError: The created should be greater than zero.</li>
<li>ValueError: The box transaction happened again in the same nanosecond time.</li>
<li>ValueError: The log transaction happened again in the same nanosecond time.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.transfer" class="classattr">
                                        <input id="ZakatTracker.transfer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">transfer</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">unscaled_amount</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span>,</span><span class="param">	<span class="n">from_account</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">to_account</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">created</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.transfer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.transfer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.transfer-1786"><a href="#ZakatTracker.transfer-1786"><span class="linenos">1786</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unscaled_amount</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">from_account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.transfer-1787"><a href="#ZakatTracker.transfer-1787"><span class="linenos">1787</span></a>                 <span class="n">created</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker.transfer-1788"><a href="#ZakatTracker.transfer-1788"><span class="linenos">1788</span></a>                 <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="ZakatTracker.transfer-1789"><a href="#ZakatTracker.transfer-1789"><span class="linenos">1789</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.transfer-1790"><a href="#ZakatTracker.transfer-1790"><span class="linenos">1790</span></a><span class="sd">        Transfers a specified value from one account to another.</span>
</span><span id="ZakatTracker.transfer-1791"><a href="#ZakatTracker.transfer-1791"><span class="linenos">1791</span></a>
</span><span id="ZakatTracker.transfer-1792"><a href="#ZakatTracker.transfer-1792"><span class="linenos">1792</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.transfer-1793"><a href="#ZakatTracker.transfer-1793"><span class="linenos">1793</span></a><span class="sd">        - unscaled_amount (float | int | decimal.Decimal): The amount to be transferred.</span>
</span><span id="ZakatTracker.transfer-1794"><a href="#ZakatTracker.transfer-1794"><span class="linenos">1794</span></a><span class="sd">        - from_account (str): The account from which the value will be transferred.</span>
</span><span id="ZakatTracker.transfer-1795"><a href="#ZakatTracker.transfer-1795"><span class="linenos">1795</span></a><span class="sd">        - to_account (str): The account to which the value will be transferred.</span>
</span><span id="ZakatTracker.transfer-1796"><a href="#ZakatTracker.transfer-1796"><span class="linenos">1796</span></a><span class="sd">        - desc (str, optional): A description for the transaction. Defaults to an empty string.</span>
</span><span id="ZakatTracker.transfer-1797"><a href="#ZakatTracker.transfer-1797"><span class="linenos">1797</span></a><span class="sd">        -;created (int, optional): The timestamp of the transaction. If not provided, the current timestamp will be used.</span>
</span><span id="ZakatTracker.transfer-1798"><a href="#ZakatTracker.transfer-1798"><span class="linenos">1798</span></a><span class="sd">        - debug (bool): A flag indicating whether to print debug information. Defaults to False.</span>
</span><span id="ZakatTracker.transfer-1799"><a href="#ZakatTracker.transfer-1799"><span class="linenos">1799</span></a>
</span><span id="ZakatTracker.transfer-1800"><a href="#ZakatTracker.transfer-1800"><span class="linenos">1800</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.transfer-1801"><a href="#ZakatTracker.transfer-1801"><span class="linenos">1801</span></a><span class="sd">        - list[int]: A list of timestamps corresponding to the transactions made during the transfer.</span>
</span><span id="ZakatTracker.transfer-1802"><a href="#ZakatTracker.transfer-1802"><span class="linenos">1802</span></a>
</span><span id="ZakatTracker.transfer-1803"><a href="#ZakatTracker.transfer-1803"><span class="linenos">1803</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker.transfer-1804"><a href="#ZakatTracker.transfer-1804"><span class="linenos">1804</span></a><span class="sd">        - ValueError: Transfer to the same account is forbidden.</span>
</span><span id="ZakatTracker.transfer-1805"><a href="#ZakatTracker.transfer-1805"><span class="linenos">1805</span></a><span class="sd">        - ValueError: The created should be greater than zero.</span>
</span><span id="ZakatTracker.transfer-1806"><a href="#ZakatTracker.transfer-1806"><span class="linenos">1806</span></a><span class="sd">        - ValueError: The box transaction happened again in the same nanosecond time.</span>
</span><span id="ZakatTracker.transfer-1807"><a href="#ZakatTracker.transfer-1807"><span class="linenos">1807</span></a><span class="sd">        - ValueError: The log transaction happened again in the same nanosecond time.</span>
</span><span id="ZakatTracker.transfer-1808"><a href="#ZakatTracker.transfer-1808"><span class="linenos">1808</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.transfer-1809"><a href="#ZakatTracker.transfer-1809"><span class="linenos">1809</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.transfer-1810"><a href="#ZakatTracker.transfer-1810"><span class="linenos">1810</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;transfer&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1811"><a href="#ZakatTracker.transfer-1811"><span class="linenos">1811</span></a>        <span class="k">if</span> <span class="n">from_account</span> <span class="o">==</span> <span class="n">to_account</span><span class="p">:</span>
</span><span id="ZakatTracker.transfer-1812"><a href="#ZakatTracker.transfer-1812"><span class="linenos">1812</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Transfer to the same account is forbidden. </span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1813"><a href="#ZakatTracker.transfer-1813"><span class="linenos">1813</span></a>        <span class="k">if</span> <span class="n">unscaled_amount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.transfer-1814"><a href="#ZakatTracker.transfer-1814"><span class="linenos">1814</span></a>            <span class="k">return</span> <span class="p">[]</span>
</span><span id="ZakatTracker.transfer-1815"><a href="#ZakatTracker.transfer-1815"><span class="linenos">1815</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.transfer-1816"><a href="#ZakatTracker.transfer-1816"><span class="linenos">1816</span></a>            <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker.transfer-1817"><a href="#ZakatTracker.transfer-1817"><span class="linenos">1817</span></a>        <span class="k">if</span> <span class="n">created</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.transfer-1818"><a href="#ZakatTracker.transfer-1818"><span class="linenos">1818</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The created should be greater than zero.&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1819"><a href="#ZakatTracker.transfer-1819"><span class="linenos">1819</span></a>        <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.transfer-1820"><a href="#ZakatTracker.transfer-1820"><span class="linenos">1820</span></a>        <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker.transfer-1821"><a href="#ZakatTracker.transfer-1821"><span class="linenos">1821</span></a>        <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">ages</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">unscaled_amount</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">from_account</span><span class="p">,</span> <span class="n">created</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1822"><a href="#ZakatTracker.transfer-1822"><span class="linenos">1822</span></a>        <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker.transfer-1823"><a href="#ZakatTracker.transfer-1823"><span class="linenos">1823</span></a>        <span class="n">source_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">from_account</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1824"><a href="#ZakatTracker.transfer-1824"><span class="linenos">1824</span></a>        <span class="n">target_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">to_account</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1825"><a href="#ZakatTracker.transfer-1825"><span class="linenos">1825</span></a>
</span><span id="ZakatTracker.transfer-1826"><a href="#ZakatTracker.transfer-1826"><span class="linenos">1826</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.transfer-1827"><a href="#ZakatTracker.transfer-1827"><span class="linenos">1827</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span> <span class="n">ages</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1828"><a href="#ZakatTracker.transfer-1828"><span class="linenos">1828</span></a>
</span><span id="ZakatTracker.transfer-1829"><a href="#ZakatTracker.transfer-1829"><span class="linenos">1829</span></a>        <span class="k">for</span> <span class="n">age</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ages</span><span class="p">:</span>
</span><span id="ZakatTracker.transfer-1830"><a href="#ZakatTracker.transfer-1830"><span class="linenos">1830</span></a>            <span class="n">target_amount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange_calc</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">source_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="n">target_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]))</span>
</span><span id="ZakatTracker.transfer-1831"><a href="#ZakatTracker.transfer-1831"><span class="linenos">1831</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.transfer-1832"><a href="#ZakatTracker.transfer-1832"><span class="linenos">1832</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;target_amount&#39;</span><span class="p">,</span> <span class="n">target_amount</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1833"><a href="#ZakatTracker.transfer-1833"><span class="linenos">1833</span></a>            <span class="c1"># Perform the transfer</span>
</span><span id="ZakatTracker.transfer-1834"><a href="#ZakatTracker.transfer-1834"><span class="linenos">1834</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_exists</span><span class="p">(</span><span class="n">to_account</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
</span><span id="ZakatTracker.transfer-1835"><a href="#ZakatTracker.transfer-1835"><span class="linenos">1835</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.transfer-1836"><a href="#ZakatTracker.transfer-1836"><span class="linenos">1836</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;box_exists&#39;</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1837"><a href="#ZakatTracker.transfer-1837"><span class="linenos">1837</span></a>                <span class="n">capital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">to_account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">age</span><span class="p">][</span><span class="s1">&#39;capital&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.transfer-1838"><a href="#ZakatTracker.transfer-1838"><span class="linenos">1838</span></a>                <span class="n">rest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">to_account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">age</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.transfer-1839"><a href="#ZakatTracker.transfer-1839"><span class="linenos">1839</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.transfer-1840"><a href="#ZakatTracker.transfer-1840"><span class="linenos">1840</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="ZakatTracker.transfer-1841"><a href="#ZakatTracker.transfer-1841"><span class="linenos">1841</span></a>                        <span class="sa">f</span><span class="s2">&quot;Transfer(loop) </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> from `</span><span class="si">{</span><span class="n">from_account</span><span class="si">}</span><span class="s2">` to `</span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s2">` (equivalent to </span><span class="si">{</span><span class="n">target_amount</span><span class="si">}</span><span class="s2"> `</span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s2">`).&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1842"><a href="#ZakatTracker.transfer-1842"><span class="linenos">1842</span></a>                <span class="n">selected_age</span> <span class="o">=</span> <span class="n">age</span>
</span><span id="ZakatTracker.transfer-1843"><a href="#ZakatTracker.transfer-1843"><span class="linenos">1843</span></a>                <span class="k">if</span> <span class="n">rest</span> <span class="o">+</span> <span class="n">target_amount</span> <span class="o">&gt;</span> <span class="n">capital</span><span class="p">:</span>
</span><span id="ZakatTracker.transfer-1844"><a href="#ZakatTracker.transfer-1844"><span class="linenos">1844</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">to_account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">age</span><span class="p">][</span><span class="s1">&#39;capital&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">target_amount</span>
</span><span id="ZakatTracker.transfer-1845"><a href="#ZakatTracker.transfer-1845"><span class="linenos">1845</span></a>                    <span class="n">selected_age</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker.transfer-1846"><a href="#ZakatTracker.transfer-1846"><span class="linenos">1846</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">to_account</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">age</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">target_amount</span>
</span><span id="ZakatTracker.transfer-1847"><a href="#ZakatTracker.transfer-1847"><span class="linenos">1847</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">BOX_TRANSFER</span><span class="p">,</span> <span class="n">to_account</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">selected_age</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">target_amount</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1848"><a href="#ZakatTracker.transfer-1848"><span class="linenos">1848</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">target_amount</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;TRANSFER </span><span class="si">{</span><span class="n">from_account</span><span class="si">}</span><span class="s1"> -&gt; </span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">to_account</span><span class="p">,</span>
</span><span id="ZakatTracker.transfer-1849"><a href="#ZakatTracker.transfer-1849"><span class="linenos">1849</span></a>                              <span class="n">created</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1850"><a href="#ZakatTracker.transfer-1850"><span class="linenos">1850</span></a>                <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">age</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</span><span id="ZakatTracker.transfer-1851"><a href="#ZakatTracker.transfer-1851"><span class="linenos">1851</span></a>                <span class="k">continue</span>
</span><span id="ZakatTracker.transfer-1852"><a href="#ZakatTracker.transfer-1852"><span class="linenos">1852</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.transfer-1853"><a href="#ZakatTracker.transfer-1853"><span class="linenos">1853</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="ZakatTracker.transfer-1854"><a href="#ZakatTracker.transfer-1854"><span class="linenos">1854</span></a>                    <span class="sa">f</span><span class="s2">&quot;Transfer(func) </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> from `</span><span class="si">{</span><span class="n">from_account</span><span class="si">}</span><span class="s2">` to `</span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s2">` (equivalent to </span><span class="si">{</span><span class="n">target_amount</span><span class="si">}</span><span class="s2"> `</span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s2">`).&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1855"><a href="#ZakatTracker.transfer-1855"><span class="linenos">1855</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span>
</span><span id="ZakatTracker.transfer-1856"><a href="#ZakatTracker.transfer-1856"><span class="linenos">1856</span></a>                <span class="n">unscaled_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">target_amount</span><span class="p">)),</span>
</span><span id="ZakatTracker.transfer-1857"><a href="#ZakatTracker.transfer-1857"><span class="linenos">1857</span></a>                <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
</span><span id="ZakatTracker.transfer-1858"><a href="#ZakatTracker.transfer-1858"><span class="linenos">1858</span></a>                <span class="n">account</span><span class="o">=</span><span class="n">to_account</span><span class="p">,</span>
</span><span id="ZakatTracker.transfer-1859"><a href="#ZakatTracker.transfer-1859"><span class="linenos">1859</span></a>                <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ZakatTracker.transfer-1860"><a href="#ZakatTracker.transfer-1860"><span class="linenos">1860</span></a>                <span class="n">created</span><span class="o">=</span><span class="n">age</span><span class="p">,</span>
</span><span id="ZakatTracker.transfer-1861"><a href="#ZakatTracker.transfer-1861"><span class="linenos">1861</span></a>                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="ZakatTracker.transfer-1862"><a href="#ZakatTracker.transfer-1862"><span class="linenos">1862</span></a>            <span class="p">)</span>
</span><span id="ZakatTracker.transfer-1863"><a href="#ZakatTracker.transfer-1863"><span class="linenos">1863</span></a>            <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1864"><a href="#ZakatTracker.transfer-1864"><span class="linenos">1864</span></a>        <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker.transfer-1865"><a href="#ZakatTracker.transfer-1865"><span class="linenos">1865</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker.transfer-1866"><a href="#ZakatTracker.transfer-1866"><span class="linenos">1866</span></a>        <span class="k">return</span> <span class="n">times</span>
</span></pre></div>


            <div class="docstring"><p>Transfers a specified value from one account to another.</p>

<p>Parameters:</p>

<ul>
<li>unscaled_amount (float | int | decimal.Decimal): The amount to be transferred.</li>
<li>from_account (str): The account from which the value will be transferred.</li>
<li>to_account (str): The account to which the value will be transferred.</li>
<li>desc (str, optional): A description for the transaction. Defaults to an empty string.
-;created (int, optional): The timestamp of the transaction. If not provided, the current timestamp will be used.</li>
<li>debug (bool): A flag indicating whether to print debug information. Defaults to False.</li>
</ul>

<p>Returns:</p>

<ul>
<li>list[int]: A list of timestamps corresponding to the transactions made during the transfer.</li>
</ul>

<p>Raises:</p>

<ul>
<li>ValueError: Transfer to the same account is forbidden.</li>
<li>ValueError: The created should be greater than zero.</li>
<li>ValueError: The box transaction happened again in the same nanosecond time.</li>
<li>ValueError: The log transaction happened again in the same nanosecond time.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.check" class="classattr">
                                        <input id="ZakatTracker.check-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">silver_gram_price</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">unscaled_nisab</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">now</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">cycle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.check-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.check"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.check-1868"><a href="#ZakatTracker.check-1868"><span class="linenos">1868</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="ZakatTracker.check-1869"><a href="#ZakatTracker.check-1869"><span class="linenos">1869</span></a>              <span class="n">silver_gram_price</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="ZakatTracker.check-1870"><a href="#ZakatTracker.check-1870"><span class="linenos">1870</span></a>              <span class="n">unscaled_nisab</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker.check-1871"><a href="#ZakatTracker.check-1871"><span class="linenos">1871</span></a>              <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ZakatTracker.check-1872"><a href="#ZakatTracker.check-1872"><span class="linenos">1872</span></a>              <span class="n">now</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ZakatTracker.check-1873"><a href="#ZakatTracker.check-1873"><span class="linenos">1873</span></a>              <span class="n">cycle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1874"><a href="#ZakatTracker.check-1874"><span class="linenos">1874</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.check-1875"><a href="#ZakatTracker.check-1875"><span class="linenos">1875</span></a><span class="sd">        Check the eligibility for Zakat based on the given parameters.</span>
</span><span id="ZakatTracker.check-1876"><a href="#ZakatTracker.check-1876"><span class="linenos">1876</span></a>
</span><span id="ZakatTracker.check-1877"><a href="#ZakatTracker.check-1877"><span class="linenos">1877</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.check-1878"><a href="#ZakatTracker.check-1878"><span class="linenos">1878</span></a><span class="sd">        - silver_gram_price (float): The price of a gram of silver.</span>
</span><span id="ZakatTracker.check-1879"><a href="#ZakatTracker.check-1879"><span class="linenos">1879</span></a><span class="sd">        - unscaled_nisab (float | int | decimal.Decimal): The minimum amount of wealth required for Zakat. If not provided,</span>
</span><span id="ZakatTracker.check-1880"><a href="#ZakatTracker.check-1880"><span class="linenos">1880</span></a><span class="sd">                        it will be calculated based on the silver_gram_price.</span>
</span><span id="ZakatTracker.check-1881"><a href="#ZakatTracker.check-1881"><span class="linenos">1881</span></a><span class="sd">        - debug (bool): Flag to enable debug mode.</span>
</span><span id="ZakatTracker.check-1882"><a href="#ZakatTracker.check-1882"><span class="linenos">1882</span></a><span class="sd">        - now (int): The current timestamp. If not provided, it will be calculated using ZakatTracker.time().</span>
</span><span id="ZakatTracker.check-1883"><a href="#ZakatTracker.check-1883"><span class="linenos">1883</span></a><span class="sd">        - cycle (float): The time cycle for Zakat. If not provided, it will be calculated using ZakatTracker.TimeCycle().</span>
</span><span id="ZakatTracker.check-1884"><a href="#ZakatTracker.check-1884"><span class="linenos">1884</span></a>
</span><span id="ZakatTracker.check-1885"><a href="#ZakatTracker.check-1885"><span class="linenos">1885</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.check-1886"><a href="#ZakatTracker.check-1886"><span class="linenos">1886</span></a><span class="sd">        - tuple: A tuple containing a boolean indicating the eligibility for Zakat, a list of brief statistics,</span>
</span><span id="ZakatTracker.check-1887"><a href="#ZakatTracker.check-1887"><span class="linenos">1887</span></a><span class="sd">        and a dictionary containing the Zakat plan.</span>
</span><span id="ZakatTracker.check-1888"><a href="#ZakatTracker.check-1888"><span class="linenos">1888</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.check-1889"><a href="#ZakatTracker.check-1889"><span class="linenos">1889</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1890"><a href="#ZakatTracker.check-1890"><span class="linenos">1890</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.check-1891"><a href="#ZakatTracker.check-1891"><span class="linenos">1891</span></a>        <span class="k">if</span> <span class="n">now</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1892"><a href="#ZakatTracker.check-1892"><span class="linenos">1892</span></a>            <span class="n">now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker.check-1893"><a href="#ZakatTracker.check-1893"><span class="linenos">1893</span></a>        <span class="k">if</span> <span class="n">cycle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1894"><a href="#ZakatTracker.check-1894"><span class="linenos">1894</span></a>            <span class="n">cycle</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">TimeCycle</span><span class="p">()</span>
</span><span id="ZakatTracker.check-1895"><a href="#ZakatTracker.check-1895"><span class="linenos">1895</span></a>        <span class="k">if</span> <span class="n">unscaled_nisab</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1896"><a href="#ZakatTracker.check-1896"><span class="linenos">1896</span></a>            <span class="n">unscaled_nisab</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">Nisab</span><span class="p">(</span><span class="n">silver_gram_price</span><span class="p">)</span>
</span><span id="ZakatTracker.check-1897"><a href="#ZakatTracker.check-1897"><span class="linenos">1897</span></a>        <span class="n">nisab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">unscaled_nisab</span><span class="p">)</span>
</span><span id="ZakatTracker.check-1898"><a href="#ZakatTracker.check-1898"><span class="linenos">1898</span></a>        <span class="n">plan</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker.check-1899"><a href="#ZakatTracker.check-1899"><span class="linenos">1899</span></a>        <span class="n">below_nisab</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.check-1900"><a href="#ZakatTracker.check-1900"><span class="linenos">1900</span></a>        <span class="n">brief</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="ZakatTracker.check-1901"><a href="#ZakatTracker.check-1901"><span class="linenos">1901</span></a>        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ZakatTracker.check-1902"><a href="#ZakatTracker.check-1902"><span class="linenos">1902</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1903"><a href="#ZakatTracker.check-1903"><span class="linenos">1903</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exchanges&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchanges</span><span class="p">())</span>
</span><span id="ZakatTracker.check-1904"><a href="#ZakatTracker.check-1904"><span class="linenos">1904</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.check-1905"><a href="#ZakatTracker.check-1905"><span class="linenos">1905</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">zakatable</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="ZakatTracker.check-1906"><a href="#ZakatTracker.check-1906"><span class="linenos">1906</span></a>                <span class="k">continue</span>
</span><span id="ZakatTracker.check-1907"><a href="#ZakatTracker.check-1907"><span class="linenos">1907</span></a>            <span class="n">_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.check-1908"><a href="#ZakatTracker.check-1908"><span class="linenos">1908</span></a>            <span class="n">_log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.check-1909"><a href="#ZakatTracker.check-1909"><span class="linenos">1909</span></a>            <span class="n">limit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_box</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ZakatTracker.check-1910"><a href="#ZakatTracker.check-1910"><span class="linenos">1910</span></a>            <span class="n">ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ZakatTracker.check-1911"><a href="#ZakatTracker.check-1911"><span class="linenos">1911</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ZakatTracker.check-1912"><a href="#ZakatTracker.check-1912"><span class="linenos">1912</span></a>                <span class="n">j</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="ZakatTracker.check-1913"><a href="#ZakatTracker.check-1913"><span class="linenos">1913</span></a>                <span class="n">rest</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.check-1914"><a href="#ZakatTracker.check-1914"><span class="linenos">1914</span></a>                <span class="k">if</span> <span class="n">rest</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1915"><a href="#ZakatTracker.check-1915"><span class="linenos">1915</span></a>                    <span class="k">continue</span>
</span><span id="ZakatTracker.check-1916"><a href="#ZakatTracker.check-1916"><span class="linenos">1916</span></a>                <span class="n">exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="ZakatTracker.check-1917"><a href="#ZakatTracker.check-1917"><span class="linenos">1917</span></a>                <span class="n">rest</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">exchange_calc</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ZakatTracker.check-1918"><a href="#ZakatTracker.check-1918"><span class="linenos">1918</span></a>                <span class="n">brief</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rest</span>
</span><span id="ZakatTracker.check-1919"><a href="#ZakatTracker.check-1919"><span class="linenos">1919</span></a>                <span class="n">index</span> <span class="o">=</span> <span class="n">limit</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="ZakatTracker.check-1920"><a href="#ZakatTracker.check-1920"><span class="linenos">1920</span></a>                <span class="n">epoch</span> <span class="o">=</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="n">cycle</span>
</span><span id="ZakatTracker.check-1921"><a href="#ZakatTracker.check-1921"><span class="linenos">1921</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1922"><a href="#ZakatTracker.check-1922"><span class="linenos">1922</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch: </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="ZakatTracker.check-1923"><a href="#ZakatTracker.check-1923"><span class="linenos">1923</span></a>                <span class="k">if</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;last&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1924"><a href="#ZakatTracker.check-1924"><span class="linenos">1924</span></a>                    <span class="n">epoch</span> <span class="o">=</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;last&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">cycle</span>
</span><span id="ZakatTracker.check-1925"><a href="#ZakatTracker.check-1925"><span class="linenos">1925</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1926"><a href="#ZakatTracker.check-1926"><span class="linenos">1926</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch: </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.check-1927"><a href="#ZakatTracker.check-1927"><span class="linenos">1927</span></a>                <span class="n">epoch</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
</span><span id="ZakatTracker.check-1928"><a href="#ZakatTracker.check-1928"><span class="linenos">1928</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1929"><a href="#ZakatTracker.check-1929"><span class="linenos">1929</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch: </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">epoch</span><span class="p">),</span> <span class="n">epoch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span><span id="ZakatTracker.check-1930"><a href="#ZakatTracker.check-1930"><span class="linenos">1930</span></a>                <span class="k">if</span> <span class="n">epoch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1931"><a href="#ZakatTracker.check-1931"><span class="linenos">1931</span></a>                    <span class="k">continue</span>
</span><span id="ZakatTracker.check-1932"><a href="#ZakatTracker.check-1932"><span class="linenos">1932</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1933"><a href="#ZakatTracker.check-1933"><span class="linenos">1933</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Epoch - PASSED&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.check-1934"><a href="#ZakatTracker.check-1934"><span class="linenos">1934</span></a>                <span class="n">brief</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rest</span>
</span><span id="ZakatTracker.check-1935"><a href="#ZakatTracker.check-1935"><span class="linenos">1935</span></a>                <span class="k">if</span> <span class="n">rest</span> <span class="o">&gt;=</span> <span class="n">nisab</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1936"><a href="#ZakatTracker.check-1936"><span class="linenos">1936</span></a>                    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.check-1937"><a href="#ZakatTracker.check-1937"><span class="linenos">1937</span></a>                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epoch</span><span class="p">):</span>
</span><span id="ZakatTracker.check-1938"><a href="#ZakatTracker.check-1938"><span class="linenos">1938</span></a>                        <span class="n">total</span> <span class="o">+=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">ZakatCut</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">total</span><span class="p">))</span>
</span><span id="ZakatTracker.check-1939"><a href="#ZakatTracker.check-1939"><span class="linenos">1939</span></a>                    <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1940"><a href="#ZakatTracker.check-1940"><span class="linenos">1940</span></a>                        <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1941"><a href="#ZakatTracker.check-1941"><span class="linenos">1941</span></a>                            <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker.check-1942"><a href="#ZakatTracker.check-1942"><span class="linenos">1942</span></a>                        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ZakatTracker.check-1943"><a href="#ZakatTracker.check-1943"><span class="linenos">1943</span></a>                        <span class="n">brief</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">total</span>
</span><span id="ZakatTracker.check-1944"><a href="#ZakatTracker.check-1944"><span class="linenos">1944</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker.check-1945"><a href="#ZakatTracker.check-1945"><span class="linenos">1945</span></a>                            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">total</span><span class="p">,</span>
</span><span id="ZakatTracker.check-1946"><a href="#ZakatTracker.check-1946"><span class="linenos">1946</span></a>                            <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">epoch</span><span class="p">,</span>
</span><span id="ZakatTracker.check-1947"><a href="#ZakatTracker.check-1947"><span class="linenos">1947</span></a>                            <span class="s1">&#39;box_time&#39;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span>
</span><span id="ZakatTracker.check-1948"><a href="#ZakatTracker.check-1948"><span class="linenos">1948</span></a>                            <span class="s1">&#39;box_capital&#39;</span><span class="p">:</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;capital&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker.check-1949"><a href="#ZakatTracker.check-1949"><span class="linenos">1949</span></a>                            <span class="s1">&#39;box_rest&#39;</span><span class="p">:</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker.check-1950"><a href="#ZakatTracker.check-1950"><span class="linenos">1950</span></a>                            <span class="s1">&#39;box_last&#39;</span><span class="p">:</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;last&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker.check-1951"><a href="#ZakatTracker.check-1951"><span class="linenos">1951</span></a>                            <span class="s1">&#39;box_total&#39;</span><span class="p">:</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker.check-1952"><a href="#ZakatTracker.check-1952"><span class="linenos">1952</span></a>                            <span class="s1">&#39;box_count&#39;</span><span class="p">:</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker.check-1953"><a href="#ZakatTracker.check-1953"><span class="linenos">1953</span></a>                            <span class="s1">&#39;box_log&#39;</span><span class="p">:</span> <span class="n">_log</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;desc&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker.check-1954"><a href="#ZakatTracker.check-1954"><span class="linenos">1954</span></a>                            <span class="s1">&#39;exchange_rate&#39;</span><span class="p">:</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker.check-1955"><a href="#ZakatTracker.check-1955"><span class="linenos">1955</span></a>                            <span class="s1">&#39;exchange_time&#39;</span><span class="p">:</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker.check-1956"><a href="#ZakatTracker.check-1956"><span class="linenos">1956</span></a>                            <span class="s1">&#39;exchange_desc&#39;</span><span class="p">:</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker.check-1957"><a href="#ZakatTracker.check-1957"><span class="linenos">1957</span></a>                        <span class="p">}</span>
</span><span id="ZakatTracker.check-1958"><a href="#ZakatTracker.check-1958"><span class="linenos">1958</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1959"><a href="#ZakatTracker.check-1959"><span class="linenos">1959</span></a>                    <span class="n">chunk</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">ZakatCut</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rest</span><span class="p">))</span>
</span><span id="ZakatTracker.check-1960"><a href="#ZakatTracker.check-1960"><span class="linenos">1960</span></a>                    <span class="k">if</span> <span class="n">chunk</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1961"><a href="#ZakatTracker.check-1961"><span class="linenos">1961</span></a>                        <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1962"><a href="#ZakatTracker.check-1962"><span class="linenos">1962</span></a>                            <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker.check-1963"><a href="#ZakatTracker.check-1963"><span class="linenos">1963</span></a>                        <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ZakatTracker.check-1964"><a href="#ZakatTracker.check-1964"><span class="linenos">1964</span></a>                            <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker.check-1965"><a href="#ZakatTracker.check-1965"><span class="linenos">1965</span></a>                        <span class="n">below_nisab</span> <span class="o">+=</span> <span class="n">rest</span>
</span><span id="ZakatTracker.check-1966"><a href="#ZakatTracker.check-1966"><span class="linenos">1966</span></a>                        <span class="n">brief</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">chunk</span>
</span><span id="ZakatTracker.check-1967"><a href="#ZakatTracker.check-1967"><span class="linenos">1967</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;below_nisab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span>
</span><span id="ZakatTracker.check-1968"><a href="#ZakatTracker.check-1968"><span class="linenos">1968</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span>
</span><span id="ZakatTracker.check-1969"><a href="#ZakatTracker.check-1969"><span class="linenos">1969</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoch</span>
</span><span id="ZakatTracker.check-1970"><a href="#ZakatTracker.check-1970"><span class="linenos">1970</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
</span><span id="ZakatTracker.check-1971"><a href="#ZakatTracker.check-1971"><span class="linenos">1971</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_capital&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;capital&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.check-1972"><a href="#ZakatTracker.check-1972"><span class="linenos">1972</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_rest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.check-1973"><a href="#ZakatTracker.check-1973"><span class="linenos">1973</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_last&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;last&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.check-1974"><a href="#ZakatTracker.check-1974"><span class="linenos">1974</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.check-1975"><a href="#ZakatTracker.check-1975"><span class="linenos">1975</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_box</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.check-1976"><a href="#ZakatTracker.check-1976"><span class="linenos">1976</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;box_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_log</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.check-1977"><a href="#ZakatTracker.check-1977"><span class="linenos">1977</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;exchange_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.check-1978"><a href="#ZakatTracker.check-1978"><span class="linenos">1978</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;exchange_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.check-1979"><a href="#ZakatTracker.check-1979"><span class="linenos">1979</span></a>                        <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;exchange_desc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.check-1980"><a href="#ZakatTracker.check-1980"><span class="linenos">1980</span></a>        <span class="n">valid</span> <span class="o">=</span> <span class="n">valid</span> <span class="ow">or</span> <span class="n">below_nisab</span> <span class="o">&gt;=</span> <span class="n">nisab</span>
</span><span id="ZakatTracker.check-1981"><a href="#ZakatTracker.check-1981"><span class="linenos">1981</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.check-1982"><a href="#ZakatTracker.check-1982"><span class="linenos">1982</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;below_nisab(</span><span class="si">{</span><span class="n">below_nisab</span><span class="si">}</span><span class="s2">) &gt;= nisab(</span><span class="si">{</span><span class="n">nisab</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.check-1983"><a href="#ZakatTracker.check-1983"><span class="linenos">1983</span></a>        <span class="k">return</span> <span class="n">valid</span><span class="p">,</span> <span class="n">brief</span><span class="p">,</span> <span class="n">plan</span>
</span></pre></div>


            <div class="docstring"><p>Check the eligibility for Zakat based on the given parameters.</p>

<p>Parameters:</p>

<ul>
<li>silver_gram_price (float): The price of a gram of silver.</li>
<li>unscaled_nisab (float | int | decimal.Decimal): The minimum amount of wealth required for Zakat. If not provided,
it will be calculated based on the silver_gram_price.</li>
<li>debug (bool): Flag to enable debug mode.</li>
<li>now (int): The current timestamp. If not provided, it will be calculated using <a href="#ZakatTracker.time">ZakatTracker.time()</a>.</li>
<li>cycle (float): The time cycle for Zakat. If not provided, it will be calculated using <a href="#ZakatTracker.TimeCycle">ZakatTracker.TimeCycle()</a>.</li>
</ul>

<p>Returns:</p>

<ul>
<li>tuple: A tuple containing a boolean indicating the eligibility for Zakat, a list of brief statistics,
and a dictionary containing the Zakat plan.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.build_payment_parts" class="classattr">
                                        <input id="ZakatTracker.build_payment_parts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_payment_parts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">scaled_demand</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">positive_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.build_payment_parts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.build_payment_parts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.build_payment_parts-1985"><a href="#ZakatTracker.build_payment_parts-1985"><span class="linenos">1985</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">build_payment_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scaled_demand</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">positive_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ZakatTracker.build_payment_parts-1986"><a href="#ZakatTracker.build_payment_parts-1986"><span class="linenos">1986</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.build_payment_parts-1987"><a href="#ZakatTracker.build_payment_parts-1987"><span class="linenos">1987</span></a><span class="sd">        Build payment parts for the Zakat distribution.</span>
</span><span id="ZakatTracker.build_payment_parts-1988"><a href="#ZakatTracker.build_payment_parts-1988"><span class="linenos">1988</span></a>
</span><span id="ZakatTracker.build_payment_parts-1989"><a href="#ZakatTracker.build_payment_parts-1989"><span class="linenos">1989</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.build_payment_parts-1990"><a href="#ZakatTracker.build_payment_parts-1990"><span class="linenos">1990</span></a><span class="sd">        - scaled_demand (int): The total demand for payment in local currency.</span>
</span><span id="ZakatTracker.build_payment_parts-1991"><a href="#ZakatTracker.build_payment_parts-1991"><span class="linenos">1991</span></a><span class="sd">        - positive_only (bool): If True, only consider accounts with positive balance. Default is True.</span>
</span><span id="ZakatTracker.build_payment_parts-1992"><a href="#ZakatTracker.build_payment_parts-1992"><span class="linenos">1992</span></a>
</span><span id="ZakatTracker.build_payment_parts-1993"><a href="#ZakatTracker.build_payment_parts-1993"><span class="linenos">1993</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.build_payment_parts-1994"><a href="#ZakatTracker.build_payment_parts-1994"><span class="linenos">1994</span></a><span class="sd">        - dict: A dictionary containing the payment parts for each account. The dictionary has the following structure:</span>
</span><span id="ZakatTracker.build_payment_parts-1995"><a href="#ZakatTracker.build_payment_parts-1995"><span class="linenos">1995</span></a><span class="sd">        {</span>
</span><span id="ZakatTracker.build_payment_parts-1996"><a href="#ZakatTracker.build_payment_parts-1996"><span class="linenos">1996</span></a><span class="sd">            &#39;account&#39;: {</span>
</span><span id="ZakatTracker.build_payment_parts-1997"><a href="#ZakatTracker.build_payment_parts-1997"><span class="linenos">1997</span></a><span class="sd">                &#39;account_id&#39;: {&#39;balance&#39;: float, &#39;rate&#39;: float, &#39;part&#39;: float},</span>
</span><span id="ZakatTracker.build_payment_parts-1998"><a href="#ZakatTracker.build_payment_parts-1998"><span class="linenos">1998</span></a><span class="sd">                ...</span>
</span><span id="ZakatTracker.build_payment_parts-1999"><a href="#ZakatTracker.build_payment_parts-1999"><span class="linenos">1999</span></a><span class="sd">            },</span>
</span><span id="ZakatTracker.build_payment_parts-2000"><a href="#ZakatTracker.build_payment_parts-2000"><span class="linenos">2000</span></a><span class="sd">            &#39;exceed&#39;: bool,</span>
</span><span id="ZakatTracker.build_payment_parts-2001"><a href="#ZakatTracker.build_payment_parts-2001"><span class="linenos">2001</span></a><span class="sd">            &#39;demand&#39;: int,</span>
</span><span id="ZakatTracker.build_payment_parts-2002"><a href="#ZakatTracker.build_payment_parts-2002"><span class="linenos">2002</span></a><span class="sd">            &#39;total&#39;: float,</span>
</span><span id="ZakatTracker.build_payment_parts-2003"><a href="#ZakatTracker.build_payment_parts-2003"><span class="linenos">2003</span></a><span class="sd">        }</span>
</span><span id="ZakatTracker.build_payment_parts-2004"><a href="#ZakatTracker.build_payment_parts-2004"><span class="linenos">2004</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.build_payment_parts-2005"><a href="#ZakatTracker.build_payment_parts-2005"><span class="linenos">2005</span></a>        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.build_payment_parts-2006"><a href="#ZakatTracker.build_payment_parts-2006"><span class="linenos">2006</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker.build_payment_parts-2007"><a href="#ZakatTracker.build_payment_parts-2007"><span class="linenos">2007</span></a>            <span class="s1">&#39;account&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker.build_payment_parts-2008"><a href="#ZakatTracker.build_payment_parts-2008"><span class="linenos">2008</span></a>            <span class="s1">&#39;exceed&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ZakatTracker.build_payment_parts-2009"><a href="#ZakatTracker.build_payment_parts-2009"><span class="linenos">2009</span></a>            <span class="s1">&#39;demand&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">scaled_demand</span><span class="p">)),</span>
</span><span id="ZakatTracker.build_payment_parts-2010"><a href="#ZakatTracker.build_payment_parts-2010"><span class="linenos">2010</span></a>        <span class="p">}</span>
</span><span id="ZakatTracker.build_payment_parts-2011"><a href="#ZakatTracker.build_payment_parts-2011"><span class="linenos">2011</span></a>        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker.build_payment_parts-2012"><a href="#ZakatTracker.build_payment_parts-2012"><span class="linenos">2012</span></a>            <span class="k">if</span> <span class="n">positive_only</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.build_payment_parts-2013"><a href="#ZakatTracker.build_payment_parts-2013"><span class="linenos">2013</span></a>                <span class="k">continue</span>
</span><span id="ZakatTracker.build_payment_parts-2014"><a href="#ZakatTracker.build_payment_parts-2014"><span class="linenos">2014</span></a>            <span class="n">total</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker.build_payment_parts-2015"><a href="#ZakatTracker.build_payment_parts-2015"><span class="linenos">2015</span></a>            <span class="n">exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker.build_payment_parts-2016"><a href="#ZakatTracker.build_payment_parts-2016"><span class="linenos">2016</span></a>            <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;balance&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="s1">&#39;part&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="ZakatTracker.build_payment_parts-2017"><a href="#ZakatTracker.build_payment_parts-2017"><span class="linenos">2017</span></a>        <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span>
</span><span id="ZakatTracker.build_payment_parts-2018"><a href="#ZakatTracker.build_payment_parts-2018"><span class="linenos">2018</span></a>        <span class="k">return</span> <span class="n">parts</span>
</span></pre></div>


            <div class="docstring"><p>Build payment parts for the Zakat distribution.</p>

<p>Parameters:</p>

<ul>
<li>scaled_demand (int): The total demand for payment in local currency.</li>
<li>positive_only (bool): If True, only consider accounts with positive balance. Default is True.</li>
</ul>

<p>Returns:</p>

<ul>
<li>dict: A dictionary containing the payment parts for each account. The dictionary has the following structure:
{
'account': {
    'account_id': {'balance': float, 'rate': float, 'part': float},
    ...
},
'exceed': bool,
'demand': int,
'total': float,
}</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.check_payment_parts" class="classattr">
                                        <input id="ZakatTracker.check_payment_parts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">check_payment_parts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">parts</span><span class="p">:</span> <span class="nb">dict</span>, </span><span class="param"><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.check_payment_parts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.check_payment_parts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.check_payment_parts-2020"><a href="#ZakatTracker.check_payment_parts-2020"><span class="linenos">2020</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.check_payment_parts-2021"><a href="#ZakatTracker.check_payment_parts-2021"><span class="linenos">2021</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_payment_parts</span><span class="p">(</span><span class="n">parts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker.check_payment_parts-2022"><a href="#ZakatTracker.check_payment_parts-2022"><span class="linenos">2022</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.check_payment_parts-2023"><a href="#ZakatTracker.check_payment_parts-2023"><span class="linenos">2023</span></a><span class="sd">        Checks the validity of payment parts.</span>
</span><span id="ZakatTracker.check_payment_parts-2024"><a href="#ZakatTracker.check_payment_parts-2024"><span class="linenos">2024</span></a>
</span><span id="ZakatTracker.check_payment_parts-2025"><a href="#ZakatTracker.check_payment_parts-2025"><span class="linenos">2025</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.check_payment_parts-2026"><a href="#ZakatTracker.check_payment_parts-2026"><span class="linenos">2026</span></a><span class="sd">        - parts (dict): A dictionary containing payment parts information.</span>
</span><span id="ZakatTracker.check_payment_parts-2027"><a href="#ZakatTracker.check_payment_parts-2027"><span class="linenos">2027</span></a><span class="sd">        - debug (bool): Flag to enable debug mode.</span>
</span><span id="ZakatTracker.check_payment_parts-2028"><a href="#ZakatTracker.check_payment_parts-2028"><span class="linenos">2028</span></a>
</span><span id="ZakatTracker.check_payment_parts-2029"><a href="#ZakatTracker.check_payment_parts-2029"><span class="linenos">2029</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.check_payment_parts-2030"><a href="#ZakatTracker.check_payment_parts-2030"><span class="linenos">2030</span></a><span class="sd">        - int: Returns 0 if the payment parts are valid, otherwise returns the error code.</span>
</span><span id="ZakatTracker.check_payment_parts-2031"><a href="#ZakatTracker.check_payment_parts-2031"><span class="linenos">2031</span></a>
</span><span id="ZakatTracker.check_payment_parts-2032"><a href="#ZakatTracker.check_payment_parts-2032"><span class="linenos">2032</span></a><span class="sd">        Error Codes:</span>
</span><span id="ZakatTracker.check_payment_parts-2033"><a href="#ZakatTracker.check_payment_parts-2033"><span class="linenos">2033</span></a><span class="sd">        1: &#39;demand&#39;, &#39;account&#39;, &#39;total&#39;, or &#39;exceed&#39; key is missing in parts.</span>
</span><span id="ZakatTracker.check_payment_parts-2034"><a href="#ZakatTracker.check_payment_parts-2034"><span class="linenos">2034</span></a><span class="sd">        2: &#39;balance&#39;, &#39;rate&#39; or &#39;part&#39; key is missing in parts[&#39;account&#39;][x].</span>
</span><span id="ZakatTracker.check_payment_parts-2035"><a href="#ZakatTracker.check_payment_parts-2035"><span class="linenos">2035</span></a><span class="sd">        3: &#39;part&#39; value in parts[&#39;account&#39;][x] is less than 0.</span>
</span><span id="ZakatTracker.check_payment_parts-2036"><a href="#ZakatTracker.check_payment_parts-2036"><span class="linenos">2036</span></a><span class="sd">        4: If &#39;exceed&#39; is False, &#39;balance&#39; value in parts[&#39;account&#39;][x] is less than or equal to 0.</span>
</span><span id="ZakatTracker.check_payment_parts-2037"><a href="#ZakatTracker.check_payment_parts-2037"><span class="linenos">2037</span></a><span class="sd">        5: If &#39;exceed&#39; is False, &#39;part&#39; value in parts[&#39;account&#39;][x] is greater than &#39;balance&#39; value.</span>
</span><span id="ZakatTracker.check_payment_parts-2038"><a href="#ZakatTracker.check_payment_parts-2038"><span class="linenos">2038</span></a><span class="sd">        6: The sum of &#39;part&#39; values in parts[&#39;account&#39;] does not match with &#39;demand&#39; value.</span>
</span><span id="ZakatTracker.check_payment_parts-2039"><a href="#ZakatTracker.check_payment_parts-2039"><span class="linenos">2039</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.check_payment_parts-2040"><a href="#ZakatTracker.check_payment_parts-2040"><span class="linenos">2040</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.check_payment_parts-2041"><a href="#ZakatTracker.check_payment_parts-2041"><span class="linenos">2041</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_payment_parts&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.check_payment_parts-2042"><a href="#ZakatTracker.check_payment_parts-2042"><span class="linenos">2042</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;demand&#39;</span><span class="p">,</span> <span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="s1">&#39;exceed&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.check_payment_parts-2043"><a href="#ZakatTracker.check_payment_parts-2043"><span class="linenos">2043</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
</span><span id="ZakatTracker.check_payment_parts-2044"><a href="#ZakatTracker.check_payment_parts-2044"><span class="linenos">2044</span></a>                <span class="k">return</span> <span class="mi">1</span>
</span><span id="ZakatTracker.check_payment_parts-2045"><a href="#ZakatTracker.check_payment_parts-2045"><span class="linenos">2045</span></a>        <span class="n">exceed</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;exceed&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.check_payment_parts-2046"><a href="#ZakatTracker.check_payment_parts-2046"><span class="linenos">2046</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.check_payment_parts-2047"><a href="#ZakatTracker.check_payment_parts-2047"><span class="linenos">2047</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;balance&#39;</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">,</span> <span class="s1">&#39;part&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.check_payment_parts-2048"><a href="#ZakatTracker.check_payment_parts-2048"><span class="linenos">2048</span></a>                <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]:</span>
</span><span id="ZakatTracker.check_payment_parts-2049"><a href="#ZakatTracker.check_payment_parts-2049"><span class="linenos">2049</span></a>                    <span class="k">return</span> <span class="mi">2</span>
</span><span id="ZakatTracker.check_payment_parts-2050"><a href="#ZakatTracker.check_payment_parts-2050"><span class="linenos">2050</span></a>                <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;part&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.check_payment_parts-2051"><a href="#ZakatTracker.check_payment_parts-2051"><span class="linenos">2051</span></a>                    <span class="k">return</span> <span class="mi">3</span>
</span><span id="ZakatTracker.check_payment_parts-2052"><a href="#ZakatTracker.check_payment_parts-2052"><span class="linenos">2052</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">exceed</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.check_payment_parts-2053"><a href="#ZakatTracker.check_payment_parts-2053"><span class="linenos">2053</span></a>                    <span class="k">return</span> <span class="mi">4</span>
</span><span id="ZakatTracker.check_payment_parts-2054"><a href="#ZakatTracker.check_payment_parts-2054"><span class="linenos">2054</span></a>        <span class="n">demand</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;demand&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.check_payment_parts-2055"><a href="#ZakatTracker.check_payment_parts-2055"><span class="linenos">2055</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.check_payment_parts-2056"><a href="#ZakatTracker.check_payment_parts-2056"><span class="linenos">2056</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker.check_payment_parts-2057"><a href="#ZakatTracker.check_payment_parts-2057"><span class="linenos">2057</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">exceed</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;balance&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.check_payment_parts-2058"><a href="#ZakatTracker.check_payment_parts-2058"><span class="linenos">2058</span></a>                <span class="k">return</span> <span class="mi">5</span>
</span><span id="ZakatTracker.check_payment_parts-2059"><a href="#ZakatTracker.check_payment_parts-2059"><span class="linenos">2059</span></a>            <span class="n">z</span> <span class="o">+=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">exchange_calc</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ZakatTracker.check_payment_parts-2060"><a href="#ZakatTracker.check_payment_parts-2060"><span class="linenos">2060</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="ZakatTracker.check_payment_parts-2061"><a href="#ZakatTracker.check_payment_parts-2061"><span class="linenos">2061</span></a>        <span class="n">demand</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="ZakatTracker.check_payment_parts-2062"><a href="#ZakatTracker.check_payment_parts-2062"><span class="linenos">2062</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.check_payment_parts-2063"><a href="#ZakatTracker.check_payment_parts-2063"><span class="linenos">2063</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_payment_parts&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;z = </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s1">, demand = </span><span class="si">{</span><span class="n">demand</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.check_payment_parts-2064"><a href="#ZakatTracker.check_payment_parts-2064"><span class="linenos">2064</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_payment_parts&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">demand</span><span class="p">))</span>
</span><span id="ZakatTracker.check_payment_parts-2065"><a href="#ZakatTracker.check_payment_parts-2065"><span class="linenos">2065</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_payment_parts&#39;</span><span class="p">,</span> <span class="n">z</span> <span class="o">!=</span> <span class="n">demand</span><span class="p">)</span>
</span><span id="ZakatTracker.check_payment_parts-2066"><a href="#ZakatTracker.check_payment_parts-2066"><span class="linenos">2066</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_payment_parts&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">demand</span><span class="p">))</span>
</span><span id="ZakatTracker.check_payment_parts-2067"><a href="#ZakatTracker.check_payment_parts-2067"><span class="linenos">2067</span></a>        <span class="k">if</span> <span class="n">z</span> <span class="o">!=</span> <span class="n">demand</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">demand</span><span class="p">):</span>
</span><span id="ZakatTracker.check_payment_parts-2068"><a href="#ZakatTracker.check_payment_parts-2068"><span class="linenos">2068</span></a>            <span class="k">return</span> <span class="mi">6</span>
</span><span id="ZakatTracker.check_payment_parts-2069"><a href="#ZakatTracker.check_payment_parts-2069"><span class="linenos">2069</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>Checks the validity of payment parts.</p>

<p>Parameters:</p>

<ul>
<li>parts (dict): A dictionary containing payment parts information.</li>
<li>debug (bool): Flag to enable debug mode.</li>
</ul>

<p>Returns:</p>

<ul>
<li>int: Returns 0 if the payment parts are valid, otherwise returns the error code.</li>
</ul>

<p>Error Codes:
1: 'demand', 'account', 'total', or 'exceed' key is missing in parts.
2: 'balance', 'rate' or 'part' key is missing in parts['account'][x].
3: 'part' value in parts['account'][x] is less than 0.
4: If 'exceed' is False, 'balance' value in parts['account'][x] is less than or equal to 0.
5: If 'exceed' is False, 'part' value in parts['account'][x] is greater than 'balance' value.
6: The sum of 'part' values in parts['account'] does not match with 'demand' value.</p>
</div>


                            </div>
                            <div id="ZakatTracker.zakat" class="classattr">
                                        <input id="ZakatTracker.zakat-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">zakat</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">report</span><span class="p">:</span> <span class="nb">tuple</span>,</span><span class="param">	<span class="n">parts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.zakat-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.zakat"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.zakat-2071"><a href="#ZakatTracker.zakat-2071"><span class="linenos">2071</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">zakat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">parts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2072"><a href="#ZakatTracker.zakat-2072"><span class="linenos">2072</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.zakat-2073"><a href="#ZakatTracker.zakat-2073"><span class="linenos">2073</span></a><span class="sd">        Perform Zakat calculation based on the given report and optional parts.</span>
</span><span id="ZakatTracker.zakat-2074"><a href="#ZakatTracker.zakat-2074"><span class="linenos">2074</span></a>
</span><span id="ZakatTracker.zakat-2075"><a href="#ZakatTracker.zakat-2075"><span class="linenos">2075</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.zakat-2076"><a href="#ZakatTracker.zakat-2076"><span class="linenos">2076</span></a><span class="sd">        - report (tuple): A tuple containing the validity of the report, the report data, and the zakat plan.</span>
</span><span id="ZakatTracker.zakat-2077"><a href="#ZakatTracker.zakat-2077"><span class="linenos">2077</span></a><span class="sd">        - parts (dict): A dictionary containing the payment parts for the zakat.</span>
</span><span id="ZakatTracker.zakat-2078"><a href="#ZakatTracker.zakat-2078"><span class="linenos">2078</span></a><span class="sd">        - debug (bool): A flag indicating whether to print debug information.</span>
</span><span id="ZakatTracker.zakat-2079"><a href="#ZakatTracker.zakat-2079"><span class="linenos">2079</span></a>
</span><span id="ZakatTracker.zakat-2080"><a href="#ZakatTracker.zakat-2080"><span class="linenos">2080</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.zakat-2081"><a href="#ZakatTracker.zakat-2081"><span class="linenos">2081</span></a><span class="sd">        - bool: True if the zakat calculation is successful, False otherwise.</span>
</span><span id="ZakatTracker.zakat-2082"><a href="#ZakatTracker.zakat-2082"><span class="linenos">2082</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.zakat-2083"><a href="#ZakatTracker.zakat-2083"><span class="linenos">2083</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2084"><a href="#ZakatTracker.zakat-2084"><span class="linenos">2084</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;zakat&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2085"><a href="#ZakatTracker.zakat-2085"><span class="linenos">2085</span></a>        <span class="n">valid</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">plan</span> <span class="o">=</span> <span class="n">report</span>
</span><span id="ZakatTracker.zakat-2086"><a href="#ZakatTracker.zakat-2086"><span class="linenos">2086</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2087"><a href="#ZakatTracker.zakat-2087"><span class="linenos">2087</span></a>            <span class="k">return</span> <span class="n">valid</span>
</span><span id="ZakatTracker.zakat-2088"><a href="#ZakatTracker.zakat-2088"><span class="linenos">2088</span></a>        <span class="n">parts_exist</span> <span class="o">=</span> <span class="n">parts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker.zakat-2089"><a href="#ZakatTracker.zakat-2089"><span class="linenos">2089</span></a>        <span class="k">if</span> <span class="n">parts_exist</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2090"><a href="#ZakatTracker.zakat-2090"><span class="linenos">2090</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_payment_parts</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2091"><a href="#ZakatTracker.zakat-2091"><span class="linenos">2091</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker.zakat-2092"><a href="#ZakatTracker.zakat-2092"><span class="linenos">2092</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2093"><a href="#ZakatTracker.zakat-2093"><span class="linenos">2093</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;######### zakat #######&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2094"><a href="#ZakatTracker.zakat-2094"><span class="linenos">2094</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;parts_exist&#39;</span><span class="p">,</span> <span class="n">parts_exist</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2095"><a href="#ZakatTracker.zakat-2095"><span class="linenos">2095</span></a>        <span class="n">no_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.zakat-2096"><a href="#ZakatTracker.zakat-2096"><span class="linenos">2096</span></a>        <span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker.zakat-2097"><a href="#ZakatTracker.zakat-2097"><span class="linenos">2097</span></a>        <span class="n">report_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker.zakat-2098"><a href="#ZakatTracker.zakat-2098"><span class="linenos">2098</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">][</span><span class="n">report_time</span><span class="p">]</span> <span class="o">=</span> <span class="n">report</span>
</span><span id="ZakatTracker.zakat-2099"><a href="#ZakatTracker.zakat-2099"><span class="linenos">2099</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">REPORT</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">report_time</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2100"><a href="#ZakatTracker.zakat-2100"><span class="linenos">2100</span></a>        <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker.zakat-2101"><a href="#ZakatTracker.zakat-2101"><span class="linenos">2101</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2102"><a href="#ZakatTracker.zakat-2102"><span class="linenos">2102</span></a>            <span class="n">target_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2103"><a href="#ZakatTracker.zakat-2103"><span class="linenos">2103</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2104"><a href="#ZakatTracker.zakat-2104"><span class="linenos">2104</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</span><span id="ZakatTracker.zakat-2105"><a href="#ZakatTracker.zakat-2105"><span class="linenos">2105</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2106"><a href="#ZakatTracker.zakat-2106"><span class="linenos">2106</span></a>                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.zakat-2107"><a href="#ZakatTracker.zakat-2107"><span class="linenos">2107</span></a>            <span class="n">ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ZakatTracker.zakat-2108"><a href="#ZakatTracker.zakat-2108"><span class="linenos">2108</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2109"><a href="#ZakatTracker.zakat-2109"><span class="linenos">2109</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plan[x]&#39;</span><span class="p">,</span> <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</span><span id="ZakatTracker.zakat-2110"><a href="#ZakatTracker.zakat-2110"><span class="linenos">2110</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ZakatTracker.zakat-2111"><a href="#ZakatTracker.zakat-2111"><span class="linenos">2111</span></a>                <span class="n">j</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="ZakatTracker.zakat-2112"><a href="#ZakatTracker.zakat-2112"><span class="linenos">2112</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2113"><a href="#ZakatTracker.zakat-2113"><span class="linenos">2113</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2114"><a href="#ZakatTracker.zakat-2114"><span class="linenos">2114</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">ZAKAT</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;last&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker.zakat-2115"><a href="#ZakatTracker.zakat-2115"><span class="linenos">2115</span></a>                           <span class="n">key</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.zakat-2116"><a href="#ZakatTracker.zakat-2116"><span class="linenos">2116</span></a>                           <span class="n">math_operation</span><span class="o">=</span><span class="n">MathOperation</span><span class="o">.</span><span class="n">EQUAL</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2117"><a href="#ZakatTracker.zakat-2117"><span class="linenos">2117</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;last&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">created</span>
</span><span id="ZakatTracker.zakat-2118"><a href="#ZakatTracker.zakat-2118"><span class="linenos">2118</span></a>                <span class="n">amount</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">exchange_calc</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">target_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]))</span>
</span><span id="ZakatTracker.zakat-2119"><a href="#ZakatTracker.zakat-2119"><span class="linenos">2119</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span>
</span><span id="ZakatTracker.zakat-2120"><a href="#ZakatTracker.zakat-2120"><span class="linenos">2120</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">ZAKAT</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;total&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.zakat-2121"><a href="#ZakatTracker.zakat-2121"><span class="linenos">2121</span></a>                           <span class="n">math_operation</span><span class="o">=</span><span class="n">MathOperation</span><span class="o">.</span><span class="n">ADDITION</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2122"><a href="#ZakatTracker.zakat-2122"><span class="linenos">2122</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.zakat-2123"><a href="#ZakatTracker.zakat-2123"><span class="linenos">2123</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">Action</span><span class="o">.</span><span class="n">ZAKAT</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.zakat-2124"><a href="#ZakatTracker.zakat-2124"><span class="linenos">2124</span></a>                           <span class="n">math_operation</span><span class="o">=</span><span class="n">MathOperation</span><span class="o">.</span><span class="n">ADDITION</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2125"><a href="#ZakatTracker.zakat-2125"><span class="linenos">2125</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts_exist</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2126"><a href="#ZakatTracker.zakat-2126"><span class="linenos">2126</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2127"><a href="#ZakatTracker.zakat-2127"><span class="linenos">2127</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span>
</span><span id="ZakatTracker.zakat-2128"><a href="#ZakatTracker.zakat-2128"><span class="linenos">2128</span></a>                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2129"><a href="#ZakatTracker.zakat-2129"><span class="linenos">2129</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2130"><a href="#ZakatTracker.zakat-2130"><span class="linenos">2130</span></a>                    <span class="c1"># self._step(Action.ZAKAT, account=x, ref=j, value=amount, key=&#39;rest&#39;,</span>
</span><span id="ZakatTracker.zakat-2131"><a href="#ZakatTracker.zakat-2131"><span class="linenos">2131</span></a>                    <span class="c1">#            math_operation=MathOperation.SUBTRACTION)</span>
</span><span id="ZakatTracker.zakat-2132"><a href="#ZakatTracker.zakat-2132"><span class="linenos">2132</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;zakat-زكاة&#39;</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2133"><a href="#ZakatTracker.zakat-2133"><span class="linenos">2133</span></a>        <span class="k">if</span> <span class="n">parts_exist</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2134"><a href="#ZakatTracker.zakat-2134"><span class="linenos">2134</span></a>            <span class="k">for</span> <span class="n">account</span><span class="p">,</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker.zakat-2135"><a href="#ZakatTracker.zakat-2135"><span class="linenos">2135</span></a>                <span class="k">if</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2136"><a href="#ZakatTracker.zakat-2136"><span class="linenos">2136</span></a>                    <span class="k">continue</span>
</span><span id="ZakatTracker.zakat-2137"><a href="#ZakatTracker.zakat-2137"><span class="linenos">2137</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2138"><a href="#ZakatTracker.zakat-2138"><span class="linenos">2138</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;zakat-part&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.zakat-2139"><a href="#ZakatTracker.zakat-2139"><span class="linenos">2139</span></a>                <span class="n">target_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2140"><a href="#ZakatTracker.zakat-2140"><span class="linenos">2140</span></a>                <span class="n">amount</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">exchange_calc</span><span class="p">(</span><span class="n">part</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">],</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="n">target_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.zakat-2141"><a href="#ZakatTracker.zakat-2141"><span class="linenos">2141</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
</span><span id="ZakatTracker.zakat-2142"><a href="#ZakatTracker.zakat-2142"><span class="linenos">2142</span></a>                    <span class="n">unscaled_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">amount</span><span class="p">)),</span>
</span><span id="ZakatTracker.zakat-2143"><a href="#ZakatTracker.zakat-2143"><span class="linenos">2143</span></a>                    <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;zakat-part-دفعة-زكاة&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.zakat-2144"><a href="#ZakatTracker.zakat-2144"><span class="linenos">2144</span></a>                    <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span>
</span><span id="ZakatTracker.zakat-2145"><a href="#ZakatTracker.zakat-2145"><span class="linenos">2145</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="ZakatTracker.zakat-2146"><a href="#ZakatTracker.zakat-2146"><span class="linenos">2146</span></a>                <span class="p">)</span>
</span><span id="ZakatTracker.zakat-2147"><a href="#ZakatTracker.zakat-2147"><span class="linenos">2147</span></a>        <span class="k">if</span> <span class="n">no_lock</span><span class="p">:</span>
</span><span id="ZakatTracker.zakat-2148"><a href="#ZakatTracker.zakat-2148"><span class="linenos">2148</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
</span><span id="ZakatTracker.zakat-2149"><a href="#ZakatTracker.zakat-2149"><span class="linenos">2149</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Perform Zakat calculation based on the given report and optional parts.</p>

<p>Parameters:</p>

<ul>
<li>report (tuple): A tuple containing the validity of the report, the report data, and the zakat plan.</li>
<li>parts (dict): A dictionary containing the payment parts for the zakat.</li>
<li>debug (bool): A flag indicating whether to print debug information.</li>
</ul>

<p>Returns:</p>

<ul>
<li>bool: True if the zakat calculation is successful, False otherwise.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.export_json" class="classattr">
                                        <input id="ZakatTracker.export_json-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">export_json</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;data.json&#39;</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.export_json-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.export_json"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.export_json-2151"><a href="#ZakatTracker.export_json-2151"><span class="linenos">2151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">export_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data.json&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.export_json-2152"><a href="#ZakatTracker.export_json-2152"><span class="linenos">2152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.export_json-2153"><a href="#ZakatTracker.export_json-2153"><span class="linenos">2153</span></a><span class="sd">        Exports the current state of the ZakatTracker object to a JSON file.</span>
</span><span id="ZakatTracker.export_json-2154"><a href="#ZakatTracker.export_json-2154"><span class="linenos">2154</span></a>
</span><span id="ZakatTracker.export_json-2155"><a href="#ZakatTracker.export_json-2155"><span class="linenos">2155</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.export_json-2156"><a href="#ZakatTracker.export_json-2156"><span class="linenos">2156</span></a><span class="sd">        - path (str): The path where the JSON file will be saved. Default is &quot;data.json&quot;.</span>
</span><span id="ZakatTracker.export_json-2157"><a href="#ZakatTracker.export_json-2157"><span class="linenos">2157</span></a>
</span><span id="ZakatTracker.export_json-2158"><a href="#ZakatTracker.export_json-2158"><span class="linenos">2158</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.export_json-2159"><a href="#ZakatTracker.export_json-2159"><span class="linenos">2159</span></a><span class="sd">        - bool: True if the export is successful, False otherwise.</span>
</span><span id="ZakatTracker.export_json-2160"><a href="#ZakatTracker.export_json-2160"><span class="linenos">2160</span></a>
</span><span id="ZakatTracker.export_json-2161"><a href="#ZakatTracker.export_json-2161"><span class="linenos">2161</span></a><span class="sd">        Raises:</span>
</span><span id="ZakatTracker.export_json-2162"><a href="#ZakatTracker.export_json-2162"><span class="linenos">2162</span></a><span class="sd">        No specific exceptions are raised by this method.</span>
</span><span id="ZakatTracker.export_json-2163"><a href="#ZakatTracker.export_json-2163"><span class="linenos">2163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.export_json-2164"><a href="#ZakatTracker.export_json-2164"><span class="linenos">2164</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="ZakatTracker.export_json-2165"><a href="#ZakatTracker.export_json-2165"><span class="linenos">2165</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">JSONEncoder</span><span class="p">)</span>
</span><span id="ZakatTracker.export_json-2166"><a href="#ZakatTracker.export_json-2166"><span class="linenos">2166</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Exports the current state of the ZakatTracker object to a JSON file.</p>

<p>Parameters:</p>

<ul>
<li>path (str): The path where the JSON file will be saved. Default is "data.json".</li>
</ul>

<p>Returns:</p>

<ul>
<li>bool: True if the export is successful, False otherwise.</li>
</ul>

<p>Raises:
No specific exceptions are raised by this method.</p>
</div>


                            </div>
                            <div id="ZakatTracker.save" class="classattr">
                                        <input id="ZakatTracker.save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.save-2168"><a href="#ZakatTracker.save-2168"><span class="linenos">2168</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.save-2169"><a href="#ZakatTracker.save-2169"><span class="linenos">2169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.save-2170"><a href="#ZakatTracker.save-2170"><span class="linenos">2170</span></a><span class="sd">        Saves the ZakatTracker&#39;s current state to a camel file.</span>
</span><span id="ZakatTracker.save-2171"><a href="#ZakatTracker.save-2171"><span class="linenos">2171</span></a>
</span><span id="ZakatTracker.save-2172"><a href="#ZakatTracker.save-2172"><span class="linenos">2172</span></a><span class="sd">        This method serializes the internal data (`_vault`).</span>
</span><span id="ZakatTracker.save-2173"><a href="#ZakatTracker.save-2173"><span class="linenos">2173</span></a>
</span><span id="ZakatTracker.save-2174"><a href="#ZakatTracker.save-2174"><span class="linenos">2174</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.save-2175"><a href="#ZakatTracker.save-2175"><span class="linenos">2175</span></a><span class="sd">        - path (str, optional): File path for saving. Defaults to a predefined location.</span>
</span><span id="ZakatTracker.save-2176"><a href="#ZakatTracker.save-2176"><span class="linenos">2176</span></a>
</span><span id="ZakatTracker.save-2177"><a href="#ZakatTracker.save-2177"><span class="linenos">2177</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.save-2178"><a href="#ZakatTracker.save-2178"><span class="linenos">2178</span></a><span class="sd">        - bool: True if the save operation is successful, False otherwise.</span>
</span><span id="ZakatTracker.save-2179"><a href="#ZakatTracker.save-2179"><span class="linenos">2179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.save-2180"><a href="#ZakatTracker.save-2180"><span class="linenos">2180</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.save-2181"><a href="#ZakatTracker.save-2181"><span class="linenos">2181</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">()</span>
</span><span id="ZakatTracker.save-2182"><a href="#ZakatTracker.save-2182"><span class="linenos">2182</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker.save-2183"><a href="#ZakatTracker.save-2183"><span class="linenos">2183</span></a>            <span class="c1"># first save in tmp file</span>
</span><span id="ZakatTracker.save-2184"><a href="#ZakatTracker.save-2184"><span class="linenos">2184</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">.tmp&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker.save-2185"><a href="#ZakatTracker.save-2185"><span class="linenos">2185</span></a>                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">camel</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">))</span>
</span><span id="ZakatTracker.save-2186"><a href="#ZakatTracker.save-2186"><span class="linenos">2186</span></a>            <span class="c1"># then move tmp file to original location</span>
</span><span id="ZakatTracker.save-2187"><a href="#ZakatTracker.save-2187"><span class="linenos">2187</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">.tmp&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="ZakatTracker.save-2188"><a href="#ZakatTracker.save-2188"><span class="linenos">2188</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker.save-2189"><a href="#ZakatTracker.save-2189"><span class="linenos">2189</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ZakatTracker.save-2190"><a href="#ZakatTracker.save-2190"><span class="linenos">2190</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.save-2191"><a href="#ZakatTracker.save-2191"><span class="linenos">2191</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Saves the ZakatTracker's current state to a camel file.</p>

<p>This method serializes the internal data (<code>_vault</code>).</p>

<p>Parameters:</p>

<ul>
<li>path (str, optional): File path for saving. Defaults to a predefined location.</li>
</ul>

<p>Returns:</p>

<ul>
<li>bool: True if the save operation is successful, False otherwise.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.load" class="classattr">
                                        <input id="ZakatTracker.load-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.load-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.load"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.load-2193"><a href="#ZakatTracker.load-2193"><span class="linenos">2193</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.load-2194"><a href="#ZakatTracker.load-2194"><span class="linenos">2194</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.load-2195"><a href="#ZakatTracker.load-2195"><span class="linenos">2195</span></a><span class="sd">        Load the current state of the ZakatTracker object from a camel file.</span>
</span><span id="ZakatTracker.load-2196"><a href="#ZakatTracker.load-2196"><span class="linenos">2196</span></a>
</span><span id="ZakatTracker.load-2197"><a href="#ZakatTracker.load-2197"><span class="linenos">2197</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.load-2198"><a href="#ZakatTracker.load-2198"><span class="linenos">2198</span></a><span class="sd">        - path (str): The path where the camel file is located. If not provided, it will use the default path.</span>
</span><span id="ZakatTracker.load-2199"><a href="#ZakatTracker.load-2199"><span class="linenos">2199</span></a>
</span><span id="ZakatTracker.load-2200"><a href="#ZakatTracker.load-2200"><span class="linenos">2200</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.load-2201"><a href="#ZakatTracker.load-2201"><span class="linenos">2201</span></a><span class="sd">        - bool: True if the load operation is successful, False otherwise.</span>
</span><span id="ZakatTracker.load-2202"><a href="#ZakatTracker.load-2202"><span class="linenos">2202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.load-2203"><a href="#ZakatTracker.load-2203"><span class="linenos">2203</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.load-2204"><a href="#ZakatTracker.load-2204"><span class="linenos">2204</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">()</span>
</span><span id="ZakatTracker.load-2205"><a href="#ZakatTracker.load-2205"><span class="linenos">2205</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker.load-2206"><a href="#ZakatTracker.load-2206"><span class="linenos">2206</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="ZakatTracker.load-2207"><a href="#ZakatTracker.load-2207"><span class="linenos">2207</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker.load-2208"><a href="#ZakatTracker.load-2208"><span class="linenos">2208</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span> <span class="o">=</span> <span class="n">camel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="ZakatTracker.load-2209"><a href="#ZakatTracker.load-2209"><span class="linenos">2209</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker.load-2210"><a href="#ZakatTracker.load-2210"><span class="linenos">2210</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker.load-2211"><a href="#ZakatTracker.load-2211"><span class="linenos">2211</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.load-2212"><a href="#ZakatTracker.load-2212"><span class="linenos">2212</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="ZakatTracker.load-2213"><a href="#ZakatTracker.load-2213"><span class="linenos">2213</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ZakatTracker.load-2214"><a href="#ZakatTracker.load-2214"><span class="linenos">2214</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.load-2215"><a href="#ZakatTracker.load-2215"><span class="linenos">2215</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Load the current state of the ZakatTracker object from a camel file.</p>

<p>Parameters:</p>

<ul>
<li>path (str): The path where the camel file is located. If not provided, it will use the default path.</li>
</ul>

<p>Returns:</p>

<ul>
<li>bool: True if the load operation is successful, False otherwise.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.import_csv_cache_path" class="classattr">
                                        <input id="ZakatTracker.import_csv_cache_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">import_csv_cache_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ZakatTracker.import_csv_cache_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.import_csv_cache_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.import_csv_cache_path-2217"><a href="#ZakatTracker.import_csv_cache_path-2217"><span class="linenos">2217</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">import_csv_cache_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ZakatTracker.import_csv_cache_path-2218"><a href="#ZakatTracker.import_csv_cache_path-2218"><span class="linenos">2218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.import_csv_cache_path-2219"><a href="#ZakatTracker.import_csv_cache_path-2219"><span class="linenos">2219</span></a><span class="sd">        Generates the cache file path for imported CSV data.</span>
</span><span id="ZakatTracker.import_csv_cache_path-2220"><a href="#ZakatTracker.import_csv_cache_path-2220"><span class="linenos">2220</span></a>
</span><span id="ZakatTracker.import_csv_cache_path-2221"><a href="#ZakatTracker.import_csv_cache_path-2221"><span class="linenos">2221</span></a><span class="sd">        This function constructs the file path where cached data from CSV imports</span>
</span><span id="ZakatTracker.import_csv_cache_path-2222"><a href="#ZakatTracker.import_csv_cache_path-2222"><span class="linenos">2222</span></a><span class="sd">        will be stored. The cache file is a camel file (.camel extension) appended</span>
</span><span id="ZakatTracker.import_csv_cache_path-2223"><a href="#ZakatTracker.import_csv_cache_path-2223"><span class="linenos">2223</span></a><span class="sd">        to the base path of the object.</span>
</span><span id="ZakatTracker.import_csv_cache_path-2224"><a href="#ZakatTracker.import_csv_cache_path-2224"><span class="linenos">2224</span></a>
</span><span id="ZakatTracker.import_csv_cache_path-2225"><a href="#ZakatTracker.import_csv_cache_path-2225"><span class="linenos">2225</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.import_csv_cache_path-2226"><a href="#ZakatTracker.import_csv_cache_path-2226"><span class="linenos">2226</span></a><span class="sd">        - str: The full path to the import CSV cache file.</span>
</span><span id="ZakatTracker.import_csv_cache_path-2227"><a href="#ZakatTracker.import_csv_cache_path-2227"><span class="linenos">2227</span></a>
</span><span id="ZakatTracker.import_csv_cache_path-2228"><a href="#ZakatTracker.import_csv_cache_path-2228"><span class="linenos">2228</span></a><span class="sd">        Example:</span>
</span><span id="ZakatTracker.import_csv_cache_path-2229"><a href="#ZakatTracker.import_csv_cache_path-2229"><span class="linenos">2229</span></a><span class="sd">            &gt;&gt;&gt; obj = ZakatTracker(&#39;/data/reports&#39;)</span>
</span><span id="ZakatTracker.import_csv_cache_path-2230"><a href="#ZakatTracker.import_csv_cache_path-2230"><span class="linenos">2230</span></a><span class="sd">            &gt;&gt;&gt; obj.import_csv_cache_path()</span>
</span><span id="ZakatTracker.import_csv_cache_path-2231"><a href="#ZakatTracker.import_csv_cache_path-2231"><span class="linenos">2231</span></a><span class="sd">            &#39;/data/reports.import_csv.camel&#39;</span>
</span><span id="ZakatTracker.import_csv_cache_path-2232"><a href="#ZakatTracker.import_csv_cache_path-2232"><span class="linenos">2232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.import_csv_cache_path-2233"><a href="#ZakatTracker.import_csv_cache_path-2233"><span class="linenos">2233</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">())</span>
</span><span id="ZakatTracker.import_csv_cache_path-2234"><a href="#ZakatTracker.import_csv_cache_path-2234"><span class="linenos">2234</span></a>        <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span>
</span><span id="ZakatTracker.import_csv_cache_path-2235"><a href="#ZakatTracker.import_csv_cache_path-2235"><span class="linenos">2235</span></a>        <span class="n">ext_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv_cache_path-2236"><a href="#ZakatTracker.import_csv_cache_path-2236"><span class="linenos">2236</span></a>        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
</span><span id="ZakatTracker.import_csv_cache_path-2237"><a href="#ZakatTracker.import_csv_cache_path-2237"><span class="linenos">2237</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="n">ext_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker.import_csv_cache_path-2238"><a href="#ZakatTracker.import_csv_cache_path-2238"><span class="linenos">2238</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;.import_csv.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv_cache_path-2239"><a href="#ZakatTracker.import_csv_cache_path-2239"><span class="linenos">2239</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generates the cache file path for imported CSV data.</p>

<p>This function constructs the file path where cached data from CSV imports
will be stored. The cache file is a camel file (.camel extension) appended
to the base path of the object.</p>

<p>Returns:</p>

<ul>
<li>str: The full path to the import CSV cache file.</li>
</ul>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>obj = ZakatTracker('/data/reports')
      obj.import_csv_cache_path()
          '/data/reports.import_csv.camel'</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="ZakatTracker.import_csv" class="classattr">
                                        <input id="ZakatTracker.import_csv-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">import_csv</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;file.csv&#39;</span>,</span><span class="param">	<span class="n">scale_decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.import_csv-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.import_csv"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.import_csv-2241"><a href="#ZakatTracker.import_csv-2241"><span class="linenos">2241</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">import_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;file.csv&#39;</span><span class="p">,</span> <span class="n">scale_decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2242"><a href="#ZakatTracker.import_csv-2242"><span class="linenos">2242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.import_csv-2243"><a href="#ZakatTracker.import_csv-2243"><span class="linenos">2243</span></a><span class="sd">        The function reads the CSV file, checks for duplicate transactions, and creates the transactions in the system.</span>
</span><span id="ZakatTracker.import_csv-2244"><a href="#ZakatTracker.import_csv-2244"><span class="linenos">2244</span></a>
</span><span id="ZakatTracker.import_csv-2245"><a href="#ZakatTracker.import_csv-2245"><span class="linenos">2245</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.import_csv-2246"><a href="#ZakatTracker.import_csv-2246"><span class="linenos">2246</span></a><span class="sd">        - path (str): The path to the CSV file. Default is &#39;file.csv&#39;.</span>
</span><span id="ZakatTracker.import_csv-2247"><a href="#ZakatTracker.import_csv-2247"><span class="linenos">2247</span></a><span class="sd">        - scale_decimal_places (int): The number of decimal places to scale the value. Default is 0.</span>
</span><span id="ZakatTracker.import_csv-2248"><a href="#ZakatTracker.import_csv-2248"><span class="linenos">2248</span></a><span class="sd">        - debug (bool): A flag indicating whether to print debug information.</span>
</span><span id="ZakatTracker.import_csv-2249"><a href="#ZakatTracker.import_csv-2249"><span class="linenos">2249</span></a>
</span><span id="ZakatTracker.import_csv-2250"><a href="#ZakatTracker.import_csv-2250"><span class="linenos">2250</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.import_csv-2251"><a href="#ZakatTracker.import_csv-2251"><span class="linenos">2251</span></a><span class="sd">        - tuple: A tuple containing the number of transactions created, the number of transactions found in the cache,</span>
</span><span id="ZakatTracker.import_csv-2252"><a href="#ZakatTracker.import_csv-2252"><span class="linenos">2252</span></a><span class="sd">                and a dictionary of bad transactions.</span>
</span><span id="ZakatTracker.import_csv-2253"><a href="#ZakatTracker.import_csv-2253"><span class="linenos">2253</span></a>
</span><span id="ZakatTracker.import_csv-2254"><a href="#ZakatTracker.import_csv-2254"><span class="linenos">2254</span></a><span class="sd">        Notes:</span>
</span><span id="ZakatTracker.import_csv-2255"><a href="#ZakatTracker.import_csv-2255"><span class="linenos">2255</span></a><span class="sd">            * Currency Pair Assumption: This function assumes that the exchange rates stored for each account</span>
</span><span id="ZakatTracker.import_csv-2256"><a href="#ZakatTracker.import_csv-2256"><span class="linenos">2256</span></a><span class="sd">                                        are appropriate for the currency pairs involved in the conversions.</span>
</span><span id="ZakatTracker.import_csv-2257"><a href="#ZakatTracker.import_csv-2257"><span class="linenos">2257</span></a><span class="sd">            * The exchange rate for each account is based on the last encountered transaction rate that is not equal</span>
</span><span id="ZakatTracker.import_csv-2258"><a href="#ZakatTracker.import_csv-2258"><span class="linenos">2258</span></a><span class="sd">                to 1.0 or the previous rate for that account.</span>
</span><span id="ZakatTracker.import_csv-2259"><a href="#ZakatTracker.import_csv-2259"><span class="linenos">2259</span></a><span class="sd">            * Those rates will be merged into the exchange rates main data, and later it will be used for all subsequent</span>
</span><span id="ZakatTracker.import_csv-2260"><a href="#ZakatTracker.import_csv-2260"><span class="linenos">2260</span></a><span class="sd">              transactions of the same account within the whole imported and existing dataset when doing `check` and</span>
</span><span id="ZakatTracker.import_csv-2261"><a href="#ZakatTracker.import_csv-2261"><span class="linenos">2261</span></a><span class="sd">              `zakat` operations.</span>
</span><span id="ZakatTracker.import_csv-2262"><a href="#ZakatTracker.import_csv-2262"><span class="linenos">2262</span></a>
</span><span id="ZakatTracker.import_csv-2263"><a href="#ZakatTracker.import_csv-2263"><span class="linenos">2263</span></a><span class="sd">        Example Usage:</span>
</span><span id="ZakatTracker.import_csv-2264"><a href="#ZakatTracker.import_csv-2264"><span class="linenos">2264</span></a><span class="sd">            The CSV file should have the following format, rate is optional per transaction:</span>
</span><span id="ZakatTracker.import_csv-2265"><a href="#ZakatTracker.import_csv-2265"><span class="linenos">2265</span></a><span class="sd">            account, desc, value, date, rate</span>
</span><span id="ZakatTracker.import_csv-2266"><a href="#ZakatTracker.import_csv-2266"><span class="linenos">2266</span></a><span class="sd">            For example:</span>
</span><span id="ZakatTracker.import_csv-2267"><a href="#ZakatTracker.import_csv-2267"><span class="linenos">2267</span></a><span class="sd">            safe-45, &quot;Some text&quot;, 34872, 1988-06-30 00:00:00, 1</span>
</span><span id="ZakatTracker.import_csv-2268"><a href="#ZakatTracker.import_csv-2268"><span class="linenos">2268</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.import_csv-2269"><a href="#ZakatTracker.import_csv-2269"><span class="linenos">2269</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2270"><a href="#ZakatTracker.import_csv-2270"><span class="linenos">2270</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;import_csv&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2271"><a href="#ZakatTracker.import_csv-2271"><span class="linenos">2271</span></a>        <span class="n">cache</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker.import_csv-2272"><a href="#ZakatTracker.import_csv-2272"><span class="linenos">2272</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2273"><a href="#ZakatTracker.import_csv-2273"><span class="linenos">2273</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">import_csv_cache_path</span><span class="p">(),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2274"><a href="#ZakatTracker.import_csv-2274"><span class="linenos">2274</span></a>                <span class="n">cache</span> <span class="o">=</span> <span class="n">camel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="ZakatTracker.import_csv-2275"><a href="#ZakatTracker.import_csv-2275"><span class="linenos">2275</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2276"><a href="#ZakatTracker.import_csv-2276"><span class="linenos">2276</span></a>            <span class="k">pass</span>
</span><span id="ZakatTracker.import_csv-2277"><a href="#ZakatTracker.import_csv-2277"><span class="linenos">2277</span></a>        <span class="n">date_formats</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ZakatTracker.import_csv-2278"><a href="#ZakatTracker.import_csv-2278"><span class="linenos">2278</span></a>            <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2279"><a href="#ZakatTracker.import_csv-2279"><span class="linenos">2279</span></a>            <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2280"><a href="#ZakatTracker.import_csv-2280"><span class="linenos">2280</span></a>            <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2281"><a href="#ZakatTracker.import_csv-2281"><span class="linenos">2281</span></a>            <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2282"><a href="#ZakatTracker.import_csv-2282"><span class="linenos">2282</span></a>        <span class="p">]</span>
</span><span id="ZakatTracker.import_csv-2283"><a href="#ZakatTracker.import_csv-2283"><span class="linenos">2283</span></a>        <span class="n">created</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">bad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{}</span>
</span><span id="ZakatTracker.import_csv-2284"><a href="#ZakatTracker.import_csv-2284"><span class="linenos">2284</span></a>        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ZakatTracker.import_csv-2285"><a href="#ZakatTracker.import_csv-2285"><span class="linenos">2285</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2286"><a href="#ZakatTracker.import_csv-2286"><span class="linenos">2286</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.import_csv-2287"><a href="#ZakatTracker.import_csv-2287"><span class="linenos">2287</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
</span><span id="ZakatTracker.import_csv-2288"><a href="#ZakatTracker.import_csv-2288"><span class="linenos">2288</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker.import_csv-2289"><a href="#ZakatTracker.import_csv-2289"><span class="linenos">2289</span></a>                <span class="n">hashed</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
</span><span id="ZakatTracker.import_csv-2290"><a href="#ZakatTracker.import_csv-2290"><span class="linenos">2290</span></a>                <span class="k">if</span> <span class="n">hashed</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2291"><a href="#ZakatTracker.import_csv-2291"><span class="linenos">2291</span></a>                    <span class="n">found</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker.import_csv-2292"><a href="#ZakatTracker.import_csv-2292"><span class="linenos">2292</span></a>                    <span class="k">continue</span>
</span><span id="ZakatTracker.import_csv-2293"><a href="#ZakatTracker.import_csv-2293"><span class="linenos">2293</span></a>                <span class="n">account</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ZakatTracker.import_csv-2294"><a href="#ZakatTracker.import_csv-2294"><span class="linenos">2294</span></a>                <span class="n">desc</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker.import_csv-2295"><a href="#ZakatTracker.import_csv-2295"><span class="linenos">2295</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="ZakatTracker.import_csv-2296"><a href="#ZakatTracker.import_csv-2296"><span class="linenos">2296</span></a>                <span class="n">rate</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="ZakatTracker.import_csv-2297"><a href="#ZakatTracker.import_csv-2297"><span class="linenos">2297</span></a>                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">5</span><span class="p">]:</span>  <span class="c1"># Empty list if index is out of range</span>
</span><span id="ZakatTracker.import_csv-2298"><a href="#ZakatTracker.import_csv-2298"><span class="linenos">2298</span></a>                    <span class="n">rate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="ZakatTracker.import_csv-2299"><a href="#ZakatTracker.import_csv-2299"><span class="linenos">2299</span></a>                <span class="n">date</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.import_csv-2300"><a href="#ZakatTracker.import_csv-2300"><span class="linenos">2300</span></a>                <span class="k">for</span> <span class="n">time_format</span> <span class="ow">in</span> <span class="n">date_formats</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2301"><a href="#ZakatTracker.import_csv-2301"><span class="linenos">2301</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2302"><a href="#ZakatTracker.import_csv-2302"><span class="linenos">2302</span></a>                        <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">time_format</span><span class="p">))</span>
</span><span id="ZakatTracker.import_csv-2303"><a href="#ZakatTracker.import_csv-2303"><span class="linenos">2303</span></a>                        <span class="k">break</span>
</span><span id="ZakatTracker.import_csv-2304"><a href="#ZakatTracker.import_csv-2304"><span class="linenos">2304</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2305"><a href="#ZakatTracker.import_csv-2305"><span class="linenos">2305</span></a>                        <span class="k">pass</span>
</span><span id="ZakatTracker.import_csv-2306"><a href="#ZakatTracker.import_csv-2306"><span class="linenos">2306</span></a>                <span class="k">if</span> <span class="n">date</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2307"><a href="#ZakatTracker.import_csv-2307"><span class="linenos">2307</span></a>                    <span class="n">bad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;invalid date&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.import_csv-2308"><a href="#ZakatTracker.import_csv-2308"><span class="linenos">2308</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2309"><a href="#ZakatTracker.import_csv-2309"><span class="linenos">2309</span></a>                    <span class="n">bad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;invalid value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.import_csv-2310"><a href="#ZakatTracker.import_csv-2310"><span class="linenos">2310</span></a>                    <span class="k">continue</span>
</span><span id="ZakatTracker.import_csv-2311"><a href="#ZakatTracker.import_csv-2311"><span class="linenos">2311</span></a>                <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2312"><a href="#ZakatTracker.import_csv-2312"><span class="linenos">2312</span></a>                    <span class="n">data</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker.import_csv-2313"><a href="#ZakatTracker.import_csv-2313"><span class="linenos">2313</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">date</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">hashed</span><span class="p">))</span>
</span><span id="ZakatTracker.import_csv-2314"><a href="#ZakatTracker.import_csv-2314"><span class="linenos">2314</span></a>
</span><span id="ZakatTracker.import_csv-2315"><a href="#ZakatTracker.import_csv-2315"><span class="linenos">2315</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2316"><a href="#ZakatTracker.import_csv-2316"><span class="linenos">2316</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;import_csv&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="ZakatTracker.import_csv-2317"><a href="#ZakatTracker.import_csv-2317"><span class="linenos">2317</span></a>
</span><span id="ZakatTracker.import_csv-2318"><a href="#ZakatTracker.import_csv-2318"><span class="linenos">2318</span></a>        <span class="k">if</span> <span class="n">bad</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2319"><a href="#ZakatTracker.import_csv-2319"><span class="linenos">2319</span></a>            <span class="k">return</span> <span class="n">created</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">bad</span>
</span><span id="ZakatTracker.import_csv-2320"><a href="#ZakatTracker.import_csv-2320"><span class="linenos">2320</span></a>
</span><span id="ZakatTracker.import_csv-2321"><a href="#ZakatTracker.import_csv-2321"><span class="linenos">2321</span></a>        <span class="k">for</span> <span class="n">date</span><span class="p">,</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="ZakatTracker.import_csv-2322"><a href="#ZakatTracker.import_csv-2322"><span class="linenos">2322</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2323"><a href="#ZakatTracker.import_csv-2323"><span class="linenos">2323</span></a>                <span class="n">len_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2324"><a href="#ZakatTracker.import_csv-2324"><span class="linenos">2324</span></a>                <span class="k">if</span> <span class="n">len_rows</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2325"><a href="#ZakatTracker.import_csv-2325"><span class="linenos">2325</span></a>                    <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">unscaled_value</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">hashed</span><span class="p">)</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ZakatTracker.import_csv-2326"><a href="#ZakatTracker.import_csv-2326"><span class="linenos">2326</span></a>                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span>
</span><span id="ZakatTracker.import_csv-2327"><a href="#ZakatTracker.import_csv-2327"><span class="linenos">2327</span></a>                        <span class="n">unscaled_value</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2328"><a href="#ZakatTracker.import_csv-2328"><span class="linenos">2328</span></a>                        <span class="n">decimal_places</span><span class="o">=</span><span class="n">scale_decimal_places</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2329"><a href="#ZakatTracker.import_csv-2329"><span class="linenos">2329</span></a>                    <span class="p">)</span> <span class="k">if</span> <span class="n">scale_decimal_places</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">unscaled_value</span>
</span><span id="ZakatTracker.import_csv-2330"><a href="#ZakatTracker.import_csv-2330"><span class="linenos">2330</span></a>                    <span class="k">if</span> <span class="n">rate</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2331"><a href="#ZakatTracker.import_csv-2331"><span class="linenos">2331</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">rate</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2332"><a href="#ZakatTracker.import_csv-2332"><span class="linenos">2332</span></a>                    <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2333"><a href="#ZakatTracker.import_csv-2333"><span class="linenos">2333</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="n">unscaled_value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2334"><a href="#ZakatTracker.import_csv-2334"><span class="linenos">2334</span></a>                    <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2335"><a href="#ZakatTracker.import_csv-2335"><span class="linenos">2335</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">unscaled_value</span><span class="o">=-</span><span class="n">value</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2336"><a href="#ZakatTracker.import_csv-2336"><span class="linenos">2336</span></a>                    <span class="n">created</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker.import_csv-2337"><a href="#ZakatTracker.import_csv-2337"><span class="linenos">2337</span></a>                    <span class="n">cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashed</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2338"><a href="#ZakatTracker.import_csv-2338"><span class="linenos">2338</span></a>                    <span class="k">continue</span>
</span><span id="ZakatTracker.import_csv-2339"><a href="#ZakatTracker.import_csv-2339"><span class="linenos">2339</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2340"><a href="#ZakatTracker.import_csv-2340"><span class="linenos">2340</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-- Duplicated time detected&#39;</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="s1">&#39;len&#39;</span><span class="p">,</span> <span class="n">len_rows</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2341"><a href="#ZakatTracker.import_csv-2341"><span class="linenos">2341</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2342"><a href="#ZakatTracker.import_csv-2342"><span class="linenos">2342</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2343"><a href="#ZakatTracker.import_csv-2343"><span class="linenos">2343</span></a>                <span class="c1"># If records are found at the same time with different accounts in the same amount</span>
</span><span id="ZakatTracker.import_csv-2344"><a href="#ZakatTracker.import_csv-2344"><span class="linenos">2344</span></a>                <span class="c1"># (one positive and the other negative), this indicates it is a transfer.</span>
</span><span id="ZakatTracker.import_csv-2345"><a href="#ZakatTracker.import_csv-2345"><span class="linenos">2345</span></a>                <span class="k">if</span> <span class="n">len_rows</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2346"><a href="#ZakatTracker.import_csv-2346"><span class="linenos">2346</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;more than two transactions(</span><span class="si">{</span><span class="n">len_rows</span><span class="si">}</span><span class="s1">) at the same time&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2347"><a href="#ZakatTracker.import_csv-2347"><span class="linenos">2347</span></a>                <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">account1</span><span class="p">,</span> <span class="n">desc1</span><span class="p">,</span> <span class="n">unscaled_value1</span><span class="p">,</span> <span class="n">date1</span><span class="p">,</span> <span class="n">rate1</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ZakatTracker.import_csv-2348"><a href="#ZakatTracker.import_csv-2348"><span class="linenos">2348</span></a>                <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">account2</span><span class="p">,</span> <span class="n">desc2</span><span class="p">,</span> <span class="n">unscaled_value2</span><span class="p">,</span> <span class="n">date2</span><span class="p">,</span> <span class="n">rate2</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker.import_csv-2349"><a href="#ZakatTracker.import_csv-2349"><span class="linenos">2349</span></a>                <span class="k">if</span> <span class="n">account1</span> <span class="o">==</span> <span class="n">account2</span> <span class="ow">or</span> <span class="n">desc1</span> <span class="o">!=</span> <span class="n">desc2</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">unscaled_value1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">abs</span><span class="p">(</span>
</span><span id="ZakatTracker.import_csv-2350"><a href="#ZakatTracker.import_csv-2350"><span class="linenos">2350</span></a>                        <span class="n">unscaled_value2</span><span class="p">)</span> <span class="ow">or</span> <span class="n">date1</span> <span class="o">!=</span> <span class="n">date2</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2351"><a href="#ZakatTracker.import_csv-2351"><span class="linenos">2351</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;invalid transfer&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2352"><a href="#ZakatTracker.import_csv-2352"><span class="linenos">2352</span></a>                <span class="k">if</span> <span class="n">rate1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2353"><a href="#ZakatTracker.import_csv-2353"><span class="linenos">2353</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account1</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">date1</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">rate1</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2354"><a href="#ZakatTracker.import_csv-2354"><span class="linenos">2354</span></a>                <span class="k">if</span> <span class="n">rate2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2355"><a href="#ZakatTracker.import_csv-2355"><span class="linenos">2355</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account2</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">date2</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">rate2</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2356"><a href="#ZakatTracker.import_csv-2356"><span class="linenos">2356</span></a>                <span class="n">value1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span>
</span><span id="ZakatTracker.import_csv-2357"><a href="#ZakatTracker.import_csv-2357"><span class="linenos">2357</span></a>                    <span class="n">unscaled_value1</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2358"><a href="#ZakatTracker.import_csv-2358"><span class="linenos">2358</span></a>                    <span class="n">decimal_places</span><span class="o">=</span><span class="n">scale_decimal_places</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2359"><a href="#ZakatTracker.import_csv-2359"><span class="linenos">2359</span></a>                <span class="p">)</span> <span class="k">if</span> <span class="n">scale_decimal_places</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">unscaled_value1</span>
</span><span id="ZakatTracker.import_csv-2360"><a href="#ZakatTracker.import_csv-2360"><span class="linenos">2360</span></a>                <span class="n">value2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span>
</span><span id="ZakatTracker.import_csv-2361"><a href="#ZakatTracker.import_csv-2361"><span class="linenos">2361</span></a>                    <span class="n">unscaled_value2</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2362"><a href="#ZakatTracker.import_csv-2362"><span class="linenos">2362</span></a>                    <span class="n">decimal_places</span><span class="o">=</span><span class="n">scale_decimal_places</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2363"><a href="#ZakatTracker.import_csv-2363"><span class="linenos">2363</span></a>                <span class="p">)</span> <span class="k">if</span> <span class="n">scale_decimal_places</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">unscaled_value2</span>
</span><span id="ZakatTracker.import_csv-2364"><a href="#ZakatTracker.import_csv-2364"><span class="linenos">2364</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker.import_csv-2365"><a href="#ZakatTracker.import_csv-2365"><span class="linenos">2365</span></a>                    <span class="n">value1</span><span class="p">:</span> <span class="n">account1</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2366"><a href="#ZakatTracker.import_csv-2366"><span class="linenos">2366</span></a>                    <span class="n">value2</span><span class="p">:</span> <span class="n">account2</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2367"><a href="#ZakatTracker.import_csv-2367"><span class="linenos">2367</span></a>                <span class="p">}</span>
</span><span id="ZakatTracker.import_csv-2368"><a href="#ZakatTracker.import_csv-2368"><span class="linenos">2368</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span>
</span><span id="ZakatTracker.import_csv-2369"><a href="#ZakatTracker.import_csv-2369"><span class="linenos">2369</span></a>                    <span class="n">unscaled_amount</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">value1</span><span class="p">),</span>
</span><span id="ZakatTracker.import_csv-2370"><a href="#ZakatTracker.import_csv-2370"><span class="linenos">2370</span></a>                    <span class="n">from_account</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
</span><span id="ZakatTracker.import_csv-2371"><a href="#ZakatTracker.import_csv-2371"><span class="linenos">2371</span></a>                    <span class="n">to_account</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
</span><span id="ZakatTracker.import_csv-2372"><a href="#ZakatTracker.import_csv-2372"><span class="linenos">2372</span></a>                    <span class="n">desc</span><span class="o">=</span><span class="n">desc1</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2373"><a href="#ZakatTracker.import_csv-2373"><span class="linenos">2373</span></a>                    <span class="n">created</span><span class="o">=</span><span class="n">date1</span><span class="p">,</span>
</span><span id="ZakatTracker.import_csv-2374"><a href="#ZakatTracker.import_csv-2374"><span class="linenos">2374</span></a>                <span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2375"><a href="#ZakatTracker.import_csv-2375"><span class="linenos">2375</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2376"><a href="#ZakatTracker.import_csv-2376"><span class="linenos">2376</span></a>                <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2377"><a href="#ZakatTracker.import_csv-2377"><span class="linenos">2377</span></a>                    <span class="n">bad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="ZakatTracker.import_csv-2378"><a href="#ZakatTracker.import_csv-2378"><span class="linenos">2378</span></a>                <span class="k">break</span>
</span><span id="ZakatTracker.import_csv-2379"><a href="#ZakatTracker.import_csv-2379"><span class="linenos">2379</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">import_csv_cache_path</span><span class="p">(),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="ZakatTracker.import_csv-2380"><a href="#ZakatTracker.import_csv-2380"><span class="linenos">2380</span></a>            <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">camel</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cache</span><span class="p">))</span>
</span><span id="ZakatTracker.import_csv-2381"><a href="#ZakatTracker.import_csv-2381"><span class="linenos">2381</span></a>        <span class="k">return</span> <span class="n">created</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">bad</span>
</span></pre></div>


            <div class="docstring"><p>The function reads the CSV file, checks for duplicate transactions, and creates the transactions in the system.</p>

<p>Parameters:</p>

<ul>
<li>path (str): The path to the CSV file. Default is 'file.csv'.</li>
<li>scale_decimal_places (int): The number of decimal places to scale the value. Default is 0.</li>
<li>debug (bool): A flag indicating whether to print debug information.</li>
</ul>

<p>Returns:</p>

<ul>
<li>tuple: A tuple containing the number of transactions created, the number of transactions found in the cache,
and a dictionary of bad transactions.</li>
</ul>

<p>Notes:
    * Currency Pair Assumption: This function assumes that the exchange rates stored for each account
                                are appropriate for the currency pairs involved in the conversions.
    * The exchange rate for each account is based on the last encountered transaction rate that is not equal
        to 1.0 or the previous rate for that account.
    * Those rates will be merged into the exchange rates main data, and later it will be used for all subsequent
      transactions of the same account within the whole imported and existing dataset when doing <code><a href="#ZakatTracker.check">check</a></code> and
      <code><a href="#ZakatTracker.zakat">zakat</a></code> operations.</p>

<p>Example Usage:
    The CSV file should have the following format, rate is optional per transaction:
    account, desc, value, date, rate
    For example:
    safe-45, "Some text", 34872, 1988-06-30 00:00:00, 1</p>
</div>


                            </div>
                            <div id="ZakatTracker.human_readable_size" class="classattr">
                                        <input id="ZakatTracker.human_readable_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">human_readable_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">size</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.human_readable_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.human_readable_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.human_readable_size-2387"><a href="#ZakatTracker.human_readable_size-2387"><span class="linenos">2387</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.human_readable_size-2388"><a href="#ZakatTracker.human_readable_size-2388"><span class="linenos">2388</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">human_readable_size</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ZakatTracker.human_readable_size-2389"><a href="#ZakatTracker.human_readable_size-2389"><span class="linenos">2389</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.human_readable_size-2390"><a href="#ZakatTracker.human_readable_size-2390"><span class="linenos">2390</span></a><span class="sd">        Converts a size in bytes to a human-readable format (e.g., KB, MB, GB).</span>
</span><span id="ZakatTracker.human_readable_size-2391"><a href="#ZakatTracker.human_readable_size-2391"><span class="linenos">2391</span></a>
</span><span id="ZakatTracker.human_readable_size-2392"><a href="#ZakatTracker.human_readable_size-2392"><span class="linenos">2392</span></a><span class="sd">        This function iterates through progressively larger units of information</span>
</span><span id="ZakatTracker.human_readable_size-2393"><a href="#ZakatTracker.human_readable_size-2393"><span class="linenos">2393</span></a><span class="sd">        (B, KB, MB, GB, etc.) and divides the input size until it fits within a</span>
</span><span id="ZakatTracker.human_readable_size-2394"><a href="#ZakatTracker.human_readable_size-2394"><span class="linenos">2394</span></a><span class="sd">        range that can be expressed with a reasonable number before the unit.</span>
</span><span id="ZakatTracker.human_readable_size-2395"><a href="#ZakatTracker.human_readable_size-2395"><span class="linenos">2395</span></a>
</span><span id="ZakatTracker.human_readable_size-2396"><a href="#ZakatTracker.human_readable_size-2396"><span class="linenos">2396</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.human_readable_size-2397"><a href="#ZakatTracker.human_readable_size-2397"><span class="linenos">2397</span></a><span class="sd">        - size (float): The size in bytes to convert.</span>
</span><span id="ZakatTracker.human_readable_size-2398"><a href="#ZakatTracker.human_readable_size-2398"><span class="linenos">2398</span></a><span class="sd">        - decimal_places (int, optional): The number of decimal places to display</span>
</span><span id="ZakatTracker.human_readable_size-2399"><a href="#ZakatTracker.human_readable_size-2399"><span class="linenos">2399</span></a><span class="sd">            in the result. Defaults to 2.</span>
</span><span id="ZakatTracker.human_readable_size-2400"><a href="#ZakatTracker.human_readable_size-2400"><span class="linenos">2400</span></a>
</span><span id="ZakatTracker.human_readable_size-2401"><a href="#ZakatTracker.human_readable_size-2401"><span class="linenos">2401</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.human_readable_size-2402"><a href="#ZakatTracker.human_readable_size-2402"><span class="linenos">2402</span></a><span class="sd">        - str: A string representation of the size in a human-readable format,</span>
</span><span id="ZakatTracker.human_readable_size-2403"><a href="#ZakatTracker.human_readable_size-2403"><span class="linenos">2403</span></a><span class="sd">            rounded to the specified number of decimal places. For example:</span>
</span><span id="ZakatTracker.human_readable_size-2404"><a href="#ZakatTracker.human_readable_size-2404"><span class="linenos">2404</span></a><span class="sd">                - &quot;1.50 KB&quot; (1536 bytes)</span>
</span><span id="ZakatTracker.human_readable_size-2405"><a href="#ZakatTracker.human_readable_size-2405"><span class="linenos">2405</span></a><span class="sd">                - &quot;23.00 MB&quot; (24117248 bytes)</span>
</span><span id="ZakatTracker.human_readable_size-2406"><a href="#ZakatTracker.human_readable_size-2406"><span class="linenos">2406</span></a><span class="sd">                - &quot;1.23 GB&quot; (1325899906 bytes)</span>
</span><span id="ZakatTracker.human_readable_size-2407"><a href="#ZakatTracker.human_readable_size-2407"><span class="linenos">2407</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.human_readable_size-2408"><a href="#ZakatTracker.human_readable_size-2408"><span class="linenos">2408</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="ZakatTracker.human_readable_size-2409"><a href="#ZakatTracker.human_readable_size-2409"><span class="linenos">2409</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;size must be a float or integer&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.human_readable_size-2410"><a href="#ZakatTracker.human_readable_size-2410"><span class="linenos">2410</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">decimal_places</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker.human_readable_size-2411"><a href="#ZakatTracker.human_readable_size-2411"><span class="linenos">2411</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;decimal_places must be an integer&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.human_readable_size-2412"><a href="#ZakatTracker.human_readable_size-2412"><span class="linenos">2412</span></a>        <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;KB&#39;</span><span class="p">,</span> <span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="s1">&#39;GB&#39;</span><span class="p">,</span> <span class="s1">&#39;TB&#39;</span><span class="p">,</span> <span class="s1">&#39;PB&#39;</span><span class="p">,</span> <span class="s1">&#39;EB&#39;</span><span class="p">,</span> <span class="s1">&#39;ZB&#39;</span><span class="p">,</span> <span class="s1">&#39;YB&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.human_readable_size-2413"><a href="#ZakatTracker.human_readable_size-2413"><span class="linenos">2413</span></a>            <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mf">1024.0</span><span class="p">:</span>
</span><span id="ZakatTracker.human_readable_size-2414"><a href="#ZakatTracker.human_readable_size-2414"><span class="linenos">2414</span></a>                <span class="k">break</span>
</span><span id="ZakatTracker.human_readable_size-2415"><a href="#ZakatTracker.human_readable_size-2415"><span class="linenos">2415</span></a>            <span class="n">size</span> <span class="o">/=</span> <span class="mf">1024.0</span>
</span><span id="ZakatTracker.human_readable_size-2416"><a href="#ZakatTracker.human_readable_size-2416"><span class="linenos">2416</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">decimal_places</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Converts a size in bytes to a human-readable format (e.g., KB, MB, GB).</p>

<p>This function iterates through progressively larger units of information
(B, KB, MB, GB, etc.) and divides the input size until it fits within a
range that can be expressed with a reasonable number before the unit.</p>

<p>Parameters:</p>

<ul>
<li>size (float): The size in bytes to convert.</li>
<li>decimal_places (int, optional): The number of decimal places to display
in the result. Defaults to 2.</li>
</ul>

<p>Returns:</p>

<ul>
<li>str: A string representation of the size in a human-readable format,
rounded to the specified number of decimal places. For example:
    - "1.50 KB" (1536 bytes)
    - "23.00 MB" (24117248 bytes)
    - "1.23 GB" (1325899906 bytes)</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.get_dict_size" class="classattr">
                                        <input id="ZakatTracker.get_dict_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_dict_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obj</span><span class="p">:</span> <span class="nb">dict</span>, </span><span class="param"><span class="n">seen</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.get_dict_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.get_dict_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.get_dict_size-2418"><a href="#ZakatTracker.get_dict_size-2418"><span class="linenos">2418</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.get_dict_size-2419"><a href="#ZakatTracker.get_dict_size-2419"><span class="linenos">2419</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_dict_size</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">seen</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ZakatTracker.get_dict_size-2420"><a href="#ZakatTracker.get_dict_size-2420"><span class="linenos">2420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.get_dict_size-2421"><a href="#ZakatTracker.get_dict_size-2421"><span class="linenos">2421</span></a><span class="sd">        Recursively calculates the approximate memory size of a dictionary and its contents in bytes.</span>
</span><span id="ZakatTracker.get_dict_size-2422"><a href="#ZakatTracker.get_dict_size-2422"><span class="linenos">2422</span></a>
</span><span id="ZakatTracker.get_dict_size-2423"><a href="#ZakatTracker.get_dict_size-2423"><span class="linenos">2423</span></a><span class="sd">        This function traverses the dictionary structure, accounting for the size of keys, values,</span>
</span><span id="ZakatTracker.get_dict_size-2424"><a href="#ZakatTracker.get_dict_size-2424"><span class="linenos">2424</span></a><span class="sd">        and any nested objects. It handles various data types commonly found in dictionaries</span>
</span><span id="ZakatTracker.get_dict_size-2425"><a href="#ZakatTracker.get_dict_size-2425"><span class="linenos">2425</span></a><span class="sd">        (e.g., lists, tuples, sets, numbers, strings) and prevents infinite recursion in case</span>
</span><span id="ZakatTracker.get_dict_size-2426"><a href="#ZakatTracker.get_dict_size-2426"><span class="linenos">2426</span></a><span class="sd">        of circular references.</span>
</span><span id="ZakatTracker.get_dict_size-2427"><a href="#ZakatTracker.get_dict_size-2427"><span class="linenos">2427</span></a>
</span><span id="ZakatTracker.get_dict_size-2428"><a href="#ZakatTracker.get_dict_size-2428"><span class="linenos">2428</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.get_dict_size-2429"><a href="#ZakatTracker.get_dict_size-2429"><span class="linenos">2429</span></a><span class="sd">        - obj (dict): The dictionary whose size is to be calculated.</span>
</span><span id="ZakatTracker.get_dict_size-2430"><a href="#ZakatTracker.get_dict_size-2430"><span class="linenos">2430</span></a><span class="sd">        - seen (set, optional): A set used internally to track visited objects</span>
</span><span id="ZakatTracker.get_dict_size-2431"><a href="#ZakatTracker.get_dict_size-2431"><span class="linenos">2431</span></a><span class="sd">                             and avoid circular references. Defaults to None.</span>
</span><span id="ZakatTracker.get_dict_size-2432"><a href="#ZakatTracker.get_dict_size-2432"><span class="linenos">2432</span></a>
</span><span id="ZakatTracker.get_dict_size-2433"><a href="#ZakatTracker.get_dict_size-2433"><span class="linenos">2433</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.get_dict_size-2434"><a href="#ZakatTracker.get_dict_size-2434"><span class="linenos">2434</span></a><span class="sd">         - float: An approximate size of the dictionary and its contents in bytes.</span>
</span><span id="ZakatTracker.get_dict_size-2435"><a href="#ZakatTracker.get_dict_size-2435"><span class="linenos">2435</span></a>
</span><span id="ZakatTracker.get_dict_size-2436"><a href="#ZakatTracker.get_dict_size-2436"><span class="linenos">2436</span></a><span class="sd">        Note:</span>
</span><span id="ZakatTracker.get_dict_size-2437"><a href="#ZakatTracker.get_dict_size-2437"><span class="linenos">2437</span></a><span class="sd">        - This function is a method of the `ZakatTracker` class and is likely used to</span>
</span><span id="ZakatTracker.get_dict_size-2438"><a href="#ZakatTracker.get_dict_size-2438"><span class="linenos">2438</span></a><span class="sd">          estimate the memory footprint of data structures relevant to Zakat calculations.</span>
</span><span id="ZakatTracker.get_dict_size-2439"><a href="#ZakatTracker.get_dict_size-2439"><span class="linenos">2439</span></a><span class="sd">        - The size calculation is approximate as it relies on `sys.getsizeof()`, which might</span>
</span><span id="ZakatTracker.get_dict_size-2440"><a href="#ZakatTracker.get_dict_size-2440"><span class="linenos">2440</span></a><span class="sd">          not account for all memory overhead depending on the Python implementation.</span>
</span><span id="ZakatTracker.get_dict_size-2441"><a href="#ZakatTracker.get_dict_size-2441"><span class="linenos">2441</span></a><span class="sd">        - Circular references are handled to prevent infinite recursion.</span>
</span><span id="ZakatTracker.get_dict_size-2442"><a href="#ZakatTracker.get_dict_size-2442"><span class="linenos">2442</span></a><span class="sd">        - Basic numeric types (int, float, complex) are assumed to have fixed sizes.</span>
</span><span id="ZakatTracker.get_dict_size-2443"><a href="#ZakatTracker.get_dict_size-2443"><span class="linenos">2443</span></a><span class="sd">        - String sizes are estimated based on character length and encoding.</span>
</span><span id="ZakatTracker.get_dict_size-2444"><a href="#ZakatTracker.get_dict_size-2444"><span class="linenos">2444</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.get_dict_size-2445"><a href="#ZakatTracker.get_dict_size-2445"><span class="linenos">2445</span></a>        <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.get_dict_size-2446"><a href="#ZakatTracker.get_dict_size-2446"><span class="linenos">2446</span></a>        <span class="k">if</span> <span class="n">seen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ZakatTracker.get_dict_size-2447"><a href="#ZakatTracker.get_dict_size-2447"><span class="linenos">2447</span></a>            <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ZakatTracker.get_dict_size-2448"><a href="#ZakatTracker.get_dict_size-2448"><span class="linenos">2448</span></a>
</span><span id="ZakatTracker.get_dict_size-2449"><a href="#ZakatTracker.get_dict_size-2449"><span class="linenos">2449</span></a>        <span class="n">obj_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="ZakatTracker.get_dict_size-2450"><a href="#ZakatTracker.get_dict_size-2450"><span class="linenos">2450</span></a>        <span class="k">if</span> <span class="n">obj_id</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
</span><span id="ZakatTracker.get_dict_size-2451"><a href="#ZakatTracker.get_dict_size-2451"><span class="linenos">2451</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="ZakatTracker.get_dict_size-2452"><a href="#ZakatTracker.get_dict_size-2452"><span class="linenos">2452</span></a>
</span><span id="ZakatTracker.get_dict_size-2453"><a href="#ZakatTracker.get_dict_size-2453"><span class="linenos">2453</span></a>        <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj_id</span><span class="p">)</span>
</span><span id="ZakatTracker.get_dict_size-2454"><a href="#ZakatTracker.get_dict_size-2454"><span class="linenos">2454</span></a>        <span class="n">size</span> <span class="o">+=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="ZakatTracker.get_dict_size-2455"><a href="#ZakatTracker.get_dict_size-2455"><span class="linenos">2455</span></a>
</span><span id="ZakatTracker.get_dict_size-2456"><a href="#ZakatTracker.get_dict_size-2456"><span class="linenos">2456</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="ZakatTracker.get_dict_size-2457"><a href="#ZakatTracker.get_dict_size-2457"><span class="linenos">2457</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker.get_dict_size-2458"><a href="#ZakatTracker.get_dict_size-2458"><span class="linenos">2458</span></a>                <span class="n">size</span> <span class="o">+=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">get_dict_size</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>
</span><span id="ZakatTracker.get_dict_size-2459"><a href="#ZakatTracker.get_dict_size-2459"><span class="linenos">2459</span></a>                <span class="n">size</span> <span class="o">+=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">get_dict_size</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>
</span><span id="ZakatTracker.get_dict_size-2460"><a href="#ZakatTracker.get_dict_size-2460"><span class="linenos">2460</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)):</span>
</span><span id="ZakatTracker.get_dict_size-2461"><a href="#ZakatTracker.get_dict_size-2461"><span class="linenos">2461</span></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
</span><span id="ZakatTracker.get_dict_size-2462"><a href="#ZakatTracker.get_dict_size-2462"><span class="linenos">2462</span></a>                <span class="n">size</span> <span class="o">+=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">get_dict_size</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>
</span><span id="ZakatTracker.get_dict_size-2463"><a href="#ZakatTracker.get_dict_size-2463"><span class="linenos">2463</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>  <span class="c1"># Handle numbers</span>
</span><span id="ZakatTracker.get_dict_size-2464"><a href="#ZakatTracker.get_dict_size-2464"><span class="linenos">2464</span></a>            <span class="k">pass</span>  <span class="c1"># Basic numbers have a fixed size, so nothing to add here</span>
</span><span id="ZakatTracker.get_dict_size-2465"><a href="#ZakatTracker.get_dict_size-2465"><span class="linenos">2465</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># Handle strings</span>
</span><span id="ZakatTracker.get_dict_size-2466"><a href="#ZakatTracker.get_dict_size-2466"><span class="linenos">2466</span></a>            <span class="n">size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">*</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="nb">str</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>  <span class="c1"># Size per character in bytes</span>
</span><span id="ZakatTracker.get_dict_size-2467"><a href="#ZakatTracker.get_dict_size-2467"><span class="linenos">2467</span></a>        <span class="k">return</span> <span class="n">size</span>
</span></pre></div>


            <div class="docstring"><p>Recursively calculates the approximate memory size of a dictionary and its contents in bytes.</p>

<p>This function traverses the dictionary structure, accounting for the size of keys, values,
and any nested objects. It handles various data types commonly found in dictionaries
(e.g., lists, tuples, sets, numbers, strings) and prevents infinite recursion in case
of circular references.</p>

<p>Parameters:</p>

<ul>
<li>obj (dict): The dictionary whose size is to be calculated.</li>
<li>seen (set, optional): A set used internally to track visited objects
and avoid circular references. Defaults to None.</li>
</ul>

<p>Returns:</p>

<ul>
<li>float: An approximate size of the dictionary and its contents in bytes.</li>
</ul>

<p>Note:</p>

<ul>
<li>This function is a method of the <code><a href="#ZakatTracker">ZakatTracker</a></code> class and is likely used to
estimate the memory footprint of data structures relevant to Zakat calculations.</li>
<li>The size calculation is approximate as it relies on <code>sys.getsizeof()</code>, which might
not account for all memory overhead depending on the Python implementation.</li>
<li>Circular references are handled to prevent infinite recursion.</li>
<li>Basic numeric types (int, float, complex) are assumed to have fixed sizes.</li>
<li>String sizes are estimated based on character length and encoding.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.duration_from_nanoseconds" class="classattr">
                                        <input id="ZakatTracker.duration_from_nanoseconds-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">duration_from_nanoseconds</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">ns</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">show_zeros_in_spoken_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">spoken_time_separator</span><span class="o">=</span><span class="s1">&#39;,&#39;</span>,</span><span class="param">	<span class="n">millennia</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Millennia&#39;</span>,</span><span class="param">	<span class="n">century</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Century&#39;</span>,</span><span class="param">	<span class="n">years</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Years&#39;</span>,</span><span class="param">	<span class="n">days</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Days&#39;</span>,</span><span class="param">	<span class="n">hours</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Hours&#39;</span>,</span><span class="param">	<span class="n">minutes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Minutes&#39;</span>,</span><span class="param">	<span class="n">seconds</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Seconds&#39;</span>,</span><span class="param">	<span class="n">milli_seconds</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;MilliSeconds&#39;</span>,</span><span class="param">	<span class="n">micro_seconds</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;MicroSeconds&#39;</span>,</span><span class="param">	<span class="n">nano_seconds</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;NanoSeconds&#39;</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.duration_from_nanoseconds-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.duration_from_nanoseconds"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.duration_from_nanoseconds-2469"><a href="#ZakatTracker.duration_from_nanoseconds-2469"><span class="linenos">2469</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2470"><a href="#ZakatTracker.duration_from_nanoseconds-2470"><span class="linenos">2470</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">duration_from_nanoseconds</span><span class="p">(</span><span class="n">ns</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2471"><a href="#ZakatTracker.duration_from_nanoseconds-2471"><span class="linenos">2471</span></a>                                  <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2472"><a href="#ZakatTracker.duration_from_nanoseconds-2472"><span class="linenos">2472</span></a>                                  <span class="n">spoken_time_separator</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2473"><a href="#ZakatTracker.duration_from_nanoseconds-2473"><span class="linenos">2473</span></a>                                  <span class="n">millennia</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Millennia&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2474"><a href="#ZakatTracker.duration_from_nanoseconds-2474"><span class="linenos">2474</span></a>                                  <span class="n">century</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Century&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2475"><a href="#ZakatTracker.duration_from_nanoseconds-2475"><span class="linenos">2475</span></a>                                  <span class="n">years</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Years&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2476"><a href="#ZakatTracker.duration_from_nanoseconds-2476"><span class="linenos">2476</span></a>                                  <span class="n">days</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Days&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2477"><a href="#ZakatTracker.duration_from_nanoseconds-2477"><span class="linenos">2477</span></a>                                  <span class="n">hours</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Hours&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2478"><a href="#ZakatTracker.duration_from_nanoseconds-2478"><span class="linenos">2478</span></a>                                  <span class="n">minutes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Minutes&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2479"><a href="#ZakatTracker.duration_from_nanoseconds-2479"><span class="linenos">2479</span></a>                                  <span class="n">seconds</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Seconds&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2480"><a href="#ZakatTracker.duration_from_nanoseconds-2480"><span class="linenos">2480</span></a>                                  <span class="n">milli_seconds</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;MilliSeconds&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2481"><a href="#ZakatTracker.duration_from_nanoseconds-2481"><span class="linenos">2481</span></a>                                  <span class="n">micro_seconds</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;MicroSeconds&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2482"><a href="#ZakatTracker.duration_from_nanoseconds-2482"><span class="linenos">2482</span></a>                                  <span class="n">nano_seconds</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;NanoSeconds&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2483"><a href="#ZakatTracker.duration_from_nanoseconds-2483"><span class="linenos">2483</span></a>                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2484"><a href="#ZakatTracker.duration_from_nanoseconds-2484"><span class="linenos">2484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2485"><a href="#ZakatTracker.duration_from_nanoseconds-2485"><span class="linenos">2485</span></a><span class="sd">        REF https://github.com/JayRizzo/Random_Scripts/blob/master/time_measure.py#L106</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2486"><a href="#ZakatTracker.duration_from_nanoseconds-2486"><span class="linenos">2486</span></a><span class="sd">        Convert NanoSeconds to Human Readable Time Format.</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2487"><a href="#ZakatTracker.duration_from_nanoseconds-2487"><span class="linenos">2487</span></a><span class="sd">        A NanoSeconds is a unit of time in the International System of Units (SI) equal</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2488"><a href="#ZakatTracker.duration_from_nanoseconds-2488"><span class="linenos">2488</span></a><span class="sd">        to one millionth (0.000001 or 10−6 or 1⁄1,000,000) of a second.</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2489"><a href="#ZakatTracker.duration_from_nanoseconds-2489"><span class="linenos">2489</span></a><span class="sd">        Its symbol is μs, sometimes simplified to us when Unicode is not available.</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2490"><a href="#ZakatTracker.duration_from_nanoseconds-2490"><span class="linenos">2490</span></a><span class="sd">        A microsecond is equal to 1000 nanoseconds or 1⁄1,000 of a millisecond.</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2491"><a href="#ZakatTracker.duration_from_nanoseconds-2491"><span class="linenos">2491</span></a>
</span><span id="ZakatTracker.duration_from_nanoseconds-2492"><a href="#ZakatTracker.duration_from_nanoseconds-2492"><span class="linenos">2492</span></a><span class="sd">        INPUT : ms (AKA: MilliSeconds)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2493"><a href="#ZakatTracker.duration_from_nanoseconds-2493"><span class="linenos">2493</span></a><span class="sd">        OUTPUT: tuple(string time_lapsed, string spoken_time) like format.</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2494"><a href="#ZakatTracker.duration_from_nanoseconds-2494"><span class="linenos">2494</span></a><span class="sd">        OUTPUT Variables: time_lapsed, spoken_time</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2495"><a href="#ZakatTracker.duration_from_nanoseconds-2495"><span class="linenos">2495</span></a>
</span><span id="ZakatTracker.duration_from_nanoseconds-2496"><a href="#ZakatTracker.duration_from_nanoseconds-2496"><span class="linenos">2496</span></a><span class="sd">        Example  Input: duration_from_nanoseconds(ns)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2497"><a href="#ZakatTracker.duration_from_nanoseconds-2497"><span class="linenos">2497</span></a><span class="sd">        **&quot;Millennium:Century:Years:Days:Hours:Minutes:Seconds:MilliSeconds:MicroSeconds:NanoSeconds&quot;**</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2498"><a href="#ZakatTracker.duration_from_nanoseconds-2498"><span class="linenos">2498</span></a><span class="sd">        Example Output: (&#39;039:0001:047:325:05:02:03:456:789:012&#39;, &#39; 39 Millennia,    1 Century,  47 Years,  325 Days,  5 Hours,  2 Minutes,  3 Seconds,  456 MilliSeconds,  789 MicroSeconds,  12 NanoSeconds&#39;)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2499"><a href="#ZakatTracker.duration_from_nanoseconds-2499"><span class="linenos">2499</span></a><span class="sd">        duration_from_nanoseconds(1234567890123456789012)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2500"><a href="#ZakatTracker.duration_from_nanoseconds-2500"><span class="linenos">2500</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2501"><a href="#ZakatTracker.duration_from_nanoseconds-2501"><span class="linenos">2501</span></a>        <span class="n">us</span><span class="p">,</span> <span class="n">ns</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2502"><a href="#ZakatTracker.duration_from_nanoseconds-2502"><span class="linenos">2502</span></a>        <span class="n">ms</span><span class="p">,</span> <span class="n">us</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">us</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2503"><a href="#ZakatTracker.duration_from_nanoseconds-2503"><span class="linenos">2503</span></a>        <span class="n">s</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2504"><a href="#ZakatTracker.duration_from_nanoseconds-2504"><span class="linenos">2504</span></a>        <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2505"><a href="#ZakatTracker.duration_from_nanoseconds-2505"><span class="linenos">2505</span></a>        <span class="n">h</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2506"><a href="#ZakatTracker.duration_from_nanoseconds-2506"><span class="linenos">2506</span></a>        <span class="n">d</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2507"><a href="#ZakatTracker.duration_from_nanoseconds-2507"><span class="linenos">2507</span></a>        <span class="n">y</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">365</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2508"><a href="#ZakatTracker.duration_from_nanoseconds-2508"><span class="linenos">2508</span></a>        <span class="n">c</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2509"><a href="#ZakatTracker.duration_from_nanoseconds-2509"><span class="linenos">2509</span></a>        <span class="n">n</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2510"><a href="#ZakatTracker.duration_from_nanoseconds-2510"><span class="linenos">2510</span></a>        <span class="n">time_lapsed</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">:</span><span class="s2">03.0f</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">c</span><span class="si">:</span><span class="s2">04.0f</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s2">03.0f</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">d</span><span class="si">:</span><span class="s2">03.0f</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2">02.0f</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2">02.0f</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">02.0f</span><span class="si">}</span><span class="s2">::</span><span class="si">{</span><span class="n">ms</span><span class="si">:</span><span class="s2">03.0f</span><span class="si">}</span><span class="s2">::</span><span class="si">{</span><span class="n">us</span><span class="si">:</span><span class="s2">03.0f</span><span class="si">}</span><span class="s2">::</span><span class="si">{</span><span class="n">ns</span><span class="si">:</span><span class="s2">03.0f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2511"><a href="#ZakatTracker.duration_from_nanoseconds-2511"><span class="linenos">2511</span></a>        <span class="n">spoken_time_part</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2512"><a href="#ZakatTracker.duration_from_nanoseconds-2512"><span class="linenos">2512</span></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2513"><a href="#ZakatTracker.duration_from_nanoseconds-2513"><span class="linenos">2513</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">:</span><span class="s2"> 3d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">millennia</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2514"><a href="#ZakatTracker.duration_from_nanoseconds-2514"><span class="linenos">2514</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2515"><a href="#ZakatTracker.duration_from_nanoseconds-2515"><span class="linenos">2515</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="si">:</span><span class="s2"> 4d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">century</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2516"><a href="#ZakatTracker.duration_from_nanoseconds-2516"><span class="linenos">2516</span></a>        <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2517"><a href="#ZakatTracker.duration_from_nanoseconds-2517"><span class="linenos">2517</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s2"> 3d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">years</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2518"><a href="#ZakatTracker.duration_from_nanoseconds-2518"><span class="linenos">2518</span></a>        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2519"><a href="#ZakatTracker.duration_from_nanoseconds-2519"><span class="linenos">2519</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="si">:</span><span class="s2"> 4d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2520"><a href="#ZakatTracker.duration_from_nanoseconds-2520"><span class="linenos">2520</span></a>        <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2521"><a href="#ZakatTracker.duration_from_nanoseconds-2521"><span class="linenos">2521</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2"> 2d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2522"><a href="#ZakatTracker.duration_from_nanoseconds-2522"><span class="linenos">2522</span></a>        <span class="k">if</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2523"><a href="#ZakatTracker.duration_from_nanoseconds-2523"><span class="linenos">2523</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2"> 2d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">minutes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2524"><a href="#ZakatTracker.duration_from_nanoseconds-2524"><span class="linenos">2524</span></a>        <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2525"><a href="#ZakatTracker.duration_from_nanoseconds-2525"><span class="linenos">2525</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2"> 2d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">seconds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2526"><a href="#ZakatTracker.duration_from_nanoseconds-2526"><span class="linenos">2526</span></a>        <span class="k">if</span> <span class="n">ms</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2527"><a href="#ZakatTracker.duration_from_nanoseconds-2527"><span class="linenos">2527</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ms</span><span class="si">:</span><span class="s2"> 3d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">milli_seconds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2528"><a href="#ZakatTracker.duration_from_nanoseconds-2528"><span class="linenos">2528</span></a>        <span class="k">if</span> <span class="n">us</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2529"><a href="#ZakatTracker.duration_from_nanoseconds-2529"><span class="linenos">2529</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">us</span><span class="si">:</span><span class="s2"> 3d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">micro_seconds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2530"><a href="#ZakatTracker.duration_from_nanoseconds-2530"><span class="linenos">2530</span></a>        <span class="k">if</span> <span class="n">ns</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">show_zeros_in_spoken_time</span><span class="p">:</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2531"><a href="#ZakatTracker.duration_from_nanoseconds-2531"><span class="linenos">2531</span></a>            <span class="n">spoken_time_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns</span><span class="si">:</span><span class="s2"> 3d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">nano_seconds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.duration_from_nanoseconds-2532"><a href="#ZakatTracker.duration_from_nanoseconds-2532"><span class="linenos">2532</span></a>        <span class="k">return</span> <span class="n">time_lapsed</span><span class="p">,</span> <span class="n">spoken_time_separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">spoken_time_part</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>REF <a href="https://github.com/JayRizzo/Random_Scripts/blob/master/time_measure.py#L106">https://github.com/JayRizzo/Random_Scripts/blob/master/time_measure.py#L106</a>
Convert NanoSeconds to Human Readable Time Format.
A NanoSeconds is a unit of time in the International System of Units (SI) equal
to one millionth (0.000001 or 10−6 or 1⁄1,000,000) of a second.
Its symbol is μs, sometimes simplified to us when Unicode is not available.
A microsecond is equal to 1000 nanoseconds or 1⁄1,000 of a millisecond.</p>

<p>INPUT : ms (AKA: MilliSeconds)
OUTPUT: tuple(string time_lapsed, string spoken_time) like format.
OUTPUT Variables: time_lapsed, spoken_time</p>

<p>Example  Input: duration_from_nanoseconds(ns)
<strong>"Millennium:Century:Years:Days:Hours:Minutes:Seconds:MilliSeconds:MicroSeconds:NanoSeconds"</strong>
Example Output: ('039:0001:047:325:05:02:03:456:789:012', ' 39 Millennia,    1 Century,  47 Years,  325 Days,  5 Hours,  2 Minutes,  3 Seconds,  456 MilliSeconds,  789 MicroSeconds,  12 NanoSeconds')
duration_from_nanoseconds(1234567890123456789012)</p>
</div>


                            </div>
                            <div id="ZakatTracker.day_to_time" class="classattr">
                                        <input id="ZakatTracker.day_to_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">day_to_time</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">day</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">month</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span>, </span><span class="param"><span class="n">year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2024</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.day_to_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.day_to_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.day_to_time-2534"><a href="#ZakatTracker.day_to_time-2534"><span class="linenos">2534</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.day_to_time-2535"><a href="#ZakatTracker.day_to_time-2535"><span class="linenos">2535</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">day_to_time</span><span class="p">(</span><span class="n">day</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">month</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># افتراض أن الشهر هو يونيو والسنة 2024</span>
</span><span id="ZakatTracker.day_to_time-2536"><a href="#ZakatTracker.day_to_time-2536"><span class="linenos">2536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.day_to_time-2537"><a href="#ZakatTracker.day_to_time-2537"><span class="linenos">2537</span></a><span class="sd">        Convert a specific day, month, and year into a timestamp.</span>
</span><span id="ZakatTracker.day_to_time-2538"><a href="#ZakatTracker.day_to_time-2538"><span class="linenos">2538</span></a>
</span><span id="ZakatTracker.day_to_time-2539"><a href="#ZakatTracker.day_to_time-2539"><span class="linenos">2539</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.day_to_time-2540"><a href="#ZakatTracker.day_to_time-2540"><span class="linenos">2540</span></a><span class="sd">        - day (int): The day of the month.</span>
</span><span id="ZakatTracker.day_to_time-2541"><a href="#ZakatTracker.day_to_time-2541"><span class="linenos">2541</span></a><span class="sd">        - month (int): The month of the year. Default is 6 (June).</span>
</span><span id="ZakatTracker.day_to_time-2542"><a href="#ZakatTracker.day_to_time-2542"><span class="linenos">2542</span></a><span class="sd">        - year (int): The year. Default is 2024.</span>
</span><span id="ZakatTracker.day_to_time-2543"><a href="#ZakatTracker.day_to_time-2543"><span class="linenos">2543</span></a>
</span><span id="ZakatTracker.day_to_time-2544"><a href="#ZakatTracker.day_to_time-2544"><span class="linenos">2544</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.day_to_time-2545"><a href="#ZakatTracker.day_to_time-2545"><span class="linenos">2545</span></a><span class="sd">        - int: The timestamp representing the given day, month, and year.</span>
</span><span id="ZakatTracker.day_to_time-2546"><a href="#ZakatTracker.day_to_time-2546"><span class="linenos">2546</span></a>
</span><span id="ZakatTracker.day_to_time-2547"><a href="#ZakatTracker.day_to_time-2547"><span class="linenos">2547</span></a><span class="sd">        Note:</span>
</span><span id="ZakatTracker.day_to_time-2548"><a href="#ZakatTracker.day_to_time-2548"><span class="linenos">2548</span></a><span class="sd">        This method assumes the default month and year if not provided.</span>
</span><span id="ZakatTracker.day_to_time-2549"><a href="#ZakatTracker.day_to_time-2549"><span class="linenos">2549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.day_to_time-2550"><a href="#ZakatTracker.day_to_time-2550"><span class="linenos">2550</span></a>        <span class="k">return</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Convert a specific day, month, and year into a timestamp.</p>

<p>Parameters:</p>

<ul>
<li>day (int): The day of the month.</li>
<li>month (int): The month of the year. Default is 6 (June).</li>
<li>year (int): The year. Default is 2024.</li>
</ul>

<p>Returns:</p>

<ul>
<li>int: The timestamp representing the given day, month, and year.</li>
</ul>

<p>Note:
This method assumes the default month and year if not provided.</p>
</div>


                            </div>
                            <div id="ZakatTracker.generate_random_date" class="classattr">
                                        <input id="ZakatTracker.generate_random_date-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">generate_random_date</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>,</span><span class="param">	<span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span></span><span class="return-annotation">) -> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.generate_random_date-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.generate_random_date"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.generate_random_date-2552"><a href="#ZakatTracker.generate_random_date-2552"><span class="linenos">2552</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.generate_random_date-2553"><a href="#ZakatTracker.generate_random_date-2553"><span class="linenos">2553</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_random_date</span><span class="p">(</span><span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
</span><span id="ZakatTracker.generate_random_date-2554"><a href="#ZakatTracker.generate_random_date-2554"><span class="linenos">2554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.generate_random_date-2555"><a href="#ZakatTracker.generate_random_date-2555"><span class="linenos">2555</span></a><span class="sd">        Generate a random date between two given dates.</span>
</span><span id="ZakatTracker.generate_random_date-2556"><a href="#ZakatTracker.generate_random_date-2556"><span class="linenos">2556</span></a>
</span><span id="ZakatTracker.generate_random_date-2557"><a href="#ZakatTracker.generate_random_date-2557"><span class="linenos">2557</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.generate_random_date-2558"><a href="#ZakatTracker.generate_random_date-2558"><span class="linenos">2558</span></a><span class="sd">        - start_date (datetime.datetime): The start date from which to generate a random date.</span>
</span><span id="ZakatTracker.generate_random_date-2559"><a href="#ZakatTracker.generate_random_date-2559"><span class="linenos">2559</span></a><span class="sd">        - end_date (datetime.datetime): The end date until which to generate a random date.</span>
</span><span id="ZakatTracker.generate_random_date-2560"><a href="#ZakatTracker.generate_random_date-2560"><span class="linenos">2560</span></a>
</span><span id="ZakatTracker.generate_random_date-2561"><a href="#ZakatTracker.generate_random_date-2561"><span class="linenos">2561</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.generate_random_date-2562"><a href="#ZakatTracker.generate_random_date-2562"><span class="linenos">2562</span></a><span class="sd">        - datetime.datetime: A random date between the start_date and end_date.</span>
</span><span id="ZakatTracker.generate_random_date-2563"><a href="#ZakatTracker.generate_random_date-2563"><span class="linenos">2563</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.generate_random_date-2564"><a href="#ZakatTracker.generate_random_date-2564"><span class="linenos">2564</span></a>        <span class="n">time_between_dates</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">start_date</span>
</span><span id="ZakatTracker.generate_random_date-2565"><a href="#ZakatTracker.generate_random_date-2565"><span class="linenos">2565</span></a>        <span class="n">days_between_dates</span> <span class="o">=</span> <span class="n">time_between_dates</span><span class="o">.</span><span class="n">days</span>
</span><span id="ZakatTracker.generate_random_date-2566"><a href="#ZakatTracker.generate_random_date-2566"><span class="linenos">2566</span></a>        <span class="n">random_number_of_days</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">days_between_dates</span><span class="p">)</span>
</span><span id="ZakatTracker.generate_random_date-2567"><a href="#ZakatTracker.generate_random_date-2567"><span class="linenos">2567</span></a>        <span class="k">return</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random_number_of_days</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate a random date between two given dates.</p>

<p>Parameters:</p>

<ul>
<li>start_date (datetime.datetime): The start date from which to generate a random date.</li>
<li>end_date (datetime.datetime): The end date until which to generate a random date.</li>
</ul>

<p>Returns:</p>

<ul>
<li>datetime.datetime: A random date between the start_date and end_date.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.generate_random_csv_file" class="classattr">
                                        <input id="ZakatTracker.generate_random_csv_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">generate_random_csv_file</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;data.csv&#39;</span>,</span><span class="param">	<span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>,</span><span class="param">	<span class="n">with_rate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.generate_random_csv_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.generate_random_csv_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.generate_random_csv_file-2569"><a href="#ZakatTracker.generate_random_csv_file-2569"><span class="linenos">2569</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.generate_random_csv_file-2570"><a href="#ZakatTracker.generate_random_csv_file-2570"><span class="linenos">2570</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_random_csv_file</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data.csv&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">with_rate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ZakatTracker.generate_random_csv_file-2571"><a href="#ZakatTracker.generate_random_csv_file-2571"><span class="linenos">2571</span></a>                                 <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ZakatTracker.generate_random_csv_file-2572"><a href="#ZakatTracker.generate_random_csv_file-2572"><span class="linenos">2572</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.generate_random_csv_file-2573"><a href="#ZakatTracker.generate_random_csv_file-2573"><span class="linenos">2573</span></a><span class="sd">        Generate a random CSV file with specified parameters.</span>
</span><span id="ZakatTracker.generate_random_csv_file-2574"><a href="#ZakatTracker.generate_random_csv_file-2574"><span class="linenos">2574</span></a>
</span><span id="ZakatTracker.generate_random_csv_file-2575"><a href="#ZakatTracker.generate_random_csv_file-2575"><span class="linenos">2575</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.generate_random_csv_file-2576"><a href="#ZakatTracker.generate_random_csv_file-2576"><span class="linenos">2576</span></a><span class="sd">        - path (str): The path where the CSV file will be saved. Default is &quot;data.csv&quot;.</span>
</span><span id="ZakatTracker.generate_random_csv_file-2577"><a href="#ZakatTracker.generate_random_csv_file-2577"><span class="linenos">2577</span></a><span class="sd">        - count (int): The number of rows to generate in the CSV file. Default is 1000.</span>
</span><span id="ZakatTracker.generate_random_csv_file-2578"><a href="#ZakatTracker.generate_random_csv_file-2578"><span class="linenos">2578</span></a><span class="sd">        - with_rate (bool): If True, a random rate between 1.2% and 12% is added. Default is False.</span>
</span><span id="ZakatTracker.generate_random_csv_file-2579"><a href="#ZakatTracker.generate_random_csv_file-2579"><span class="linenos">2579</span></a><span class="sd">        - debug (bool): A flag indicating whether to print debug information.</span>
</span><span id="ZakatTracker.generate_random_csv_file-2580"><a href="#ZakatTracker.generate_random_csv_file-2580"><span class="linenos">2580</span></a>
</span><span id="ZakatTracker.generate_random_csv_file-2581"><a href="#ZakatTracker.generate_random_csv_file-2581"><span class="linenos">2581</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.generate_random_csv_file-2582"><a href="#ZakatTracker.generate_random_csv_file-2582"><span class="linenos">2582</span></a><span class="sd">        None. The function generates a CSV file at the specified path with the given count of rows.</span>
</span><span id="ZakatTracker.generate_random_csv_file-2583"><a href="#ZakatTracker.generate_random_csv_file-2583"><span class="linenos">2583</span></a><span class="sd">        Each row contains a randomly generated account, description, value, and date.</span>
</span><span id="ZakatTracker.generate_random_csv_file-2584"><a href="#ZakatTracker.generate_random_csv_file-2584"><span class="linenos">2584</span></a><span class="sd">        The value is randomly generated between 1000 and 100000,</span>
</span><span id="ZakatTracker.generate_random_csv_file-2585"><a href="#ZakatTracker.generate_random_csv_file-2585"><span class="linenos">2585</span></a><span class="sd">        and the date is randomly generated between 1950-01-01 and 2023-12-31.</span>
</span><span id="ZakatTracker.generate_random_csv_file-2586"><a href="#ZakatTracker.generate_random_csv_file-2586"><span class="linenos">2586</span></a><span class="sd">        If the row number is not divisible by 13, the value is multiplied by -1.</span>
</span><span id="ZakatTracker.generate_random_csv_file-2587"><a href="#ZakatTracker.generate_random_csv_file-2587"><span class="linenos">2587</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.generate_random_csv_file-2588"><a href="#ZakatTracker.generate_random_csv_file-2588"><span class="linenos">2588</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.generate_random_csv_file-2589"><a href="#ZakatTracker.generate_random_csv_file-2589"><span class="linenos">2589</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;generate_random_csv_file&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.generate_random_csv_file-2590"><a href="#ZakatTracker.generate_random_csv_file-2590"><span class="linenos">2590</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.generate_random_csv_file-2591"><a href="#ZakatTracker.generate_random_csv_file-2591"><span class="linenos">2591</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
</span><span id="ZakatTracker.generate_random_csv_file-2592"><a href="#ZakatTracker.generate_random_csv_file-2592"><span class="linenos">2592</span></a>            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
</span><span id="ZakatTracker.generate_random_csv_file-2593"><a href="#ZakatTracker.generate_random_csv_file-2593"><span class="linenos">2593</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span><span id="ZakatTracker.generate_random_csv_file-2594"><a href="#ZakatTracker.generate_random_csv_file-2594"><span class="linenos">2594</span></a>                <span class="n">account</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;acc-</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ZakatTracker.generate_random_csv_file-2595"><a href="#ZakatTracker.generate_random_csv_file-2595"><span class="linenos">2595</span></a>                <span class="n">desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Some text </span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ZakatTracker.generate_random_csv_file-2596"><a href="#ZakatTracker.generate_random_csv_file-2596"><span class="linenos">2596</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
</span><span id="ZakatTracker.generate_random_csv_file-2597"><a href="#ZakatTracker.generate_random_csv_file-2597"><span class="linenos">2597</span></a>                <span class="n">date</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">generate_random_date</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="ZakatTracker.generate_random_csv_file-2598"><a href="#ZakatTracker.generate_random_csv_file-2598"><span class="linenos">2598</span></a>                                                         <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.generate_random_csv_file-2599"><a href="#ZakatTracker.generate_random_csv_file-2599"><span class="linenos">2599</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">13</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.generate_random_csv_file-2600"><a href="#ZakatTracker.generate_random_csv_file-2600"><span class="linenos">2600</span></a>                    <span class="n">value</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="ZakatTracker.generate_random_csv_file-2601"><a href="#ZakatTracker.generate_random_csv_file-2601"><span class="linenos">2601</span></a>                <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">account</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">date</span><span class="p">]</span>
</span><span id="ZakatTracker.generate_random_csv_file-2602"><a href="#ZakatTracker.generate_random_csv_file-2602"><span class="linenos">2602</span></a>                <span class="k">if</span> <span class="n">with_rate</span><span class="p">:</span>
</span><span id="ZakatTracker.generate_random_csv_file-2603"><a href="#ZakatTracker.generate_random_csv_file-2603"><span class="linenos">2603</span></a>                    <span class="n">rate</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.12</span>
</span><span id="ZakatTracker.generate_random_csv_file-2604"><a href="#ZakatTracker.generate_random_csv_file-2604"><span class="linenos">2604</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.generate_random_csv_file-2605"><a href="#ZakatTracker.generate_random_csv_file-2605"><span class="linenos">2605</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;before-append&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><span id="ZakatTracker.generate_random_csv_file-2606"><a href="#ZakatTracker.generate_random_csv_file-2606"><span class="linenos">2606</span></a>                    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
</span><span id="ZakatTracker.generate_random_csv_file-2607"><a href="#ZakatTracker.generate_random_csv_file-2607"><span class="linenos">2607</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.generate_random_csv_file-2608"><a href="#ZakatTracker.generate_random_csv_file-2608"><span class="linenos">2608</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after-append&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><span id="ZakatTracker.generate_random_csv_file-2609"><a href="#ZakatTracker.generate_random_csv_file-2609"><span class="linenos">2609</span></a>                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="ZakatTracker.generate_random_csv_file-2610"><a href="#ZakatTracker.generate_random_csv_file-2610"><span class="linenos">2610</span></a>                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ZakatTracker.generate_random_csv_file-2611"><a href="#ZakatTracker.generate_random_csv_file-2611"><span class="linenos">2611</span></a>        <span class="k">return</span> <span class="n">i</span>
</span></pre></div>


            <div class="docstring"><p>Generate a random CSV file with specified parameters.</p>

<p>Parameters:</p>

<ul>
<li>path (str): The path where the CSV file will be saved. Default is "data.csv".</li>
<li>count (int): The number of rows to generate in the CSV file. Default is 1000.</li>
<li>with_rate (bool): If True, a random rate between 1.2% and 12% is added. Default is False.</li>
<li>debug (bool): A flag indicating whether to print debug information.</li>
</ul>

<p>Returns:
None. The function generates a CSV file at the specified path with the given count of rows.
Each row contains a randomly generated account, description, value, and date.
The value is randomly generated between 1000 and 100000,
and the date is randomly generated between 1950-01-01 and 2023-12-31.
If the row number is not divisible by 13, the value is multiplied by -1.</p>
</div>


                            </div>
                            <div id="ZakatTracker.create_random_list" class="classattr">
                                        <input id="ZakatTracker.create_random_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">create_random_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">max_sum</span>, </span><span class="param"><span class="n">min_value</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">max_value</span><span class="o">=</span><span class="mi">10</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ZakatTracker.create_random_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.create_random_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.create_random_list-2613"><a href="#ZakatTracker.create_random_list-2613"><span class="linenos">2613</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ZakatTracker.create_random_list-2614"><a href="#ZakatTracker.create_random_list-2614"><span class="linenos">2614</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_random_list</span><span class="p">(</span><span class="n">max_sum</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
</span><span id="ZakatTracker.create_random_list-2615"><a href="#ZakatTracker.create_random_list-2615"><span class="linenos">2615</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ZakatTracker.create_random_list-2616"><a href="#ZakatTracker.create_random_list-2616"><span class="linenos">2616</span></a><span class="sd">        Creates a list of random integers whose sum does not exceed the specified maximum.</span>
</span><span id="ZakatTracker.create_random_list-2617"><a href="#ZakatTracker.create_random_list-2617"><span class="linenos">2617</span></a>
</span><span id="ZakatTracker.create_random_list-2618"><a href="#ZakatTracker.create_random_list-2618"><span class="linenos">2618</span></a><span class="sd">        Parameters:</span>
</span><span id="ZakatTracker.create_random_list-2619"><a href="#ZakatTracker.create_random_list-2619"><span class="linenos">2619</span></a><span class="sd">        - max_sum: The maximum allowed sum of the list elements.</span>
</span><span id="ZakatTracker.create_random_list-2620"><a href="#ZakatTracker.create_random_list-2620"><span class="linenos">2620</span></a><span class="sd">        - min_value: The minimum possible value for an element (inclusive).</span>
</span><span id="ZakatTracker.create_random_list-2621"><a href="#ZakatTracker.create_random_list-2621"><span class="linenos">2621</span></a><span class="sd">        - max_value: The maximum possible value for an element (inclusive).</span>
</span><span id="ZakatTracker.create_random_list-2622"><a href="#ZakatTracker.create_random_list-2622"><span class="linenos">2622</span></a>
</span><span id="ZakatTracker.create_random_list-2623"><a href="#ZakatTracker.create_random_list-2623"><span class="linenos">2623</span></a><span class="sd">        Returns:</span>
</span><span id="ZakatTracker.create_random_list-2624"><a href="#ZakatTracker.create_random_list-2624"><span class="linenos">2624</span></a><span class="sd">        - A list of random integers.</span>
</span><span id="ZakatTracker.create_random_list-2625"><a href="#ZakatTracker.create_random_list-2625"><span class="linenos">2625</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ZakatTracker.create_random_list-2626"><a href="#ZakatTracker.create_random_list-2626"><span class="linenos">2626</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker.create_random_list-2627"><a href="#ZakatTracker.create_random_list-2627"><span class="linenos">2627</span></a>        <span class="n">current_sum</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.create_random_list-2628"><a href="#ZakatTracker.create_random_list-2628"><span class="linenos">2628</span></a>
</span><span id="ZakatTracker.create_random_list-2629"><a href="#ZakatTracker.create_random_list-2629"><span class="linenos">2629</span></a>        <span class="k">while</span> <span class="n">current_sum</span> <span class="o">&lt;</span> <span class="n">max_sum</span><span class="p">:</span>
</span><span id="ZakatTracker.create_random_list-2630"><a href="#ZakatTracker.create_random_list-2630"><span class="linenos">2630</span></a>            <span class="c1"># Calculate the remaining space for the next element</span>
</span><span id="ZakatTracker.create_random_list-2631"><a href="#ZakatTracker.create_random_list-2631"><span class="linenos">2631</span></a>            <span class="n">remaining_sum</span> <span class="o">=</span> <span class="n">max_sum</span> <span class="o">-</span> <span class="n">current_sum</span>
</span><span id="ZakatTracker.create_random_list-2632"><a href="#ZakatTracker.create_random_list-2632"><span class="linenos">2632</span></a>            <span class="c1"># Determine the maximum possible value for the next element</span>
</span><span id="ZakatTracker.create_random_list-2633"><a href="#ZakatTracker.create_random_list-2633"><span class="linenos">2633</span></a>            <span class="n">next_max_value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">remaining_sum</span><span class="p">,</span> <span class="n">max_value</span><span class="p">)</span>
</span><span id="ZakatTracker.create_random_list-2634"><a href="#ZakatTracker.create_random_list-2634"><span class="linenos">2634</span></a>            <span class="c1"># Generate a random element within the allowed range</span>
</span><span id="ZakatTracker.create_random_list-2635"><a href="#ZakatTracker.create_random_list-2635"><span class="linenos">2635</span></a>            <span class="n">next_element</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">next_max_value</span><span class="p">)</span>
</span><span id="ZakatTracker.create_random_list-2636"><a href="#ZakatTracker.create_random_list-2636"><span class="linenos">2636</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_element</span><span class="p">)</span>
</span><span id="ZakatTracker.create_random_list-2637"><a href="#ZakatTracker.create_random_list-2637"><span class="linenos">2637</span></a>            <span class="n">current_sum</span> <span class="o">+=</span> <span class="n">next_element</span>
</span><span id="ZakatTracker.create_random_list-2638"><a href="#ZakatTracker.create_random_list-2638"><span class="linenos">2638</span></a>
</span><span id="ZakatTracker.create_random_list-2639"><a href="#ZakatTracker.create_random_list-2639"><span class="linenos">2639</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Creates a list of random integers whose sum does not exceed the specified maximum.</p>

<p>Parameters:</p>

<ul>
<li>max_sum: The maximum allowed sum of the list elements.</li>
<li>min_value: The minimum possible value for an element (inclusive).</li>
<li>max_value: The maximum possible value for an element (inclusive).</li>
</ul>

<p>Returns:</p>

<ul>
<li>A list of random integers.</li>
</ul>
</div>


                            </div>
                            <div id="ZakatTracker.test" class="classattr">
                                        <input id="ZakatTracker.test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ZakatTracker.test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ZakatTracker.test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ZakatTracker.test-2898"><a href="#ZakatTracker.test-2898"><span class="linenos">2898</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ZakatTracker.test-2899"><a href="#ZakatTracker.test-2899"><span class="linenos">2899</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-2900"><a href="#ZakatTracker.test-2900"><span class="linenos">2900</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-2901"><a href="#ZakatTracker.test-2901"><span class="linenos">2901</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker.test-2902"><a href="#ZakatTracker.test-2902"><span class="linenos">2902</span></a>
</span><span id="ZakatTracker.test-2903"><a href="#ZakatTracker.test-2903"><span class="linenos">2903</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_test_core</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-2904"><a href="#ZakatTracker.test-2904"><span class="linenos">2904</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_test_core</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-2905"><a href="#ZakatTracker.test-2905"><span class="linenos">2905</span></a>
</span><span id="ZakatTracker.test-2906"><a href="#ZakatTracker.test-2906"><span class="linenos">2906</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">()</span>
</span><span id="ZakatTracker.test-2907"><a href="#ZakatTracker.test-2907"><span class="linenos">2907</span></a>
</span><span id="ZakatTracker.test-2908"><a href="#ZakatTracker.test-2908"><span class="linenos">2908</span></a>            <span class="c1"># Not allowed for duplicate transactions in the same account and time</span>
</span><span id="ZakatTracker.test-2909"><a href="#ZakatTracker.test-2909"><span class="linenos">2909</span></a>
</span><span id="ZakatTracker.test-2910"><a href="#ZakatTracker.test-2910"><span class="linenos">2910</span></a>            <span class="n">created</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ZakatTracker.test-2911"><a href="#ZakatTracker.test-2911"><span class="linenos">2911</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;test-1&#39;</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker.test-2912"><a href="#ZakatTracker.test-2912"><span class="linenos">2912</span></a>            <span class="n">failed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ZakatTracker.test-2913"><a href="#ZakatTracker.test-2913"><span class="linenos">2913</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker.test-2914"><a href="#ZakatTracker.test-2914"><span class="linenos">2914</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;test-1&#39;</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker.test-2915"><a href="#ZakatTracker.test-2915"><span class="linenos">2915</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="ZakatTracker.test-2916"><a href="#ZakatTracker.test-2916"><span class="linenos">2916</span></a>                <span class="n">failed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ZakatTracker.test-2917"><a href="#ZakatTracker.test-2917"><span class="linenos">2917</span></a>            <span class="k">assert</span> <span class="n">failed</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="ZakatTracker.test-2918"><a href="#ZakatTracker.test-2918"><span class="linenos">2918</span></a>
</span><span id="ZakatTracker.test-2919"><a href="#ZakatTracker.test-2919"><span class="linenos">2919</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker.test-2920"><a href="#ZakatTracker.test-2920"><span class="linenos">2920</span></a>
</span><span id="ZakatTracker.test-2921"><a href="#ZakatTracker.test-2921"><span class="linenos">2921</span></a>            <span class="c1"># Same account transfer</span>
</span><span id="ZakatTracker.test-2922"><a href="#ZakatTracker.test-2922"><span class="linenos">2922</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="ZakatTracker.test-2923"><a href="#ZakatTracker.test-2923"><span class="linenos">2923</span></a>                <span class="n">failed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ZakatTracker.test-2924"><a href="#ZakatTracker.test-2924"><span class="linenos">2924</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="ZakatTracker.test-2925"><a href="#ZakatTracker.test-2925"><span class="linenos">2925</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;same-account&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-2926"><a href="#ZakatTracker.test-2926"><span class="linenos">2926</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="ZakatTracker.test-2927"><a href="#ZakatTracker.test-2927"><span class="linenos">2927</span></a>                    <span class="n">failed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ZakatTracker.test-2928"><a href="#ZakatTracker.test-2928"><span class="linenos">2928</span></a>                <span class="k">assert</span> <span class="n">failed</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="ZakatTracker.test-2929"><a href="#ZakatTracker.test-2929"><span class="linenos">2929</span></a>
</span><span id="ZakatTracker.test-2930"><a href="#ZakatTracker.test-2930"><span class="linenos">2930</span></a>            <span class="c1"># Always preserve box age during transfer</span>
</span><span id="ZakatTracker.test-2931"><a href="#ZakatTracker.test-2931"><span class="linenos">2931</span></a>
</span><span id="ZakatTracker.test-2932"><a href="#ZakatTracker.test-2932"><span class="linenos">2932</span></a>            <span class="n">series</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ZakatTracker.test-2933"><a href="#ZakatTracker.test-2933"><span class="linenos">2933</span></a>                <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span><span id="ZakatTracker.test-2934"><a href="#ZakatTracker.test-2934"><span class="linenos">2934</span></a>                <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span><span id="ZakatTracker.test-2935"><a href="#ZakatTracker.test-2935"><span class="linenos">2935</span></a>                <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="ZakatTracker.test-2936"><a href="#ZakatTracker.test-2936"><span class="linenos">2936</span></a>            <span class="p">]</span>
</span><span id="ZakatTracker.test-2937"><a href="#ZakatTracker.test-2937"><span class="linenos">2937</span></a>            <span class="n">case</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker.test-2938"><a href="#ZakatTracker.test-2938"><span class="linenos">2938</span></a>                <span class="mi">3000</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker.test-2939"><a href="#ZakatTracker.test-2939"><span class="linenos">2939</span></a>                    <span class="s1">&#39;series&#39;</span><span class="p">:</span> <span class="n">series</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2940"><a href="#ZakatTracker.test-2940"><span class="linenos">2940</span></a>                    <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2941"><a href="#ZakatTracker.test-2941"><span class="linenos">2941</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker.test-2942"><a href="#ZakatTracker.test-2942"><span class="linenos">2942</span></a>                <span class="mi">6000</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker.test-2943"><a href="#ZakatTracker.test-2943"><span class="linenos">2943</span></a>                    <span class="s1">&#39;series&#39;</span><span class="p">:</span> <span class="n">series</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2944"><a href="#ZakatTracker.test-2944"><span class="linenos">2944</span></a>                    <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="mi">12000</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2945"><a href="#ZakatTracker.test-2945"><span class="linenos">2945</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker.test-2946"><a href="#ZakatTracker.test-2946"><span class="linenos">2946</span></a>                <span class="mi">9000</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker.test-2947"><a href="#ZakatTracker.test-2947"><span class="linenos">2947</span></a>                    <span class="s1">&#39;series&#39;</span><span class="p">:</span> <span class="n">series</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2948"><a href="#ZakatTracker.test-2948"><span class="linenos">2948</span></a>                    <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="mi">9000</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2949"><a href="#ZakatTracker.test-2949"><span class="linenos">2949</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker.test-2950"><a href="#ZakatTracker.test-2950"><span class="linenos">2950</span></a>                <span class="mi">18000</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker.test-2951"><a href="#ZakatTracker.test-2951"><span class="linenos">2951</span></a>                    <span class="s1">&#39;series&#39;</span><span class="p">:</span> <span class="n">series</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2952"><a href="#ZakatTracker.test-2952"><span class="linenos">2952</span></a>                    <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2953"><a href="#ZakatTracker.test-2953"><span class="linenos">2953</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker.test-2954"><a href="#ZakatTracker.test-2954"><span class="linenos">2954</span></a>                <span class="mi">27000</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker.test-2955"><a href="#ZakatTracker.test-2955"><span class="linenos">2955</span></a>                    <span class="s1">&#39;series&#39;</span><span class="p">:</span> <span class="n">series</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2956"><a href="#ZakatTracker.test-2956"><span class="linenos">2956</span></a>                    <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">9000</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2957"><a href="#ZakatTracker.test-2957"><span class="linenos">2957</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker.test-2958"><a href="#ZakatTracker.test-2958"><span class="linenos">2958</span></a>                <span class="mi">36000</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker.test-2959"><a href="#ZakatTracker.test-2959"><span class="linenos">2959</span></a>                    <span class="s1">&#39;series&#39;</span><span class="p">:</span> <span class="n">series</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2960"><a href="#ZakatTracker.test-2960"><span class="linenos">2960</span></a>                    <span class="s1">&#39;rest&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">18000</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2961"><a href="#ZakatTracker.test-2961"><span class="linenos">2961</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker.test-2962"><a href="#ZakatTracker.test-2962"><span class="linenos">2962</span></a>            <span class="p">}</span>
</span><span id="ZakatTracker.test-2963"><a href="#ZakatTracker.test-2963"><span class="linenos">2963</span></a>
</span><span id="ZakatTracker.test-2964"><a href="#ZakatTracker.test-2964"><span class="linenos">2964</span></a>            <span class="n">selected_time</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">TimeCycle</span><span class="p">()</span>
</span><span id="ZakatTracker.test-2965"><a href="#ZakatTracker.test-2965"><span class="linenos">2965</span></a>
</span><span id="ZakatTracker.test-2966"><a href="#ZakatTracker.test-2966"><span class="linenos">2966</span></a>            <span class="k">for</span> <span class="n">total</span> <span class="ow">in</span> <span class="n">case</span><span class="p">:</span>
</span><span id="ZakatTracker.test-2967"><a href="#ZakatTracker.test-2967"><span class="linenos">2967</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-2968"><a href="#ZakatTracker.test-2968"><span class="linenos">2968</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------------------------------------------------------&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-2969"><a href="#ZakatTracker.test-2969"><span class="linenos">2969</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;case[</span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="n">case</span><span class="p">[</span><span class="n">total</span><span class="p">])</span>
</span><span id="ZakatTracker.test-2970"><a href="#ZakatTracker.test-2970"><span class="linenos">2970</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">case</span><span class="p">[</span><span class="n">total</span><span class="p">][</span><span class="s1">&#39;series&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.test-2971"><a href="#ZakatTracker.test-2971"><span class="linenos">2971</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span>
</span><span id="ZakatTracker.test-2972"><a href="#ZakatTracker.test-2972"><span class="linenos">2972</span></a>                        <span class="n">unscaled_value</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ZakatTracker.test-2973"><a href="#ZakatTracker.test-2973"><span class="linenos">2973</span></a>                        <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;test-</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> ages&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2974"><a href="#ZakatTracker.test-2974"><span class="linenos">2974</span></a>                        <span class="n">account</span><span class="o">=</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2975"><a href="#ZakatTracker.test-2975"><span class="linenos">2975</span></a>                        <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2976"><a href="#ZakatTracker.test-2976"><span class="linenos">2976</span></a>                        <span class="n">created</span><span class="o">=</span><span class="n">selected_time</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ZakatTracker.test-2977"><a href="#ZakatTracker.test-2977"><span class="linenos">2977</span></a>                    <span class="p">)</span>
</span><span id="ZakatTracker.test-2978"><a href="#ZakatTracker.test-2978"><span class="linenos">2978</span></a>
</span><span id="ZakatTracker.test-2979"><a href="#ZakatTracker.test-2979"><span class="linenos">2979</span></a>                <span class="n">unscaled_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
</span><span id="ZakatTracker.test-2980"><a href="#ZakatTracker.test-2980"><span class="linenos">2980</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-2981"><a href="#ZakatTracker.test-2981"><span class="linenos">2981</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;unscaled_total&#39;</span><span class="p">,</span> <span class="n">unscaled_total</span><span class="p">)</span>
</span><span id="ZakatTracker.test-2982"><a href="#ZakatTracker.test-2982"><span class="linenos">2982</span></a>                <span class="n">refs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span>
</span><span id="ZakatTracker.test-2983"><a href="#ZakatTracker.test-2983"><span class="linenos">2983</span></a>                    <span class="n">unscaled_amount</span><span class="o">=</span><span class="n">unscaled_total</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2984"><a href="#ZakatTracker.test-2984"><span class="linenos">2984</span></a>                    <span class="n">from_account</span><span class="o">=</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2985"><a href="#ZakatTracker.test-2985"><span class="linenos">2985</span></a>                    <span class="n">to_account</span><span class="o">=</span><span class="s1">&#39;future&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2986"><a href="#ZakatTracker.test-2986"><span class="linenos">2986</span></a>                    <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Zakat Movement&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2987"><a href="#ZakatTracker.test-2987"><span class="linenos">2987</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="ZakatTracker.test-2988"><a href="#ZakatTracker.test-2988"><span class="linenos">2988</span></a>                <span class="p">)</span>
</span><span id="ZakatTracker.test-2989"><a href="#ZakatTracker.test-2989"><span class="linenos">2989</span></a>
</span><span id="ZakatTracker.test-2990"><a href="#ZakatTracker.test-2990"><span class="linenos">2990</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-2991"><a href="#ZakatTracker.test-2991"><span class="linenos">2991</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;refs&#39;</span><span class="p">,</span> <span class="n">refs</span><span class="p">)</span>
</span><span id="ZakatTracker.test-2992"><a href="#ZakatTracker.test-2992"><span class="linenos">2992</span></a>
</span><span id="ZakatTracker.test-2993"><a href="#ZakatTracker.test-2993"><span class="linenos">2993</span></a>                <span class="n">ages_cache_balance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="s1">&#39;ages&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-2994"><a href="#ZakatTracker.test-2994"><span class="linenos">2994</span></a>                <span class="n">ages_fresh_balance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker.test-2995"><a href="#ZakatTracker.test-2995"><span class="linenos">2995</span></a>                <span class="n">rest</span> <span class="o">=</span> <span class="n">case</span><span class="p">[</span><span class="n">total</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-2996"><a href="#ZakatTracker.test-2996"><span class="linenos">2996</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-2997"><a href="#ZakatTracker.test-2997"><span class="linenos">2997</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="n">ages_cache_balance</span><span class="p">,</span> <span class="n">ages_fresh_balance</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
</span><span id="ZakatTracker.test-2998"><a href="#ZakatTracker.test-2998"><span class="linenos">2998</span></a>                <span class="k">assert</span> <span class="n">ages_cache_balance</span> <span class="o">==</span> <span class="n">rest</span>
</span><span id="ZakatTracker.test-2999"><a href="#ZakatTracker.test-2999"><span class="linenos">2999</span></a>                <span class="k">assert</span> <span class="n">ages_fresh_balance</span> <span class="o">==</span> <span class="n">rest</span>
</span><span id="ZakatTracker.test-3000"><a href="#ZakatTracker.test-3000"><span class="linenos">3000</span></a>
</span><span id="ZakatTracker.test-3001"><a href="#ZakatTracker.test-3001"><span class="linenos">3001</span></a>                <span class="n">future_cache_balance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="s1">&#39;future&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3002"><a href="#ZakatTracker.test-3002"><span class="linenos">3002</span></a>                <span class="n">future_fresh_balance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="s1">&#39;future&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3003"><a href="#ZakatTracker.test-3003"><span class="linenos">3003</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3004"><a href="#ZakatTracker.test-3004"><span class="linenos">3004</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="n">future_cache_balance</span><span class="p">,</span> <span class="n">future_fresh_balance</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3005"><a href="#ZakatTracker.test-3005"><span class="linenos">3005</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;refs&#39;</span><span class="p">,</span> <span class="n">refs</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3006"><a href="#ZakatTracker.test-3006"><span class="linenos">3006</span></a>                <span class="k">assert</span> <span class="n">future_cache_balance</span> <span class="o">==</span> <span class="n">total</span>
</span><span id="ZakatTracker.test-3007"><a href="#ZakatTracker.test-3007"><span class="linenos">3007</span></a>                <span class="k">assert</span> <span class="n">future_fresh_balance</span> <span class="o">==</span> <span class="n">total</span>
</span><span id="ZakatTracker.test-3008"><a href="#ZakatTracker.test-3008"><span class="linenos">3008</span></a>
</span><span id="ZakatTracker.test-3009"><a href="#ZakatTracker.test-3009"><span class="linenos">3009</span></a>                <span class="c1"># TODO: check boxes times for `ages` should equal box times in `future`</span>
</span><span id="ZakatTracker.test-3010"><a href="#ZakatTracker.test-3010"><span class="linenos">3010</span></a>                <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;ages&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.test-3011"><a href="#ZakatTracker.test-3011"><span class="linenos">3011</span></a>                    <span class="n">ages_capital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;ages&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;capital&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3012"><a href="#ZakatTracker.test-3012"><span class="linenos">3012</span></a>                    <span class="n">ages_rest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;ages&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3013"><a href="#ZakatTracker.test-3013"><span class="linenos">3013</span></a>                    <span class="n">future_capital</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3014"><a href="#ZakatTracker.test-3014"><span class="linenos">3014</span></a>                    <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;future&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.test-3015"><a href="#ZakatTracker.test-3015"><span class="linenos">3015</span></a>                        <span class="n">future_capital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;future&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;capital&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3016"><a href="#ZakatTracker.test-3016"><span class="linenos">3016</span></a>                    <span class="n">future_rest</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3017"><a href="#ZakatTracker.test-3017"><span class="linenos">3017</span></a>                    <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;future&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">]:</span>
</span><span id="ZakatTracker.test-3018"><a href="#ZakatTracker.test-3018"><span class="linenos">3018</span></a>                        <span class="n">future_rest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="s1">&#39;future&#39;</span><span class="p">][</span><span class="s1">&#39;box&#39;</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3019"><a href="#ZakatTracker.test-3019"><span class="linenos">3019</span></a>                    <span class="k">if</span> <span class="n">ages_capital</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">future_capital</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">future_rest</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3020"><a href="#ZakatTracker.test-3020"><span class="linenos">3020</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3021"><a href="#ZakatTracker.test-3021"><span class="linenos">3021</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;================================================================&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3022"><a href="#ZakatTracker.test-3022"><span class="linenos">3022</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span> <span class="n">ages_capital</span><span class="p">,</span> <span class="n">ages_rest</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3023"><a href="#ZakatTracker.test-3023"><span class="linenos">3023</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;future&#39;</span><span class="p">,</span> <span class="n">future_capital</span><span class="p">,</span> <span class="n">future_rest</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3024"><a href="#ZakatTracker.test-3024"><span class="linenos">3024</span></a>                        <span class="k">if</span> <span class="n">ages_rest</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3025"><a href="#ZakatTracker.test-3025"><span class="linenos">3025</span></a>                            <span class="k">assert</span> <span class="n">ages_capital</span> <span class="o">==</span> <span class="n">future_capital</span>
</span><span id="ZakatTracker.test-3026"><a href="#ZakatTracker.test-3026"><span class="linenos">3026</span></a>                        <span class="k">elif</span> <span class="n">ages_rest</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3027"><a href="#ZakatTracker.test-3027"><span class="linenos">3027</span></a>                            <span class="k">assert</span> <span class="o">-</span><span class="n">ages_capital</span> <span class="o">==</span> <span class="n">future_capital</span>
</span><span id="ZakatTracker.test-3028"><a href="#ZakatTracker.test-3028"><span class="linenos">3028</span></a>                        <span class="k">elif</span> <span class="n">ages_rest</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3029"><a href="#ZakatTracker.test-3029"><span class="linenos">3029</span></a>                            <span class="k">assert</span> <span class="n">ages_capital</span> <span class="o">==</span> <span class="n">ages_rest</span> <span class="o">+</span> <span class="n">future_capital</span>
</span><span id="ZakatTracker.test-3030"><a href="#ZakatTracker.test-3030"><span class="linenos">3030</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3031"><a href="#ZakatTracker.test-3031"><span class="linenos">3031</span></a>                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3032"><a href="#ZakatTracker.test-3032"><span class="linenos">3032</span></a>
</span><span id="ZakatTracker.test-3033"><a href="#ZakatTracker.test-3033"><span class="linenos">3033</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3034"><a href="#ZakatTracker.test-3034"><span class="linenos">3034</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker.test-3035"><a href="#ZakatTracker.test-3035"><span class="linenos">3035</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker.test-3036"><a href="#ZakatTracker.test-3036"><span class="linenos">3036</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3037"><a href="#ZakatTracker.test-3037"><span class="linenos">3037</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3038"><a href="#ZakatTracker.test-3038"><span class="linenos">3038</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3039"><a href="#ZakatTracker.test-3039"><span class="linenos">3039</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;####################################################################&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3040"><a href="#ZakatTracker.test-3040"><span class="linenos">3040</span></a>
</span><span id="ZakatTracker.test-3041"><a href="#ZakatTracker.test-3041"><span class="linenos">3041</span></a>            <span class="n">transaction</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ZakatTracker.test-3042"><a href="#ZakatTracker.test-3042"><span class="linenos">3042</span></a>                <span class="p">(</span>
</span><span id="ZakatTracker.test-3043"><a href="#ZakatTracker.test-3043"><span class="linenos">3043</span></a>                    <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;wallet&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3044"><a href="#ZakatTracker.test-3044"><span class="linenos">3044</span></a>                    <span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3045"><a href="#ZakatTracker.test-3045"><span class="linenos">3045</span></a>                <span class="p">),</span>
</span><span id="ZakatTracker.test-3046"><a href="#ZakatTracker.test-3046"><span class="linenos">3046</span></a>                <span class="p">(</span>
</span><span id="ZakatTracker.test-3047"><a href="#ZakatTracker.test-3047"><span class="linenos">3047</span></a>                    <span class="mi">750</span><span class="p">,</span> <span class="s1">&#39;wallet&#39;</span><span class="p">,</span> <span class="s1">&#39;safe&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">77000</span><span class="p">,</span> <span class="o">-</span><span class="mi">77000</span><span class="p">,</span> <span class="o">-</span><span class="mi">77000</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3048"><a href="#ZakatTracker.test-3048"><span class="linenos">3048</span></a>                    <span class="mi">75000</span><span class="p">,</span> <span class="mi">75000</span><span class="p">,</span> <span class="mi">75000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3049"><a href="#ZakatTracker.test-3049"><span class="linenos">3049</span></a>                <span class="p">),</span>
</span><span id="ZakatTracker.test-3050"><a href="#ZakatTracker.test-3050"><span class="linenos">3050</span></a>                <span class="p">(</span>
</span><span id="ZakatTracker.test-3051"><a href="#ZakatTracker.test-3051"><span class="linenos">3051</span></a>                    <span class="mi">600</span><span class="p">,</span> <span class="s1">&#39;safe&#39;</span><span class="p">,</span> <span class="s1">&#39;bank&#39;</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3052"><a href="#ZakatTracker.test-3052"><span class="linenos">3052</span></a>                    <span class="mi">60000</span><span class="p">,</span> <span class="mi">60000</span><span class="p">,</span> <span class="mi">60000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3053"><a href="#ZakatTracker.test-3053"><span class="linenos">3053</span></a>                <span class="p">),</span>
</span><span id="ZakatTracker.test-3054"><a href="#ZakatTracker.test-3054"><span class="linenos">3054</span></a>            <span class="p">]</span>
</span><span id="ZakatTracker.test-3055"><a href="#ZakatTracker.test-3055"><span class="linenos">3055</span></a>            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">transaction</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3056"><a href="#ZakatTracker.test-3056"><span class="linenos">3056</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3057"><a href="#ZakatTracker.test-3057"><span class="linenos">3057</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3058"><a href="#ZakatTracker.test-3058"><span class="linenos">3058</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3059"><a href="#ZakatTracker.test-3059"><span class="linenos">3059</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span>
</span><span id="ZakatTracker.test-3060"><a href="#ZakatTracker.test-3060"><span class="linenos">3060</span></a>                    <span class="n">unscaled_amount</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ZakatTracker.test-3061"><a href="#ZakatTracker.test-3061"><span class="linenos">3061</span></a>                    <span class="n">from_account</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3062"><a href="#ZakatTracker.test-3062"><span class="linenos">3062</span></a>                    <span class="n">to_account</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3063"><a href="#ZakatTracker.test-3063"><span class="linenos">3063</span></a>                    <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;test-transfer&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3064"><a href="#ZakatTracker.test-3064"><span class="linenos">3064</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3065"><a href="#ZakatTracker.test-3065"><span class="linenos">3065</span></a>                <span class="p">)</span>
</span><span id="ZakatTracker.test-3066"><a href="#ZakatTracker.test-3066"><span class="linenos">3066</span></a>                <span class="n">zz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3067"><a href="#ZakatTracker.test-3067"><span class="linenos">3067</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3068"><a href="#ZakatTracker.test-3068"><span class="linenos">3068</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3069"><a href="#ZakatTracker.test-3069"><span class="linenos">3069</span></a>                <span class="k">assert</span> <span class="n">zz</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3070"><a href="#ZakatTracker.test-3070"><span class="linenos">3070</span></a>                <span class="n">xx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">()[</span><span class="n">x</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3071"><a href="#ZakatTracker.test-3071"><span class="linenos">3071</span></a>                <span class="k">assert</span> <span class="n">xx</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3072"><a href="#ZakatTracker.test-3072"><span class="linenos">3072</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3073"><a href="#ZakatTracker.test-3073"><span class="linenos">3073</span></a>                <span class="k">assert</span> <span class="n">xx</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3074"><a href="#ZakatTracker.test-3074"><span class="linenos">3074</span></a>
</span><span id="ZakatTracker.test-3075"><a href="#ZakatTracker.test-3075"><span class="linenos">3075</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3076"><a href="#ZakatTracker.test-3076"><span class="linenos">3076</span></a>                <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3077"><a href="#ZakatTracker.test-3077"><span class="linenos">3077</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">log</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3078"><a href="#ZakatTracker.test-3078"><span class="linenos">3078</span></a>                    <span class="n">s</span> <span class="o">+=</span> <span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3079"><a href="#ZakatTracker.test-3079"><span class="linenos">3079</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3080"><a href="#ZakatTracker.test-3080"><span class="linenos">3080</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;z[5]&#39;</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
</span><span id="ZakatTracker.test-3081"><a href="#ZakatTracker.test-3081"><span class="linenos">3081</span></a>                <span class="k">assert</span> <span class="n">s</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3082"><a href="#ZakatTracker.test-3082"><span class="linenos">3082</span></a>
</span><span id="ZakatTracker.test-3083"><a href="#ZakatTracker.test-3083"><span class="linenos">3083</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3084"><a href="#ZakatTracker.test-3084"><span class="linenos">3084</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3085"><a href="#ZakatTracker.test-3085"><span class="linenos">3085</span></a>
</span><span id="ZakatTracker.test-3086"><a href="#ZakatTracker.test-3086"><span class="linenos">3086</span></a>                <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">()[</span><span class="n">y</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3087"><a href="#ZakatTracker.test-3087"><span class="linenos">3087</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3088"><a href="#ZakatTracker.test-3088"><span class="linenos">3088</span></a>                <span class="k">assert</span> <span class="n">yy</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3089"><a href="#ZakatTracker.test-3089"><span class="linenos">3089</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3090"><a href="#ZakatTracker.test-3090"><span class="linenos">3090</span></a>                <span class="k">assert</span> <span class="n">yy</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3091"><a href="#ZakatTracker.test-3091"><span class="linenos">3091</span></a>
</span><span id="ZakatTracker.test-3092"><a href="#ZakatTracker.test-3092"><span class="linenos">3092</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3093"><a href="#ZakatTracker.test-3093"><span class="linenos">3093</span></a>                <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="s1">&#39;log&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3094"><a href="#ZakatTracker.test-3094"><span class="linenos">3094</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">log</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3095"><a href="#ZakatTracker.test-3095"><span class="linenos">3095</span></a>                    <span class="n">s</span> <span class="o">+=</span> <span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3096"><a href="#ZakatTracker.test-3096"><span class="linenos">3096</span></a>                <span class="k">assert</span> <span class="n">s</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3097"><a href="#ZakatTracker.test-3097"><span class="linenos">3097</span></a>
</span><span id="ZakatTracker.test-3098"><a href="#ZakatTracker.test-3098"><span class="linenos">3098</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3099"><a href="#ZakatTracker.test-3099"><span class="linenos">3099</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">z</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3100"><a href="#ZakatTracker.test-3100"><span class="linenos">3100</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">())</span>
</span><span id="ZakatTracker.test-3101"><a href="#ZakatTracker.test-3101"><span class="linenos">3101</span></a>
</span><span id="ZakatTracker.test-3102"><a href="#ZakatTracker.test-3102"><span class="linenos">3102</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3103"><a href="#ZakatTracker.test-3103"><span class="linenos">3103</span></a>                <span class="n">pp</span><span class="p">()</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="mf">2.17</span><span class="p">))</span>
</span><span id="ZakatTracker.test-3104"><a href="#ZakatTracker.test-3104"><span class="linenos">3104</span></a>
</span><span id="ZakatTracker.test-3105"><a href="#ZakatTracker.test-3105"><span class="linenos">3105</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3106"><a href="#ZakatTracker.test-3106"><span class="linenos">3106</span></a>            <span class="n">history_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.test-3107"><a href="#ZakatTracker.test-3107"><span class="linenos">3107</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3108"><a href="#ZakatTracker.test-3108"><span class="linenos">3108</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;history-count&#39;</span><span class="p">,</span> <span class="n">history_count</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3109"><a href="#ZakatTracker.test-3109"><span class="linenos">3109</span></a>            <span class="k">assert</span> <span class="n">history_count</span> <span class="o">==</span> <span class="mi">4</span>
</span><span id="ZakatTracker.test-3110"><a href="#ZakatTracker.test-3110"><span class="linenos">3110</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</span><span id="ZakatTracker.test-3111"><a href="#ZakatTracker.test-3111"><span class="linenos">3111</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">())</span>
</span><span id="ZakatTracker.test-3112"><a href="#ZakatTracker.test-3112"><span class="linenos">3112</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3113"><a href="#ZakatTracker.test-3113"><span class="linenos">3113</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="ZakatTracker.test-3114"><a href="#ZakatTracker.test-3114"><span class="linenos">3114</span></a>
</span><span id="ZakatTracker.test-3115"><a href="#ZakatTracker.test-3115"><span class="linenos">3115</span></a>            <span class="c1"># storage</span>
</span><span id="ZakatTracker.test-3116"><a href="#ZakatTracker.test-3116"><span class="linenos">3116</span></a>
</span><span id="ZakatTracker.test-3117"><a href="#ZakatTracker.test-3117"><span class="linenos">3117</span></a>            <span class="n">_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./zakat_test_db/test.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3118"><a href="#ZakatTracker.test-3118"><span class="linenos">3118</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_path</span><span class="p">):</span>
</span><span id="ZakatTracker.test-3119"><a href="#ZakatTracker.test-3119"><span class="linenos">3119</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">_path</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3120"><a href="#ZakatTracker.test-3120"><span class="linenos">3120</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3121"><a href="#ZakatTracker.test-3121"><span class="linenos">3121</span></a>            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3122"><a href="#ZakatTracker.test-3122"><span class="linenos">3122</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3123"><a href="#ZakatTracker.test-3123"><span class="linenos">3123</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker.test-3124"><a href="#ZakatTracker.test-3124"><span class="linenos">3124</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3125"><a href="#ZakatTracker.test-3125"><span class="linenos">3125</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3126"><a href="#ZakatTracker.test-3126"><span class="linenos">3126</span></a>
</span><span id="ZakatTracker.test-3127"><a href="#ZakatTracker.test-3127"><span class="linenos">3127</span></a>            <span class="c1"># recall</span>
</span><span id="ZakatTracker.test-3128"><a href="#ZakatTracker.test-3128"><span class="linenos">3128</span></a>
</span><span id="ZakatTracker.test-3129"><a href="#ZakatTracker.test-3129"><span class="linenos">3129</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3130"><a href="#ZakatTracker.test-3130"><span class="linenos">3130</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="ZakatTracker.test-3131"><a href="#ZakatTracker.test-3131"><span class="linenos">3131</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="ZakatTracker.test-3132"><a href="#ZakatTracker.test-3132"><span class="linenos">3132</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
</span><span id="ZakatTracker.test-3133"><a href="#ZakatTracker.test-3133"><span class="linenos">3133</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="ZakatTracker.test-3134"><a href="#ZakatTracker.test-3134"><span class="linenos">3134</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="ZakatTracker.test-3135"><a href="#ZakatTracker.test-3135"><span class="linenos">3135</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="ZakatTracker.test-3136"><a href="#ZakatTracker.test-3136"><span class="linenos">3136</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3137"><a href="#ZakatTracker.test-3137"><span class="linenos">3137</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker.test-3138"><a href="#ZakatTracker.test-3138"><span class="linenos">3138</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3139"><a href="#ZakatTracker.test-3139"><span class="linenos">3139</span></a>
</span><span id="ZakatTracker.test-3140"><a href="#ZakatTracker.test-3140"><span class="linenos">3140</span></a>            <span class="c1"># exchange</span>
</span><span id="ZakatTracker.test-3141"><a href="#ZakatTracker.test-3141"><span class="linenos">3141</span></a>
</span><span id="ZakatTracker.test-3142"><a href="#ZakatTracker.test-3142"><span class="linenos">3142</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mf">3.75</span><span class="p">,</span> <span class="s2">&quot;2024-06-25&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3143"><a href="#ZakatTracker.test-3143"><span class="linenos">3143</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mf">3.73</span><span class="p">,</span> <span class="s2">&quot;2024-06-22&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3144"><a href="#ZakatTracker.test-3144"><span class="linenos">3144</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">3.69</span><span class="p">,</span> <span class="s2">&quot;2024-06-15&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3145"><a href="#ZakatTracker.test-3145"><span class="linenos">3145</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">3.66</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3146"><a href="#ZakatTracker.test-3146"><span class="linenos">3146</span></a>
</span><span id="ZakatTracker.test-3147"><a href="#ZakatTracker.test-3147"><span class="linenos">3147</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
</span><span id="ZakatTracker.test-3148"><a href="#ZakatTracker.test-3148"><span class="linenos">3148</span></a>                <span class="n">exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3149"><a href="#ZakatTracker.test-3149"><span class="linenos">3149</span></a>                <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3150"><a href="#ZakatTracker.test-3150"><span class="linenos">3150</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3151"><a href="#ZakatTracker.test-3151"><span class="linenos">3151</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3152"><a href="#ZakatTracker.test-3152"><span class="linenos">3152</span></a>                <span class="k">assert</span> <span class="n">created</span>
</span><span id="ZakatTracker.test-3153"><a href="#ZakatTracker.test-3153"><span class="linenos">3153</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3154"><a href="#ZakatTracker.test-3154"><span class="linenos">3154</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="ZakatTracker.test-3155"><a href="#ZakatTracker.test-3155"><span class="linenos">3155</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3156"><a href="#ZakatTracker.test-3156"><span class="linenos">3156</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3157"><a href="#ZakatTracker.test-3157"><span class="linenos">3157</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.66</span>
</span><span id="ZakatTracker.test-3158"><a href="#ZakatTracker.test-3158"><span class="linenos">3158</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3159"><a href="#ZakatTracker.test-3159"><span class="linenos">3159</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3160"><a href="#ZakatTracker.test-3160"><span class="linenos">3160</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.66</span>
</span><span id="ZakatTracker.test-3161"><a href="#ZakatTracker.test-3161"><span class="linenos">3161</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3162"><a href="#ZakatTracker.test-3162"><span class="linenos">3162</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3163"><a href="#ZakatTracker.test-3163"><span class="linenos">3163</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.69</span>
</span><span id="ZakatTracker.test-3164"><a href="#ZakatTracker.test-3164"><span class="linenos">3164</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3165"><a href="#ZakatTracker.test-3165"><span class="linenos">3165</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">22</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3166"><a href="#ZakatTracker.test-3166"><span class="linenos">3166</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.69</span>
</span><span id="ZakatTracker.test-3167"><a href="#ZakatTracker.test-3167"><span class="linenos">3167</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3168"><a href="#ZakatTracker.test-3168"><span class="linenos">3168</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3169"><a href="#ZakatTracker.test-3169"><span class="linenos">3169</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.73</span>
</span><span id="ZakatTracker.test-3170"><a href="#ZakatTracker.test-3170"><span class="linenos">3170</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3171"><a href="#ZakatTracker.test-3171"><span class="linenos">3171</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3172"><a href="#ZakatTracker.test-3172"><span class="linenos">3172</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.75</span>
</span><span id="ZakatTracker.test-3173"><a href="#ZakatTracker.test-3173"><span class="linenos">3173</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3174"><a href="#ZakatTracker.test-3174"><span class="linenos">3174</span></a>                <span class="n">exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;bank&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3175"><a href="#ZakatTracker.test-3175"><span class="linenos">3175</span></a>                <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3176"><a href="#ZakatTracker.test-3176"><span class="linenos">3176</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3177"><a href="#ZakatTracker.test-3177"><span class="linenos">3177</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3178"><a href="#ZakatTracker.test-3178"><span class="linenos">3178</span></a>                <span class="k">assert</span> <span class="n">created</span>
</span><span id="ZakatTracker.test-3179"><a href="#ZakatTracker.test-3179"><span class="linenos">3179</span></a>                <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="ZakatTracker.test-3180"><a href="#ZakatTracker.test-3180"><span class="linenos">3180</span></a>                <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3181"><a href="#ZakatTracker.test-3181"><span class="linenos">3181</span></a>
</span><span id="ZakatTracker.test-3182"><a href="#ZakatTracker.test-3182"><span class="linenos">3182</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3183"><a href="#ZakatTracker.test-3183"><span class="linenos">3183</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchanges</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3184"><a href="#ZakatTracker.test-3184"><span class="linenos">3184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3185"><a href="#ZakatTracker.test-3185"><span class="linenos">3185</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3186"><a href="#ZakatTracker.test-3186"><span class="linenos">3186</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchanges</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3187"><a href="#ZakatTracker.test-3187"><span class="linenos">3187</span></a>
</span><span id="ZakatTracker.test-3188"><a href="#ZakatTracker.test-3188"><span class="linenos">3188</span></a>            <span class="c1"># حفظ أسعار الصرف باستخدام التواريخ بالنانو ثانية</span>
</span><span id="ZakatTracker.test-3189"><a href="#ZakatTracker.test-3189"><span class="linenos">3189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">day_to_time</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span> <span class="mf">3.75</span><span class="p">,</span> <span class="s2">&quot;2024-06-25&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3190"><a href="#ZakatTracker.test-3190"><span class="linenos">3190</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">day_to_time</span><span class="p">(</span><span class="mi">22</span><span class="p">),</span> <span class="mf">3.73</span><span class="p">,</span> <span class="s2">&quot;2024-06-22&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3191"><a href="#ZakatTracker.test-3191"><span class="linenos">3191</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">day_to_time</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span> <span class="mf">3.69</span><span class="p">,</span> <span class="s2">&quot;2024-06-15&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3192"><a href="#ZakatTracker.test-3192"><span class="linenos">3192</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">day_to_time</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="mf">3.66</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3193"><a href="#ZakatTracker.test-3193"><span class="linenos">3193</span></a>
</span><span id="ZakatTracker.test-3194"><a href="#ZakatTracker.test-3194"><span class="linenos">3194</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.12</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">21</span><span class="p">)]:</span>
</span><span id="ZakatTracker.test-3195"><a href="#ZakatTracker.test-3195"><span class="linenos">3195</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3196"><a href="#ZakatTracker.test-3196"><span class="linenos">3196</span></a>                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;range(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3197"><a href="#ZakatTracker.test-3197"><span class="linenos">3197</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3198"><a href="#ZakatTracker.test-3198"><span class="linenos">3198</span></a>                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;range(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3199"><a href="#ZakatTracker.test-3199"><span class="linenos">3199</span></a>
</span><span id="ZakatTracker.test-3200"><a href="#ZakatTracker.test-3200"><span class="linenos">3200</span></a>            <span class="c1"># اختبار النتائج باستخدام التواريخ بالنانو ثانية</span>
</span><span id="ZakatTracker.test-3201"><a href="#ZakatTracker.test-3201"><span class="linenos">3201</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">):</span>
</span><span id="ZakatTracker.test-3202"><a href="#ZakatTracker.test-3202"><span class="linenos">3202</span></a>                <span class="n">timestamp_ns</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">day_to_time</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3203"><a href="#ZakatTracker.test-3203"><span class="linenos">3203</span></a>                <span class="n">exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span> <span class="n">timestamp_ns</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3204"><a href="#ZakatTracker.test-3204"><span class="linenos">3204</span></a>                <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3205"><a href="#ZakatTracker.test-3205"><span class="linenos">3205</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3206"><a href="#ZakatTracker.test-3206"><span class="linenos">3206</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3207"><a href="#ZakatTracker.test-3207"><span class="linenos">3207</span></a>                <span class="k">assert</span> <span class="n">created</span>
</span><span id="ZakatTracker.test-3208"><a href="#ZakatTracker.test-3208"><span class="linenos">3208</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3209"><a href="#ZakatTracker.test-3209"><span class="linenos">3209</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="ZakatTracker.test-3210"><a href="#ZakatTracker.test-3210"><span class="linenos">3210</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3211"><a href="#ZakatTracker.test-3211"><span class="linenos">3211</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3212"><a href="#ZakatTracker.test-3212"><span class="linenos">3212</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.66</span>
</span><span id="ZakatTracker.test-3213"><a href="#ZakatTracker.test-3213"><span class="linenos">3213</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3214"><a href="#ZakatTracker.test-3214"><span class="linenos">3214</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3215"><a href="#ZakatTracker.test-3215"><span class="linenos">3215</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.66</span>
</span><span id="ZakatTracker.test-3216"><a href="#ZakatTracker.test-3216"><span class="linenos">3216</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3217"><a href="#ZakatTracker.test-3217"><span class="linenos">3217</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3218"><a href="#ZakatTracker.test-3218"><span class="linenos">3218</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.69</span>
</span><span id="ZakatTracker.test-3219"><a href="#ZakatTracker.test-3219"><span class="linenos">3219</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3220"><a href="#ZakatTracker.test-3220"><span class="linenos">3220</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">22</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3221"><a href="#ZakatTracker.test-3221"><span class="linenos">3221</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.69</span>
</span><span id="ZakatTracker.test-3222"><a href="#ZakatTracker.test-3222"><span class="linenos">3222</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3223"><a href="#ZakatTracker.test-3223"><span class="linenos">3223</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3224"><a href="#ZakatTracker.test-3224"><span class="linenos">3224</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.73</span>
</span><span id="ZakatTracker.test-3225"><a href="#ZakatTracker.test-3225"><span class="linenos">3225</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3226"><a href="#ZakatTracker.test-3226"><span class="linenos">3226</span></a>                <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3227"><a href="#ZakatTracker.test-3227"><span class="linenos">3227</span></a>                    <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mf">3.75</span>
</span><span id="ZakatTracker.test-3228"><a href="#ZakatTracker.test-3228"><span class="linenos">3228</span></a>                    <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3229"><a href="#ZakatTracker.test-3229"><span class="linenos">3229</span></a>                <span class="n">exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;bank&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3230"><a href="#ZakatTracker.test-3230"><span class="linenos">3230</span></a>                <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span> <span class="n">exchange</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3231"><a href="#ZakatTracker.test-3231"><span class="linenos">3231</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3232"><a href="#ZakatTracker.test-3232"><span class="linenos">3232</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3233"><a href="#ZakatTracker.test-3233"><span class="linenos">3233</span></a>                <span class="k">assert</span> <span class="n">created</span>
</span><span id="ZakatTracker.test-3234"><a href="#ZakatTracker.test-3234"><span class="linenos">3234</span></a>                <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="ZakatTracker.test-3235"><a href="#ZakatTracker.test-3235"><span class="linenos">3235</span></a>                <span class="k">assert</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ZakatTracker.test-3236"><a href="#ZakatTracker.test-3236"><span class="linenos">3236</span></a>
</span><span id="ZakatTracker.test-3237"><a href="#ZakatTracker.test-3237"><span class="linenos">3237</span></a>            <span class="c1"># csv</span>
</span><span id="ZakatTracker.test-3238"><a href="#ZakatTracker.test-3238"><span class="linenos">3238</span></a>
</span><span id="ZakatTracker.test-3239"><a href="#ZakatTracker.test-3239"><span class="linenos">3239</span></a>            <span class="n">csv_count</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="ZakatTracker.test-3240"><a href="#ZakatTracker.test-3240"><span class="linenos">3240</span></a>
</span><span id="ZakatTracker.test-3241"><a href="#ZakatTracker.test-3241"><span class="linenos">3241</span></a>            <span class="k">for</span> <span class="n">with_rate</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">{</span>
</span><span id="ZakatTracker.test-3242"><a href="#ZakatTracker.test-3242"><span class="linenos">3242</span></a>                <span class="kc">False</span><span class="p">:</span> <span class="s1">&#39;test-import_csv-no-exchange&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3243"><a href="#ZakatTracker.test-3243"><span class="linenos">3243</span></a>                <span class="kc">True</span><span class="p">:</span> <span class="s1">&#39;test-import_csv-with-exchange&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3244"><a href="#ZakatTracker.test-3244"><span class="linenos">3244</span></a>            <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker.test-3245"><a href="#ZakatTracker.test-3245"><span class="linenos">3245</span></a>
</span><span id="ZakatTracker.test-3246"><a href="#ZakatTracker.test-3246"><span class="linenos">3246</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3247"><a href="#ZakatTracker.test-3247"><span class="linenos">3247</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test_import_csv&#39;</span><span class="p">,</span> <span class="n">with_rate</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3248"><a href="#ZakatTracker.test-3248"><span class="linenos">3248</span></a>
</span><span id="ZakatTracker.test-3249"><a href="#ZakatTracker.test-3249"><span class="linenos">3249</span></a>                <span class="n">csv_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>
</span><span id="ZakatTracker.test-3250"><a href="#ZakatTracker.test-3250"><span class="linenos">3250</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">csv_path</span><span class="p">):</span>
</span><span id="ZakatTracker.test-3251"><a href="#ZakatTracker.test-3251"><span class="linenos">3251</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3252"><a href="#ZakatTracker.test-3252"><span class="linenos">3252</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_random_csv_file</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">csv_count</span><span class="p">,</span> <span class="n">with_rate</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3253"><a href="#ZakatTracker.test-3253"><span class="linenos">3253</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3254"><a href="#ZakatTracker.test-3254"><span class="linenos">3254</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;generate_random_csv_file&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3255"><a href="#ZakatTracker.test-3255"><span class="linenos">3255</span></a>                <span class="k">assert</span> <span class="n">c</span> <span class="o">==</span> <span class="n">csv_count</span>
</span><span id="ZakatTracker.test-3256"><a href="#ZakatTracker.test-3256"><span class="linenos">3256</span></a>                <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3257"><a href="#ZakatTracker.test-3257"><span class="linenos">3257</span></a>                <span class="n">cache_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_csv_cache_path</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3258"><a href="#ZakatTracker.test-3258"><span class="linenos">3258</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cache_path</span><span class="p">):</span>
</span><span id="ZakatTracker.test-3259"><a href="#ZakatTracker.test-3259"><span class="linenos">3259</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3260"><a href="#ZakatTracker.test-3260"><span class="linenos">3260</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3261"><a href="#ZakatTracker.test-3261"><span class="linenos">3261</span></a>                <span class="p">(</span><span class="n">created</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">bad</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3262"><a href="#ZakatTracker.test-3262"><span class="linenos">3262</span></a>                <span class="n">bad_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3263"><a href="#ZakatTracker.test-3263"><span class="linenos">3263</span></a>                <span class="k">assert</span> <span class="n">bad_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3264"><a href="#ZakatTracker.test-3264"><span class="linenos">3264</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3265"><a href="#ZakatTracker.test-3265"><span class="linenos">3265</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;csv-imported: (</span><span class="si">{</span><span class="n">created</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">found</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">bad_count</span><span class="si">}</span><span class="s2">) = count(</span><span class="si">{</span><span class="n">csv_count</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3266"><a href="#ZakatTracker.test-3266"><span class="linenos">3266</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bad&#39;</span><span class="p">,</span> <span class="n">bad</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3267"><a href="#ZakatTracker.test-3267"><span class="linenos">3267</span></a>                <span class="n">tmp_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3268"><a href="#ZakatTracker.test-3268"><span class="linenos">3268</span></a>                <span class="k">assert</span> <span class="n">tmp_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3269"><a href="#ZakatTracker.test-3269"><span class="linenos">3269</span></a>                <span class="c1"># TODO: assert created + found + bad_count == csv_count</span>
</span><span id="ZakatTracker.test-3270"><a href="#ZakatTracker.test-3270"><span class="linenos">3270</span></a>                <span class="c1"># TODO: assert created == csv_count</span>
</span><span id="ZakatTracker.test-3271"><a href="#ZakatTracker.test-3271"><span class="linenos">3271</span></a>                <span class="c1"># TODO: assert bad_count == 0</span>
</span><span id="ZakatTracker.test-3272"><a href="#ZakatTracker.test-3272"><span class="linenos">3272</span></a>                <span class="p">(</span><span class="n">created_2</span><span class="p">,</span> <span class="n">found_2</span><span class="p">,</span> <span class="n">bad_2</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3273"><a href="#ZakatTracker.test-3273"><span class="linenos">3273</span></a>                <span class="n">bad_2_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bad_2</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3274"><a href="#ZakatTracker.test-3274"><span class="linenos">3274</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3275"><a href="#ZakatTracker.test-3275"><span class="linenos">3275</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;csv-imported: (</span><span class="si">{</span><span class="n">created_2</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">found_2</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">bad_2_count</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3276"><a href="#ZakatTracker.test-3276"><span class="linenos">3276</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bad&#39;</span><span class="p">,</span> <span class="n">bad</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3277"><a href="#ZakatTracker.test-3277"><span class="linenos">3277</span></a>                <span class="k">assert</span> <span class="n">bad_2_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3278"><a href="#ZakatTracker.test-3278"><span class="linenos">3278</span></a>                <span class="c1"># TODO: assert tmp_size == os.path.getsize(cache_path)</span>
</span><span id="ZakatTracker.test-3279"><a href="#ZakatTracker.test-3279"><span class="linenos">3279</span></a>                <span class="c1"># TODO: assert created_2 + found_2 + bad_2_count == csv_count</span>
</span><span id="ZakatTracker.test-3280"><a href="#ZakatTracker.test-3280"><span class="linenos">3280</span></a>                <span class="c1"># TODO: assert created == found_2</span>
</span><span id="ZakatTracker.test-3281"><a href="#ZakatTracker.test-3281"><span class="linenos">3281</span></a>                <span class="c1"># TODO: assert bad_count == bad_2_count</span>
</span><span id="ZakatTracker.test-3282"><a href="#ZakatTracker.test-3282"><span class="linenos">3282</span></a>                <span class="c1"># TODO: assert found_2 == csv_count</span>
</span><span id="ZakatTracker.test-3283"><a href="#ZakatTracker.test-3283"><span class="linenos">3283</span></a>                <span class="c1"># TODO: assert bad_2_count == 0</span>
</span><span id="ZakatTracker.test-3284"><a href="#ZakatTracker.test-3284"><span class="linenos">3284</span></a>                <span class="c1"># TODO: assert created_2 == 0</span>
</span><span id="ZakatTracker.test-3285"><a href="#ZakatTracker.test-3285"><span class="linenos">3285</span></a>
</span><span id="ZakatTracker.test-3286"><a href="#ZakatTracker.test-3286"><span class="linenos">3286</span></a>                <span class="c1"># payment parts</span>
</span><span id="ZakatTracker.test-3287"><a href="#ZakatTracker.test-3287"><span class="linenos">3287</span></a>
</span><span id="ZakatTracker.test-3288"><a href="#ZakatTracker.test-3288"><span class="linenos">3288</span></a>                <span class="n">positive_parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_payment_parts</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">positive_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3289"><a href="#ZakatTracker.test-3289"><span class="linenos">3289</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_payment_parts</span><span class="p">(</span><span class="n">positive_parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3290"><a href="#ZakatTracker.test-3290"><span class="linenos">3290</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_payment_parts</span><span class="p">(</span><span class="n">positive_parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3291"><a href="#ZakatTracker.test-3291"><span class="linenos">3291</span></a>                <span class="n">all_parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_payment_parts</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="n">positive_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3292"><a href="#ZakatTracker.test-3292"><span class="linenos">3292</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_payment_parts</span><span class="p">(</span><span class="n">all_parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3293"><a href="#ZakatTracker.test-3293"><span class="linenos">3293</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_payment_parts</span><span class="p">(</span><span class="n">all_parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3294"><a href="#ZakatTracker.test-3294"><span class="linenos">3294</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3295"><a href="#ZakatTracker.test-3295"><span class="linenos">3295</span></a>                    <span class="n">pp</span><span class="p">()</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">positive_parts</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3296"><a href="#ZakatTracker.test-3296"><span class="linenos">3296</span></a>                    <span class="n">pp</span><span class="p">()</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">all_parts</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3297"><a href="#ZakatTracker.test-3297"><span class="linenos">3297</span></a>                <span class="c1"># dynamic discount</span>
</span><span id="ZakatTracker.test-3298"><a href="#ZakatTracker.test-3298"><span class="linenos">3298</span></a>                <span class="n">suite</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker.test-3299"><a href="#ZakatTracker.test-3299"><span class="linenos">3299</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="ZakatTracker.test-3300"><a href="#ZakatTracker.test-3300"><span class="linenos">3300</span></a>                <span class="k">for</span> <span class="n">exceed</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]:</span>
</span><span id="ZakatTracker.test-3301"><a href="#ZakatTracker.test-3301"><span class="linenos">3301</span></a>                    <span class="n">case</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ZakatTracker.test-3302"><a href="#ZakatTracker.test-3302"><span class="linenos">3302</span></a>                    <span class="k">for</span> <span class="n">parts</span> <span class="ow">in</span> <span class="p">[</span><span class="n">positive_parts</span><span class="p">,</span> <span class="n">all_parts</span><span class="p">]:</span>
</span><span id="ZakatTracker.test-3303"><a href="#ZakatTracker.test-3303"><span class="linenos">3303</span></a>                        <span class="n">part</span> <span class="o">=</span> <span class="n">parts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3304"><a href="#ZakatTracker.test-3304"><span class="linenos">3304</span></a>                        <span class="n">demand</span> <span class="o">=</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;demand&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3305"><a href="#ZakatTracker.test-3305"><span class="linenos">3305</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3306"><a href="#ZakatTracker.test-3306"><span class="linenos">3306</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.test-3307"><a href="#ZakatTracker.test-3307"><span class="linenos">3307</span></a>                        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3308"><a href="#ZakatTracker.test-3308"><span class="linenos">3308</span></a>                        <span class="n">z</span> <span class="o">=</span> <span class="n">demand</span> <span class="o">/</span> <span class="n">count</span>
</span><span id="ZakatTracker.test-3309"><a href="#ZakatTracker.test-3309"><span class="linenos">3309</span></a>                        <span class="n">cp</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ZakatTracker.test-3310"><a href="#ZakatTracker.test-3310"><span class="linenos">3310</span></a>                            <span class="s1">&#39;account&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="ZakatTracker.test-3311"><a href="#ZakatTracker.test-3311"><span class="linenos">3311</span></a>                            <span class="s1">&#39;demand&#39;</span><span class="p">:</span> <span class="n">demand</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3312"><a href="#ZakatTracker.test-3312"><span class="linenos">3312</span></a>                            <span class="s1">&#39;exceed&#39;</span><span class="p">:</span> <span class="n">exceed</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3313"><a href="#ZakatTracker.test-3313"><span class="linenos">3313</span></a>                            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">],</span>
</span><span id="ZakatTracker.test-3314"><a href="#ZakatTracker.test-3314"><span class="linenos">3314</span></a>                        <span class="p">}</span>
</span><span id="ZakatTracker.test-3315"><a href="#ZakatTracker.test-3315"><span class="linenos">3315</span></a>                        <span class="n">j</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="ZakatTracker.test-3316"><a href="#ZakatTracker.test-3316"><span class="linenos">3316</span></a>                        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">part</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker.test-3317"><a href="#ZakatTracker.test-3317"><span class="linenos">3317</span></a>                            <span class="n">x_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3318"><a href="#ZakatTracker.test-3318"><span class="linenos">3318</span></a>                            <span class="n">zz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange_calc</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.test-3319"><a href="#ZakatTracker.test-3319"><span class="linenos">3319</span></a>                            <span class="k">if</span> <span class="n">exceed</span> <span class="ow">and</span> <span class="n">zz</span> <span class="o">&lt;=</span> <span class="n">demand</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3320"><a href="#ZakatTracker.test-3320"><span class="linenos">3320</span></a>                                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker.test-3321"><a href="#ZakatTracker.test-3321"><span class="linenos">3321</span></a>                                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zz</span>
</span><span id="ZakatTracker.test-3322"><a href="#ZakatTracker.test-3322"><span class="linenos">3322</span></a>                                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3323"><a href="#ZakatTracker.test-3323"><span class="linenos">3323</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="n">exceed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3324"><a href="#ZakatTracker.test-3324"><span class="linenos">3324</span></a>                                <span class="n">cp</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
</span><span id="ZakatTracker.test-3325"><a href="#ZakatTracker.test-3325"><span class="linenos">3325</span></a>                                <span class="k">case</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3326"><a href="#ZakatTracker.test-3326"><span class="linenos">3326</span></a>                            <span class="k">elif</span> <span class="ow">not</span> <span class="n">exceed</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">zz</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3327"><a href="#ZakatTracker.test-3327"><span class="linenos">3327</span></a>                                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker.test-3328"><a href="#ZakatTracker.test-3328"><span class="linenos">3328</span></a>                                <span class="n">y</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zz</span>
</span><span id="ZakatTracker.test-3329"><a href="#ZakatTracker.test-3329"><span class="linenos">3329</span></a>                                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3330"><a href="#ZakatTracker.test-3330"><span class="linenos">3330</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="n">exceed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3331"><a href="#ZakatTracker.test-3331"><span class="linenos">3331</span></a>                                <span class="n">cp</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
</span><span id="ZakatTracker.test-3332"><a href="#ZakatTracker.test-3332"><span class="linenos">3332</span></a>                                <span class="k">case</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3333"><a href="#ZakatTracker.test-3333"><span class="linenos">3333</span></a>                            <span class="n">j</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="ZakatTracker.test-3334"><a href="#ZakatTracker.test-3334"><span class="linenos">3334</span></a>                            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">count</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3335"><a href="#ZakatTracker.test-3335"><span class="linenos">3335</span></a>                                <span class="k">break</span>
</span><span id="ZakatTracker.test-3336"><a href="#ZakatTracker.test-3336"><span class="linenos">3336</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cp</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3337"><a href="#ZakatTracker.test-3337"><span class="linenos">3337</span></a>                            <span class="n">suite</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3338"><a href="#ZakatTracker.test-3338"><span class="linenos">3338</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3339"><a href="#ZakatTracker.test-3339"><span class="linenos">3339</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;suite&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">suite</span><span class="p">))</span>
</span><span id="ZakatTracker.test-3340"><a href="#ZakatTracker.test-3340"><span class="linenos">3340</span></a>                <span class="c1"># vault = self._vault.copy()</span>
</span><span id="ZakatTracker.test-3341"><a href="#ZakatTracker.test-3341"><span class="linenos">3341</span></a>                <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">suite</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3342"><a href="#ZakatTracker.test-3342"><span class="linenos">3342</span></a>                    <span class="c1"># self._vault = vault.copy()</span>
</span><span id="ZakatTracker.test-3343"><a href="#ZakatTracker.test-3343"><span class="linenos">3343</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3344"><a href="#ZakatTracker.test-3344"><span class="linenos">3344</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;case&#39;</span><span class="p">,</span> <span class="n">case</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3345"><a href="#ZakatTracker.test-3345"><span class="linenos">3345</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_payment_parts</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3346"><a href="#ZakatTracker.test-3346"><span class="linenos">3346</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3347"><a href="#ZakatTracker.test-3347"><span class="linenos">3347</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_payment_parts&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;exceed: </span><span class="si">{</span><span class="n">exceed</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3348"><a href="#ZakatTracker.test-3348"><span class="linenos">3348</span></a>                    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3349"><a href="#ZakatTracker.test-3349"><span class="linenos">3349</span></a>
</span><span id="ZakatTracker.test-3350"><a href="#ZakatTracker.test-3350"><span class="linenos">3350</span></a>                    <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="mf">2.17</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3351"><a href="#ZakatTracker.test-3351"><span class="linenos">3351</span></a>                    <span class="p">(</span><span class="n">valid</span><span class="p">,</span> <span class="n">brief</span><span class="p">,</span> <span class="n">plan</span><span class="p">)</span> <span class="o">=</span> <span class="n">report</span>
</span><span id="ZakatTracker.test-3352"><a href="#ZakatTracker.test-3352"><span class="linenos">3352</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3353"><a href="#ZakatTracker.test-3353"><span class="linenos">3353</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;valid&#39;</span><span class="p">,</span> <span class="n">valid</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3354"><a href="#ZakatTracker.test-3354"><span class="linenos">3354</span></a>                    <span class="n">zakat_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zakat</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="n">case</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3355"><a href="#ZakatTracker.test-3355"><span class="linenos">3355</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3356"><a href="#ZakatTracker.test-3356"><span class="linenos">3356</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;zakat-result&#39;</span><span class="p">,</span> <span class="n">zakat_result</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3357"><a href="#ZakatTracker.test-3357"><span class="linenos">3357</span></a>                    <span class="k">assert</span> <span class="n">valid</span> <span class="o">==</span> <span class="n">zakat_result</span>
</span><span id="ZakatTracker.test-3358"><a href="#ZakatTracker.test-3358"><span class="linenos">3358</span></a>
</span><span id="ZakatTracker.test-3359"><a href="#ZakatTracker.test-3359"><span class="linenos">3359</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3360"><a href="#ZakatTracker.test-3360"><span class="linenos">3360</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_json</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3361"><a href="#ZakatTracker.test-3361"><span class="linenos">3361</span></a>
</span><span id="ZakatTracker.test-3362"><a href="#ZakatTracker.test-3362"><span class="linenos">3362</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_json</span><span class="p">(</span><span class="s2">&quot;1000-transactions-test.json&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3363"><a href="#ZakatTracker.test-3363"><span class="linenos">3363</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1000-transactions-test.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3364"><a href="#ZakatTracker.test-3364"><span class="linenos">3364</span></a>
</span><span id="ZakatTracker.test-3365"><a href="#ZakatTracker.test-3365"><span class="linenos">3365</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3366"><a href="#ZakatTracker.test-3366"><span class="linenos">3366</span></a>
</span><span id="ZakatTracker.test-3367"><a href="#ZakatTracker.test-3367"><span class="linenos">3367</span></a>            <span class="c1"># test transfer between accounts with different exchange rate</span>
</span><span id="ZakatTracker.test-3368"><a href="#ZakatTracker.test-3368"><span class="linenos">3368</span></a>
</span><span id="ZakatTracker.test-3369"><a href="#ZakatTracker.test-3369"><span class="linenos">3369</span></a>            <span class="n">a_SAR</span> <span class="o">=</span> <span class="s2">&quot;Bank (SAR)&quot;</span>
</span><span id="ZakatTracker.test-3370"><a href="#ZakatTracker.test-3370"><span class="linenos">3370</span></a>            <span class="n">b_USD</span> <span class="o">=</span> <span class="s2">&quot;Bank (USD)&quot;</span>
</span><span id="ZakatTracker.test-3371"><a href="#ZakatTracker.test-3371"><span class="linenos">3371</span></a>            <span class="n">c_SAR</span> <span class="o">=</span> <span class="s2">&quot;Safe (SAR)&quot;</span>
</span><span id="ZakatTracker.test-3372"><a href="#ZakatTracker.test-3372"><span class="linenos">3372</span></a>            <span class="c1"># 0: track, 1: check-exchange, 2: do-exchange, 3: transfer</span>
</span><span id="ZakatTracker.test-3373"><a href="#ZakatTracker.test-3373"><span class="linenos">3373</span></a>            <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="ZakatTracker.test-3374"><a href="#ZakatTracker.test-3374"><span class="linenos">3374</span></a>                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_SAR</span><span class="p">,</span> <span class="s2">&quot;SAR Gift&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3375"><a href="#ZakatTracker.test-3375"><span class="linenos">3375</span></a>                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">a_SAR</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3376"><a href="#ZakatTracker.test-3376"><span class="linenos">3376</span></a>                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="s2">&quot;USD Gift&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">50000</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3377"><a href="#ZakatTracker.test-3377"><span class="linenos">3377</span></a>                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3378"><a href="#ZakatTracker.test-3378"><span class="linenos">3378</span></a>                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="mf">3.75</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3379"><a href="#ZakatTracker.test-3379"><span class="linenos">3379</span></a>                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="mf">3.75</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3380"><a href="#ZakatTracker.test-3380"><span class="linenos">3380</span></a>                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="n">a_SAR</span><span class="p">,</span> <span class="s2">&quot;100 USD -&gt; SAR&quot;</span><span class="p">,</span> <span class="mi">40000</span><span class="p">,</span> <span class="mi">137500</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3381"><a href="#ZakatTracker.test-3381"><span class="linenos">3381</span></a>                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c_SAR</span><span class="p">,</span> <span class="s2">&quot;Salary&quot;</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">75000</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3382"><a href="#ZakatTracker.test-3382"><span class="linenos">3382</span></a>                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="n">c_SAR</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="s2">&quot;375 SAR -&gt; USD&quot;</span><span class="p">,</span> <span class="mi">37500</span><span class="p">,</span> <span class="mi">50000</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3383"><a href="#ZakatTracker.test-3383"><span class="linenos">3383</span></a>                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">3.75</span><span class="p">,</span> <span class="n">a_SAR</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="s2">&quot;3.75 SAR -&gt; USD&quot;</span><span class="p">,</span> <span class="mi">137125</span><span class="p">,</span> <span class="mi">50100</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3384"><a href="#ZakatTracker.test-3384"><span class="linenos">3384</span></a>            <span class="p">]:</span>
</span><span id="ZakatTracker.test-3385"><a href="#ZakatTracker.test-3385"><span class="linenos">3385</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3386"><a href="#ZakatTracker.test-3386"><span class="linenos">3386</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;case&#39;</span><span class="p">,</span> <span class="n">case</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3387"><a href="#ZakatTracker.test-3387"><span class="linenos">3387</span></a>                <span class="k">match</span> <span class="p">(</span><span class="n">case</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="ZakatTracker.test-3388"><a href="#ZakatTracker.test-3388"><span class="linenos">3388</span></a>                    <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># track</span>
</span><span id="ZakatTracker.test-3389"><a href="#ZakatTracker.test-3389"><span class="linenos">3389</span></a>                        <span class="n">_</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">case</span>
</span><span id="ZakatTracker.test-3390"><a href="#ZakatTracker.test-3390"><span class="linenos">3390</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="n">unscaled_value</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3391"><a href="#ZakatTracker.test-3391"><span class="linenos">3391</span></a>
</span><span id="ZakatTracker.test-3392"><a href="#ZakatTracker.test-3392"><span class="linenos">3392</span></a>                        <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3393"><a href="#ZakatTracker.test-3393"><span class="linenos">3393</span></a>                        <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3394"><a href="#ZakatTracker.test-3394"><span class="linenos">3394</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3395"><a href="#ZakatTracker.test-3395"><span class="linenos">3395</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span> <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3396"><a href="#ZakatTracker.test-3396"><span class="linenos">3396</span></a>                        <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">balance</span>
</span><span id="ZakatTracker.test-3397"><a href="#ZakatTracker.test-3397"><span class="linenos">3397</span></a>                        <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">balance</span>
</span><span id="ZakatTracker.test-3398"><a href="#ZakatTracker.test-3398"><span class="linenos">3398</span></a>                    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># check-exchange</span>
</span><span id="ZakatTracker.test-3399"><a href="#ZakatTracker.test-3399"><span class="linenos">3399</span></a>                        <span class="n">_</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">expected_rate</span> <span class="o">=</span> <span class="n">case</span>
</span><span id="ZakatTracker.test-3400"><a href="#ZakatTracker.test-3400"><span class="linenos">3400</span></a>                        <span class="n">t_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3401"><a href="#ZakatTracker.test-3401"><span class="linenos">3401</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3402"><a href="#ZakatTracker.test-3402"><span class="linenos">3402</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t-exchange&#39;</span><span class="p">,</span> <span class="n">t_exchange</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3403"><a href="#ZakatTracker.test-3403"><span class="linenos">3403</span></a>                        <span class="k">assert</span> <span class="n">t_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_rate</span>
</span><span id="ZakatTracker.test-3404"><a href="#ZakatTracker.test-3404"><span class="linenos">3404</span></a>                    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># do-exchange</span>
</span><span id="ZakatTracker.test-3405"><a href="#ZakatTracker.test-3405"><span class="linenos">3405</span></a>                        <span class="n">_</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">case</span>
</span><span id="ZakatTracker.test-3406"><a href="#ZakatTracker.test-3406"><span class="linenos">3406</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3407"><a href="#ZakatTracker.test-3407"><span class="linenos">3407</span></a>                        <span class="n">b_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3408"><a href="#ZakatTracker.test-3408"><span class="linenos">3408</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3409"><a href="#ZakatTracker.test-3409"><span class="linenos">3409</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;b-exchange&#39;</span><span class="p">,</span> <span class="n">b_exchange</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3410"><a href="#ZakatTracker.test-3410"><span class="linenos">3410</span></a>                        <span class="k">assert</span> <span class="n">b_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">rate</span>
</span><span id="ZakatTracker.test-3411"><a href="#ZakatTracker.test-3411"><span class="linenos">3411</span></a>                    <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># transfer</span>
</span><span id="ZakatTracker.test-3412"><a href="#ZakatTracker.test-3412"><span class="linenos">3412</span></a>                        <span class="n">_</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">a_balance</span><span class="p">,</span> <span class="n">b_balance</span> <span class="o">=</span> <span class="n">case</span>
</span><span id="ZakatTracker.test-3413"><a href="#ZakatTracker.test-3413"><span class="linenos">3413</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3414"><a href="#ZakatTracker.test-3414"><span class="linenos">3414</span></a>
</span><span id="ZakatTracker.test-3415"><a href="#ZakatTracker.test-3415"><span class="linenos">3415</span></a>                        <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3416"><a href="#ZakatTracker.test-3416"><span class="linenos">3416</span></a>                        <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3417"><a href="#ZakatTracker.test-3417"><span class="linenos">3417</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3418"><a href="#ZakatTracker.test-3418"><span class="linenos">3418</span></a>                            <span class="nb">print</span><span class="p">(</span>
</span><span id="ZakatTracker.test-3419"><a href="#ZakatTracker.test-3419"><span class="linenos">3419</span></a>                                <span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3420"><a href="#ZakatTracker.test-3420"><span class="linenos">3420</span></a>                                <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3421"><a href="#ZakatTracker.test-3421"><span class="linenos">3421</span></a>                                <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3422"><a href="#ZakatTracker.test-3422"><span class="linenos">3422</span></a>                                <span class="s1">&#39;a_balance&#39;</span><span class="p">,</span> <span class="n">a_balance</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3423"><a href="#ZakatTracker.test-3423"><span class="linenos">3423</span></a>                            <span class="p">)</span>
</span><span id="ZakatTracker.test-3424"><a href="#ZakatTracker.test-3424"><span class="linenos">3424</span></a>                        <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">a_balance</span>
</span><span id="ZakatTracker.test-3425"><a href="#ZakatTracker.test-3425"><span class="linenos">3425</span></a>                        <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">a_balance</span>
</span><span id="ZakatTracker.test-3426"><a href="#ZakatTracker.test-3426"><span class="linenos">3426</span></a>
</span><span id="ZakatTracker.test-3427"><a href="#ZakatTracker.test-3427"><span class="linenos">3427</span></a>                        <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3428"><a href="#ZakatTracker.test-3428"><span class="linenos">3428</span></a>                        <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3429"><a href="#ZakatTracker.test-3429"><span class="linenos">3429</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3430"><a href="#ZakatTracker.test-3430"><span class="linenos">3430</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span> <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3431"><a href="#ZakatTracker.test-3431"><span class="linenos">3431</span></a>                        <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">b_balance</span>
</span><span id="ZakatTracker.test-3432"><a href="#ZakatTracker.test-3432"><span class="linenos">3432</span></a>                        <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">b_balance</span>
</span><span id="ZakatTracker.test-3433"><a href="#ZakatTracker.test-3433"><span class="linenos">3433</span></a>
</span><span id="ZakatTracker.test-3434"><a href="#ZakatTracker.test-3434"><span class="linenos">3434</span></a>            <span class="c1"># Transfer all in many chunks randomly from B to A</span>
</span><span id="ZakatTracker.test-3435"><a href="#ZakatTracker.test-3435"><span class="linenos">3435</span></a>            <span class="n">a_SAR_balance</span> <span class="o">=</span> <span class="mi">137125</span>
</span><span id="ZakatTracker.test-3436"><a href="#ZakatTracker.test-3436"><span class="linenos">3436</span></a>            <span class="n">b_USD_balance</span> <span class="o">=</span> <span class="mi">50100</span>
</span><span id="ZakatTracker.test-3437"><a href="#ZakatTracker.test-3437"><span class="linenos">3437</span></a>            <span class="n">b_USD_exchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">b_USD</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3438"><a href="#ZakatTracker.test-3438"><span class="linenos">3438</span></a>            <span class="n">amounts</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">create_random_list</span><span class="p">(</span><span class="n">b_USD_balance</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3439"><a href="#ZakatTracker.test-3439"><span class="linenos">3439</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3440"><a href="#ZakatTracker.test-3440"><span class="linenos">3440</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;amounts&#39;</span><span class="p">,</span> <span class="n">amounts</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3441"><a href="#ZakatTracker.test-3441"><span class="linenos">3441</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3442"><a href="#ZakatTracker.test-3442"><span class="linenos">3442</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">amounts</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3443"><a href="#ZakatTracker.test-3443"><span class="linenos">3443</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3444"><a href="#ZakatTracker.test-3444"><span class="linenos">3444</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> - transfer-with-exchange(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3445"><a href="#ZakatTracker.test-3445"><span class="linenos">3445</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span>
</span><span id="ZakatTracker.test-3446"><a href="#ZakatTracker.test-3446"><span class="linenos">3446</span></a>                    <span class="n">unscaled_amount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3447"><a href="#ZakatTracker.test-3447"><span class="linenos">3447</span></a>                    <span class="n">from_account</span><span class="o">=</span><span class="n">b_USD</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3448"><a href="#ZakatTracker.test-3448"><span class="linenos">3448</span></a>                    <span class="n">to_account</span><span class="o">=</span><span class="n">a_SAR</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3449"><a href="#ZakatTracker.test-3449"><span class="linenos">3449</span></a>                    <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> USD -&gt; SAR&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3450"><a href="#ZakatTracker.test-3450"><span class="linenos">3450</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3451"><a href="#ZakatTracker.test-3451"><span class="linenos">3451</span></a>                <span class="p">)</span>
</span><span id="ZakatTracker.test-3452"><a href="#ZakatTracker.test-3452"><span class="linenos">3452</span></a>
</span><span id="ZakatTracker.test-3453"><a href="#ZakatTracker.test-3453"><span class="linenos">3453</span></a>                <span class="n">b_USD_balance</span> <span class="o">-=</span> <span class="n">x</span>
</span><span id="ZakatTracker.test-3454"><a href="#ZakatTracker.test-3454"><span class="linenos">3454</span></a>                <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">b_USD</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3455"><a href="#ZakatTracker.test-3455"><span class="linenos">3455</span></a>                <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">b_USD</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3456"><a href="#ZakatTracker.test-3456"><span class="linenos">3456</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3457"><a href="#ZakatTracker.test-3457"><span class="linenos">3457</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">b_USD</span><span class="p">,</span> <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span> <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">,</span> <span class="s1">&#39;excepted&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3458"><a href="#ZakatTracker.test-3458"><span class="linenos">3458</span></a>                          <span class="n">b_USD_balance</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3459"><a href="#ZakatTracker.test-3459"><span class="linenos">3459</span></a>                <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">b_USD_balance</span>
</span><span id="ZakatTracker.test-3460"><a href="#ZakatTracker.test-3460"><span class="linenos">3460</span></a>                <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">b_USD_balance</span>
</span><span id="ZakatTracker.test-3461"><a href="#ZakatTracker.test-3461"><span class="linenos">3461</span></a>
</span><span id="ZakatTracker.test-3462"><a href="#ZakatTracker.test-3462"><span class="linenos">3462</span></a>                <span class="n">a_SAR_balance</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">b_USD_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.test-3463"><a href="#ZakatTracker.test-3463"><span class="linenos">3463</span></a>                <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">a_SAR</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3464"><a href="#ZakatTracker.test-3464"><span class="linenos">3464</span></a>                <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">a_SAR</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3465"><a href="#ZakatTracker.test-3465"><span class="linenos">3465</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3466"><a href="#ZakatTracker.test-3466"><span class="linenos">3466</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">a_SAR</span><span class="p">,</span> <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span> <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">,</span> <span class="s1">&#39;expected&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3467"><a href="#ZakatTracker.test-3467"><span class="linenos">3467</span></a>                          <span class="n">a_SAR_balance</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">,</span> <span class="n">b_USD_exchange</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.test-3468"><a href="#ZakatTracker.test-3468"><span class="linenos">3468</span></a>                <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">a_SAR_balance</span>
</span><span id="ZakatTracker.test-3469"><a href="#ZakatTracker.test-3469"><span class="linenos">3469</span></a>                <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">a_SAR_balance</span>
</span><span id="ZakatTracker.test-3470"><a href="#ZakatTracker.test-3470"><span class="linenos">3470</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker.test-3471"><a href="#ZakatTracker.test-3471"><span class="linenos">3471</span></a>
</span><span id="ZakatTracker.test-3472"><a href="#ZakatTracker.test-3472"><span class="linenos">3472</span></a>            <span class="c1"># Transfer all in many chunks randomly from C to A</span>
</span><span id="ZakatTracker.test-3473"><a href="#ZakatTracker.test-3473"><span class="linenos">3473</span></a>            <span class="n">c_SAR_balance</span> <span class="o">=</span> <span class="mi">37500</span>
</span><span id="ZakatTracker.test-3474"><a href="#ZakatTracker.test-3474"><span class="linenos">3474</span></a>            <span class="n">amounts</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">create_random_list</span><span class="p">(</span><span class="n">c_SAR_balance</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3475"><a href="#ZakatTracker.test-3475"><span class="linenos">3475</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3476"><a href="#ZakatTracker.test-3476"><span class="linenos">3476</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;amounts&#39;</span><span class="p">,</span> <span class="n">amounts</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3477"><a href="#ZakatTracker.test-3477"><span class="linenos">3477</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3478"><a href="#ZakatTracker.test-3478"><span class="linenos">3478</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">amounts</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3479"><a href="#ZakatTracker.test-3479"><span class="linenos">3479</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3480"><a href="#ZakatTracker.test-3480"><span class="linenos">3480</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> - transfer-with-exchange(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3481"><a href="#ZakatTracker.test-3481"><span class="linenos">3481</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span>
</span><span id="ZakatTracker.test-3482"><a href="#ZakatTracker.test-3482"><span class="linenos">3482</span></a>                    <span class="n">unscaled_amount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unscale</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3483"><a href="#ZakatTracker.test-3483"><span class="linenos">3483</span></a>                    <span class="n">from_account</span><span class="o">=</span><span class="n">c_SAR</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3484"><a href="#ZakatTracker.test-3484"><span class="linenos">3484</span></a>                    <span class="n">to_account</span><span class="o">=</span><span class="n">a_SAR</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3485"><a href="#ZakatTracker.test-3485"><span class="linenos">3485</span></a>                    <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> SAR -&gt; a_SAR&quot;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3486"><a href="#ZakatTracker.test-3486"><span class="linenos">3486</span></a>                    <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3487"><a href="#ZakatTracker.test-3487"><span class="linenos">3487</span></a>                <span class="p">)</span>
</span><span id="ZakatTracker.test-3488"><a href="#ZakatTracker.test-3488"><span class="linenos">3488</span></a>
</span><span id="ZakatTracker.test-3489"><a href="#ZakatTracker.test-3489"><span class="linenos">3489</span></a>                <span class="n">c_SAR_balance</span> <span class="o">-=</span> <span class="n">x</span>
</span><span id="ZakatTracker.test-3490"><a href="#ZakatTracker.test-3490"><span class="linenos">3490</span></a>                <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">c_SAR</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3491"><a href="#ZakatTracker.test-3491"><span class="linenos">3491</span></a>                <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">c_SAR</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3492"><a href="#ZakatTracker.test-3492"><span class="linenos">3492</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3493"><a href="#ZakatTracker.test-3493"><span class="linenos">3493</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">c_SAR</span><span class="p">,</span> <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span> <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">,</span> <span class="s1">&#39;excepted&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3494"><a href="#ZakatTracker.test-3494"><span class="linenos">3494</span></a>                          <span class="n">c_SAR_balance</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3495"><a href="#ZakatTracker.test-3495"><span class="linenos">3495</span></a>                <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">c_SAR_balance</span>
</span><span id="ZakatTracker.test-3496"><a href="#ZakatTracker.test-3496"><span class="linenos">3496</span></a>                <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">c_SAR_balance</span>
</span><span id="ZakatTracker.test-3497"><a href="#ZakatTracker.test-3497"><span class="linenos">3497</span></a>
</span><span id="ZakatTracker.test-3498"><a href="#ZakatTracker.test-3498"><span class="linenos">3498</span></a>                <span class="n">a_SAR_balance</span> <span class="o">+=</span> <span class="n">x</span>
</span><span id="ZakatTracker.test-3499"><a href="#ZakatTracker.test-3499"><span class="linenos">3499</span></a>                <span class="n">cached_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">a_SAR</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3500"><a href="#ZakatTracker.test-3500"><span class="linenos">3500</span></a>                <span class="n">fresh_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">a_SAR</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3501"><a href="#ZakatTracker.test-3501"><span class="linenos">3501</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3502"><a href="#ZakatTracker.test-3502"><span class="linenos">3502</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account&#39;</span><span class="p">,</span> <span class="n">a_SAR</span><span class="p">,</span> <span class="s1">&#39;cached_value&#39;</span><span class="p">,</span> <span class="n">cached_value</span><span class="p">,</span> <span class="s1">&#39;fresh_value&#39;</span><span class="p">,</span> <span class="n">fresh_value</span><span class="p">,</span> <span class="s1">&#39;expected&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3503"><a href="#ZakatTracker.test-3503"><span class="linenos">3503</span></a>                          <span class="n">a_SAR_balance</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3504"><a href="#ZakatTracker.test-3504"><span class="linenos">3504</span></a>                <span class="k">assert</span> <span class="n">cached_value</span> <span class="o">==</span> <span class="n">a_SAR_balance</span>
</span><span id="ZakatTracker.test-3505"><a href="#ZakatTracker.test-3505"><span class="linenos">3505</span></a>                <span class="k">assert</span> <span class="n">fresh_value</span> <span class="o">==</span> <span class="n">a_SAR_balance</span>
</span><span id="ZakatTracker.test-3506"><a href="#ZakatTracker.test-3506"><span class="linenos">3506</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ZakatTracker.test-3507"><a href="#ZakatTracker.test-3507"><span class="linenos">3507</span></a>
</span><span id="ZakatTracker.test-3508"><a href="#ZakatTracker.test-3508"><span class="linenos">3508</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_json</span><span class="p">(</span><span class="s2">&quot;accounts-transfer-with-exchange-rates.json&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3509"><a href="#ZakatTracker.test-3509"><span class="linenos">3509</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;accounts-transfer-with-exchange-rates.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3510"><a href="#ZakatTracker.test-3510"><span class="linenos">3510</span></a>
</span><span id="ZakatTracker.test-3511"><a href="#ZakatTracker.test-3511"><span class="linenos">3511</span></a>            <span class="c1"># check &amp; zakat with exchange rates for many cycles</span>
</span><span id="ZakatTracker.test-3512"><a href="#ZakatTracker.test-3512"><span class="linenos">3512</span></a>
</span><span id="ZakatTracker.test-3513"><a href="#ZakatTracker.test-3513"><span class="linenos">3513</span></a>            <span class="k">for</span> <span class="n">rate</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="p">{</span>
</span><span id="ZakatTracker.test-3514"><a href="#ZakatTracker.test-3514"><span class="linenos">3514</span></a>                <span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker.test-3515"><a href="#ZakatTracker.test-3515"><span class="linenos">3515</span></a>                    <span class="s1">&#39;in&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">],</span>
</span><span id="ZakatTracker.test-3516"><a href="#ZakatTracker.test-3516"><span class="linenos">3516</span></a>                    <span class="s1">&#39;exchanged&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">200000</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">],</span>
</span><span id="ZakatTracker.test-3517"><a href="#ZakatTracker.test-3517"><span class="linenos">3517</span></a>                    <span class="s1">&#39;out&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2500</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">73140</span><span class="p">],</span>
</span><span id="ZakatTracker.test-3518"><a href="#ZakatTracker.test-3518"><span class="linenos">3518</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker.test-3519"><a href="#ZakatTracker.test-3519"><span class="linenos">3519</span></a>                <span class="mf">3.75</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ZakatTracker.test-3520"><a href="#ZakatTracker.test-3520"><span class="linenos">3520</span></a>                    <span class="s1">&#39;in&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">],</span>
</span><span id="ZakatTracker.test-3521"><a href="#ZakatTracker.test-3521"><span class="linenos">3521</span></a>                    <span class="s1">&#39;exchanged&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">75000</span><span class="p">,</span> <span class="mi">375000</span><span class="p">,</span> <span class="mi">1875000</span><span class="p">],</span>
</span><span id="ZakatTracker.test-3522"><a href="#ZakatTracker.test-3522"><span class="linenos">3522</span></a>                    <span class="s1">&#39;out&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1875</span><span class="p">,</span> <span class="mi">9375</span><span class="p">,</span> <span class="mi">137138</span><span class="p">],</span>
</span><span id="ZakatTracker.test-3523"><a href="#ZakatTracker.test-3523"><span class="linenos">3523</span></a>                <span class="p">},</span>
</span><span id="ZakatTracker.test-3524"><a href="#ZakatTracker.test-3524"><span class="linenos">3524</span></a>            <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ZakatTracker.test-3525"><a href="#ZakatTracker.test-3525"><span class="linenos">3525</span></a>                <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;in&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3526"><a href="#ZakatTracker.test-3526"><span class="linenos">3526</span></a>                <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;exchanged&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3527"><a href="#ZakatTracker.test-3527"><span class="linenos">3527</span></a>                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3528"><a href="#ZakatTracker.test-3528"><span class="linenos">3528</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3529"><a href="#ZakatTracker.test-3529"><span class="linenos">3529</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;rate&#39;</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3530"><a href="#ZakatTracker.test-3530"><span class="linenos">3530</span></a>                <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="ZakatTracker.test-3531"><a href="#ZakatTracker.test-3531"><span class="linenos">3531</span></a>                    <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;safe&#39;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">TimeCycle</span><span class="p">(),</span> <span class="p">[</span>
</span><span id="ZakatTracker.test-3532"><a href="#ZakatTracker.test-3532"><span class="linenos">3532</span></a>                        <span class="p">{</span><span class="s1">&#39;safe&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;below_nisab&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">}}},</span>
</span><span id="ZakatTracker.test-3533"><a href="#ZakatTracker.test-3533"><span class="linenos">3533</span></a>                    <span class="p">],</span> <span class="kc">False</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3534"><a href="#ZakatTracker.test-3534"><span class="linenos">3534</span></a>                    <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;safe&#39;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">TimeCycle</span><span class="p">(),</span> <span class="p">[</span>
</span><span id="ZakatTracker.test-3535"><a href="#ZakatTracker.test-3535"><span class="linenos">3535</span></a>                        <span class="p">{</span><span class="s1">&#39;safe&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">}}},</span>
</span><span id="ZakatTracker.test-3536"><a href="#ZakatTracker.test-3536"><span class="linenos">3536</span></a>                    <span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3537"><a href="#ZakatTracker.test-3537"><span class="linenos">3537</span></a>                    <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;cave&#39;</span><span class="p">,</span> <span class="n">ZakatTracker</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="n">ZakatTracker</span><span class="o">.</span><span class="n">TimeCycle</span><span class="p">()</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span> <span class="p">[</span>
</span><span id="ZakatTracker.test-3538"><a href="#ZakatTracker.test-3538"><span class="linenos">3538</span></a>                        <span class="p">{</span><span class="s1">&#39;cave&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">}}},</span>
</span><span id="ZakatTracker.test-3539"><a href="#ZakatTracker.test-3539"><span class="linenos">3539</span></a>                    <span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="n">o</span><span class="p">),</span>
</span><span id="ZakatTracker.test-3540"><a href="#ZakatTracker.test-3540"><span class="linenos">3540</span></a>                <span class="p">]:</span>
</span><span id="ZakatTracker.test-3541"><a href="#ZakatTracker.test-3541"><span class="linenos">3541</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3542"><a href="#ZakatTracker.test-3542"><span class="linenos">3542</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;############# check(rate: </span><span class="si">{</span><span class="n">rate</span><span class="si">}</span><span class="s2">) #############&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3543"><a href="#ZakatTracker.test-3543"><span class="linenos">3543</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;case&#39;</span><span class="p">,</span> <span class="n">case</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3544"><a href="#ZakatTracker.test-3544"><span class="linenos">3544</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3545"><a href="#ZakatTracker.test-3545"><span class="linenos">3545</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">account</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">created</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rate</span><span class="o">=</span><span class="n">rate</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3546"><a href="#ZakatTracker.test-3546"><span class="linenos">3546</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">(</span>
</span><span id="ZakatTracker.test-3547"><a href="#ZakatTracker.test-3547"><span class="linenos">3547</span></a>                        <span class="n">unscaled_value</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="ZakatTracker.test-3548"><a href="#ZakatTracker.test-3548"><span class="linenos">3548</span></a>                        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;test-check&#39;</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3549"><a href="#ZakatTracker.test-3549"><span class="linenos">3549</span></a>                        <span class="n">account</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ZakatTracker.test-3550"><a href="#ZakatTracker.test-3550"><span class="linenos">3550</span></a>                        <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ZakatTracker.test-3551"><a href="#ZakatTracker.test-3551"><span class="linenos">3551</span></a>                        <span class="n">created</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="ZakatTracker.test-3552"><a href="#ZakatTracker.test-3552"><span class="linenos">3552</span></a>                    <span class="p">)</span>
</span><span id="ZakatTracker.test-3553"><a href="#ZakatTracker.test-3553"><span class="linenos">3553</span></a>                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3554"><a href="#ZakatTracker.test-3554"><span class="linenos">3554</span></a>
</span><span id="ZakatTracker.test-3555"><a href="#ZakatTracker.test-3555"><span class="linenos">3555</span></a>                    <span class="c1"># assert self.nolock()</span>
</span><span id="ZakatTracker.test-3556"><a href="#ZakatTracker.test-3556"><span class="linenos">3556</span></a>                    <span class="c1"># history_size = len(self._vault[&#39;history&#39;])</span>
</span><span id="ZakatTracker.test-3557"><a href="#ZakatTracker.test-3557"><span class="linenos">3557</span></a>                    <span class="c1"># print(&#39;history_size&#39;, history_size)</span>
</span><span id="ZakatTracker.test-3558"><a href="#ZakatTracker.test-3558"><span class="linenos">3558</span></a>                    <span class="c1"># assert history_size == 2</span>
</span><span id="ZakatTracker.test-3559"><a href="#ZakatTracker.test-3559"><span class="linenos">3559</span></a>                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3560"><a href="#ZakatTracker.test-3560"><span class="linenos">3560</span></a>                    <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3561"><a href="#ZakatTracker.test-3561"><span class="linenos">3561</span></a>                    <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="mf">2.17</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3562"><a href="#ZakatTracker.test-3562"><span class="linenos">3562</span></a>                    <span class="p">(</span><span class="n">valid</span><span class="p">,</span> <span class="n">brief</span><span class="p">,</span> <span class="n">plan</span><span class="p">)</span> <span class="o">=</span> <span class="n">report</span>
</span><span id="ZakatTracker.test-3563"><a href="#ZakatTracker.test-3563"><span class="linenos">3563</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3564"><a href="#ZakatTracker.test-3564"><span class="linenos">3564</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;brief&#39;</span><span class="p">,</span> <span class="n">brief</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3565"><a href="#ZakatTracker.test-3565"><span class="linenos">3565</span></a>                    <span class="k">assert</span> <span class="n">valid</span> <span class="o">==</span> <span class="n">case</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3566"><a href="#ZakatTracker.test-3566"><span class="linenos">3566</span></a>                    <span class="k">assert</span> <span class="n">case</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="n">brief</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3567"><a href="#ZakatTracker.test-3567"><span class="linenos">3567</span></a>                    <span class="k">assert</span> <span class="n">case</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="n">brief</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3568"><a href="#ZakatTracker.test-3568"><span class="linenos">3568</span></a>
</span><span id="ZakatTracker.test-3569"><a href="#ZakatTracker.test-3569"><span class="linenos">3569</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3570"><a href="#ZakatTracker.test-3570"><span class="linenos">3570</span></a>                        <span class="n">pp</span><span class="p">()</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">plan</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3571"><a href="#ZakatTracker.test-3571"><span class="linenos">3571</span></a>
</span><span id="ZakatTracker.test-3572"><a href="#ZakatTracker.test-3572"><span class="linenos">3572</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3573"><a href="#ZakatTracker.test-3573"><span class="linenos">3573</span></a>                        <span class="k">assert</span> <span class="n">case</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span>
</span><span id="ZakatTracker.test-3574"><a href="#ZakatTracker.test-3574"><span class="linenos">3574</span></a>                        <span class="k">if</span> <span class="s1">&#39;total&#39;</span> <span class="ow">in</span> <span class="n">case</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ZakatTracker.test-3575"><a href="#ZakatTracker.test-3575"><span class="linenos">3575</span></a>                            <span class="k">assert</span> <span class="n">case</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">brief</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="ZakatTracker.test-3576"><a href="#ZakatTracker.test-3576"><span class="linenos">3576</span></a>                            <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">case</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3577"><a href="#ZakatTracker.test-3577"><span class="linenos">3577</span></a>                            <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">case</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3578"><a href="#ZakatTracker.test-3578"><span class="linenos">3578</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3579"><a href="#ZakatTracker.test-3579"><span class="linenos">3579</span></a>                            <span class="k">assert</span> <span class="n">plan</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;below_nisab&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">case</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;below_nisab&#39;</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3580"><a href="#ZakatTracker.test-3580"><span class="linenos">3580</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3581"><a href="#ZakatTracker.test-3581"><span class="linenos">3581</span></a>                        <span class="n">pp</span><span class="p">()</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3582"><a href="#ZakatTracker.test-3582"><span class="linenos">3582</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zakat</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3583"><a href="#ZakatTracker.test-3583"><span class="linenos">3583</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3584"><a href="#ZakatTracker.test-3584"><span class="linenos">3584</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;zakat-result&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">case</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="ZakatTracker.test-3585"><a href="#ZakatTracker.test-3585"><span class="linenos">3585</span></a>                    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="n">case</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="ZakatTracker.test-3586"><a href="#ZakatTracker.test-3586"><span class="linenos">3586</span></a>                    <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="mf">2.17</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3587"><a href="#ZakatTracker.test-3587"><span class="linenos">3587</span></a>                    <span class="p">(</span><span class="n">valid</span><span class="p">,</span> <span class="n">brief</span><span class="p">,</span> <span class="n">plan</span><span class="p">)</span> <span class="o">=</span> <span class="n">report</span>
</span><span id="ZakatTracker.test-3588"><a href="#ZakatTracker.test-3588"><span class="linenos">3588</span></a>                    <span class="k">assert</span> <span class="n">valid</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker.test-3589"><a href="#ZakatTracker.test-3589"><span class="linenos">3589</span></a>
</span><span id="ZakatTracker.test-3590"><a href="#ZakatTracker.test-3590"><span class="linenos">3590</span></a>            <span class="n">history_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.test-3591"><a href="#ZakatTracker.test-3591"><span class="linenos">3591</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3592"><a href="#ZakatTracker.test-3592"><span class="linenos">3592</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;history_size&#39;</span><span class="p">,</span> <span class="n">history_size</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3593"><a href="#ZakatTracker.test-3593"><span class="linenos">3593</span></a>            <span class="k">assert</span> <span class="n">history_size</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="ZakatTracker.test-3594"><a href="#ZakatTracker.test-3594"><span class="linenos">3594</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3595"><a href="#ZakatTracker.test-3595"><span class="linenos">3595</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker.test-3596"><a href="#ZakatTracker.test-3596"><span class="linenos">3596</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">())</span>
</span><span id="ZakatTracker.test-3597"><a href="#ZakatTracker.test-3597"><span class="linenos">3597</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3598"><a href="#ZakatTracker.test-3598"><span class="linenos">3598</span></a>
</span><span id="ZakatTracker.test-3599"><a href="#ZakatTracker.test-3599"><span class="linenos">3599</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="ZakatTracker.test-3600"><a href="#ZakatTracker.test-3600"><span class="linenos">3600</span></a>                <span class="n">history_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.test-3601"><a href="#ZakatTracker.test-3601"><span class="linenos">3601</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3602"><a href="#ZakatTracker.test-3602"><span class="linenos">3602</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;history_size&#39;</span><span class="p">,</span> <span class="n">history_size</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3603"><a href="#ZakatTracker.test-3603"><span class="linenos">3603</span></a>                <span class="k">assert</span> <span class="n">history_size</span> <span class="o">==</span> <span class="n">i</span>
</span><span id="ZakatTracker.test-3604"><a href="#ZakatTracker.test-3604"><span class="linenos">3604</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="ZakatTracker.test-3605"><a href="#ZakatTracker.test-3605"><span class="linenos">3605</span></a>
</span><span id="ZakatTracker.test-3606"><a href="#ZakatTracker.test-3606"><span class="linenos">3606</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3607"><a href="#ZakatTracker.test-3607"><span class="linenos">3607</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="ZakatTracker.test-3608"><a href="#ZakatTracker.test-3608"><span class="linenos">3608</span></a>
</span><span id="ZakatTracker.test-3609"><a href="#ZakatTracker.test-3609"><span class="linenos">3609</span></a>            <span class="n">history_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;history&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.test-3610"><a href="#ZakatTracker.test-3610"><span class="linenos">3610</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3611"><a href="#ZakatTracker.test-3611"><span class="linenos">3611</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;history_size&#39;</span><span class="p">,</span> <span class="n">history_size</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3612"><a href="#ZakatTracker.test-3612"><span class="linenos">3612</span></a>            <span class="k">assert</span> <span class="n">history_size</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3613"><a href="#ZakatTracker.test-3613"><span class="linenos">3613</span></a>
</span><span id="ZakatTracker.test-3614"><a href="#ZakatTracker.test-3614"><span class="linenos">3614</span></a>            <span class="n">account_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;account&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.test-3615"><a href="#ZakatTracker.test-3615"><span class="linenos">3615</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3616"><a href="#ZakatTracker.test-3616"><span class="linenos">3616</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;account_size&#39;</span><span class="p">,</span> <span class="n">account_size</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3617"><a href="#ZakatTracker.test-3617"><span class="linenos">3617</span></a>            <span class="k">assert</span> <span class="n">account_size</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3618"><a href="#ZakatTracker.test-3618"><span class="linenos">3618</span></a>
</span><span id="ZakatTracker.test-3619"><a href="#ZakatTracker.test-3619"><span class="linenos">3619</span></a>            <span class="n">report_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vault</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">])</span>
</span><span id="ZakatTracker.test-3620"><a href="#ZakatTracker.test-3620"><span class="linenos">3620</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3621"><a href="#ZakatTracker.test-3621"><span class="linenos">3621</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;report_size&#39;</span><span class="p">,</span> <span class="n">report_size</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3622"><a href="#ZakatTracker.test-3622"><span class="linenos">3622</span></a>            <span class="k">assert</span> <span class="n">report_size</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ZakatTracker.test-3623"><a href="#ZakatTracker.test-3623"><span class="linenos">3623</span></a>
</span><span id="ZakatTracker.test-3624"><a href="#ZakatTracker.test-3624"><span class="linenos">3624</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolock</span><span class="p">()</span>
</span><span id="ZakatTracker.test-3625"><a href="#ZakatTracker.test-3625"><span class="linenos">3625</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ZakatTracker.test-3626"><a href="#ZakatTracker.test-3626"><span class="linenos">3626</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ZakatTracker.test-3627"><a href="#ZakatTracker.test-3627"><span class="linenos">3627</span></a>            <span class="c1"># pp().pprint(self._vault)</span>
</span><span id="ZakatTracker.test-3628"><a href="#ZakatTracker.test-3628"><span class="linenos">3628</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_json</span><span class="p">(</span><span class="s2">&quot;test-snapshot.json&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3629"><a href="#ZakatTracker.test-3629"><span class="linenos">3629</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test-snapshot.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ZakatTracker.test-3630"><a href="#ZakatTracker.test-3630"><span class="linenos">3630</span></a>            <span class="k">raise</span> <span class="n">e</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="test">
                            <input id="test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="test-3633"><a href="#test-3633"><span class="linenos">3633</span></a><span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="test-3634"><a href="#test-3634"><span class="linenos">3634</span></a>    <span class="n">ledger</span> <span class="o">=</span> <span class="n">ZakatTracker</span><span class="p">(</span><span class="s2">&quot;./zakat_test_db&quot;</span><span class="p">)</span>
</span><span id="test-3635"><a href="#test-3635"><span class="linenos">3635</span></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
</span><span id="test-3636"><a href="#test-3636"><span class="linenos">3636</span></a>    <span class="k">assert</span> <span class="n">ledger</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
</span><span id="test-3637"><a href="#test-3637"><span class="linenos">3637</span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="test-3638"><a href="#test-3638"><span class="linenos">3638</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#########################&quot;</span><span class="p">)</span>
</span><span id="test-3639"><a href="#test-3639"><span class="linenos">3639</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;######## TEST DONE ########&quot;</span><span class="p">)</span>
</span><span id="test-3640"><a href="#test-3640"><span class="linenos">3640</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#########################&quot;</span><span class="p">)</span>
</span><span id="test-3641"><a href="#test-3641"><span class="linenos">3641</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">ZakatTracker</span><span class="o">.</span><span class="n">duration_from_nanoseconds</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
</span><span id="test-3642"><a href="#test-3642"><span class="linenos">3642</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#########################&quot;</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="Action">
                            <input id="Action-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Action</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="Action-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Action"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Action-88"><a href="#Action-88"><span class="linenos">88</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Action</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="Action-89"><a href="#Action-89"><span class="linenos">89</span></a>    <span class="n">CREATE</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Action-90"><a href="#Action-90"><span class="linenos">90</span></a>    <span class="n">TRACK</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Action-91"><a href="#Action-91"><span class="linenos">91</span></a>    <span class="n">LOG</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="Action-92"><a href="#Action-92"><span class="linenos">92</span></a>    <span class="n">SUB</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="Action-93"><a href="#Action-93"><span class="linenos">93</span></a>    <span class="n">ADD_FILE</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="Action-94"><a href="#Action-94"><span class="linenos">94</span></a>    <span class="n">REMOVE_FILE</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Action-95"><a href="#Action-95"><span class="linenos">95</span></a>    <span class="n">BOX_TRANSFER</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="Action-96"><a href="#Action-96"><span class="linenos">96</span></a>    <span class="n">EXCHANGE</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="Action-97"><a href="#Action-97"><span class="linenos">97</span></a>    <span class="n">REPORT</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="Action-98"><a href="#Action-98"><span class="linenos">98</span></a>    <span class="n">ZAKAT</span> <span class="o">=</span> <span class="mi">9</span>
</span></pre></div>


    

                            <div id="Action.CREATE" class="classattr">
                                <div class="attr variable">
            <span class="name">CREATE</span>        =
<span class="default_value">&lt;<a href="#Action.CREATE">Action.CREATE</a>: 0&gt;</span>

        
    </div>
    <a class="headerlink" href="#Action.CREATE"></a>
    
    

                            </div>
                            <div id="Action.TRACK" class="classattr">
                                <div class="attr variable">
            <span class="name">TRACK</span>        =
<span class="default_value">&lt;<a href="#Action.TRACK">Action.TRACK</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#Action.TRACK"></a>
    
    

                            </div>
                            <div id="Action.LOG" class="classattr">
                                <div class="attr variable">
            <span class="name">LOG</span>        =
<span class="default_value">&lt;<a href="#Action.LOG">Action.LOG</a>: 2&gt;</span>

        
    </div>
    <a class="headerlink" href="#Action.LOG"></a>
    
    

                            </div>
                            <div id="Action.SUB" class="classattr">
                                <div class="attr variable">
            <span class="name">SUB</span>        =
<span class="default_value">&lt;<a href="#Action.SUB">Action.SUB</a>: 3&gt;</span>

        
    </div>
    <a class="headerlink" href="#Action.SUB"></a>
    
    

                            </div>
                            <div id="Action.ADD_FILE" class="classattr">
                                <div class="attr variable">
            <span class="name">ADD_FILE</span>        =
<span class="default_value">&lt;<a href="#Action.ADD_FILE">Action.ADD_FILE</a>: 4&gt;</span>

        
    </div>
    <a class="headerlink" href="#Action.ADD_FILE"></a>
    
    

                            </div>
                            <div id="Action.REMOVE_FILE" class="classattr">
                                <div class="attr variable">
            <span class="name">REMOVE_FILE</span>        =
<span class="default_value">&lt;<a href="#Action.REMOVE_FILE">Action.REMOVE_FILE</a>: 5&gt;</span>

        
    </div>
    <a class="headerlink" href="#Action.REMOVE_FILE"></a>
    
    

                            </div>
                            <div id="Action.BOX_TRANSFER" class="classattr">
                                <div class="attr variable">
            <span class="name">BOX_TRANSFER</span>        =
<span class="default_value">&lt;<a href="#Action.BOX_TRANSFER">Action.BOX_TRANSFER</a>: 6&gt;</span>

        
    </div>
    <a class="headerlink" href="#Action.BOX_TRANSFER"></a>
    
    

                            </div>
                            <div id="Action.EXCHANGE" class="classattr">
                                <div class="attr variable">
            <span class="name">EXCHANGE</span>        =
<span class="default_value">&lt;<a href="#Action.EXCHANGE">Action.EXCHANGE</a>: 7&gt;</span>

        
    </div>
    <a class="headerlink" href="#Action.EXCHANGE"></a>
    
    

                            </div>
                            <div id="Action.REPORT" class="classattr">
                                <div class="attr variable">
            <span class="name">REPORT</span>        =
<span class="default_value">&lt;<a href="#Action.REPORT">Action.REPORT</a>: 8&gt;</span>

        
    </div>
    <a class="headerlink" href="#Action.REPORT"></a>
    
    

                            </div>
                            <div id="Action.ZAKAT" class="classattr">
                                <div class="attr variable">
            <span class="name">ZAKAT</span>        =
<span class="default_value">&lt;<a href="#Action.ZAKAT">Action.ZAKAT</a>: 9&gt;</span>

        
    </div>
    <a class="headerlink" href="#Action.ZAKAT"></a>
    
    

                            </div>
                </section>
                <section id="JSONEncoder">
                            <input id="JSONEncoder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">JSONEncoder</span><wbr>(<span class="base">json.encoder.JSONEncoder</span>):

                <label class="view-source-button" for="JSONEncoder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JSONEncoder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JSONEncoder-107"><a href="#JSONEncoder-107"><span class="linenos">107</span></a><span class="k">class</span><span class="w"> </span><span class="nc">JSONEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
</span><span id="JSONEncoder-108"><a href="#JSONEncoder-108"><span class="linenos">108</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
</span><span id="JSONEncoder-109"><a href="#JSONEncoder-109"><span class="linenos">109</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">MathOperation</span><span class="p">):</span>
</span><span id="JSONEncoder-110"><a href="#JSONEncoder-110"><span class="linenos">110</span></a>            <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># Serialize as the enum member&#39;s name</span>
</span><span id="JSONEncoder-111"><a href="#JSONEncoder-111"><span class="linenos">111</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">):</span>
</span><span id="JSONEncoder-112"><a href="#JSONEncoder-112"><span class="linenos">112</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
</span><span id="JSONEncoder-113"><a href="#JSONEncoder-113"><span class="linenos">113</span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extensible JSON <a href="https://json.org">https://json.org</a> encoder for Python data structures.</p>

<p>Supports the following objects and types by default:</p>

<p>+-------------------+---------------+
| Python            | JSON          |
+===================+===============+
| dict              | object        |
+-------------------+---------------+
| list, tuple       | array         |
+-------------------+---------------+
| str               | string        |
+-------------------+---------------+
| int, float        | number        |
+-------------------+---------------+
| True              | true          |
+-------------------+---------------+
| False             | false         |
+-------------------+---------------+
| None              | null          |
+-------------------+---------------+</p>

<p>To extend this to recognize other objects, subclass and implement a
<code>.default()</code> method with another method that returns a serializable
object for <code>o</code> if possible, otherwise it should call the superclass
implementation (to raise <code>TypeError</code>).</p>
</div>


                            <div id="JSONEncoder.default" class="classattr">
                                        <input id="JSONEncoder.default-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">default</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">o</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="JSONEncoder.default-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JSONEncoder.default"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JSONEncoder.default-108"><a href="#JSONEncoder.default-108"><span class="linenos">108</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
</span><span id="JSONEncoder.default-109"><a href="#JSONEncoder.default-109"><span class="linenos">109</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">MathOperation</span><span class="p">):</span>
</span><span id="JSONEncoder.default-110"><a href="#JSONEncoder.default-110"><span class="linenos">110</span></a>            <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># Serialize as the enum member&#39;s name</span>
</span><span id="JSONEncoder.default-111"><a href="#JSONEncoder.default-111"><span class="linenos">111</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">):</span>
</span><span id="JSONEncoder.default-112"><a href="#JSONEncoder.default-112"><span class="linenos">112</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
</span><span id="JSONEncoder.default-113"><a href="#JSONEncoder.default-113"><span class="linenos">113</span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Implement this method in a subclass such that it returns
a serializable object for <code>o</code>, or calls the base implementation
(to raise a <code>TypeError</code>).</p>

<p>For example, to support arbitrary iterators, you could
implement default like this::</p>

<pre><code>def default(self, o):
    try:
        iterable = iter(o)
    except TypeError:
        pass
    else:
        return list(iterable)
    # Let the base class default method raise the TypeError
    return <a href="#JSONEncoder.default">JSONEncoder.default</a>(self, o)
</code></pre>
</div>


                            </div>
                </section>
                <section id="MathOperation">
                            <input id="MathOperation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MathOperation</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="MathOperation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MathOperation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MathOperation-101"><a href="#MathOperation-101"><span class="linenos">101</span></a><span class="k">class</span><span class="w"> </span><span class="nc">MathOperation</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="MathOperation-102"><a href="#MathOperation-102"><span class="linenos">102</span></a>    <span class="n">ADDITION</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MathOperation-103"><a href="#MathOperation-103"><span class="linenos">103</span></a>    <span class="n">EQUAL</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="MathOperation-104"><a href="#MathOperation-104"><span class="linenos">104</span></a>    <span class="n">SUBTRACTION</span> <span class="o">=</span> <span class="mi">2</span>
</span></pre></div>


    

                            <div id="MathOperation.ADDITION" class="classattr">
                                <div class="attr variable">
            <span class="name">ADDITION</span>        =
<span class="default_value">&lt;<a href="#MathOperation.ADDITION">MathOperation.ADDITION</a>: 0&gt;</span>

        
    </div>
    <a class="headerlink" href="#MathOperation.ADDITION"></a>
    
    

                            </div>
                            <div id="MathOperation.EQUAL" class="classattr">
                                <div class="attr variable">
            <span class="name">EQUAL</span>        =
<span class="default_value">&lt;<a href="#MathOperation.EQUAL">MathOperation.EQUAL</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#MathOperation.EQUAL"></a>
    
    

                            </div>
                            <div id="MathOperation.SUBTRACTION" class="classattr">
                                <div class="attr variable">
            <span class="name">SUBTRACTION</span>        =
<span class="default_value">&lt;<a href="#MathOperation.SUBTRACTION">MathOperation.SUBTRACTION</a>: 2&gt;</span>

        
    </div>
    <a class="headerlink" href="#MathOperation.SUBTRACTION"></a>
    
    

                            </div>
                </section>
                <section id="WeekDay">
                            <input id="WeekDay-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">WeekDay</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="WeekDay-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WeekDay"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WeekDay-78"><a href="#WeekDay-78"><span class="linenos">78</span></a><span class="k">class</span><span class="w"> </span><span class="nc">WeekDay</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="WeekDay-79"><a href="#WeekDay-79"><span class="linenos">79</span></a>    <span class="n">Monday</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="WeekDay-80"><a href="#WeekDay-80"><span class="linenos">80</span></a>    <span class="n">Tuesday</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="WeekDay-81"><a href="#WeekDay-81"><span class="linenos">81</span></a>    <span class="n">Wednesday</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="WeekDay-82"><a href="#WeekDay-82"><span class="linenos">82</span></a>    <span class="n">Thursday</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="WeekDay-83"><a href="#WeekDay-83"><span class="linenos">83</span></a>    <span class="n">Friday</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="WeekDay-84"><a href="#WeekDay-84"><span class="linenos">84</span></a>    <span class="n">Saturday</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="WeekDay-85"><a href="#WeekDay-85"><span class="linenos">85</span></a>    <span class="n">Sunday</span> <span class="o">=</span> <span class="mi">6</span>
</span></pre></div>


    

                            <div id="WeekDay.Monday" class="classattr">
                                <div class="attr variable">
            <span class="name">Monday</span>        =
<span class="default_value">&lt;<a href="#WeekDay.Monday">WeekDay.Monday</a>: 0&gt;</span>

        
    </div>
    <a class="headerlink" href="#WeekDay.Monday"></a>
    
    

                            </div>
                            <div id="WeekDay.Tuesday" class="classattr">
                                <div class="attr variable">
            <span class="name">Tuesday</span>        =
<span class="default_value">&lt;<a href="#WeekDay.Tuesday">WeekDay.Tuesday</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#WeekDay.Tuesday"></a>
    
    

                            </div>
                            <div id="WeekDay.Wednesday" class="classattr">
                                <div class="attr variable">
            <span class="name">Wednesday</span>        =
<span class="default_value">&lt;<a href="#WeekDay.Wednesday">WeekDay.Wednesday</a>: 2&gt;</span>

        
    </div>
    <a class="headerlink" href="#WeekDay.Wednesday"></a>
    
    

                            </div>
                            <div id="WeekDay.Thursday" class="classattr">
                                <div class="attr variable">
            <span class="name">Thursday</span>        =
<span class="default_value">&lt;<a href="#WeekDay.Thursday">WeekDay.Thursday</a>: 3&gt;</span>

        
    </div>
    <a class="headerlink" href="#WeekDay.Thursday"></a>
    
    

                            </div>
                            <div id="WeekDay.Friday" class="classattr">
                                <div class="attr variable">
            <span class="name">Friday</span>        =
<span class="default_value">&lt;<a href="#WeekDay.Friday">WeekDay.Friday</a>: 4&gt;</span>

        
    </div>
    <a class="headerlink" href="#WeekDay.Friday"></a>
    
    

                            </div>
                            <div id="WeekDay.Saturday" class="classattr">
                                <div class="attr variable">
            <span class="name">Saturday</span>        =
<span class="default_value">&lt;<a href="#WeekDay.Saturday">WeekDay.Saturday</a>: 5&gt;</span>

        
    </div>
    <a class="headerlink" href="#WeekDay.Saturday"></a>
    
    

                            </div>
                            <div id="WeekDay.Sunday" class="classattr">
                                <div class="attr variable">
            <span class="name">Sunday</span>        =
<span class="default_value">&lt;<a href="#WeekDay.Sunday">WeekDay.Sunday</a>: 6&gt;</span>

        
    </div>
    <a class="headerlink" href="#WeekDay.Sunday"></a>
    
    

                            </div>
                </section>
                <section id="start_file_server">
                            <input id="start_file_server-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_file_server</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">database_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">database_callback</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="nb">callable</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">csv_callback</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="nb">callable</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="start_file_server-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#start_file_server"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="start_file_server-55"><a href="#start_file_server-55"><span class="linenos"> 55</span></a><span class="k">def</span><span class="w"> </span><span class="nf">start_file_server</span><span class="p">(</span><span class="n">database_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database_callback</span><span class="p">:</span> <span class="nb">callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">csv_callback</span><span class="p">:</span> <span class="nb">callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="start_file_server-56"><a href="#start_file_server-56"><span class="linenos"> 56</span></a>                      <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="start_file_server-57"><a href="#start_file_server-57"><span class="linenos"> 57</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="start_file_server-58"><a href="#start_file_server-58"><span class="linenos"> 58</span></a><span class="sd">    Starts a multi-purpose WSGI server to manage file interactions for a Zakat application.</span>
</span><span id="start_file_server-59"><a href="#start_file_server-59"><span class="linenos"> 59</span></a>
</span><span id="start_file_server-60"><a href="#start_file_server-60"><span class="linenos"> 60</span></a><span class="sd">    This server facilitates the following functionalities:</span>
</span><span id="start_file_server-61"><a href="#start_file_server-61"><span class="linenos"> 61</span></a>
</span><span id="start_file_server-62"><a href="#start_file_server-62"><span class="linenos"> 62</span></a><span class="sd">    1. GET /{file_uuid}/get: Download the database file specified by `database_path`.</span>
</span><span id="start_file_server-63"><a href="#start_file_server-63"><span class="linenos"> 63</span></a><span class="sd">    2. GET /{file_uuid}/upload: Display an HTML form for uploading files.</span>
</span><span id="start_file_server-64"><a href="#start_file_server-64"><span class="linenos"> 64</span></a><span class="sd">    3. POST /{file_uuid}/upload: Handle file uploads, distinguishing between:</span>
</span><span id="start_file_server-65"><a href="#start_file_server-65"><span class="linenos"> 65</span></a><span class="sd">        - Database File (.db): Replaces the existing database with the uploaded one.</span>
</span><span id="start_file_server-66"><a href="#start_file_server-66"><span class="linenos"> 66</span></a><span class="sd">        - CSV File (.csv): Imports data from the CSV into the existing database.</span>
</span><span id="start_file_server-67"><a href="#start_file_server-67"><span class="linenos"> 67</span></a>
</span><span id="start_file_server-68"><a href="#start_file_server-68"><span class="linenos"> 68</span></a><span class="sd">    Args:</span>
</span><span id="start_file_server-69"><a href="#start_file_server-69"><span class="linenos"> 69</span></a><span class="sd">        database_path (str): The path to the camel database file.</span>
</span><span id="start_file_server-70"><a href="#start_file_server-70"><span class="linenos"> 70</span></a><span class="sd">        database_callback (callable, optional): A function to call after a successful database upload.</span>
</span><span id="start_file_server-71"><a href="#start_file_server-71"><span class="linenos"> 71</span></a><span class="sd">                                                It receives the uploaded database path as its argument.</span>
</span><span id="start_file_server-72"><a href="#start_file_server-72"><span class="linenos"> 72</span></a><span class="sd">        csv_callback (callable, optional): A function to call after a successful CSV upload. It receives the uploaded CSV path,</span>
</span><span id="start_file_server-73"><a href="#start_file_server-73"><span class="linenos"> 73</span></a><span class="sd">                                           the database path, and the debug flag as its arguments.</span>
</span><span id="start_file_server-74"><a href="#start_file_server-74"><span class="linenos"> 74</span></a><span class="sd">        debug (bool, optional): If True, print debugging information. Defaults to False.</span>
</span><span id="start_file_server-75"><a href="#start_file_server-75"><span class="linenos"> 75</span></a>
</span><span id="start_file_server-76"><a href="#start_file_server-76"><span class="linenos"> 76</span></a><span class="sd">    Returns:</span>
</span><span id="start_file_server-77"><a href="#start_file_server-77"><span class="linenos"> 77</span></a><span class="sd">        Tuple[str, str, str, threading.Thread, Callable[[], None]]: A tuple containing:</span>
</span><span id="start_file_server-78"><a href="#start_file_server-78"><span class="linenos"> 78</span></a><span class="sd">            - file_name (str): The name of the database file.</span>
</span><span id="start_file_server-79"><a href="#start_file_server-79"><span class="linenos"> 79</span></a><span class="sd">            - download_url (str): The URL to download the database file.</span>
</span><span id="start_file_server-80"><a href="#start_file_server-80"><span class="linenos"> 80</span></a><span class="sd">            - upload_url (str): The URL to access the file upload form.</span>
</span><span id="start_file_server-81"><a href="#start_file_server-81"><span class="linenos"> 81</span></a><span class="sd">            - server_thread (threading.Thread): The thread running the server.</span>
</span><span id="start_file_server-82"><a href="#start_file_server-82"><span class="linenos"> 82</span></a><span class="sd">            - shutdown_server (Callable[[], None]): A function to gracefully shut down the server.</span>
</span><span id="start_file_server-83"><a href="#start_file_server-83"><span class="linenos"> 83</span></a>
</span><span id="start_file_server-84"><a href="#start_file_server-84"><span class="linenos"> 84</span></a><span class="sd">    Example:</span>
</span><span id="start_file_server-85"><a href="#start_file_server-85"><span class="linenos"> 85</span></a><span class="sd">        _, download_url, upload_url, server_thread, shutdown_server = start_file_server(&quot;zakat.db&quot;)</span>
</span><span id="start_file_server-86"><a href="#start_file_server-86"><span class="linenos"> 86</span></a><span class="sd">        print(f&quot;Download database: {download_url}&quot;)</span>
</span><span id="start_file_server-87"><a href="#start_file_server-87"><span class="linenos"> 87</span></a><span class="sd">        print(f&quot;Upload files: {upload_url}&quot;)</span>
</span><span id="start_file_server-88"><a href="#start_file_server-88"><span class="linenos"> 88</span></a><span class="sd">        server_thread.start()</span>
</span><span id="start_file_server-89"><a href="#start_file_server-89"><span class="linenos"> 89</span></a><span class="sd">        # ... later ...</span>
</span><span id="start_file_server-90"><a href="#start_file_server-90"><span class="linenos"> 90</span></a><span class="sd">        shutdown_server()</span>
</span><span id="start_file_server-91"><a href="#start_file_server-91"><span class="linenos"> 91</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="start_file_server-92"><a href="#start_file_server-92"><span class="linenos"> 92</span></a>    <span class="n">file_uuid</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
</span><span id="start_file_server-93"><a href="#start_file_server-93"><span class="linenos"> 93</span></a>    <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">database_path</span><span class="p">)</span>
</span><span id="start_file_server-94"><a href="#start_file_server-94"><span class="linenos"> 94</span></a>
</span><span id="start_file_server-95"><a href="#start_file_server-95"><span class="linenos"> 95</span></a>    <span class="n">port</span> <span class="o">=</span> <span class="n">find_available_port</span><span class="p">()</span>
</span><span id="start_file_server-96"><a href="#start_file_server-96"><span class="linenos"> 96</span></a>    <span class="n">download_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://localhost:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file_uuid</span><span class="si">}</span><span class="s2">/get&quot;</span>
</span><span id="start_file_server-97"><a href="#start_file_server-97"><span class="linenos"> 97</span></a>    <span class="n">upload_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://localhost:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">file_uuid</span><span class="si">}</span><span class="s2">/upload&quot;</span>
</span><span id="start_file_server-98"><a href="#start_file_server-98"><span class="linenos"> 98</span></a>
</span><span id="start_file_server-99"><a href="#start_file_server-99"><span class="linenos"> 99</span></a>    <span class="c1"># Upload directory</span>
</span><span id="start_file_server-100"><a href="#start_file_server-100"><span class="linenos">100</span></a>    <span class="n">upload_directory</span> <span class="o">=</span> <span class="s2">&quot;./uploads&quot;</span>
</span><span id="start_file_server-101"><a href="#start_file_server-101"><span class="linenos">101</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">upload_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="start_file_server-102"><a href="#start_file_server-102"><span class="linenos">102</span></a>
</span><span id="start_file_server-103"><a href="#start_file_server-103"><span class="linenos">103</span></a>    <span class="c1"># HTML templates</span>
</span><span id="start_file_server-104"><a href="#start_file_server-104"><span class="linenos">104</span></a>    <span class="n">upload_form</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="start_file_server-105"><a href="#start_file_server-105"><span class="linenos">105</span></a><span class="s2">    &lt;html lang=&quot;en&quot;&gt;</span>
</span><span id="start_file_server-106"><a href="#start_file_server-106"><span class="linenos">106</span></a><span class="s2">        &lt;head&gt;</span>
</span><span id="start_file_server-107"><a href="#start_file_server-107"><span class="linenos">107</span></a><span class="s2">            &lt;title&gt;Zakat File Server&lt;/title&gt;</span>
</span><span id="start_file_server-108"><a href="#start_file_server-108"><span class="linenos">108</span></a><span class="s2">        &lt;/head&gt;</span>
</span><span id="start_file_server-109"><a href="#start_file_server-109"><span class="linenos">109</span></a><span class="s2">    &lt;body&gt;</span>
</span><span id="start_file_server-110"><a href="#start_file_server-110"><span class="linenos">110</span></a><span class="s2">    &lt;h1&gt;Zakat File Server&lt;/h1&gt;</span>
</span><span id="start_file_server-111"><a href="#start_file_server-111"><span class="linenos">111</span></a><span class="s2">    &lt;h3&gt;You can download the &lt;a target=&quot;__blank&quot; href=&quot;</span><span class="si">{</span><span class="n">download_url</span><span class="si">}</span><span class="s2">&quot;&gt;database file&lt;/a&gt;...&lt;/h3&gt;</span>
</span><span id="start_file_server-112"><a href="#start_file_server-112"><span class="linenos">112</span></a><span class="s2">    &lt;h3&gt;Or upload a new file to restore a database or import `CSV` file:&lt;/h3&gt;</span>
</span><span id="start_file_server-113"><a href="#start_file_server-113"><span class="linenos">113</span></a><span class="s2">    &lt;form action=&quot;/</span><span class="si">{</span><span class="n">file_uuid</span><span class="si">}</span><span class="s2">/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span>
</span><span id="start_file_server-114"><a href="#start_file_server-114"><span class="linenos">114</span></a><span class="s2">        &lt;input type=&quot;file&quot; name=&quot;file&quot; required&gt;&lt;br/&gt;</span>
</span><span id="start_file_server-115"><a href="#start_file_server-115"><span class="linenos">115</span></a><span class="s2">        &lt;input type=&quot;radio&quot; id=&quot;</span><span class="si">{</span><span class="n">FileType</span><span class="o">.</span><span class="n">Database</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot; name=&quot;upload_type&quot; value=&quot;</span><span class="si">{</span><span class="n">FileType</span><span class="o">.</span><span class="n">Database</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot; required&gt;</span>
</span><span id="start_file_server-116"><a href="#start_file_server-116"><span class="linenos">116</span></a><span class="s2">        &lt;label for=&quot;database&quot;&gt;Database File&lt;/label&gt;&lt;br/&gt;</span>
</span><span id="start_file_server-117"><a href="#start_file_server-117"><span class="linenos">117</span></a><span class="s2">        &lt;input type=&quot;radio&quot;id=&quot;</span><span class="si">{</span><span class="n">FileType</span><span class="o">.</span><span class="n">CSV</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot; name=&quot;upload_type&quot; value=&quot;</span><span class="si">{</span><span class="n">FileType</span><span class="o">.</span><span class="n">CSV</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;&gt;</span>
</span><span id="start_file_server-118"><a href="#start_file_server-118"><span class="linenos">118</span></a><span class="s2">        &lt;label for=&quot;csv&quot;&gt;CSV File&lt;/label&gt;&lt;br/&gt;</span>
</span><span id="start_file_server-119"><a href="#start_file_server-119"><span class="linenos">119</span></a><span class="s2">        &lt;input type=&quot;submit&quot; value=&quot;Upload&quot;&gt;&lt;br/&gt;</span>
</span><span id="start_file_server-120"><a href="#start_file_server-120"><span class="linenos">120</span></a><span class="s2">    &lt;/form&gt;</span>
</span><span id="start_file_server-121"><a href="#start_file_server-121"><span class="linenos">121</span></a><span class="s2">    &lt;/body&gt;&lt;/html&gt;</span>
</span><span id="start_file_server-122"><a href="#start_file_server-122"><span class="linenos">122</span></a><span class="s2">    &quot;&quot;&quot;</span>
</span><span id="start_file_server-123"><a href="#start_file_server-123"><span class="linenos">123</span></a>
</span><span id="start_file_server-124"><a href="#start_file_server-124"><span class="linenos">124</span></a>    <span class="c1"># WSGI application</span>
</span><span id="start_file_server-125"><a href="#start_file_server-125"><span class="linenos">125</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">wsgi_app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
</span><span id="start_file_server-126"><a href="#start_file_server-126"><span class="linenos">126</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PATH_INFO&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="start_file_server-127"><a href="#start_file_server-127"><span class="linenos">127</span></a>        <span class="n">method</span> <span class="o">=</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">)</span>
</span><span id="start_file_server-128"><a href="#start_file_server-128"><span class="linenos">128</span></a>
</span><span id="start_file_server-129"><a href="#start_file_server-129"><span class="linenos">129</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">file_uuid</span><span class="si">}</span><span class="s2">/get&quot;</span> <span class="ow">and</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
</span><span id="start_file_server-130"><a href="#start_file_server-130"><span class="linenos">130</span></a>            <span class="c1"># GET: Serve the existing file</span>
</span><span id="start_file_server-131"><a href="#start_file_server-131"><span class="linenos">131</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="start_file_server-132"><a href="#start_file_server-132"><span class="linenos">132</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">database_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="start_file_server-133"><a href="#start_file_server-133"><span class="linenos">133</span></a>                    <span class="n">file_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="start_file_server-134"><a href="#start_file_server-134"><span class="linenos">134</span></a>                    
</span><span id="start_file_server-135"><a href="#start_file_server-135"><span class="linenos">135</span></a>                <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[</span>
</span><span id="start_file_server-136"><a href="#start_file_server-136"><span class="linenos">136</span></a>                    <span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">),</span>
</span><span id="start_file_server-137"><a href="#start_file_server-137"><span class="linenos">137</span></a>                    <span class="p">(</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;attachment; filename=&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">),</span>
</span><span id="start_file_server-138"><a href="#start_file_server-138"><span class="linenos">138</span></a>                    <span class="p">(</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">file_content</span><span class="p">)))</span>
</span><span id="start_file_server-139"><a href="#start_file_server-139"><span class="linenos">139</span></a>                <span class="p">])</span>
</span><span id="start_file_server-140"><a href="#start_file_server-140"><span class="linenos">140</span></a>                <span class="k">return</span> <span class="p">[</span><span class="n">file_content</span><span class="p">]</span>
</span><span id="start_file_server-141"><a href="#start_file_server-141"><span class="linenos">141</span></a>            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="start_file_server-142"><a href="#start_file_server-142"><span class="linenos">142</span></a>                <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;404 Not Found&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
</span><span id="start_file_server-143"><a href="#start_file_server-143"><span class="linenos">143</span></a>                <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;File not found&#39;</span><span class="p">]</span>
</span><span id="start_file_server-144"><a href="#start_file_server-144"><span class="linenos">144</span></a>                
</span><span id="start_file_server-145"><a href="#start_file_server-145"><span class="linenos">145</span></a>        <span class="k">elif</span> <span class="n">path</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">file_uuid</span><span class="si">}</span><span class="s2">/upload&quot;</span> <span class="ow">and</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
</span><span id="start_file_server-146"><a href="#start_file_server-146"><span class="linenos">146</span></a>            <span class="c1"># GET: Serve the upload form</span>
</span><span id="start_file_server-147"><a href="#start_file_server-147"><span class="linenos">147</span></a>            <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/html&#39;</span><span class="p">)])</span>
</span><span id="start_file_server-148"><a href="#start_file_server-148"><span class="linenos">148</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">upload_form</span><span class="o">.</span><span class="n">encode</span><span class="p">()]</span>
</span><span id="start_file_server-149"><a href="#start_file_server-149"><span class="linenos">149</span></a>            
</span><span id="start_file_server-150"><a href="#start_file_server-150"><span class="linenos">150</span></a>        <span class="k">elif</span> <span class="n">path</span> <span class="o">==</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">file_uuid</span><span class="si">}</span><span class="s2">/upload&quot;</span> <span class="ow">and</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
</span><span id="start_file_server-151"><a href="#start_file_server-151"><span class="linenos">151</span></a>            <span class="c1"># POST: Handle file uploads</span>
</span><span id="start_file_server-152"><a href="#start_file_server-152"><span class="linenos">152</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="start_file_server-153"><a href="#start_file_server-153"><span class="linenos">153</span></a>                <span class="c1"># Get content length</span>
</span><span id="start_file_server-154"><a href="#start_file_server-154"><span class="linenos">154</span></a>                <span class="n">content_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CONTENT_LENGTH&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="start_file_server-155"><a href="#start_file_server-155"><span class="linenos">155</span></a>                
</span><span id="start_file_server-156"><a href="#start_file_server-156"><span class="linenos">156</span></a>                <span class="c1"># Get content type and boundary</span>
</span><span id="start_file_server-157"><a href="#start_file_server-157"><span class="linenos">157</span></a>                <span class="n">content_type</span> <span class="o">=</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CONTENT_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="start_file_server-158"><a href="#start_file_server-158"><span class="linenos">158</span></a>                
</span><span id="start_file_server-159"><a href="#start_file_server-159"><span class="linenos">159</span></a>                <span class="c1"># Read the request body</span>
</span><span id="start_file_server-160"><a href="#start_file_server-160"><span class="linenos">160</span></a>                <span class="n">request_body</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;wsgi.input&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">content_length</span><span class="p">)</span>
</span><span id="start_file_server-161"><a href="#start_file_server-161"><span class="linenos">161</span></a>                
</span><span id="start_file_server-162"><a href="#start_file_server-162"><span class="linenos">162</span></a>                <span class="c1"># Create a file-like object from the request body</span>
</span><span id="start_file_server-163"><a href="#start_file_server-163"><span class="linenos">163</span></a>                <span class="c1"># request_body_file = io.BytesIO(request_body)</span>
</span><span id="start_file_server-164"><a href="#start_file_server-164"><span class="linenos">164</span></a>                
</span><span id="start_file_server-165"><a href="#start_file_server-165"><span class="linenos">165</span></a>                <span class="c1"># Parse the multipart form data using WSGI approach</span>
</span><span id="start_file_server-166"><a href="#start_file_server-166"><span class="linenos">166</span></a>                <span class="c1"># First, detect the boundary from content_type</span>
</span><span id="start_file_server-167"><a href="#start_file_server-167"><span class="linenos">167</span></a>                <span class="n">boundary</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="start_file_server-168"><a href="#start_file_server-168"><span class="linenos">168</span></a>                <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">content_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">):</span>
</span><span id="start_file_server-169"><a href="#start_file_server-169"><span class="linenos">169</span></a>                    <span class="n">part</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="start_file_server-170"><a href="#start_file_server-170"><span class="linenos">170</span></a>                    <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;boundary=&#39;</span><span class="p">):</span>
</span><span id="start_file_server-171"><a href="#start_file_server-171"><span class="linenos">171</span></a>                        <span class="n">boundary</span> <span class="o">=</span> <span class="n">part</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span>
</span><span id="start_file_server-172"><a href="#start_file_server-172"><span class="linenos">172</span></a>                        <span class="k">if</span> <span class="n">boundary</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">boundary</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">):</span>
</span><span id="start_file_server-173"><a href="#start_file_server-173"><span class="linenos">173</span></a>                            <span class="n">boundary</span> <span class="o">=</span> <span class="n">boundary</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="start_file_server-174"><a href="#start_file_server-174"><span class="linenos">174</span></a>                        <span class="k">break</span>
</span><span id="start_file_server-175"><a href="#start_file_server-175"><span class="linenos">175</span></a>                
</span><span id="start_file_server-176"><a href="#start_file_server-176"><span class="linenos">176</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">boundary</span><span class="p">:</span>
</span><span id="start_file_server-177"><a href="#start_file_server-177"><span class="linenos">177</span></a>                    <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;400 Bad Request&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
</span><span id="start_file_server-178"><a href="#start_file_server-178"><span class="linenos">178</span></a>                    <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;Missing boundary in multipart form data&quot;</span><span class="p">]</span>
</span><span id="start_file_server-179"><a href="#start_file_server-179"><span class="linenos">179</span></a>                
</span><span id="start_file_server-180"><a href="#start_file_server-180"><span class="linenos">180</span></a>                <span class="c1"># Process multipart data</span>
</span><span id="start_file_server-181"><a href="#start_file_server-181"><span class="linenos">181</span></a>                <span class="n">parts</span> <span class="o">=</span> <span class="n">request_body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;--</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="start_file_server-182"><a href="#start_file_server-182"><span class="linenos">182</span></a>                
</span><span id="start_file_server-183"><a href="#start_file_server-183"><span class="linenos">183</span></a>                <span class="c1"># Initialize variables to store form data</span>
</span><span id="start_file_server-184"><a href="#start_file_server-184"><span class="linenos">184</span></a>                <span class="n">upload_type</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="start_file_server-185"><a href="#start_file_server-185"><span class="linenos">185</span></a>                <span class="c1"># file_item = None</span>
</span><span id="start_file_server-186"><a href="#start_file_server-186"><span class="linenos">186</span></a>                <span class="n">file_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="start_file_server-187"><a href="#start_file_server-187"><span class="linenos">187</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="start_file_server-188"><a href="#start_file_server-188"><span class="linenos">188</span></a>                
</span><span id="start_file_server-189"><a href="#start_file_server-189"><span class="linenos">189</span></a>                <span class="c1"># Process each part</span>
</span><span id="start_file_server-190"><a href="#start_file_server-190"><span class="linenos">190</span></a>                <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
</span><span id="start_file_server-191"><a href="#start_file_server-191"><span class="linenos">191</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="start_file_server-192"><a href="#start_file_server-192"><span class="linenos">192</span></a>                        <span class="k">continue</span>
</span><span id="start_file_server-193"><a href="#start_file_server-193"><span class="linenos">193</span></a>                    
</span><span id="start_file_server-194"><a href="#start_file_server-194"><span class="linenos">194</span></a>                    <span class="c1"># Split header and body</span>
</span><span id="start_file_server-195"><a href="#start_file_server-195"><span class="linenos">195</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="start_file_server-196"><a href="#start_file_server-196"><span class="linenos">196</span></a>                        <span class="n">headers_raw</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="start_file_server-197"><a href="#start_file_server-197"><span class="linenos">197</span></a>                        <span class="n">headers_text</span> <span class="o">=</span> <span class="n">headers_raw</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="start_file_server-198"><a href="#start_file_server-198"><span class="linenos">198</span></a>                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="start_file_server-199"><a href="#start_file_server-199"><span class="linenos">199</span></a>                        <span class="k">continue</span>
</span><span id="start_file_server-200"><a href="#start_file_server-200"><span class="linenos">200</span></a>                    
</span><span id="start_file_server-201"><a href="#start_file_server-201"><span class="linenos">201</span></a>                    <span class="c1"># Parse headers</span>
</span><span id="start_file_server-202"><a href="#start_file_server-202"><span class="linenos">202</span></a>                    <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="start_file_server-203"><a href="#start_file_server-203"><span class="linenos">203</span></a>                    <span class="k">for</span> <span class="n">header_line</span> <span class="ow">in</span> <span class="n">headers_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">):</span>
</span><span id="start_file_server-204"><a href="#start_file_server-204"><span class="linenos">204</span></a>                        <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">header_line</span><span class="p">:</span>
</span><span id="start_file_server-205"><a href="#start_file_server-205"><span class="linenos">205</span></a>                            <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">header_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="start_file_server-206"><a href="#start_file_server-206"><span class="linenos">206</span></a>                            <span class="n">headers</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="start_file_server-207"><a href="#start_file_server-207"><span class="linenos">207</span></a>                    
</span><span id="start_file_server-208"><a href="#start_file_server-208"><span class="linenos">208</span></a>                    <span class="c1"># Get content disposition</span>
</span><span id="start_file_server-209"><a href="#start_file_server-209"><span class="linenos">209</span></a>                    <span class="n">content_disposition</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-disposition&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="start_file_server-210"><a href="#start_file_server-210"><span class="linenos">210</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">content_disposition</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;form-data&#39;</span><span class="p">):</span>
</span><span id="start_file_server-211"><a href="#start_file_server-211"><span class="linenos">211</span></a>                        <span class="k">continue</span>
</span><span id="start_file_server-212"><a href="#start_file_server-212"><span class="linenos">212</span></a>                    
</span><span id="start_file_server-213"><a href="#start_file_server-213"><span class="linenos">213</span></a>                    <span class="c1"># Extract field name</span>
</span><span id="start_file_server-214"><a href="#start_file_server-214"><span class="linenos">214</span></a>                    <span class="n">field_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="start_file_server-215"><a href="#start_file_server-215"><span class="linenos">215</span></a>                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">content_disposition</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">):</span>
</span><span id="start_file_server-216"><a href="#start_file_server-216"><span class="linenos">216</span></a>                        <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="start_file_server-217"><a href="#start_file_server-217"><span class="linenos">217</span></a>                        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;name=&#39;</span><span class="p">):</span>
</span><span id="start_file_server-218"><a href="#start_file_server-218"><span class="linenos">218</span></a>                            <span class="n">field_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="start_file_server-219"><a href="#start_file_server-219"><span class="linenos">219</span></a>                            <span class="k">break</span>
</span><span id="start_file_server-220"><a href="#start_file_server-220"><span class="linenos">220</span></a>                    
</span><span id="start_file_server-221"><a href="#start_file_server-221"><span class="linenos">221</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">field_name</span><span class="p">:</span>
</span><span id="start_file_server-222"><a href="#start_file_server-222"><span class="linenos">222</span></a>                        <span class="k">continue</span>
</span><span id="start_file_server-223"><a href="#start_file_server-223"><span class="linenos">223</span></a>                    
</span><span id="start_file_server-224"><a href="#start_file_server-224"><span class="linenos">224</span></a>                    <span class="c1"># Handle upload_type field</span>
</span><span id="start_file_server-225"><a href="#start_file_server-225"><span class="linenos">225</span></a>                    <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s1">&#39;upload_type&#39;</span><span class="p">:</span>
</span><span id="start_file_server-226"><a href="#start_file_server-226"><span class="linenos">226</span></a>                        <span class="c1"># Remove trailing data including the boundary</span>
</span><span id="start_file_server-227"><a href="#start_file_server-227"><span class="linenos">227</span></a>                        <span class="n">body_end</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">--&#39;</span><span class="p">)</span>
</span><span id="start_file_server-228"><a href="#start_file_server-228"><span class="linenos">228</span></a>                        <span class="k">if</span> <span class="n">body_end</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="start_file_server-229"><a href="#start_file_server-229"><span class="linenos">229</span></a>                            <span class="n">body</span> <span class="o">=</span> <span class="n">body</span><span class="p">[:</span><span class="n">body_end</span><span class="p">]</span>
</span><span id="start_file_server-230"><a href="#start_file_server-230"><span class="linenos">230</span></a>                        <span class="n">upload_type</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="start_file_server-231"><a href="#start_file_server-231"><span class="linenos">231</span></a>                    
</span><span id="start_file_server-232"><a href="#start_file_server-232"><span class="linenos">232</span></a>                    <span class="c1"># Handle file field</span>
</span><span id="start_file_server-233"><a href="#start_file_server-233"><span class="linenos">233</span></a>                    <span class="k">elif</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span>
</span><span id="start_file_server-234"><a href="#start_file_server-234"><span class="linenos">234</span></a>                        <span class="c1"># Extract filename</span>
</span><span id="start_file_server-235"><a href="#start_file_server-235"><span class="linenos">235</span></a>                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">content_disposition</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">):</span>
</span><span id="start_file_server-236"><a href="#start_file_server-236"><span class="linenos">236</span></a>                            <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="start_file_server-237"><a href="#start_file_server-237"><span class="linenos">237</span></a>                            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;filename=&#39;</span><span class="p">):</span>
</span><span id="start_file_server-238"><a href="#start_file_server-238"><span class="linenos">238</span></a>                                <span class="n">filename</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="start_file_server-239"><a href="#start_file_server-239"><span class="linenos">239</span></a>                                <span class="k">break</span>
</span><span id="start_file_server-240"><a href="#start_file_server-240"><span class="linenos">240</span></a>                        
</span><span id="start_file_server-241"><a href="#start_file_server-241"><span class="linenos">241</span></a>                        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="start_file_server-242"><a href="#start_file_server-242"><span class="linenos">242</span></a>                            <span class="c1"># Remove trailing data including the boundary</span>
</span><span id="start_file_server-243"><a href="#start_file_server-243"><span class="linenos">243</span></a>                            <span class="n">body_end</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">--&#39;</span><span class="p">)</span>
</span><span id="start_file_server-244"><a href="#start_file_server-244"><span class="linenos">244</span></a>                            <span class="k">if</span> <span class="n">body_end</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="start_file_server-245"><a href="#start_file_server-245"><span class="linenos">245</span></a>                                <span class="n">body</span> <span class="o">=</span> <span class="n">body</span><span class="p">[:</span><span class="n">body_end</span><span class="p">]</span>
</span><span id="start_file_server-246"><a href="#start_file_server-246"><span class="linenos">246</span></a>                            <span class="n">file_data</span> <span class="o">=</span> <span class="n">body</span>
</span><span id="start_file_server-247"><a href="#start_file_server-247"><span class="linenos">247</span></a>                
</span><span id="start_file_server-248"><a href="#start_file_server-248"><span class="linenos">248</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="start_file_server-249"><a href="#start_file_server-249"><span class="linenos">249</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;upload_type&#39;</span><span class="p">,</span> <span class="n">upload_type</span><span class="p">)</span>
</span><span id="start_file_server-250"><a href="#start_file_server-250"><span class="linenos">250</span></a>                    
</span><span id="start_file_server-251"><a href="#start_file_server-251"><span class="linenos">251</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="start_file_server-252"><a href="#start_file_server-252"><span class="linenos">252</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;upload_type:&#39;</span><span class="p">,</span> <span class="n">upload_type</span><span class="p">)</span>
</span><span id="start_file_server-253"><a href="#start_file_server-253"><span class="linenos">253</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;filename:&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="start_file_server-254"><a href="#start_file_server-254"><span class="linenos">254</span></a>                
</span><span id="start_file_server-255"><a href="#start_file_server-255"><span class="linenos">255</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">upload_type</span> <span class="ow">or</span> <span class="n">upload_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">FileType</span><span class="o">.</span><span class="n">Database</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">FileType</span><span class="o">.</span><span class="n">CSV</span><span class="o">.</span><span class="n">value</span><span class="p">]:</span>
</span><span id="start_file_server-256"><a href="#start_file_server-256"><span class="linenos">256</span></a>                    <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;400 Bad Request&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
</span><span id="start_file_server-257"><a href="#start_file_server-257"><span class="linenos">257</span></a>                    <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;Invalid upload type&quot;</span><span class="p">]</span>
</span><span id="start_file_server-258"><a href="#start_file_server-258"><span class="linenos">258</span></a>                
</span><span id="start_file_server-259"><a href="#start_file_server-259"><span class="linenos">259</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">file_data</span><span class="p">:</span>
</span><span id="start_file_server-260"><a href="#start_file_server-260"><span class="linenos">260</span></a>                    <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;400 Bad Request&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
</span><span id="start_file_server-261"><a href="#start_file_server-261"><span class="linenos">261</span></a>                    <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;Missing file data&quot;</span><span class="p">]</span>
</span><span id="start_file_server-262"><a href="#start_file_server-262"><span class="linenos">262</span></a>                
</span><span id="start_file_server-263"><a href="#start_file_server-263"><span class="linenos">263</span></a>                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="start_file_server-264"><a href="#start_file_server-264"><span class="linenos">264</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Uploaded filename: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="start_file_server-265"><a href="#start_file_server-265"><span class="linenos">265</span></a>                
</span><span id="start_file_server-266"><a href="#start_file_server-266"><span class="linenos">266</span></a>                <span class="c1"># Save the file</span>
</span><span id="start_file_server-267"><a href="#start_file_server-267"><span class="linenos">267</span></a>                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">upload_directory</span><span class="p">,</span> <span class="n">upload_type</span><span class="p">)</span>
</span><span id="start_file_server-268"><a href="#start_file_server-268"><span class="linenos">268</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="start_file_server-269"><a href="#start_file_server-269"><span class="linenos">269</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
</span><span id="start_file_server-270"><a href="#start_file_server-270"><span class="linenos">270</span></a>                
</span><span id="start_file_server-271"><a href="#start_file_server-271"><span class="linenos">271</span></a>                <span class="c1"># Process based on file type</span>
</span><span id="start_file_server-272"><a href="#start_file_server-272"><span class="linenos">272</span></a>                <span class="k">if</span> <span class="n">upload_type</span> <span class="o">==</span> <span class="n">FileType</span><span class="o">.</span><span class="n">Database</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span id="start_file_server-273"><a href="#start_file_server-273"><span class="linenos">273</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="start_file_server-274"><a href="#start_file_server-274"><span class="linenos">274</span></a>                        <span class="c1"># Verify database file</span>
</span><span id="start_file_server-275"><a href="#start_file_server-275"><span class="linenos">275</span></a>                        <span class="k">if</span> <span class="n">database_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="start_file_server-276"><a href="#start_file_server-276"><span class="linenos">276</span></a>                            <span class="n">database_callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="start_file_server-277"><a href="#start_file_server-277"><span class="linenos">277</span></a>                        
</span><span id="start_file_server-278"><a href="#start_file_server-278"><span class="linenos">278</span></a>                        <span class="c1"># Copy database into the original path</span>
</span><span id="start_file_server-279"><a href="#start_file_server-279"><span class="linenos">279</span></a>                        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">database_path</span><span class="p">)</span>
</span><span id="start_file_server-280"><a href="#start_file_server-280"><span class="linenos">280</span></a>                        
</span><span id="start_file_server-281"><a href="#start_file_server-281"><span class="linenos">281</span></a>                        <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
</span><span id="start_file_server-282"><a href="#start_file_server-282"><span class="linenos">282</span></a>                        <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;Database file uploaded successfully.&quot;</span><span class="p">]</span>
</span><span id="start_file_server-283"><a href="#start_file_server-283"><span class="linenos">283</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="start_file_server-284"><a href="#start_file_server-284"><span class="linenos">284</span></a>                        <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;400 Bad Request&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
</span><span id="start_file_server-285"><a href="#start_file_server-285"><span class="linenos">285</span></a>                        <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()]</span>
</span><span id="start_file_server-286"><a href="#start_file_server-286"><span class="linenos">286</span></a>                
</span><span id="start_file_server-287"><a href="#start_file_server-287"><span class="linenos">287</span></a>                <span class="k">elif</span> <span class="n">upload_type</span> <span class="o">==</span> <span class="n">FileType</span><span class="o">.</span><span class="n">CSV</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span id="start_file_server-288"><a href="#start_file_server-288"><span class="linenos">288</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="start_file_server-289"><a href="#start_file_server-289"><span class="linenos">289</span></a>                        <span class="k">if</span> <span class="n">csv_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="start_file_server-290"><a href="#start_file_server-290"><span class="linenos">290</span></a>                            <span class="n">result</span> <span class="o">=</span> <span class="n">csv_callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">database_path</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
</span><span id="start_file_server-291"><a href="#start_file_server-291"><span class="linenos">291</span></a>                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="start_file_server-292"><a href="#start_file_server-292"><span class="linenos">292</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;CSV imported: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="start_file_server-293"><a href="#start_file_server-293"><span class="linenos">293</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="start_file_server-294"><a href="#start_file_server-294"><span class="linenos">294</span></a>                                <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)])</span>
</span><span id="start_file_server-295"><a href="#start_file_server-295"><span class="linenos">295</span></a>                                <span class="k">return</span> <span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()]</span>
</span><span id="start_file_server-296"><a href="#start_file_server-296"><span class="linenos">296</span></a>                        
</span><span id="start_file_server-297"><a href="#start_file_server-297"><span class="linenos">297</span></a>                        <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
</span><span id="start_file_server-298"><a href="#start_file_server-298"><span class="linenos">298</span></a>                        <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;CSV file uploaded successfully.&quot;</span><span class="p">]</span>
</span><span id="start_file_server-299"><a href="#start_file_server-299"><span class="linenos">299</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="start_file_server-300"><a href="#start_file_server-300"><span class="linenos">300</span></a>                        <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;400 Bad Request&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
</span><span id="start_file_server-301"><a href="#start_file_server-301"><span class="linenos">301</span></a>                        <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()]</span>
</span><span id="start_file_server-302"><a href="#start_file_server-302"><span class="linenos">302</span></a>            
</span><span id="start_file_server-303"><a href="#start_file_server-303"><span class="linenos">303</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="start_file_server-304"><a href="#start_file_server-304"><span class="linenos">304</span></a>                <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;500 Internal Server Error&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
</span><span id="start_file_server-305"><a href="#start_file_server-305"><span class="linenos">305</span></a>                <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Error processing upload: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">()]</span>
</span><span id="start_file_server-306"><a href="#start_file_server-306"><span class="linenos">306</span></a>        
</span><span id="start_file_server-307"><a href="#start_file_server-307"><span class="linenos">307</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="start_file_server-308"><a href="#start_file_server-308"><span class="linenos">308</span></a>            <span class="c1"># 404 for anything else</span>
</span><span id="start_file_server-309"><a href="#start_file_server-309"><span class="linenos">309</span></a>            <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;404 Not Found&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
</span><span id="start_file_server-310"><a href="#start_file_server-310"><span class="linenos">310</span></a>            <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;Not Found&#39;</span><span class="p">]</span>
</span><span id="start_file_server-311"><a href="#start_file_server-311"><span class="linenos">311</span></a>    
</span><span id="start_file_server-312"><a href="#start_file_server-312"><span class="linenos">312</span></a>    <span class="c1"># Create and start the server</span>
</span><span id="start_file_server-313"><a href="#start_file_server-313"><span class="linenos">313</span></a>    <span class="n">httpd</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">wsgi_app</span><span class="p">)</span>
</span><span id="start_file_server-314"><a href="#start_file_server-314"><span class="linenos">314</span></a>    <span class="n">server_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">)</span>
</span><span id="start_file_server-315"><a href="#start_file_server-315"><span class="linenos">315</span></a>    
</span><span id="start_file_server-316"><a href="#start_file_server-316"><span class="linenos">316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdown_server</span><span class="p">():</span>
</span><span id="start_file_server-317"><a href="#start_file_server-317"><span class="linenos">317</span></a>        <span class="k">nonlocal</span> <span class="n">httpd</span><span class="p">,</span> <span class="n">server_thread</span>
</span><span id="start_file_server-318"><a href="#start_file_server-318"><span class="linenos">318</span></a>        <span class="n">httpd</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="start_file_server-319"><a href="#start_file_server-319"><span class="linenos">319</span></a>        <span class="n">server_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>  <span class="c1"># Wait for the thread to finish</span>
</span><span id="start_file_server-320"><a href="#start_file_server-320"><span class="linenos">320</span></a>    
</span><span id="start_file_server-321"><a href="#start_file_server-321"><span class="linenos">321</span></a>    <span class="k">return</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">download_url</span><span class="p">,</span> <span class="n">upload_url</span><span class="p">,</span> <span class="n">server_thread</span><span class="p">,</span> <span class="n">shutdown_server</span>
</span></pre></div>


            <div class="docstring"><p>Starts a multi-purpose WSGI server to manage file interactions for a Zakat application.</p>

<p>This server facilitates the following functionalities:</p>

<ol>
<li>GET /{file_uuid}/get: Download the database file specified by <code>database_path</code>.</li>
<li>GET /{file_uuid}/upload: Display an HTML form for uploading files.</li>
<li>POST /{file_uuid}/upload: Handle file uploads, distinguishing between:
<ul>
<li>Database File (.db): Replaces the existing database with the uploaded one.</li>
<li>CSV File (.csv): Imports data from the CSV into the existing database.</li>
</ul></li>
</ol>

<p>Args:
    database_path (str): The path to the camel database file.
    database_callback (callable, optional): A function to call after a successful database upload.
                                            It receives the uploaded database path as its argument.
    csv_callback (callable, optional): A function to call after a successful CSV upload. It receives the uploaded CSV path,
                                       the database path, and the debug flag as its arguments.
    debug (bool, optional): If True, print debugging information. Defaults to False.</p>

<p>Returns:
    Tuple[str, str, str, threading.Thread, Callable[[], None]]: A tuple containing:
        - file_name (str): The name of the database file.
        - download_url (str): The URL to download the database file.
        - upload_url (str): The URL to access the file upload form.
        - server_thread (threading.Thread): The thread running the server.
        - shutdown_server (Callable[[], None]): A function to gracefully shut down the server.</p>

<p>Example:
    _, download_url, upload_url, server_thread, shutdown_server = start_file_server("zakat.db")
    print(f"Download database: {download_url}")
    print(f"Upload files: {upload_url}")
    server_thread.start()
    # ... later ...
    shutdown_server()</p>
</div>


                </section>
                <section id="find_available_port">
                            <input id="find_available_port-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_available_port</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="find_available_port-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#find_available_port"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="find_available_port-32"><a href="#find_available_port-32"><span class="linenos">32</span></a><span class="k">def</span><span class="w"> </span><span class="nf">find_available_port</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="find_available_port-33"><a href="#find_available_port-33"><span class="linenos">33</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="find_available_port-34"><a href="#find_available_port-34"><span class="linenos">34</span></a><span class="sd">    Finds and returns an available TCP port on the local machine.</span>
</span><span id="find_available_port-35"><a href="#find_available_port-35"><span class="linenos">35</span></a>
</span><span id="find_available_port-36"><a href="#find_available_port-36"><span class="linenos">36</span></a><span class="sd">    This function utilizes a TCP server socket to bind to port 0, which</span>
</span><span id="find_available_port-37"><a href="#find_available_port-37"><span class="linenos">37</span></a><span class="sd">    instructs the operating system to automatically assign an available</span>
</span><span id="find_available_port-38"><a href="#find_available_port-38"><span class="linenos">38</span></a><span class="sd">    port. The assigned port is then extracted and returned.</span>
</span><span id="find_available_port-39"><a href="#find_available_port-39"><span class="linenos">39</span></a>
</span><span id="find_available_port-40"><a href="#find_available_port-40"><span class="linenos">40</span></a><span class="sd">    Returns:</span>
</span><span id="find_available_port-41"><a href="#find_available_port-41"><span class="linenos">41</span></a><span class="sd">        int: The available TCP port number.</span>
</span><span id="find_available_port-42"><a href="#find_available_port-42"><span class="linenos">42</span></a>
</span><span id="find_available_port-43"><a href="#find_available_port-43"><span class="linenos">43</span></a><span class="sd">    Raises:</span>
</span><span id="find_available_port-44"><a href="#find_available_port-44"><span class="linenos">44</span></a><span class="sd">        OSError: If an error occurs during the port binding process, such</span>
</span><span id="find_available_port-45"><a href="#find_available_port-45"><span class="linenos">45</span></a><span class="sd">            as all ports being in use.</span>
</span><span id="find_available_port-46"><a href="#find_available_port-46"><span class="linenos">46</span></a>
</span><span id="find_available_port-47"><a href="#find_available_port-47"><span class="linenos">47</span></a><span class="sd">    Example:</span>
</span><span id="find_available_port-48"><a href="#find_available_port-48"><span class="linenos">48</span></a><span class="sd">        port = find_available_port()</span>
</span><span id="find_available_port-49"><a href="#find_available_port-49"><span class="linenos">49</span></a><span class="sd">        print(f&quot;Available port: {port}&quot;)</span>
</span><span id="find_available_port-50"><a href="#find_available_port-50"><span class="linenos">50</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="find_available_port-51"><a href="#find_available_port-51"><span class="linenos">51</span></a>    <span class="k">with</span> <span class="n">socketserver</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">((</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
</span><span id="find_available_port-52"><a href="#find_available_port-52"><span class="linenos">52</span></a>        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">server_address</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Finds and returns an available TCP port on the local machine.</p>

<p>This function utilizes a TCP server socket to bind to port 0, which
instructs the operating system to automatically assign an available
port. The assigned port is then extracted and returned.</p>

<p>Returns:
    int: The available TCP port number.</p>

<p>Raises:
    OSError: If an error occurs during the port binding process, such
        as all ports being in use.</p>

<p>Example:
    port = find_available_port()
    print(f"Available port: {port}")</p>
</div>


                </section>
                <section id="FileType">
                            <input id="FileType-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FileType</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="FileType-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileType"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileType-13"><a href="#FileType-13"><span class="linenos">13</span></a><span class="k">class</span><span class="w"> </span><span class="nc">FileType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="FileType-14"><a href="#FileType-14"><span class="linenos">14</span></a>    <span class="n">Database</span> <span class="o">=</span> <span class="s1">&#39;db&#39;</span>
</span><span id="FileType-15"><a href="#FileType-15"><span class="linenos">15</span></a>    <span class="n">CSV</span> <span class="o">=</span> <span class="s1">&#39;csv&#39;</span>
</span></pre></div>


    

                            <div id="FileType.Database" class="classattr">
                                <div class="attr variable">
            <span class="name">Database</span>        =
<span class="default_value">&lt;<a href="#FileType.Database">FileType.Database</a>: &#39;db&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#FileType.Database"></a>
    
    

                            </div>
                            <div id="FileType.CSV" class="classattr">
                                <div class="attr variable">
            <span class="name">CSV</span>        =
<span class="default_value">&lt;<a href="#FileType.CSV">FileType.CSV</a>: &#39;csv&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#FileType.CSV"></a>
    
    

                            </div>
                </section>
    </main>
</body>
</html>